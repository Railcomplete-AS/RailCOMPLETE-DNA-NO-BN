<!--========================================================================================================

    NO-BN-OcsPoles.xml
	
	Include in DNA file using XPPq XML preprocessor directive <xpp:expand href="fileName.xml"/>.

	Copyright (c) 2015-2024 Railcomplete AS, Norway, NO916118503
	
=========================================================================================================-->
<xpp:bloc>

<!--========================================================================================================
	Line(ca)	Contents:
	  30		CONTACT WIRE AND CATENARY SUPPORT POLES
	 850		CATENARY POLES (DROPARMS) UNDER BRIDGE OR TUNNEL CEILING
	1215		CATENARY POLES (DROPARMS) SUSPENDED FROM PORTAL (OR FROM GANTRY)
	1730		OVERHEAD CATENARY SYSTEM PORTAL AND GANTRY
	2215		End Of File
=========================================================================================================-->


<!--========================================================================================================
	HIGH VOLTAGE
	CONTACT WIRE AND CATENARY SUPPORT POLES
=========================================================================================================-->
	<!-- Note: Functions which are called from 'JBTEH_MAS KL-mast' and 'JBTEH_MAS Hengemast for bru og tunnel' and 'JBTEH_MAS Hengemast i åk': -->

	<LuaFunction Name="JBTEH_MAS_nonPortalPole_code()" ReturnType="String"
		Description="Obtains the code for the OCS pole, as a concatenation of the pole's reference mileage km-value and the current 'Seq' local variable.">
		<Signature>String JBTEH_MAS_nonPortalPole_code()</Signature>
		<Formula>
			function JBTEH_MAS_nonPortalPole_code()
				local entireKm = math.floor(ReferenceMileage/1000)
				return string.format("%d-%02d",entireKm, Seq), _info("Pole's code is inherited from reference mileage ("..ReferenceMileage..") and the local variable Seq ("..Seq..").")
			end
		</Formula>
	</LuaFunction>

	<LuaFunction Name="_JBTEH_MAS_getSpanlengths()" ReturnType="Double" 
			HideFromUser="false"
			Description="Returns a collection of dictionaries {Spanlength = [String], Wirename = [String]}, one such dictionary for each cantilever present on this catenary pole, from wireclamp to the related cantilever's next wireclamp, measured as a 2D straight-line distance.">
		<Signature>Double _JBTEH_MAS_getSpanlengths()</Signature>
		<Formula>
			function _JBTEH_MAS_getSpanlengths()
				--[[
					This function assumes that wtb and cnt are chained with a common previous/next relation. Also handles 
					wtb mounted on a tunnel wall baseplate.
					-	Start at OCS pole and find its cantilevers and wtb's, or start at or tunnel wall baseplate
						and find its wtb.
					-	Iterate over all such objects found, locate the next cantilever or wtb in sequence
					-	For each next object, store next object's contact wire name and the 
						straight-line 2D distance in the XY plane from CW wireclamp/wtb to CW wireclamp/wtb.
					Return value: 	A collection of collections, each containing the 'name' of a contact wire and the
									straight-line 2D distance to next item.
				--]]
				local tol = 1.0 --[m] Tolerance when searching for wire tension balancers at an OCS pole
				local result = {}
			
				--Find all cantilevers and WTBs at this OCS pole, but skip WTBs serving midpoint anchor lines or AT conductors, earthing wires etc:
				local rCnt = getRelatedObjects(rel_OcsPole_Has_Cantilever)
				local rWtb = getNearbyPointObjects2D(tol, rctype_WireTensioningBalancer)
								:filter(function (x) return x.Alignment == rctype_ContactWire end)
				local items = getUnionOfCollections({rCnt, rWtb})
				local nItems = getCollectionLength(items)
			
				if nItems == 0 then
					--Poles for supporting OCS portals will exist, with neither wtbs nor cantilevers at the pole.
					return {}, _info("No spanlengths")
				else
					for i = 0, nItems-1 do
						local thisItem = items[i]
						local cowName
						local p1
						if thisItem.RcType == rctype_WireTensioningBalancer then
							p1 = thisItem:getPoint3D()
							cowName = thisItem.Alignment.name
						else
							--thisItem.RcType == rctype_Cantilever:
							p1 = thisItem:NOBN_ocs_getWireClampPoint3D()
							cowName = thisItem:getRelatedObjects(rel_Cantilever_Holds_ContactWire)[0].name
						end
						local nextItems, nNextItems = thisItem:getRelatedObjects(rel_CantileverOrWtb_HasNext_CantileverOrWtb)
						--A WTB might be the terminal for a contact wire (at a buffer stop etc). Treat only those who possess a successor:
						if nNextItems &gt; 0 then
							local nextItem = nextItems[0]
							local p2
							if nextItem.RcType == rctype_WireTensioningBalancer then
								p2 = nextItem:getPoint3D()
							else
								--nextItem.RcType == rctype_Cantilever:
								p2 = nextItem:NOBN_ocs_getWireClampPoint3D()
							end
							local distance2D = RC__getDistance2D(p1, p2)
							table.insert(result,{Spanlength = RC__round(distance2D,1), Wirename = cowName})
						end
					end
				end
				return result, _info(getCollectionLength(result).." spanlength(s)")
			end
		</Formula>
	</LuaFunction>

	<LuaFunction Name="_JBTEH_MAS_SpanlengthDisplay()" ReturnType="String"
			HideFromUser="false"
			Description="Returns a text string containing the ContactWireName and Spanlength for each cantilever located on this OCS pole, from wire clamp to next canitlever's wire clamp (measured as a straight-line 2D length).">
		<Signature>String _JBTEH_MAS_SpanlengthDisplay()</Signature>
		<Formula>
			function _JBTEH_MAS_SpanlengthDisplay()
				--[[
					It is assumed that Spanlength holds a collection of dictionaries, each of which holds a
					contact wire's name [String] and its corresponding spanlength [Double].
			
					The return value has format:
			
					Show this:									...if property Spanlength is:
					=================================			=========================================================
					"-57.8-"									...a collection of just one dictionary {Spanlength = [double], Wirename = [string]}
					"L30-536 -52.6- /.../  L30-537 -37.8-"		...a collection of several such dictionaries.
				--]]
				
				local Spanlengths = getCollectionFromTable(_JBTEH_MAS_getSpanlengths())
				local nSpanlengths = getCollectionLength(Spanlengths)
				local s
				if nSpanlengths == 0 then
					return "", _info("No spanlength(s) - expected format is {{Spanlength = [double], Wirename = [string]}+}")
				elseif nSpanlengths == 1 then
					local sl = Spanlengths[0]
					return sl.Spanlength == 0 and "" or string.format("-%.01f-",sl.Spanlength)
				else
					for i = 0, nSpanlengths-1 do
						local sl = Spanlengths[i]
						if i == 0 then
							s = string.format("%s -%.01f-",sl.Wirename, sl.Spanlength)
						else
							s = s..string.format(" / %s -%.01f-",sl.Wirename, sl.Spanlength)
						end
					end
				end
				return s
			end
		</Formula>
	</LuaFunction>

	<LuaFunction Name="_JBTEH_MAS_SpanlengthTextPosition()" ReturnType="Vector2D" 
			HideFromUser="false" 
			Description="Returns a World Coordinate System offset vector for the span length custom text position attribute, by default from the object's insertion point to halfway between the concerned poles' display points. Optionally, specify offsets as [LateralOffset [,LongitudinalOffset]]). RC will adapt input offsets to the current drawing scale if different from 1:1.">
		<Signature>{Double, Double} _JBTEH_MAS_SpanlengthTextPosition(Double LateralOffset, Double LongitudinalOffset = 0)</Signature>
		<Formula>
			function _JBTEH_MAS_SpanlengthTextPosition(LateralOffset, LongitudinalOffset)
				local wcsX, wcsY = RC__getWcsVectorFromAcsVector(RC__scale((RightSided and 1 or -1)*LateralOffset, LongitudinalOffset))
				local r, n = getRelatedObjects(rel_OcsPole_HasNext_OcsPole)
				if n == 0 then
					return {wcsX, wcsY}
				else
					local target = r[0]

					--Offset from object's insertion point to the midpoint between the displaypoints for the poles that are involved:
					local startX = geoCoord.X + SymbolOffset.X
					local startY = geoCoord.Y + SymbolOffset.Y
					local endX = target.geoCoord.X + target.SymbolOffset.X
					local endY = target.geoCoord.Y + target.SymbolOffset.Y
	
					return { SymbolOffset.X + (endX - startX)/2 + wcsX, SymbolOffset.Y + (endY - startY)/2 + wcsY }
				end
			end
		</Formula>
	</LuaFunction>

	<LuaFunction Name="_JBTEH_MAS_SpanlengthTextRotation()" ReturnType="Double" 
			HideFromUser="false" 
			Description="Returns the text attribute's rotation [DD] for the shortest span length custom text rotation attribute, to place the text nicely between its two poles' display points.">
		<Signature>Double _JBTEH_MAS_SpanlengthTextRotation()</Signature>
		<Formula>
			function _JBTEH_MAS_SpanlengthTextRotation()
				local r, n = getRelatedObjects(rel_OcsPole_HasNext_OcsPole)
				if n == 0 then 
					return AlignmentTangent
				else 
					local target = r[0]
	
					--WCS angle between the displaypoints for the poles that are involved:
					local startX = geoCoord.X + SymbolOffset.X
					local startY = geoCoord.Y + SymbolOffset.Y
					local endX = target.geoCoord.X + target.SymbolOffset.X
					local endY = target.geoCoord.Y + target.SymbolOffset.Y
					return math.deg(math.atan(endY - startY, endX - startX)) + (MileageIncreasesTowardsLeft and 180 or 0)
				end
			end
		</Formula>
	</LuaFunction>

	<LuaFunction Name="JBTEH_MAS_getOtherObjectsToModelcheck()" ReturnType="String"
		Description = "Returns the number of other items to modelcheck, and a table with references to them.">
		<Signature>JBTEH_MAS_getOtherObjectsToModelcheck()</Signature>
		<Formula>
			function JBTEH_MAS_getOtherObjectsToModelcheck()
				local sPortal1 = rel_OcsPole_IsSupportFor_OcsPortal
				local sPortal2 = rel_OcsPole_IsDropArmUnder_OcsPortal
				local sSupportingPole = rel_OcsPortal_IsSupportedBy_OcsPole
				local sDropArm = rel_OcsPortal_IsDropArmSupportFor_OcsPole

				local t = {} --Collection of other objects to check
				local first = true

				local rPortal1, nPortal1 = getRelatedObjects(sPortal1)
				local rPortal2, nPortal2 = getRelatedObjects(sPortal2)
				local rPortal = getUnionOfCollections({rPortal1, rPortal2})
				local nPortal = nPortal1 + nPortal2

				for j = 0, nPortal-1 do
					table.insert(t, rPortal[j])
					txt = first and "{"..RC__identify(rPortal[j]) or txt..","..RC__identify(rPortal[j])
					first = false
					local rSupportingPole, nSupportingPole = rPortal[j]:getRelatedObjects(sSupportingPole)
					for i = 0, nSupportingPole-1 do 
						if rSupportingPole[i].id ~= this.id then
							table.insert(t, rSupportingPole[i])
							txt = txt..","..RC__identify(rSupportingPole[i])
						end
					end
					local rDropArm, nDropArm = rPortal[j]:getRelatedObjects(sDropArm)
					for i = 0, nDropArm-1 do
						if rDropArm[i].id ~= this.id then
							table.insert(t, rDropArm[i])
							txt = txt..","..RC__identify(rDropArm[i])
						end
					end
					local n = nSupportingPole + nDropArm
					return n, t, _info(n..": "..txt.."}")
				end
				return 0,{}, _info(first and "{}" or txt)
			end
		</Formula>
	</LuaFunction> 

<!-- Macro for use in JBTEH_MAS (ordinary pole, drop arm from bridge/tunnel and drop arm from portal): -->
<xpp:define name="JBTEH_MAS_CUSTOMATTRIBUTE___NEW_OR_EXISTING">
	<xpp:bloc>
		<CustomProperty DataType="Enumeration" Name="NewOrExisting" DisplayName="Ny eller eksisterende" DefaultValue="Ny"
			Description="The overhead catenary system (OCS) pole's age [Ny | Eksisterende].">
			<Values>
				<Value>Ny</Value>
				<Value>Eksisterende</Value>	
			</Values>			
		</CustomProperty>
	</xpp:bloc>
</xpp:define>

<!-- Macro for use in JBTEH_MAS (ordinary pole, drop arm from bridge/tunnel and drop arm from portal): -->
<xpp:define name="JBTEH_MAS_CUSTOMATTRIBUTE_AND_LUA___SPANLENGTH">
	<xpp:bloc>
		<CustomProperty DataType="Collection" Name="Spanlength" DisplayName="Spennlengde" DefaultValue="0.0" 
			Description="The span length (sl) [m] denotes the distance traveled along the associated alignment's reference alignment (projected onto the XY plane) from this pole to the closest next pole, related using '&quot;..rel_OcsPole_HasNext_OcsPole..&quot;'/'&quot;..rel_OcsPole_HasPrevious_OcsPole..&quot;'."/>
		<LuaExpression Name="Spanlength"><Formula>_JBTEH_MAS_getSpanlengths()</Formula></LuaExpression>
		<CustomProperty DataType="String" Name="SpanlengthDisplay" DisplayName="Spennlengde visning" DefaultValue="" 
			Description="The span length value [m] being displayed close to the OCS pole."/>
		<LuaExpression Name="SpanlengthDisplay"><Formula>_JBTEH_MAS_SpanlengthDisplay()</Formula></LuaExpression>
        <TextAttribute Annotative="true" BindingProperty="SpanlengthDisplay" CadAttributeTag="SPENNLENGDE" X="15" Y="5" 
			Layer="JBTEH@SPENNLENGDE" Justify="MiddleCenter" Height="0.9" Width="0" Rotation="0" ObliqueAngle="0" Constant="false" 
			Invisible="false" Lock="false" MText="false"/>
		<CustomProperty DataType="Double" Name="SpanlengthTextLateralOffset" DisplayName="Sideveis spennlengdetekst offset" DefaultValue="0"
			Description="The span length(s) text lateral offset [m] denotes the distance, transversal to the pole's local track direction, to offset the text element(s)."/>      
		<CustomProperty DataType="Double" Name="SpanlengthTextLongitudinalOffset" DisplayName="Longitudinal offset for Spanlength text" DefaultValue="0"
			Description="The span length(s) text longitudinal offset [m] denotes the distance, along the pole's local track direction, to offset the text element(s)."/>
		<TextPositionLuaExpression Name="SPENNLENGDE"><Formula>_JBTEH_MAS_SpanlengthTextPosition(SpanlengthTextLateralOffset, SpanlengthTextLongitudinalOffset)</Formula></TextPositionLuaExpression>
		<TextRotationLuaExpression Name="SPENNLENGDE"><Formula>_JBTEH_MAS_SpanlengthTextRotation()</Formula></TextRotationLuaExpression>
	</xpp:bloc>
</xpp:define>



	<ObjectType DataType="tOrientedElement" Class="RailwayPlacedObject" LuaName="rctype_OcsPole" Name="JBTEH_MAS KL-mast" 
				Layer="JBTEH_MAS" Color="ByLayer"
				Group="Kontaktledning/Master"
				AttMirrorX="{% if MileageIncreasesTowardsLeft %}true{% else %}false{% endif %}"
				AttMirrorY="{% if RightSided %}true{% else %}false{% endif %}"
				>
				<!-- Note: AttMirrorX is in use because the span length shall be shown on the hi-mileage side also if M.i.t.l. -->

		<RelationSpace>kl-mast</RelationSpace>
		<AttachmentCategory Name="kl-mast"/>
		
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___SYMBOLFRAME"/>
		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___VAR"/>
		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___MILEAGE_INCREASES_TOWARDS_LEFT"/>
		<xpp:expand select="NOBN_com_STD_TEXTATTRIBUTES___HORIZONTAL_AND_CLOSE___OCS"/>
		<xpp:expand select="NOBN_com_DISCIPLINE___OCS"/>
		<xpp:expand select="NOBN_com_CHK_NUMBER_OF_OCP_AREAS"/>
		<xpp:expand select="NOBN_com_SET_OCP_STATION_REFERENCE"/>
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___WAYSIDE_GENERAL_OBJECT"/>
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___EARTHED_TO_RAIL"/>

		<Variants DefaultValue="Bjelkemast">
			<Variant Name="Bjelkemast">
				<SetValue Key="OcsPoleCrossSection" Value="HEB240"/>
				<SetValue Key="OcsPoleHeight" Value="10000"/>
			</Variant>
			<Variant Name="Bjelkemast, forsterket">
				<SetValue Key="OcsPoleCrossSection" Value="HEM260"/>
				<SetValue Key="OcsPoleHeight" Value="10000"/>
			</Variant>
			<!-- TODO: Få ekte data for GMB-mastene -->
			<Variant Name="GMB-mast">
				<SetValue Key="OcsPoleCrossSection" Value="HEB240"/>
				<SetValue Key="OcsPoleHeight" Value="7500"/>
			</Variant>
			<Variant Name="H-mast">
				<SetValue Key="OcsPoleCrossSection" Value="H3"/>
				<SetValue Key="OcsPoleHeight" Value="7500"/>
			</Variant>
			<Variant Name="B-mast">
				<SetValue Key="OcsPoleCrossSection" Value="B3"/>
				<SetValue Key="OcsPoleHeight" Value="7500"/>
			</Variant>
			<Variant Name="Betongmast">
				<!-- Assuming that poles always extend 2m under ground -->
				<!-- See EH.800065 (EK.800065), concrete poles & load computations -->
				<!-- TODO 2021-03-14 Produce all concrete poles. At present, only the "13" and the "13S" series exist in 3D. -->
				<SetValue Key="OcsPoleCrossSection" Value="13"/>  
				<SetValue Key="OcsPoleDepth" Value="2000"/>
				<SetValue Key="OcsPoleHeight" Value="8000"/>
			</Variant>
			<Variant Name="Tremast">
				<SetValue Key="OcsPoleCrossSection" Value="Ø260"/>
				<SetValue Key="OcsPoleDepth" Value="1600"/>
				<SetValue Key="OcsPoleHeight" Value="7500"/>
			</Variant>
		</Variants>
		
		<xpp:expand select="JBTEH_MAS_CUSTOMATTRIBUTE___NEW_OR_EXISTING"/>

		<TextPositionLuaExpression Name="OBJEKTNAVN"><Formula>RC__TextAttributePosition(4,0)</Formula></TextPositionLuaExpression>
		<TextPositionLuaExpression Name="OBJEKTID"><Formula>RC__TextAttributePosition(22,0)</Formula></TextPositionLuaExpression>
		<TextPositionLuaExpression Name="OBJEKTINFO"><Formula>RC__TextAttributePosition(24,0)</Formula></TextPositionLuaExpression>

		<CustomProperty DataType="String" ReadOnly="true" Category="Model check" Name="mc_OtherObjectsToBeModelchecked" 
			DisplayName="Andre objekter som modelsjekkes" 
			Description="If this OCS pole supports a portal, then the portal with more poles / drop arms are modelchecked as well."
		 />
		<!-- See global definition of function JBTEH_MAS_getOtherObjectsToModelcheck() elsewhere. -->
		<LuaExpression Name="mc_OtherObjectsToBeModelchecked" IsModelCheck="true"><Formula>JBTEH_MAS_getOtherObjectsToModelcheck()</Formula></LuaExpression>

		<CustomProperty DataType="Enumeration" Name="OcsPoleCrossSection" DisplayName="Masteprofil"
			Description="The overhead catenary system (OCS) pole profile (omp) [HEB200..280 | HEM260 | H3..H6 | B2..B6 | 240x240 | Ø260].">
			<Values Variant="Bjelkemast">
				<Value>HEB280</Value>
				<Value>HEB260</Value>
				<Value>HEB240</Value>
				<Value>HEB220</Value>
				<Value>HEB200</Value>
			</Values>
			<Values Variant="Bjelkemast, forsterket">
				<Value>HEM260</Value>
			</Values>
			<!-- TODO: Få ekte data for GMB-mastene -->
			<Values Variant="GMB-mast">
				<Value>HEB280</Value>
				<Value>HEB260</Value>
				<Value>HEB240</Value>
				<Value>HEB220</Value>
				<Value>HEB200</Value>
			</Values>
			<Values Variant="H-mast">
				<Value>H6</Value>
				<Value>H5</Value>
				<Value>H3</Value>
			</Values>
			<Values Variant="B-mast">
				<!-- Note: B2:UNP120 - B3:UNP140 - B4:UNP160 - B5: UNP180 - B6:UNP200 -->
				<Value>B6</Value>
				<Value>B5</Value>
				<Value>B4</Value>
				<Value>B3</Value>
				<Value>B2</Value>
			</Values>
			<Values Variant="Betongmast">
				<!-- Se EK.800025 -->
				<!-- Kvadratiske har navn "13", "14" etc. -->
				<!-- Type 13 er 192x192 i toppen, bunnmål sidekanter ved 2+6m=263, 2+7m=274, 2+8m=285, 2+9m=296, 2+10m=308, 2+11m=320, 2+12m=333, 2+13m=346 -->
				<!-- Type 14 sidelem er 200x200, type 15 er 208x208 i topp etc.-->
				<!-- Rektangulære "smal-master" har navn "13S", "14S" etc.  -->
				<!-- Smalmast 13S har toppmål 130/239, Bunnmål 2+4m=152/296m 2+5m=158/308, 2+6m=154/320, 2+7m=171/333, 2+8m=178/346, 2+9m=185/360, 2+10m=192/374. -->
				<!-- Smalmast 14S har toppmål 130x253, 15S=130/274, 16S=130/285, 17S=130/296, 18S=130/320, 19S=130/346 -->
				<!-- Bredside smalmast type 13S er altså som type 18 mast, bredside 14S som 20-mast, 15S som 22-mast, 16S som 23-mast, 17S som 24-mast, 18S som 26, 19S som "28". (litt uten system...)-->
				<Value>27</Value>
				<Value>26</Value>
				<Value>25</Value>
				<Value>24</Value>
				<Value>23</Value>
				<Value>22</Value>
				<Value>21</Value>
				<Value>20</Value>
				<Value>19</Value>
				<Value>18</Value>
				<Value>17</Value>
				<Value>16</Value>
				<Value>15</Value>
				<Value>14</Value>
				<Value>13</Value> 	<!-- TODO: 2020-09-26 Dimensjon 13 (2+6m..2+13m) er modellert i 3D -->
				<Value>19S</Value>
				<Value>18S</Value>
				<Value>17S</Value>
				<Value>16S</Value>
				<Value>15S</Value>
				<Value>14S</Value>
				<Value>13S</Value> 	<!-- TODO: 2020-09-26 Smal dimensjon type 13S (2+6m..2+10m) er modellert i 3D -->
			</Values>
			<Values Variant="Tremast">
				<Value>Ø260</Value>
			</Values>
		</CustomProperty>
		
		<CustomProperty DataType="Enumeration" Name="OcsPoleHeight" DisplayName="Mastehøyde" DefaultValue="7000"
			Description="The overhead catenary system (OCS) pole height [mm]. The total pole length is the sum of its height and its depth.">
			<Values Variant="Bjelkemast">
				<Value>13000</Value>
				<Value>12500</Value>
				<Value>12000</Value>
				<Value>11500</Value>
				<Value>11000</Value>
				<Value>10500</Value>
				<Value>10000</Value>
				<Value>9500</Value>
				<Value>9000</Value>
				<Value>8500</Value>
				<Value>8000</Value>
				<Value>7500</Value>
				<Value>7000</Value>
				<Value>6500</Value>
				<Value>6000</Value>
			</Values>
			<Values Variant="Bjelkemast, forsterket">
				<Value>13000</Value>
				<Value>12500</Value>
				<Value>12000</Value>
				<Value>11500</Value>
				<Value>11000</Value>
				<Value>10500</Value>
				<Value>10000</Value>
				<Value>9500</Value>
				<Value>9000</Value>
				<Value>8500</Value>
				<Value>8000</Value>
			</Values>
			<Values Variant="GMB-mast">
				<!-- TODO: Få ekte data for GMB-mastene -->
				<Value>13000</Value>
				<Value>12500</Value>
				<Value>12000</Value>
				<Value>11500</Value>
				<Value>11000</Value>
				<Value>10500</Value>
				<Value>10000</Value>
				<Value>9500</Value>
				<Value>9000</Value>
				<Value>8500</Value>
				<Value>8000</Value>
				<Value>7500</Value>
				<Value>7000</Value>
				<Value>6500</Value>
				<Value>6000</Value>
			</Values>
			<Values Variant="H-mast">
				<Value>13000</Value>
				<Value>12500</Value>
				<Value>12000</Value>
				<Value>11500</Value>
				<Value>11000</Value>
				<Value>10500</Value>
				<Value>10000</Value>
				<Value>9500</Value>
				<Value>9000</Value>
				<Value>8500</Value>
				<Value>8000</Value>
				<Value>7500</Value>
				<Value>7000</Value>
				<Value>6500</Value>
				<Value>6000</Value>
			</Values>
			<Values Variant="B-mast">
				<Value>13000</Value>
				<Value>12500</Value>
				<Value>12000</Value>
				<Value>11500</Value>
				<Value>11000</Value>
				<Value>10500</Value>
				<Value>10000</Value>
				<Value>9500</Value>
				<Value>9000</Value>
				<Value>8500</Value>
				<Value>8000</Value>
				<Value>7500</Value>
			</Values>
			<Values Variant="Betongmast">
				<!-- Betongmast. Se tegning 'EK.800265-000_000_001 Betongmaster - mål og beregninger'. -->
				<!-- Mangler data her - EK.800025 sier ikke noe om hvor dypt masta må stikke -->
				<Value>13000</Value>
				<Value>12000</Value>
				<Value>11000</Value>
				<Value>10000</Value>
				<Value>9000</Value>
				<Value>8000</Value>
				<Value>7000</Value>
				<Value>6000</Value>
			</Values>
			<Values Variant="Tremast">
				<!-- Tremast er kun modellert som Ø260. Se tegning 'EH-701770-000_005_001 Tremast oppsetting og bardun fotplate'-->
				<Value>12000</Value>
				<Value>11500</Value>
				<Value>11000</Value>
				<Value>10500</Value>
				<Value>10000</Value>
				<Value>9500</Value>
				<Value>9000</Value>
				<Value>8500</Value>
				<Value>8000</Value>
				<Value>7500</Value>
				<Value>7000</Value>
				<Value>6500</Value>
				<Value>6000</Value>
			</Values>
		</CustomProperty>
		<LuaExpression Name="OcsPoleHeight"><Formula>_JBTEH_MAS_OcsPoleHeight()</Formula></LuaExpression>
		<LuaFunction Name="_JBTEH_MAS_OcsPoleHeight()" ReturnType="Double"
				HideFromUser="false"
				Description="Returns the height of the OCS pole, possibly adapted to carry a portal.">
			<Signature>Double _JBTEH_MAS_OcsPoleHeight()</Signature>
			<Formula>
				function _JBTEH_MAS_OcsPoleHeight()
					local r, n = getRelatedObjects(rel_OcsPole_IsSupportFor_OcsPortal)
					if n &gt; 0 then
						return string.format("%.0f", 500 * ((r[0].VerticalOffset + 1.0) // 0.5)) --[mm]
					else
						--Assume that the 3D library uses steps of 500 mm, assume using tall poles (for AT):
						return tostring(9500 - 500*math.floor((250 + 1000*VerticalOffset)//500)) --[mm]
					end
				end
			</Formula>
		</LuaFunction>
		
		<CustomProperty DataType="Enumeration" Name="OcsPoleDepth" DisplayName="Mastedybde" DefaultValue="0"
			Description="Only applicable to wooden and concrete poles. The overhead catenary system (OCS) pole depth below ground reference level (omd) [mm].">
			<Values Variant="Bjelkemast">
				<Value>0</Value>
			</Values>
			<Values Variant="Bjelkemast, forsterket">
				<Value>0</Value>
			</Values>
			<Values Variant="GMB-mast">
				<Value>0</Value>
			</Values>
			<Values Variant="H-mast">
				<Value>0</Value>
			</Values>
			<Values Variant="B-mast">
				<Value>0</Value>
			</Values>
			<Values Variant="Betongmast">
				<Value>2000</Value>
			</Values>
			<!-- TODO: Få ekte data for tremastene -->
			<Values Variant="Tremast">
				<Value>2000</Value>
				<Value>1800</Value>
				<Value>1600</Value> <!-- Kun nedstikk 1600 er modellert i 3D -->
			</Values>
		</CustomProperty>
		
		<!-- Span length -->
		<xpp:expand select="JBTEH_MAS_CUSTOMATTRIBUTE_AND_LUA___SPANLENGTH"/>

		<CustomProperty DataType="Boolean" Name="SupportArm" DisplayName="Support arm" DefaultValue="false"
			Description="True if the OCS pole features a support arm holding autotransformer conductors [ True | False ]."/>

		<LuaExpression Name="dir"><Formula>"both"</Formula></LuaExpression>
		<LuaExpression Name="code"><Formula>JBTEH_MAS_nonPortalPole_code()</Formula></LuaExpression>
		<LuaExpression Name="name"><Formula>code</Formula></LuaExpression>

		<LuaExpression Name="VerticalOffset"><Formula>_JBTEH_MAS_VerticalOffset()</Formula></LuaExpression>
		<LuaFunction Name="_JBTEH_MAS_VerticalOffset()" ReturnType="Double"
				HideFromUser="false"
				Description="Returns and locks the relative elevation at zero (lowest rail) for OCS pole. Delete this formula and adjust manually when other relative elevation is needed.">
			<Signature>Double _JBTEH_MAS_VerticalOffset()</Signature>
			<Formula>
				function _JBTEH_MAS_VerticalOffset()
					return 0
				end
			</Formula>
		</LuaFunction>

		<LuaExpression Name="AngularOffset"><Formula>_JBTEH_MAS_ocsPole_AngularOffset()</Formula></LuaExpression>
		<LuaFunction Name="_JBTEH_MAS_ocsPole_AngularOffset()" ReturnType="Double"
				HideFromUser="false"
				Description="Returns an angular offset, to orient the (ordinary) pole colinear with its portal (if any).">
			<Signature>Double _JBTEH_MAS_ocsPole_AngularOffset()</Signature>
			<Formula>
				function _JBTEH_MAS_ocsPole_AngularOffset()
					local pRelationName = rel_OcsPole_IsSupportFor_OcsPortal
					local pr, pn = getRelatedObjects(pRelationName)
					if pn == 0 then
						return getPropertyValue("AngularOffset"), _info("No control input - adjust angular offset manually or relate with '"..pRelationName.."' to a portal (which has second support pole).")
				
					else
						local portal = pr[0]
						local s = rel_OcsPortal_IsSupportedBy_OcsPole
						local r, n = getRelatedObjects(s, portal)
				
						if n == 0 then
							return getPropertyValue("AngularOffset"),_error,
								_info("ERROR OCS pole has bad connection to gantry '"..RC__identify(portal).."'.")
				
						elseif n == 1 then
							--Gantry:
							return getPropertyValue("AngularOffset"),
								_info("OCS pole is connected to a gantry '"..RC__identify(portal)..
								"' - adjust pole's angular offset manually or change gantry into portal (which has one more portal support poles).")
						
						elseif n == 2 then
							--Assume that the first two related poles are located at the portal's extremities:
							local m1 = r[0]
							local m2 = r[1]
							local x1 = m1.geoCoord.X		
							local y1 = m1.geoCoord.Y
							local x2 = m2.geoCoord.X
							local y2 = m2.geoCoord.Y
							local portalDir = math.deg(math.atan(y2-y1, x2-x1)) % 180.0
							local tg = getAlignmentInfo().Tangent
							local trackDir = math.deg(math.atan(tg.Y, tg.X))
							local info = "Angular Offset deduced using portal support poles '"..RC__identify(m1).."' and '"..RC__identify(m2).."'."
							return (360.0 + RC__round(90 - (trackDir - portalDir),3)) % 360.0, _info(info)
				
						else
							--TODO: Locate the two support poles at each end of portal, use this to find angular offset, then turn yourself if you 
							--are a support pole at one or the other end, or just adapt if you are in between ends.
							return getPropertyValue("AngularOffset"),
								_info("OCS pole is connected to a portal '"..RC__identify(portal).." with total 3 or more supporting poles"..
								"' - adjust pole's angular offset manually.")
						end
					end
				end
			</Formula>
		</LuaFunction>
		
		<LuaExpression Name="Geometry3D_0.Name"><Formula>_JBTEH_MAS_ocsPole_Geometry3DName()</Formula></LuaExpression>
		<LuaFunction Name="_JBTEH_MAS_ocsPole_Geometry3DName()" 
			ReturnType="String"
			Description="Obtains the 3D geometry's 'Name' for this KL pole."
			>
			<Signature>Double _JBTEH_MAS_ocsPole_Geometry3DName()</Signature>
			<Formula>
				function _JBTEH_MAS_ocsPole_Geometry3DName()
					if Variant == "Bjelkemast" then
						return "NO-BN-3D-EH-MAS-BJELKEMAST-" ..OcsPoleCrossSection .."-191x374xM36-"..OcsPoleHeight
					elseif Variant == "Bjelkemast, forsterket" then
						return "NO-BN-3D-EH-MAS-BJELKEMAST-" ..OcsPoleCrossSection .."-191x374xM36-"..OcsPoleHeight
					elseif Variant == "GMB-mast" then
						--TODO: Få ekte data for GMB-mastene, Lage 3D GMB-master
						return "NO-BN-3D-EH-MAS-GMBMAST-" ..OcsPoleCrossSection .."-" ..OcsPoleHeight
					elseif Variant == "H-mast" then
						--Assume the 191x374 modern type:
						return "NO-BN-3D-EH-MAS-GITTERMAST-" ..OcsPoleCrossSection .."-191x374xM36-"..OcsPoleHeight
					elseif Variant == "B-mast" then
						--Assume the 191x374 modern type:
						return "NO-BN-3D-EH-MAS-GITTERMAST-" ..OcsPoleCrossSection .."-191x374xM36-"..OcsPoleHeight
					elseif Variant == "Betongmast" then
						return "NO-BN-3D-EH-MAS-BETONGMAST-" ..OcsPoleCrossSection .."-"..OcsPoleDepth.."-"..OcsPoleHeight
					elseif Variant == "Tremast" then
						return "NO-BN-3D-EH-MAS-TREMAST-" ..OcsPoleCrossSection .."-"..OcsPoleDepth.."-"..OcsPoleHeight
					else
						return "Ukjent Variant ["..Variant.."]",_warning
					end
				end
			</Formula>
		</LuaFunction>

		<InsertPointObject Name="Bjelkemast" DisplayBlockName="NO-BN-2D-JBTEH_MAS-BJELKEMAST-{{SymbolMode}}" 
				DefaultSnapMode="Alignment" SnapToAlignment="true" SnapDistance="4" SubGroup="Ordinære master">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="false" RotateIfRightSideOfAlignment="true"/>
			<SetValue Key="MileageIncreasesTowardsLeft" Value="{{alignmentRotation | minus:ucsRotation | cosisnegative}}"/>
		</InsertPointObject>
		
		<InsertPointObject Name="Bjelkemast, forsterket" DisplayBlockName="NO-BN-2D-JBTEH_MAS-BJELKEMAST-FORSTERKET-{{SymbolMode}}" 
				DefaultSnapMode="Alignment" SnapToAlignment="true" SnapDistance="4" SubGroup="Ordinære master">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="false" RotateIfRightSideOfAlignment="true"/>
			<SetValue Key="MileageIncreasesTowardsLeft" Value="{{alignmentRotation | minus:ucsRotation | cosisnegative}}"/>
		</InsertPointObject>
		
		<InsertPointObject Name="GMB-mast" DisplayBlockName="NO-BN-2D-JBTEH_MAS-GMBMAST-{{SymbolMode}}" 
				DefaultSnapMode="Alignment" SnapToAlignment="true" SnapDistance="4" SubGroup="Ordinære master">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="false" RotateIfRightSideOfAlignment="true"/>
			<SetValue Key="MileageIncreasesTowardsLeft" Value="{{alignmentRotation | minus:ucsRotation | cosisnegative}}"/>
		</InsertPointObject>
		
		<InsertPointObject Name="H-mast" DisplayBlockName="NO-BN-2D-JBTEH_MAS-GITTERMAST-H-{{SymbolMode}}" 
				DefaultSnapMode="Alignment" SnapToAlignment="true" SnapDistance="4" SubGroup="Ordinære master">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="false" RotateIfRightSideOfAlignment="true"/>
			<SetValue Key="MileageIncreasesTowardsLeft" Value="{{alignmentRotation | minus:ucsRotation | cosisnegative}}"/>
		</InsertPointObject>
		
		<InsertPointObject Name="B-mast" DisplayBlockName="NO-BN-2D-JBTEH_MAS-GITTERMAST-B-{{SymbolMode}}" 
				DefaultSnapMode="Alignment" SnapToAlignment="true" SnapDistance="4" SubGroup="Ordinære master">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="false" RotateIfRightSideOfAlignment="true"/>
			<SetValue Key="MileageIncreasesTowardsLeft" Value="{{alignmentRotation | minus:ucsRotation | cosisnegative}}"/>
		</InsertPointObject>
		
		<InsertPointObject Name="Betongmast" DisplayBlockName="NO-BN-2D-JBTEH_MAS-BETONGMAST-{{SymbolMode}}" 
				DefaultSnapMode="Alignment" SnapToAlignment="true" SnapDistance="4" SubGroup="Ordinære master">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="false" RotateIfRightSideOfAlignment="true"/>
			<SetValue Key="MileageIncreasesTowardsLeft" Value="{{alignmentRotation | minus:ucsRotation | cosisnegative}}"/>
		</InsertPointObject>
		
		<InsertPointObject Name="Tremast" DisplayBlockName="NO-BN-2D-JBTEH_MAS-TREMAST-{{SymbolMode}}" 
				DefaultSnapMode="Alignment" SnapToAlignment="true" SnapDistance="4" SubGroup="Ordinære master">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="false" RotateIfRightSideOfAlignment="true"/>
			<SetValue Key="MileageIncreasesTowardsLeft" Value="{{alignmentRotation | minus:ucsRotation | cosisnegative}}"/>
		</InsertPointObject>
		
		<SymbolDefinition AllowSymbolMove="true">
			<Rotation Add180DegreesIfDirIsDown="false" AddAngle="{% if dir == 'up' %}{{270.0|plus:AngularOffset}}
														{% elsif dir == 'down' %}{{90.0|plus:AngularOffset}}
														{% elsif dir == 'both' and RightSided %}{{180.0|plus:AngularOffset}}
														{% elsif dir == 'both' and LeftSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and RightSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and LeftSided %}{{180.0|plus:AngularOffset}}
														{% else %}45.0
														{% endif %}"/>	
			<BlockNameFormat JoinBy="-">
				NO-BN-2D-JBTEH_MAS
				{% if    Variant == 'Bjelkemast' %}BJELKEMAST
				{% elsif Variant == 'Bjelkemast, forsterket' %}BJELKEMAST-FORSTERKET
				{% elsif Variant == 'GMB-mast' %}GMBMAST
				{% elsif Variant == 'B-mast' %}GITTERMAST-B
				{% elsif Variant == 'H-mast' %}GITTERMAST-H
				{% elsif Variant == 'Betongmast' %}BETONGMAST
				{% elsif Variant == 'Tremast' %}TREMAST
				{% else %}BAD_Variant_{{Variant}}
				{% endif %}
				{{SymbolMode}}
			</BlockNameFormat>
		</SymbolDefinition>
		
		<SymbolDefinition DefaultBlockName="NO-BN-2D-JBTRC_INNSETTINGSPUNKT-Schematic" DoNotIncludeInSymbolFrame="true"/>

		<DockPointDefinitions>
			<SnapPoints>
				<SnapPoint X="0.0" Y="0.0" TargetSpace="åk"/>
				<SnapPoint X="0.0" Y="0.0" TargetSpace="skilt"/>
				<SnapPoint X="0.0" Y="0.0" TargetSpace="seksjonsutliggerkonsoll"/> 
				<SnapPoint X="0.0" Y="0.0" TargetSpace="utligger"/>
				<SnapPoint X="0.0" Y="0.0" TargetSpace="kl-fundament"/> 
				<SnapPoint X="0.0" Y="0.0" TargetSpace="autotransformator"/> 
				<SnapPoint X="0.0" Y="0.0" TargetSpace="avskjerming"/> 
				<SnapPoint X="0.0" Y="0.0" TargetSpace="forankring_på_mast"/>
				<SnapPoint X="0.0" Y="0.0" TargetSpace="avspenning"/>
				<SnapPoint X="0.0" Y="0.0" TargetSpace="kl-bryter"/> 
			</SnapPoints>
		</DockPointDefinitions>
	</ObjectType>



<!--========================================================================================================
	HIGH VOLTAGE
	CATENARY DROP ARM UNDER BRIDGE OR TUNNEL CEILING
=========================================================================================================-->
	<ObjectType DataType="tOrientedElement" Class="RailwayPlacedObject" LuaName="rctype_OcsDropArmForBridgeOrTunnel" Name="JBTEH_MAS Hengemast for bru og tunnel"
				Layer="JBTEH_MAS_HGM_TUNNEL" Color="ByLayer"
				Group="Kontaktledning/Master"
				AttMirrorY="{% if RightSided %}true{% else %}false{% endif %}"
				>
				
		<RelationSpace>kl-mast</RelationSpace>

		<!-- <xpp:expand select="NOBN_xxx_DEPRECATED_MACRO___TO_BE_REMOVED"/> -->
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___SYMBOLFRAME"/>
		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___VAR"/>
		<xpp:expand select="NOBN_com_STD_TEXTATTRIBUTES___HORIZONTAL_RIGHT_SIDE___OCS"/>
		<xpp:expand select="NOBN_com_DISCIPLINE___OCS"/>
		<xpp:expand select="NOBN_com_CHK_NUMBER_OF_OCP_AREAS"/>
		<xpp:expand select="NOBN_com_SET_OCP_STATION_REFERENCE"/>
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___WAYSIDE_GENERAL_OBJECT"/>
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___EARTHED_TO_NONE"/>
 		
		<Variants DefaultValue="Hengemast for bru og tunnel">
			<Variant Name="Hengemast for bru og tunnel">
				<SetValue Key="OcsPoleCrossSection" Value="Sirkulær, Ø120"/>
				<SetValue Key="OcsPoleHeight" Value="3100"/>
			</Variant>
			<Variant Name="Hengemast Cariboni">
				<SetValue Key="OcsPoleCrossSection" Value="Rektangulær, 100x150"/>
				<SetValue Key="OcsPoleHeight" Value="3100"/>
			</Variant>
		</Variants>
		
		<xpp:expand select="JBTEH_MAS_CUSTOMATTRIBUTE___NEW_OR_EXISTING"/>

		<TextPositionLuaExpression Name="OBJEKTNAVN"><Formula>RC__TextAttributePosition(20,0)</Formula></TextPositionLuaExpression>
		<TextPositionLuaExpression Name="OBJEKTID"><Formula>RC__TextAttributePosition(22,0)</Formula></TextPositionLuaExpression>
		<TextPositionLuaExpression Name="OBJEKTINFO"><Formula>RC__TextAttributePosition(24,0)</Formula></TextPositionLuaExpression>

		<CustomProperty DataType="Enumeration" Name="OcsPoleCrossSection" DisplayName="Masteprofil" DefaultValue="Sirkulær, Ø120"
			Description="The overhead catenary system (OCS) drop arm profile (smp) [ Sirkulær, Ø120 | Kvadratisk, 100x100 | Rektangulær, 100x150 | Rektangulær, 100x200 ].">
			<Values Variant="Hengemast for bru og tunnel">
				<Value>Sirkulær, Ø120</Value>
				<Value>Kvadratisk, 100x100</Value>
				<Value>Rektangulær, 100x150</Value>
				<Value>Rektangulær, 100x200</Value>				
			</Values>
			<Values Variant="Hengemast Cariboni">
				<!-- <Value>Kvadratisk, 100x100</Value> -->
				<Value>Rektangulær, 100x150</Value>
			</Values>
		</CustomProperty>
		
		<CustomProperty DataType="Enumeration" Name="OcsPoleHeight" DisplayName="Høyde" DefaultValue="3600" 
			Description="The overhead catenary system (OCS) drop arm height [mm], given in predefined lengths 0.5m - 5.0m in 250 millimeter steps.">
			<Values Variant="Hengemast for bru og tunnel">	
				<Value>5000</Value>
				<Value>4750</Value>
				<Value>4500</Value>
				<Value>4250</Value>
				<Value>4000</Value>
				<Value>3750</Value>
				<Value>3500</Value>
				<Value>3250</Value>
				<Value>3000</Value>
				<Value>2750</Value>
				<Value>2500</Value>
				<Value>2250</Value>
				<Value>2000</Value>
				<Value>1750</Value>
				<Value>1500</Value>
				<Value>1250</Value>
				<Value>1000</Value>
				<Value>750</Value>
				<Value>500</Value>
			</Values>
			<Values Variant="Hengemast Cariboni">
				<Value>5000</Value>
				<Value>4750</Value>
				<Value>4500</Value>
				<Value>4250</Value>
				<Value>4000</Value>
				<Value>3750</Value>
				<Value>3500</Value>
				<Value>3250</Value>
				<Value>3000</Value>
				<Value>2750</Value>
				<Value>2500</Value>
				<Value>2250</Value>
				<Value>2000</Value>
				<Value>1750</Value>
				<Value>1500</Value>
				<Value>1250</Value>
				<Value>1000</Value>
				<Value>750</Value>
				<Value>500</Value>
			</Values>
        </CustomProperty>

		<!-- Span length -->
		<xpp:expand select="JBTEH_MAS_CUSTOMATTRIBUTE_AND_LUA___SPANLENGTH"/>

		<LuaExpression Name="dir"><Formula>"both"</Formula></LuaExpression>
		<LuaExpression Name="code"><Formula>JBTEH_MAS_nonPortalPole_code()</Formula></LuaExpression>
		<LuaExpression Name="name"><Formula>code</Formula></LuaExpression>

		<LuaExpression Name="VerticalOffset"><Formula>_JBTEH_MAS_DropArmUnderBridgeOrTunnel_VerticalOffset()</Formula></LuaExpression>
		<LuaFunction Name="_JBTEH_MAS_DropArmUnderBridgeOrTunnel_VerticalOffset()" ReturnType="Double"
				HideFromUser="false"
				Description="Returns the relative elevation for a OCS pole suspended from a portal, based on the portal's type and relative elevation.">
			<Signature>Double _JBTEH_MAS_DropArmUnderBridgeOrTunnel_VerticalOffset()</Signature>
			<Formula>
				function _JBTEH_MAS_DropArmUnderBridgeOrTunnel_VerticalOffset()
					local s = rel_OcsPoleOrAnchoringFootplate_Has_OcsFoundation
					local r, n = getRelatedObjects(s)
					if n == 0 then
						-- Belongs to a bridge underside (with no bolt group/foundation object), or has not (yet) received its bolt group relation:
						return 7.0, _info(
						"UNFINISHED - Relate pole with '"..rel_OcsPoleOrAnchoringFootplate_Has_OcsFoundation.."' to OCS ceiling bolt group, or delete formula and replace by actual relative height if bolt group is irrelevant.")
					else
						-- Has bolt group:
						return r[0].VerticalOffset, _info("Value obtained from foundation '"..RC__identify(r[0]).."'.")
					end
				end
			</Formula>
		</LuaFunction>

		<LuaExpression Name="Geometry3D_0.Name"><Formula>_JBTEH_MAS_DropArmForBridgeOrTunnel_Geometry3DName()</Formula></LuaExpression>
		<LuaFunction Name="_JBTEH_MAS_DropArmForBridgeOrTunnel_Geometry3DName()" 
			ReturnType="String"
			Description="Obtains the 3D geometry's 'Name' for this OCS drop arm.">
			<Signature>String _JBTEH_MAS_DropArmForBridgeOrTunnel_Geometry3DName()</Signature>
			<Formula>
				function _JBTEH_MAS_DropArmForBridgeOrTunnel_Geometry3DName()
					local h = (math.floor((250/2 + OcsPoleHeight) / 250)) * 250 -- Assume 3D models in steps of 250 mm
					if Variant == "Hengemast for bru og tunnel" then
						if (OcsPoleCrossSection == "Sirkulær, Ø120") then
							return "NO-BN-3D-EH-MAS-HENGEMAST-FOR-BRU-OG-TUNNEL-350x350xM24-Ø120-"..h
						elseif (OcsPoleCrossSection == "Kvadratisk, 100x100") then 
							return "NO-BN-3D-EH-MAS-HENGEMAST-FOR-BRU-OG-TUNNEL-350x350xM24-HUP-100x100-"..h
						elseif (OcsPoleCrossSection == "Rektangulær, 100x150") then 
							return "NO-BN-3D-EH-MAS-HENGEMAST-FOR-BRU-OG-TUNNEL-350x350xM24-HUP-100x150-"..h
						elseif (OcsPoleCrossSection == "Rektangulær, 100x200") then
							return "NO-BN-3D-EH-MAS-HENGEMAST-FOR-BRU-OG-TUNNEL-350x350xM24-HUP-100x200-"..h
						end
					elseif Variant:match("Hengemast Cariboni") then
						if (OcsPoleCrossSection == "Rektangulær, 100x150") then 
							return "NO-BN-3D-EH-MAS-HENGEMAST-FOR-BRU-OG-TUNNEL-350x350xM24-HUP-100x150-"..h
						end
					else 
						return "Bad OCS drop arm Variant ["..Variant.."].",_warning
					end
				end
			</Formula>
		</LuaFunction>
		
		<InsertPointObject Name="Hengemast for bru og tunnel" DisplayBlockName="NO-BN-2D-JBTEH_MAS-HENGEMAST-FOR-TUNNEL-OG-BRU-{{SymbolMode}}"
				DefaultSnapMode="Alignment" SnapToAlignment="true" SnapDistance="2.65" SubGroup="Hengemast for bru og tunnel">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="0"/>
		</InsertPointObject>
		
		<InsertPointObject Name="Hengemast Cariboni" DisplayBlockName="NO-BN-2D-JBTEH_MAS-HENGEMAST-CARIBONI-{{SymbolMode}}" 
				DefaultSnapMode="Alignment" SnapToAlignment="true" SnapDistance="1.2" SubGroup="Hengemast for bru og tunnel">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="0" RotateIfRightSideOfAlignment="true"/>
		</InsertPointObject>
		
		<SymbolDefinition AllowSymbolMove="true">
			<Rotation Add180DegreesIfDirIsDown="false" AddAngle="{% if dir == 'up' %}{{270.0|plus:AngularOffset}}
														{% elsif dir == 'down' %}{{90.0|plus:AngularOffset}}
														{% elsif dir == 'both' and RightSided %}{{180.0|plus:AngularOffset}}
														{% elsif dir == 'both' and LeftSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and RightSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and LeftSided %}{{180.0|plus:AngularOffset}}
														{% else %}45.0
														{% endif %}"/>	
			<BlockNameFormat JoinBy="-">
				NO-BN-2D-JBTEH_MAS
				HENGEMAST
				{% if Variant == 'Hengemast for bru og tunnel' %}FOR-TUNNEL-OG-BRU
				{% elsif Variant == 'Hengemast Cariboni' %}CARIBONI
				{% else %}BAD_Variant_{{Variant}}
				{% endif %}
				{{SymbolMode}}
			</BlockNameFormat>
		</SymbolDefinition>
		
		<SymbolDefinition DefaultBlockName="NO-BN-2D-JBTRC_INNSETTINGSPUNKT-Schematic" DoNotIncludeInSymbolFrame="true"/>

		<DockPointDefinitions>
			<SnapPoints>
				<SnapPoint X="0.0" Y="0.0" TargetSpace="skilt"/>
				<SnapPoint X="0.0" Y="0.0" TargetSpace="seksjonsutliggerkonsoll"/> 
				<SnapPoint X="0.0" Y="0.0" TargetSpace="utligger"/>
				<SnapPoint X="0.0" Y="0.0" TargetSpace="kl-fundament"/> 
				<SnapPoint X="0.0" Y="0.0" TargetSpace="avskjerming"/>
				<SnapPoint X="0.0" Y="0.0" TargetSpace="forankring_på_mast"/>
			</SnapPoints>
		</DockPointDefinitions>

	</ObjectType>

 

<!--========================================================================================================
	HIGH VOLTAGE
	CATENARY DROP ARM FROM PORTAL (OR FROM GANTRY)
=========================================================================================================-->
	<ObjectType DataType="tOrientedElement" Class="RailwayPlacedObject" LuaName="rctype_OcsDropArmUnderPortal" Name="JBTEH_MAS Hengemast i åk"
				Layer="JBTEH_MAS_HGM_ÅK" Color="ByLayer"
				Group="Kontaktledning/Master"
				AttMirrorY="{% if RightSided %}true{% else %}false{% endif %}"
				>
				
		<RelationSpace>kl-mast</RelationSpace>

		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___SYMBOLFRAME"/>
		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___VAR"/>
		<xpp:expand select="NOBN_com_STD_TEXTATTRIBUTES___HORIZONTAL_RIGHT_SIDE___OCS"/>
		<xpp:expand select="NOBN_com_DISCIPLINE___OCS"/>
		<xpp:expand select="NOBN_com_CHK_NUMBER_OF_OCP_AREAS"/>
		<xpp:expand select="NOBN_com_SET_OCP_STATION_REFERENCE"/>
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___WAYSIDE_GENERAL_OBJECT"/>
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___EARTHED_TO_NONE"/>
 		
		<Variants DefaultValue="Hengemast i åk">
			<Variant Name="Hengemast i åk">
				<SetValue Key="OcsPoleCrossSection" Value="Rektangulær, 100x150"/>
				<SetValue Key="OcsPoleHeight" Value="3100"/>
			</Variant>
		</Variants>
		
		<TextPositionLuaExpression Name="OBJEKTNAVN"><Formula>RC__TextAttributePosition(0,10)</Formula></TextPositionLuaExpression>
		<TextPositionLuaExpression Name="OBJEKTID"><Formula>RC__TextAttributePosition(2,10)</Formula></TextPositionLuaExpression>
		<TextPositionLuaExpression Name="OBJEKTINFO"><Formula>RC__TextAttributePosition(4,10)</Formula></TextPositionLuaExpression>

		<CustomProperty DataType="String" ReadOnly="true" Category="Model check" Name="mc_OtherObjectsToBeModelchecked" 
			DisplayName="Andre objekter som modelsjekkes" 
			Description="When this OCS drop arm is refreshed, then its portal with other OCS poles are modelchecked as well."
		 />
		<!-- See global definition of function JBTEH_MAS_getOtherObjectsToModelcheck() elsewhere. -->
		<LuaExpression Name="mc_OtherObjectsToBeModelchecked" IsModelCheck="true"><Formula>JBTEH_MAS_getOtherObjectsToModelcheck()</Formula></LuaExpression>

		<xpp:expand select="JBTEH_MAS_CUSTOMATTRIBUTE___NEW_OR_EXISTING"/>

		<CustomProperty DataType="Enumeration" Name="OcsPoleCrossSection" DisplayName="Masteprofil" DefaultValue="Rektangulær, 100x150"
			Description="The overhead catenary system (OCS) drop arm profile (smp) [ Kvadratisk, 100x100 | Rektangulær, 100x150 | Rektangulær, 100x200 ].">
			<Values >
				<Value>Kvadratisk, 100x100</Value>
				<Value>Rektangulær, 100x150</Value>
				<Value>Rektangulær, 100x200</Value>				
			</Values>
		</CustomProperty>
		
		<CustomProperty DataType="Enumeration" Name="OcsPoleHeight" DisplayName="Høyde" DefaultValue="3100"
			Description="The overhead catenary system (OCS) drop arm height, given in predefined lengths 1.0 - 5.0 m in 100 millimeter steps.">
			<Values >
				<Value>5000</Value>
				<Value>4900</Value>
				<Value>4800</Value>
				<Value>4700</Value>
				<Value>4600</Value>
				<Value>4500</Value>
				<Value>4400</Value>
				<Value>4300</Value>
				<Value>4200</Value>
				<Value>4100</Value>
				<Value>4000</Value>
				<Value>3900</Value>
				<Value>3800</Value>
				<Value>3700</Value>
				<Value>3600</Value>
				<Value>3500</Value>
				<Value>3400</Value>
				<Value>3300</Value>
				<Value>3200</Value>
				<Value>3100</Value>
				<Value>3000</Value>
				<Value>2900</Value>
				<Value>2800</Value>
				<Value>2700</Value>
				<Value>2600</Value>
				<Value>2500</Value>
				<Value>2400</Value>
				<Value>2300</Value>
				<Value>2200</Value>
				<Value>2100</Value>
				<Value>2000</Value>
				<Value>1900</Value>
				<Value>1800</Value>
				<Value>1700</Value>
				<Value>1600</Value>
				<Value>1500</Value>
				<Value>1400</Value>
				<Value>1300</Value>
				<Value>1200</Value>
				<Value>1100</Value>
				<Value>1000</Value>
			</Values>
        </CustomProperty>
		
		<CustomProperty DataType="Double" Name="DropArmAlongOffset" DisplayName="Hengemast offset langs egen akse" DefaultValue="0"
			Description="The drop arm's offset from center of portal, colinear to the drop arm's own alignments' tangent direction.">
		</CustomProperty>
		
		<!-- Span length -->
		<xpp:expand select="JBTEH_MAS_CUSTOMATTRIBUTE_AND_LUA___SPANLENGTH"/>

		<LuaExpression Name="dir"><Formula>"both"</Formula></LuaExpression>
	
		<LuaExpression Name="code"><Formula>_JBTEH_MAS_DropArmUnderPortal_code()</Formula></LuaExpression>
			<LuaFunction Name="_JBTEH_MAS_DropArmUnderPortal_code()" 
				ReturnType="String"
				Description="Obtains the code for this OCS drop arm.">
				<Signature>String _JBTEH_MAS_DropArmUnderPortal_code()</Signature>
				<Formula>
				function _JBTEH_MAS_DropArmUnderPortal_code()
					local portalRelation = rel_OcsPole_IsDropArmUnder_OcsPortal
					local portals, nPortals = getRelatedObjects(portalRelation)
					if nPortals == 0 then
						return "UNFINISHED - Relate with '"..portalRelation.."'."
					elseif nPortals &gt; 1 then
							return _warning, "UNFINISHED - Suspended OCS pole belongs to more than one portal "
									.." - remove unintended relations '"..portalRelation.."' or adjust the active stage using layer names."
					else
						--One portal:
						local rSupportPoles, nSupportPoles = getRelatedObjects(rel_OcsPortal_IsSupportedBy_OcsPole, portals[0]) 
						if nSupportPoles == 0 then 
							return "UNFINISHED - Cannot deduce suspended OCS pole name since portal '"..RC__identify(portals[0]).."' has no support pole yet."
						else
							--Find the reference support pole - being closest to the portal's own insertion point (there may be many portal support poles):
							local shortestDist = math.huge
							local referenceSupportPole = nil 
							for i = 0, nSupportPoles-1 do
								local newDist = RC__getDistance2D(portals[0].geoCoord, rSupportPoles[i].geoCoord)
								if newDist &lt; shortestDist then
									shortestDist = newDist
									referenceSupportPole = i
								end
							end
					
							--Start suspended pole's code with support pole's code,
							--assign sequence number to this suspended OCS pole (counted from the support pole closest to portal's insertion point):
							local rDropArms, nDropArms = getRelatedObjects(rel_OcsPortal_IsDropArmSupportFor_OcsPole, portals[0])
					
							local sequenceNumber = 0
							for i = 0, nDropArms-1 do
								if rDropArms[i].id == this.id then
									sequenceNumber = i + 1
								end
							end
							return rSupportPoles[referenceSupportPole].code..string.format("-%02d",sequenceNumber),
								_info("Code deduced from portal '"..portals[0].code.."' and its related components.")
						end
					end
				end
			</Formula>
		</LuaFunction>

		<LuaExpression Name="name"><Formula>code</Formula></LuaExpression>

		<LuaExpression Name="Mileage"><Formula>_JBTEH_MAS_DropArmUnderPortal_Mileage(DropArmAlongOffset)</Formula></LuaExpression>
		<LuaFunction Name="_JBTEH_MAS_DropArmUnderPortal_Mileage()" ReturnType="Double"
			Description="Deduces the portal drop arm's mileage, based on its relation to a portal/gantry and this one's support pole(s). If provided, the offset is added to the computed mileage.">
			<Signature>Double _JBTEH_MAS_DropArmUnderPortal_Mileage([Double offset])</Signature>
			<Formula>
				function _JBTEH_MAS_DropArmUnderPortal_Mileage(offset)
					offset = offset or 0.0 --Note: The offset is "brutally" added to mileage, also when the portal does not cross tracks at a straight angle.
					local ps = rel_OcsPole_IsDropArmUnder_OcsPortal
					local pr, pn = getRelatedObjects(ps)
					if pn == 0 then
						return getPropertyValue("Mileage"), _info("UNFINISHED - Relate to portal/gantry with '"..ps.."' to set mileage automatically.")
				
					elseif pn &gt; 1 then
						return _error, getPropertyValue("Mileage"),
							_info("ERROR - Drop arm is related to more than one portal ("..RC__identify(pr[0])..", "..RC__identify(pr[1])..").")
						
					else
						--pn == 1
						local portal = pr[0]
						local s = rel_OcsPortal_IsSupportedBy_OcsPole
						local r, n = getRelatedObjects(s, portal)
						if n == 0 then
							return offset + portal.Mileage,
								_info("Mileage was deduced from a portal/gantry lacking support pole(s) '"..RC__identify(portal).."'.")
					
						elseif n == 1 then 
							--Gantry:
							return offset + RC__getMileageFromRelatedObject(s, portal), _info("Mileage deduced from support pole '"..RC__identify(portal).."'.")
							
						elseif n &gt;= 2 then
							--Our drop arm is suspended from a portal being supported by two OCS poles:
							local p1 = r[0]
							local p2 = r[1]
							local x1 = p1.geoCoord.X		
							local y1 = p1.geoCoord.Y
							local dx = p2.geoCoord.X - x1
							local dy = p2.geoCoord.Y - y1
							
							--Find point Q on the straight line betweeen p1 and p2 with the portal drop arm's specified DistanceToAlignment:
							local function err(t) 
								local Qx = x1 + t*dx  
								local Qy = y1 + t*dy  
								return getAlignmentInfo(Alignment.id, Qx, Qy).DistanceToAlignment - this.DistanceToAlignment
							end
							local tq = getZeros(err,{tolerance = 1e-4, interval = {0,1}, timeLimit = 3})[0]
							local Qx = x1 + tq*dx  
							local Qy = y1 + tq*dy  
							return offset + getAlignmentInfo(Alignment.id, Qx, Qy).Mileage
						end
					end
				end
			</Formula>
		</LuaFunction>

		<!-- Crude formula - mounted with a few cm above top of its portal: -->
		<LuaExpression Name="VerticalOffset"><Formula>_JBTEH_MAS_DropArmUnderPortal_VerticalOffset()</Formula></LuaExpression>
		<LuaFunction Name="_JBTEH_MAS_DropArmUnderPortal_VerticalOffset()" 
				ReturnType="Double"
				HideFromUser="false"
				Description="Returns the relative elevation for a drop arm under a portal, based on the portal's type and relative elevation.">
			<Signature>Double _JBTEH_MAS_DropArmUnderPortal_VerticalOffset()</Signature>
			<Formula>
				function _JBTEH_MAS_DropArmUnderPortal_VerticalOffset()
					local extensionAboveTopOfPortal = 0.10
					local s = rel_OcsPole_IsDropArmUnder_OcsPortal
					local r, n = getRelatedObjects(s)
					if n == 0 then
						return 0.0, _info("UNFINISHED - Relate with '"..s.."' to its OCS portal.") 
					else 
						local e = (r[0].geoCoord.Z - getAlignmentInfo().Elevation) --Portal's elevation above this drop arm's own alignment
						local v = r[0].Variant
						if v == "Type 12" then return e + 0.8 + extensionAboveTopOfPortal
						elseif v == "OCS gantry" then return e + 0.8 + extensionAboveTopOfPortal --Uses Type 12, 6m.
						elseif v == "Type 14" then return e + 1.2 + extensionAboveTopOfPortal
						elseif v == "Type 40" then return e + 0.4 + extensionAboveTopOfPortal
						else
							return 0.0, _error, _info("Bad related OCS portal '"..RC__identify(r[0]).."' Variant: ["..v.."].")
						end
					end
				end
			</Formula>
		</LuaFunction>

		<LuaExpression Name="AngularOffset"><Formula>_JBTEH_MAS_DropArmUnderPortal_AngularOffset()</Formula></LuaExpression>
		<LuaFunction Name="_JBTEH_MAS_DropArmUnderPortal_AngularOffset()" ReturnType="Double"
				HideFromUser="false"
				Description="Returns an angular offset, to orient the drop arm colinearly with its portal (if any).">
			<Signature>Double _JBTEH_MAS_DropArmUnderPortal_AngularOffset()</Signature>
			<Formula>
				function _JBTEH_MAS_DropArmUnderPortal_AngularOffset()
					local ps = rel_OcsPole_IsDropArmUnder_OcsPortal
					local pr, pn = getRelatedObjects(ps)
					if pn == 0 then
						return getPropertyValue("AngularOffset"), _info("UNFINISHED - relate drop arm to portal with '"..ps.."'.")
				
					else
						local portal = pr[0]
						local s = rel_OcsPortal_IsSupportedBy_OcsPole
						local r, n = getRelatedObjects(s, portal)
				
						if n == 0 then
							return getPropertyValue("AngularOffset"),_error,
								_info("ERROR Drop arm has bad connection to gantry '"..RC__identify(portal).."'.")
				
						elseif n == 1 then
							--Gantry:
							return getPropertyValue("AngularOffset"),
								_info("DropArm is connected to a gantry '"..RC__identify(portal)..
								"' - adjust drop arm's angular offset manually or change gantry into portal (which has one more portal support pole).")
						
						elseif n == 2 then
							--Assume that the first two related poles are located at the portal's extremities:
							local p1 = r[0]
							local p2 = r[1]
							local x1 = p1.geoCoord.X		
							local y1 = p1.geoCoord.Y
							local x2 = p2.geoCoord.X
							local y2 = p2.geoCoord.Y
							local portalDir = math.deg(math.atan(y2-y1, x2-x1)) % 180.0
							local tg = getAlignmentInfo().Tangent
							local trackDir = math.deg(math.atan(tg.Y, tg.X))
							local info = "Angular Offset deduced using portal support poles '"..RC__identify(p1).."' and '"..RC__identify(p2).."'."
							return (360.0 + RC__round(90 - (trackDir - portalDir),3)) % 360.0, _info(info)
				
						else
							--TODO: Locate the two support poles at each end of portal, uses this to find angular offset, then turn yourself if you 
							--are a support pole at one or the other end, or just adapt if you are in between ends.
							return getPropertyValue("AngularOffset"),
								_info("DropArm is connected to a portal '"..RC__identify(portal).." with total 3 or more supporting poles"..
								"' - adjust pole's angular offset manually.")
						end
					end
				end
			</Formula>
		</LuaFunction>

		<LuaExpression Name="Geometry3D_0.Name"><Formula>_JBTEH_MAS_DropArmUnderPortal_Geometry3DName()</Formula></LuaExpression>
		<LuaFunction Name="_JBTEH_MAS_DropArmUnderPortal_Geometry3DName()" 
			ReturnType="String"
			Description="Obtains the 3D geometry's 'Name' for this OCS drop arm.">
			<Signature>String _JBTEH_MAS_DropArmUnderPortal_Geometry3DName()</Signature>
			<Formula>
				function _JBTEH_MAS_DropArmUnderPortal_Geometry3DName()
					return "NO-BN-3D-EH-MAS-HENGEMAST-I-ÅK-HUP-"..(OcsPoleCrossSection:match("(%d+x%d+)")).."-"..OcsPoleHeight
				end
			</Formula>
		</LuaFunction>

		<InsertPointObject Name="Hengemast i åk" DisplayBlockName="NO-BN-2D-JBTEH_MAS-HENGEMAST-I-ÅK-{{SymbolMode}}" 
				DefaultSnapMode="Alignment" SnapToAlignment="true" SnapDistance="2.65" SubGroup="Hengemast i åk">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="true"/> 
		</InsertPointObject>
		
		<SymbolDefinition AllowSymbolMove="true" DefaultBlockName="NO-BN-2D-JBTEH_MAS-HENGEMAST-I-ÅK-{{SymbolMode}}">
			<Rotation Add180DegreesIfDirIsDown="false" AddAngle="{% if dir == 'up' %}{{270.0|plus:AngularOffset}}
														{% elsif dir == 'down' %}{{90.0|plus:AngularOffset}}
														{% elsif dir == 'both' and RightSided %}{{180.0|plus:AngularOffset}}
														{% elsif dir == 'both' and LeftSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and RightSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and LeftSided %}{{180.0|plus:AngularOffset}}
														{% else %}45.0
														{% endif %}"/>	
		</SymbolDefinition>
		
		<SymbolDefinition DefaultBlockName="NO-BN-2D-JBTRC_INNSETTINGSPUNKT-Schematic" DoNotIncludeInSymbolFrame="true"/>

		<DockPointDefinitions>
			<SnapPoints>
				<SnapPoint X="0.0" Y="0.0" TargetSpace="skilt"/>
				<SnapPoint X="0.0" Y="0.0" TargetSpace="seksjonsutliggerkonsoll"/> 
				<SnapPoint X="0.0" Y="0.0" TargetSpace="utligger"/>
				<SnapPoint X="0.0" Y="0.0" TargetSpace="avskjerming"/>
				<SnapPoint X="0.0" Y="0.0" TargetSpace="forankring_på_mast"/>
			</SnapPoints>
		</DockPointDefinitions>

	</ObjectType>



<!--========================================================================================================
	HIGH VOLTAGE
	OVERHEAD CATENARY SYSTEM PORTAL AND GANTRY
=========================================================================================================-->
	<ObjectType DataType="tOrientedElement" Class="RailwayPlacedObject" LuaName="rctype_OcsPortal" Name="JBTEH_AAK Åk"
				Layer="JBTEH_AAK" Color="ByLayer"
				Group="Kontaktledning/Åk"
				AttMirrorY="{% if RightSided %}true{% else %}false{% endif %}"
				>
				
		<RelationSpace>åk</RelationSpace>
		<AttachmentCategory Name="åk"/>

		<!-- <xpp:expand select="NOBN_xxx_DEPRECATED_MACRO___TO_BE_REMOVED"/> -->
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___SYMBOLFRAME"/>
		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___VAR"/>
		<xpp:expand select="NOBN_com_STD_TEXTATTRIBUTES___HORIZONTAL_AND_MEDIUM_FAR___OCS"/>
		<xpp:expand select="NOBN_com_DISCIPLINE___OCS"/>
		<xpp:expand select="NOBN_com_CHK_NUMBER_OF_OCP_AREAS"/>
		<xpp:expand select="NOBN_com_SET_OCP_STATION_REFERENCE"/>
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___EARTHED_TO_NONE"/>
		
		<Variants DefaultValue="Type 12">
			<Variant Name="Type 12">
				<SetValue Key="code" Value="Type 12"/>
				<SetValue Key="Length" Value="11m"/>
			</Variant>
			<Variant Name="Type 14">
				<SetValue Key="code" Value="Type 14"/>
				<SetValue Key="Length" Value="28m"/>
			</Variant>
			<Variant Name="Type 40">
				<SetValue Key="code" Value="Type 40"/>
				<SetValue Key="Length" Value="10m"/>
			</Variant>
			<Variant Name="OCS gantry">
				<SetValue Key="code" Value="OCS gantry"/>
			</Variant>
		</Variants>
		
		<DynamicProperty Type="Representation3D" Subtype="Geometry3D"/>
		
		<CustomProperty DataType="Enumeration" Name="Length" DisplayName="Lengde" DefaultValue="11m"
			Description="The overhead catenary system (OCS) portal length (oyl), given in predefined lengths in 1 meter steps. Each may be composed of subparts, where the joints may hinder drop arm mounting.">
			<Values Variant="Type 12">
				<Value Description="Type XXIII">33m</Value>
				<Value>32m</Value>
				<Value>31m</Value>
				<Value>30m</Value>
				<Value>29m</Value>
				<Value>28m</Value>
				<Value>27m</Value>
				<Value>26m</Value>
				<Value>25m</Value>
				<Value>24m</Value>
				<Value>23m</Value>
				<Value>22m</Value>
				<Value>21m</Value>
				<Value>20m</Value>
				<Value>19m</Value>
				<Value>18m</Value>
				<Value>17m</Value>
				<Value>16m</Value>
				<Value>15m</Value>
				<Value>14m</Value>
				<Value>13m</Value>
				<Value>12m</Value>
				<Value>11m</Value>
			</Values>
			<Values Variant="Type 14">
				<Value>43m</Value>
				<Value>42m</Value>
				<Value>41m</Value>
				<Value>40m</Value>
				<Value>39m</Value>
				<Value>38m</Value>
				<Value>37m</Value>
				<Value>36m</Value>
				<Value>35m</Value>
				<Value>34m</Value>
				<Value>33m</Value>
				<Value>32m</Value>
				<Value>31m</Value>
				<Value>30m</Value>
				<Value>29m</Value>
				<Value>28m</Value>
			</Values>
			<Values Variant="Type 40">
				<Value>16m</Value>
				<Value>15m</Value>
				<Value>14m</Value>
				<Value>13m</Value>
				<Value>12m</Value>
				<Value>11m</Value>
				<Value>10m</Value>
			</Values>
			<Values Variant="OCS gantry">
				<Value>6m</Value>
			</Values>
		</CustomProperty>

		<CustomProperty DataType="String" ReadOnly="true" Category="Model check" Name="mc_OtherObjectsToBeModelchecked" 
			DisplayName="Andre objekter som modelsjekkes" 
			Description="The number of other items to modelcheck, and a table with references to them."
		 />
		<LuaExpression Name="mc_OtherObjectsToBeModelchecked" IsModelCheck="true"><Formula>_JBTEH_AAK_getOtherObjectsToModelcheck()</Formula></LuaExpression>
		<LuaFunction Name="_JBTEH_AAK_getOtherObjectsToModelcheck()" ReturnType="String"
			Description="Returns the number of other items to modelcheck, and a table with references to them.">
			<Signature>_JBTEH_AAK_getOtherObjectsToModelcheck()</Signature>
			<Formula>
				function _JBTEH_AAK_getOtherObjectsToModelcheck()
					local sPole = rel_OcsPortal_IsSupportedBy_OcsPole
					local rPole, nPole = getRelatedObjects(sPole)
					local t = {} --Collection of other objects to check
					local first = true
					local txt = ""
					for i = 0, nPole-1 do 
						table.insert(t, rPole[i])
						txt = first and "{"..RC__identify(rPole[i]) or txt..","..RC__identify(rPole[i])
						first = false
					end
					local sDropArm = rel_OcsPortal_IsDropArmSupportFor_OcsPole
					local rDropArm, nDropArm = getRelatedObjects(sDropArm)
					for i = 0, nDropArm-1 do
						table.insert(t, rDropArm[i])
						txt = first and "{"..RC__identify(rDropArm[i]) or txt..","..RC__identify(rDropArm[i])
						first = false
					end
					local n = nPole + nDropArm
					if n == 0 then
						return 0,{}, _info("{}")
					else
						return n, t, _info(n..": "..txt.."}")
					end
				end
			</Formula>
		</LuaFunction> 

		<LuaExpression Name="name"><Formula>"KL-åk "..code.." ("..Variant..", "..Length..")"</Formula></LuaExpression>
		<LuaExpression Name="dir"><Formula>"both"</Formula></LuaExpression>

        <LuaExpression Name="LateralOffset"><Formula>_JBTEH_AAK_LateralOffset()</Formula></LuaExpression>
		<LuaFunction Name="_JBTEH_AAK_LateralOffset()" ReturnType="Enum"
			Description="Returns the distance to alignment for the portal.">
			<Signature>Double _JBTEH_AAK_LateralOffset()</Signature>
			<Formula>
				function _JBTEH_AAK_LateralOffset()
					-- Ref Bane NOR, lærebok "Bygging av kontaktledningsanlegg" Del 2:2, Kap. 14
				
					function _JBTEH_AAK_get_supportPoleLateralOffset(pole)
						if pole.Alignment == nil then 
							return RightSided and 1e-3 or -1e-3, _warning, _info("Closest OCS support pole is not connected to a track (own alignment).")
						else
							local mv = pole.Variant
							local mp = pole.OcsPoleCrossSection
							local d
							if mv:match("Bjelkemast") then
								d = string.sub(mp,4,6)/2000 --Assume pole profile names "HEB200", "HEB220" etc
							elseif mv:match("GMB%-mast") then
								d = string.sub(mp,4,6)/2000 --Assume pole profile names "HEB200", "HEB220" etc TODO: Find the real profile for Gardermobanen pole
							elseif mv:match("B%-mast") then
								d = (pole.OcsPoleHeight - VerticalOffset) * math.tan(23/1000000)
							elseif mv:match("H%-mast") then
								d = (pole.OcsPoleHeight - VerticalOffset) * math.tan(1/50000)
							elseif mv:lower():match("hengemast") then
								if (mp == 'Sirkulær, Ø120') then 
									d = 0.06
								elseif (mp == 'Kvadratisk, 100x100') then 
									d = 0.05
								elseif (mp == 'Rektangulær, 100x150') then
									d = 0.075
								elseif (mp == 'Rektangulær, 100x200') then 
									d = 0.1
								else
									return 0, _warning, _info("Bad OCS pole profile ["..mp.."].")
								end
							else 
								return 0, _warning, _info("Bad OCS pole variant ["..mv.."].")
							end
							-- OCS pole and portal may belong to different tracks (when OCS pole is located between tracks):
							local mdist = getAlignmentInfo(Alignment.id, pole.geoCoord.X, pole.geoCoord.Y).DistanceToAlignment --Distance from center closest OCS pole to portal's alignment
							if (pole.RightSided) then
								if (pole.Alignment.id == Alignment.id) then return mdist-d else return mdist+d end
							else
								if (pole.Alignment.id == Alignment.id) then return mdist+d else return mdist-d end
							end
						end
					end --function
				
					local s = rel_OcsPortal_IsSupportedBy_OcsPole
					local r, n = getRelatedObjects(s)

					if n == 0 then
						if Variant == "OCS gantry" then
							--Merk: Utliggeråk benytter en 6m mellomramme for Åk type 12.
							return getPropertyValue("LateralOffset"),_warning, _info("UNFINISHED: Relate gantry to an OCS pole with relation '"..s.."'.")
						else
							return getPropertyValue("LateralOffset"),_warning, _info(
								"UNFINISHED: Relate portal to OCS pole(s) with relation '"..s.."', or change Variant to gantry.")
						end
				
					elseif n == 1 then
						if Variant == "OCS gantry" then 
							--Merk: Utliggeråk benytter en 6m mellomramme for Åk type 12.
							return _JBTEH_AAK_get_supportPoleLateralOffset(r[0]), _info("Gantry portal (Utliggeråk) extending from pole '"..RC__identify(r[0]).."'.")
						else
							return getPropertyValue("LateralOffset"),_warning, _info(
								"UNFINISHED: Relate portal to one more OCS pole with relation '"..rel_OcsPortal_IsSupportedBy_OcsPole.."', or change Variant to gantry.")
						end
				
					elseif n &gt;= 2 then 
						local m1 = r[0]
						local m2 = r[1]
						if RC__getDistance2D(this, m1) &gt; RC__getDistance2D(this, m2) then m1, m2 = m2, m1 end 
						local d1 = RC__getDistance2D(m1, m2)
						local L = math.floor(1.500 + d1) --Assume min 0.5 and max 1.5 meter total portal length overshoot
						local d2 = 0.5 * (L - d1) --Share overshoot between poles
						local x1 = m1.geoCoord.X		
						local y1 = m1.geoCoord.Y
						local x2 = m2.geoCoord.X
						local y2 = m2.geoCoord.Y
						local x = x1 - (d2/d1)*(x2-x1)
						local y = y1 - (d2/d1)*(y2-y1)
						local info = "Distance to alignment deduced through support pole '"..RC__identify(m1).."' related by '"..s.."'."
						return getAlignmentInfo(Alignment.id, x, y).DistanceToAlignment, _info(info)
					end
				end
			</Formula>
		</LuaFunction>

		<!-- Ref lærebok del 2:2 side 86 punkt 14.8 - utregning av standard høyde underkant åk over høyeste spors SOK -->

		<LuaExpression Name="Geometry3D_0.Rotation.Z"><Formula>NOBN_trk_getYawFromDir()</Formula></LuaExpression>

		<LuaExpression Name="Length"><Formula>_JBTEH_AAK_Length()</Formula></LuaExpression>
		<LuaFunction Name="_JBTEH_AAK_Length()" ReturnType="Enum"
			Description="Returns the length of the portal, being the support's pole-to-pole center distance plus 1.50 meter, rounded down.">
			<Signature>Enum _JBTEH_AAK_Length()</Signature>
			<Formula>
				function _JBTEH_AAK_Length()
					-- Ref Bane NOR, lærebok "Bygging av kontaktledningsanlegg" Del 2:2, Kap. 14
					local RelationName = rel_OcsPortal_IsSupportedBy_OcsPole
					local r, n = getRelatedObjects(RelationName)
					local L
					if n == 0 then
						if Variant == "OCS gantry" then 
							--Merk: Utliggeråk benytter en 6m mellomramme for Åk type 12. Se sammenstillingstegning E-7507 = EH-707507, samt mellomramme 6m type 12 = EH-707448.
							L = "6m"
							return L, _warning, _info("UNFINISHED: Relate gantry to an OCS pole with relation '"..RelationName.."'.")
						else
							if Variant == "Type 12" then L = "11m"
							elseif Variant == "Type 14" then L = "28m"
							elseif Variant == "Type 40" then L = "10m"
							end
							return L, _warning, _info(
								"UNFINISHED: Relate portal to OCS pole(s) with relation '"..RelationName.."', or change Variant to gantry (Utliggeråk).")
						end
				
					elseif n == 1 then
						local m1 = r[0]
						if Variant == "OCS gantry" then 
							return "6m", _info("Gantry portal (Utliggeråk) extending from OCS pole "..m1.code..".")
						else
							if Variant == "Type 12" then L = "11m"
							elseif Variant == "Type 14" then L = "28m"
							elseif Variant == "Type 40" then L = "10m"
							end
							return L, _warning, _info(
								"UNFINISHED: Relate portal to one more OCS poles with relation '"..RelationName.."', or change Variant to gantry (Utliggeråk).")
						end
				
					elseif n &gt;= 2 then 
						local m1 = r[0]
						local m2 = r[1]
						local p1 = m1.geoCoord
						local p2 = m2.geoCoord
						local len = RC__getDistance2D(p1, p2)
						L = math.floor(len + 1.5)
						if Variant == "Type 12" then
							if L &lt; 11 then return "11m",_warning, _info("L="..L.." required, but Type 12 portals can't be shorter than 11 meter. Change to type 40 or gantry (Utliggeråk).")
							elseif L &gt; 33 then return "33m",_warning, _info("L="..L.." required, but Type 12 portals can't be longer than 33 meter, change to Type 14.")
							end
						elseif Variant == "Type 14" then
							if L &lt; 28 then return "28m",_warning, _info("L="..L.." required, but Type 14 portals can't be made shorter than 28 meter. Change to Type 12 or 40.")
							elseif L &gt; 43 then return "43m",_warning, _info("L="..L.." required, but Type 14 portals can't be made longer than 43 meter.")
							end
						elseif Variant == "Type 40" then
							if L &lt; 10 then return "10m",_warning, _info("L="..L.." required, but Type 40 portals can't be made shorter than 10 meter. Change to gantry (Utliggeråk).")
							elseif L &gt; 16 then return "16m",_warning, _info("L="..L.." required, but Type 40 portals can't be made longer than 16 meter, change to Type 12 or 14.")
							end
						else
							return getPropertyValue("Length"),_error, _info("Remove excess portal support pole(s), or change portal Variant into Type 12/14/40.")
						end
						return L.."m", _info("Length deduced from support pole "..m1.code.." and "..m2.code.." ("..RC__round(len,3).." m).")
					end
				end
			</Formula>
		</LuaFunction>
		
		<LuaExpression Name="AngularOffset"><Formula>_JBTEH_AAK_AngularOffset()</Formula></LuaExpression>
		<LuaFunction Name="_JBTEH_AAK_AngularOffset()" ReturnType="Double"
			HideFromUser="false"
			Description="Returns the angular offset needed to orient the portal between its two poles, or a gantry according to its pole.">
			<Signature>Double _JBTEH_AAK_AngularOffset()</Signature>
			<Formula>
				function _JBTEH_AAK_AngularOffset()
					local RelationName = rel_OcsPortal_IsSupportedBy_OcsPole
					local r, n = getRelatedObjects(RelationName)

					if n == 0 then
						return getPropertyValue("AngularOffset"), _info("No control input - adjust angular offset manually. Relate to one (gantry) or two (portal) poles using '"..RelationName.."' to set angular offset automatically.")

					elseif n == 1 then 
						-- Gantry "åk-unge", "utliggeråk"
						-- Assume gantry belongs to same alignment as the supporting OCS pole
						return r[0].AngularOffset, _info("AngularOffset for gantry deduced from object '"..RC__identify(r[0]).."' related by '"..RelationName.."'.")

					elseif n == 2 then 
						--Assume that the first two related OCS poles are located at the portal's extremities:
						local m1 = r[0]
						local m2 = r[1]
						local x1 = m1.geoCoord.X
						local y1 = m1.geoCoord.Y
						local x2 = m2.geoCoord.X
						local y2 = m2.geoCoord.Y
						local portalDir = math.deg(math.atan(y2-y1, x2-x1))
						local tg = getAlignmentInfo().Tangent
						local trackDir = math.deg(math.atan(tg.Y, tg.X)) - RC__getAngleFromDir()
						local info = "AngularOffset for portal deduced from its support poles '"..
							RC__identify(m1).."' and '"..RC__identify(m2).."' related by '"..RelationName.."'."
						return RC__round((2*360 + portalDir - trackDir) % 360, 3), _info(info)

					else
						--TODO: Locate the two support poles at each end of portal, uses thes to find angular offset, then turn yourself if you 
						--are a support pole at one or the other end, or just adapt if you are in between ends.
						return getPropertyValue("AngularOffset"),
							_info("Mast is connected to a portal '"..RC__identify(portal).." with total 3 or more supporting poles"..
							"' - adjust pole's angular offset manually.")
					end
				end
			</Formula>
		</LuaFunction>

		<LuaExpression Name="Mileage"><Formula>_JBTEH_AAK_Mileage()</Formula></LuaExpression>
		<LuaFunction Name="_JBTEH_AAK_Mileage()" ReturnType="Double"
			Description="Deduces the gantry's / portal's mileage, based on relation to one or two portal support poles.">
			<Signature>Double _JBTEH_AAK_Mileage()</Signature>
			<Formula>
				function _JBTEH_AAK_Mileage()
					local s = rel_OcsPortal_IsSupportedBy_OcsPole
					local r, n = getRelatedObjects(s)
					if n == 0 then
						return getPropertyValue("Mileage"),
							_info("No control input - adjust mileage manually. Relate portal to one or two poles using '"..s.."' to set mileage automatically.")
				
					elseif n == 1 then 
						-- Move to related mast (assuming gantry (Utliggeråk))
						return RC__getMileageFromRelatedObject(s), _info("Mileage deduced from support pole '"..RC__identify(r[0]).."'.")
						
					elseif n &gt;= 2 then
						local m1 = r[0]
						local m2 = r[1]
						if RC__getDistance2D(this, m1) &gt; RC__getDistance2D(this, m2) then m1, m2 = m2, m1 end 
						local d1 = RC__getDistance2D(m1, m2)
						local L = math.floor(1.500 + d1) --Assume min 0.5 and max 1.5 meter total portal length overshoot
						local d2 = 0.5 * (L - d1) --Share overshoot between poles
						local x1 = m1.geoCoord.X		
						local y1 = m1.geoCoord.Y
						local x2 = m2.geoCoord.X
						local y2 = m2.geoCoord.Y
						local x = x1 - (d2/d1)*(x2-x1)
						local y = y1 - (d2/d1)*(y2-y1)
						local info = "Mileage deduced through support pole '"..RC__identify(m1).."' related by '"..s.."'."
						return getAlignmentInfo(Alignment.id, x, y).Mileage, _info(info)
					end
				end
			</Formula>
		</LuaFunction>

		<LuaExpression Name="Geometry3D_0.Name"><Formula>_JBTEH_AAK_Geometry3DName()</Formula></LuaExpression>
		<LuaFunction Name="_JBTEH_AAK_Geometry3DName()" ReturnType="String"
			Description="Returns the portal's 3D object model name.">
			<Signature>String _JBTEH_AAK_Geometry3DName()</Signature>
			<Formula>
				function _JBTEH_AAK_Geometry3DName()
					if Variant == "Type 12" then 
						return string.upper(string.format("NO-BN-3D-EH-AAK-KONTAKTLEDNINGSÅK-TYPE-12-%02d-%s",Length:sub(1,-2)-10, Length))
					elseif Variant == "Type 14" then 
						return string.upper(string.format("NO-BN-3D-EH-AAK-KONTAKTLEDNINGSÅK-TYPE-14-%02d-%s",Length:sub(1,-2)-27, Length))
					elseif Variant == "Type 40" then 
						return string.upper(string.format("NO-BN-3D-EH-AAK-KONTAKTLEDNINGSÅK-TYPE-40-%02d-%s",Length:sub(1,-2)-9, Length))
					elseif Variant == "OCS gantry" then
						return "NO-BN-3D-EH-AAK-UTLIGGERÅK-6M"
					else
						return "Bad OCS portal Variant ["..Variant.."]",_warning
					end
				end
			</Formula>
		</LuaFunction>
		
		<InsertPointObject Name="Type 12" DisplayBlockName="NO-BN-2D-JBTEH_AAK-KONTAKTLEDNINGSÅK-11000-{% if SymbolMode == 'Schematic' %}Schematic{% else %}Metric{% endif %}"
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="4">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="true" RotateIfRightSideOfAlignment="true"/>
			<SetValue Key="VerticalOffset" Value="7.90"/>
		</InsertPointObject>
		
		<InsertPointObject Name="Type 14" DisplayBlockName="NO-BN-2D-JBTEH_AAK-KONTAKTLEDNINGSÅK-28000-{% if SymbolMode == 'Schematic' %}Schematic{% else %}Metric{% endif %}"
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="4">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="true" RotateIfRightSideOfAlignment="true"/>
			<SetValue Key="VerticalOffset" Value="7.90"/>
		</InsertPointObject>
		
		<InsertPointObject Name="Type 40" DisplayBlockName="NO-BN-2D-JBTEH_AAK-KONTAKTLEDNINGSÅK-10000-{% if SymbolMode == 'Schematic' %}Schematic{% else %}Metric{% endif %}"
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="4">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="true" RotateIfRightSideOfAlignment="true"/>
			<SetValue Key="VerticalOffset" Value="7.90"/>
		</InsertPointObject>
		
		<InsertPointObject Name="OCS gantry" DisplayName="Utliggeråk" DisplayBlockName="NO-BN-2D-JBTEH_AAK-KONTAKTLEDNINGSÅK-UTLIGGERÅK-6000-{% if SymbolMode == 'Schematic' %}Schematic{% else %}Metric{% endif %}"
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="4">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="true" RotateIfRightSideOfAlignment="true"/>
			<SetValue Key="VerticalOffset" Value="7.90"/>
		</InsertPointObject>
		
		<SymbolDefinition AllowSymbolMove="true">
			<Rotation Add180DegreesIfDirIsDown="false" AddAngle="{% if dir == 'up' %}{{270.0|plus:AngularOffset}}
														{% elsif dir == 'down' %}{{90.0|plus:AngularOffset}}
														{% elsif dir == 'both' and RightSided %}{{180.0|plus:AngularOffset}}
														{% elsif dir == 'both' and LeftSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and RightSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and LeftSided %}{{180.0|plus:AngularOffset}}
														{% else %}45.0
														{% endif %}"/>	
			<BlockNameFormat JoinBy="-">
				NO-BN-2D-JBTEH_AAK
				{% if Variant == 'OCS gantry' %}KONTAKTLEDNINGSÅK-UTLIGGERÅK-6000
				{% elsif Length == '10m' %}KONTAKTLEDNINGSÅK-10000
				{% elsif Length == '11m' %}KONTAKTLEDNINGSÅK-11000
				{% elsif Length == '12m' %}KONTAKTLEDNINGSÅK-12000
				{% elsif Length == '13m' %}KONTAKTLEDNINGSÅK-13000
				{% elsif Length == '14m' %}KONTAKTLEDNINGSÅK-14000
				{% elsif Length == '15m' %}KONTAKTLEDNINGSÅK-15000
				{% elsif Length == '16m' %}KONTAKTLEDNINGSÅK-16000
				{% elsif Length == '17m' %}KONTAKTLEDNINGSÅK-17000
				{% elsif Length == '18m' %}KONTAKTLEDNINGSÅK-18000
				{% elsif Length == '19m' %}KONTAKTLEDNINGSÅK-19000
				{% elsif Length == '20m' %}KONTAKTLEDNINGSÅK-20000
				{% elsif Length == '21m' %}KONTAKTLEDNINGSÅK-21000
				{% elsif Length == '22m' %}KONTAKTLEDNINGSÅK-22000
				{% elsif Length == '23m' %}KONTAKTLEDNINGSÅK-23000
				{% elsif Length == '24m' %}KONTAKTLEDNINGSÅK-24000
				{% elsif Length == '25m' %}KONTAKTLEDNINGSÅK-25000
				{% elsif Length == '26m' %}KONTAKTLEDNINGSÅK-26000
				{% elsif Length == '27m' %}KONTAKTLEDNINGSÅK-27000
				{% elsif Length == '28m' %}KONTAKTLEDNINGSÅK-28000
				{% elsif Length == '29m' %}KONTAKTLEDNINGSÅK-29000
				{% elsif Length == '30m' %}KONTAKTLEDNINGSÅK-30000
				{% elsif Length == '31m' %}KONTAKTLEDNINGSÅK-31000
				{% elsif Length == '32m' %}KONTAKTLEDNINGSÅK-32000
				{% elsif Length == '33m' %}KONTAKTLEDNINGSÅK-33000
				{% elsif Length == '34m' %}KONTAKTLEDNINGSÅK-34000
				{% elsif Length == '35m' %}KONTAKTLEDNINGSÅK-35000
				{% elsif Length == '36m' %}KONTAKTLEDNINGSÅK-36000
				{% elsif Length == '37m' %}KONTAKTLEDNINGSÅK-37000
				{% elsif Length == '38m' %}KONTAKTLEDNINGSÅK-38000
				{% elsif Length == '39m' %}KONTAKTLEDNINGSÅK-39000
				{% elsif Length == '40m' %}KONTAKTLEDNINGSÅK-40000
				{% elsif Length == '41m' %}KONTAKTLEDNINGSÅK-41000
				{% elsif Length == '42m' %}KONTAKTLEDNINGSÅK-42000
				{% elsif Length == '43m' %}KONTAKTLEDNINGSÅK-43000
				{% else %}BAD_Variant_{{Variant}}
				{% endif %}
				{% if SymbolMode == 'Schematic' %}Schematic{% else %}Metric{% endif %}
			</BlockNameFormat>
		</SymbolDefinition>
		
		
		<SymbolDefinition DefaultBlockName="NO-BN-2D-JBTRC_INNSETTINGSPUNKT-Schematic" DoNotIncludeInSymbolFrame="true"/>

		<DockPointDefinitions>
			<SnapPoints>
				<SnapPoint X="0.0" Y="0.0" TargetSpace="kl-mast"/>
			</SnapPoints>
		</DockPointDefinitions>

	</ObjectType>



<!--========================================================================================================
    End of file 
=========================================================================================================-->
</xpp:bloc>

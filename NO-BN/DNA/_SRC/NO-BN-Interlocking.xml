<!--========================================================================================================

    NO-BN-Interlocking.xml
	
	Include in DNA file using XPPq XML preprocessor directive <xpp:expand href="fileName.xml"/>.

	(c) Copyright Railcomplete AS, Norway, NO916118503, 2015-2024. All rights reserved.
	
=========================================================================================================-->
<xpp:bloc>



<!--=======================================================================================================
	SIGNALLING
	INTERLOCKING SYNTHESIS
========================================================================================================-->
	<DefaultInterlockingExportOptions>
		<TrainRoutesStartPointFilter>
			if (RcType == rctype_Signal and MainSignal == 'Hs2' or MainSignal == 'Hs3') then
				return NOBN_sig_getSignalShortName()
			elseif RcType == rctype_EtcsEoA then
				return NOBN_sig_getSignalShortName()
			end
		</TrainRoutesStartPointFilter>
		<TrainRoutesEndPointFilter>
			if ((RcType == rctype_Signal and (MainSignal == 'Hs1'or MainSignal == 'Hs2' or MainSignal == 'Hs3'))
				or (RcType == rctype_FictitiousSignal and Variant == "Fiktivt sluttpunkt for togvei")
				or (RcType == "JBTSA_SIG Togvei slutt"))
			then
				return NOBN_sig_getSignalShortName()
			elseif RcType == rctype_EtcsEoA then
				return NOBN_sig_getSignalShortName()
			end
		</TrainRoutesEndPointFilter>
		<ShuntingRoutesStartPointFilter>
			if (RcType == rctype_Signal and DwarfSignal == "Ja") then
				return NOBN_sig_getSignalNumber()
			end
		</ShuntingRoutesStartPointFilter>
		<ShuntingRoutesEndPointFilter>
			if (RcType == rctype_Signal and DwarfSignal ~= "-") or (RcType == rctype_EtcsEoA and Variant:lower():match("dvergsignal")) then 
				return NOBN_sig_getSignalNumber()
			elseif (RcType == rctype_FictitiousSignal and Variant == "Fiktivt sluttpunkt for togvei") or (RcType == "JBTSA_SIG Togvei slutt") then
				return code
			end
		</ShuntingRoutesEndPointFilter>
		<ViaPointFilter>
			if (RcType == rctype_FictitiousSignal and Variant == "Viapunkt for betjeningsanlegg") then
				return "(v"..code..")"
			end
		</ViaPointFilter>
		<ExtendedTrainRoutesExcludedStartPointFilter>Function == "blocking"</ExtendedTrainRoutesExcludedStartPointFilter>
		<ExtendedRoutePartFormatScript>
			base = StartName .. "-" .. EndName
			if ViaPoints.Count > 0 then
				via = ViaPoints[0].Value
				for i=1, ViaPoints.Count-1 do
					via = via .. "-" .. ViaPoints[i].Value
				end
				return base .. " via " .. via
			else
				return base
			end
		</ExtendedRoutePartFormatScript>
		<SwitchNameScript>
			dir = (position == "left") and "V" or "H"
			return Switch.code .. dir
		</SwitchNameScript>
	</DefaultInterlockingExportOptions>
	
	
	
<!--========================================================================================================
	COMMON / SIGNALLING
	INTERLOCKING TABLE
=========================================================================================================-->
	<ObjectType DataType="RailCOMPLETEInterlockingTable" Class="RCTable" LuaName="rctype_TableInterlockingControl"
				Name="JBTFE_DIV Forriglingstabell"
				Layer="JBTFE_TABELLER" Color="ByLayer"
				Group="Signal/Forriglingstabeller"
				>

		<RelationSpace>tabell</RelationSpace>

		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___VAR"/>
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___TABLE_OBJECT"/>

		<xpp:expand select="NOBN_com_PSET_BANE_NOR"/>
		<xpp:expand select="NOBN_com_PSET_FDV_BANEDATA"/>
		<xpp:expand select="NOBN_com_PSET_ISY_STK"/>
		<xpp:expand select="NOBN_com_PSET_TITTELFELT"/>

		<Variants DefaultValue="Forriglingstabell 0 Tabelloversikt">
			<Variant Name="Forriglingstabell - Tom tabell"/>
			<Variant Name="Forriglingstabell 0 Tabelloversikt"/>
			<Variant Name="Forriglingstabell 1-A Togveier retning A"/>
			<Variant Name="Forriglingstabell 1-B Togveier retning B"/>
			<Variant Name="Forriglingstabell 2-A Forlengede togveier retning A"/>
			<Variant Name="Forriglingstabell 2-B Forlengede togveier retning B"/>
			<Variant Name="Forriglingstabell 3-A Sikkerhetssone togveier retning A"/>
			<Variant Name="Forriglingstabell 3-B Sikkerhetssone togveier retning B"/>
			<Variant Name="Forriglingstabell 4 Sidedekning for togvei og skiftevei"/>
			<Variant Name="Forriglingstabell 5 Utløsing togveier"/>
			<Variant Name="Forriglingstabell 6-A Skifteveier retning A"/>
			<Variant Name="Forriglingstabell 6-B Skifteveier retning B"/>
			<Variant Name="Forriglingstabell 7-A Forlengede skifteveier retning A"/>
			<Variant Name="Forriglingstabell 7-B Forlengede skifteveier retning B"/>
			<Variant Name="Forriglingstabell 8-A Sikkerhetssone skifteveier retning A"/>
			<Variant Name="Forriglingstabell 8-B Sikkerhetssone skifteveier retning B"/>
			<Variant Name="Forriglingstabell 9 Utløsing skifteveier"/>
			<Variant Name="Forriglingstabell 10 Lokalområder"/>
			<Variant Name="Forriglingstabell 11 Sammensatte lokalområder"/>
			<Variant Name="Forriglingstabell 12 Sveivområder"/>
			<Variant Name="Forriglingstabell 13 Signalstopp"/>
			<Variant Name="Forriglingstabell 14 Avsporingsindikatorer"/>
			<Variant Name="Forriglingstabell 15 Automatisk gjennomgangsdrift"/>
			<Variant Name="Forriglingstabell 16-A AG-togveier retning A"/>
			<Variant Name="Forriglingstabell 16-B AG-togveier retning B"/>
			<Variant Name="Forriglingstabell 17 Arbeidsområder"/>
			<Variant Name="Forriglingstabell 18 Sammensatte arbeidsområder"/>
			<Variant Name="Forriglingstabell 19 Sporvekselomlegging"/>
			<Variant Name="Forriglingstabell 20 Middelkontrollampe"/>
		</Variants>
		
		<!--TODO Definere alle tabellene-->
		<InsertTable Name="Forriglingstabell - Tom tabell" DisplayBlockName="NO-BN-2D-JBTRC_THUMBNAIL-TABELL-Schematic">
			<TableSpecification>
				<ColumnSelectionSelf>true</ColumnSelectionSelf>
				<ColumnSelectionFromMasterTable>false</ColumnSelectionFromMasterTable>
				<Title>Forriglingstabell - Tom tabell</Title>
				<IncludeTitle>true</IncludeTitle>
				<ShowInvisibleObjects>false</ShowInvisibleObjects>
				<ObjectManagerFilterList />
				<ObjectTypeBrowser>false</ObjectTypeBrowser>
				<EnableLuaFilter>true</EnableLuaFilter>
				<LuaFilter>false</LuaFilter>
				<UseDataSetFilter>false</UseDataSetFilter>
				<EnableCustomSettings>true</EnableCustomSettings>
				<TitleTextHeight>5</TitleTextHeight>
				<HeaderTextHeight>3.5</HeaderTextHeight>
				<DataTextHeight>2.5</DataTextHeight>
				<VerticalCellMargin>1</VerticalCellMargin>
				<HorizontalCellMargin>1</HorizontalCellMargin>
				<BlockScale>1</BlockScale>
				<MinRowHeight>3</MinRowHeight>
				<EnableWrap>false</EnableWrap>
				<WrapDepth>0</WrapDepth>
				<WrapSpacing>0</WrapSpacing>
				<WrapDirection>Right</WrapDirection>
				<RepeatHeaders>false</RepeatHeaders>
				<VerticalNumbering>
					<Enabled>false</Enabled>
					<IsVertical>true</IsVertical>
					<Location>Left</Location>
					<NumberFormat>Numbers</NumberFormat>
					<TextHeight>2</TextHeight>
					<HideBorders>true</HideBorders>
					<Alignment>MiddleCenter</Alignment>
				</VerticalNumbering>
				<HorizontalNumbering>
					<Enabled>false</Enabled>
					<IsVertical>false</IsVertical>
					<Location>Bottom</Location>
					<NumberFormat>Numbers</NumberFormat>
					<TextHeight>2</TextHeight>
					<HideBorders>true</HideBorders>
					<Alignment>MiddleCenter</Alignment>
				</HorizontalNumbering>
				<TableFormat>Standard</TableFormat>
				<Font>RC-STANDARD</Font>
				<Columns>
					<ColumnSpecification>
					<Guid>71b321ec-4bc3-493d-974b-2b01236d720c</Guid>
					<Headers>
						<Header Name="Name"/>
					</Headers>
					<Width>50</Width>
					<HideColumn>false</HideColumn>
					<SortOption>None</SortOption>
					<Alignment>MiddleCenter</Alignment>
					<Data>name</Data>
					</ColumnSpecification>
					<ColumnSpecification>
					<Guid>10272f0b-a413-49f6-bd6a-b520ea345d97</Guid>
					<Headers>
						<Header Name="Km"/>
					</Headers>
					<Width>50</Width>
					<HideColumn>false</HideColumn>
					<SortOption>Ascending</SortOption>
					<Alignment>MiddleCenter</Alignment>
					<Data>string.format("%d+%.03f",ReferenceMileage//1000,ReferenceMileage%1000)</Data>
					</ColumnSpecification>
				</Columns>
				<SortOrder>
					<string>10272f0b-a413-49f6-bd6a-b520ea345d97</string>
				</SortOrder>
				<NewColumnWidth xsi:nil="true"/>
			</TableSpecification>
		</InsertTable>


	</ObjectType>



<!--========================================================================================================
    End of file 
=========================================================================================================-->
</xpp:bloc>

<!--========================================================================================================

    NO-BN-CommonObjects.xml
	
	Include in DNA file using XPPq XML preprocessor directive <xpp:expand href="fileName.xml"/>.

	(c) Railcomplete AS, Norway, 2019-2020 All rights reserved.
	
=========================================================================================================-->
<xpp:bloc>



<!--========================================================================================================
	XREF
	(no subcategory)
	Xref
=========================================================================================================-->
	<ObjectType DataType="RailCOMPLETEXref" Class="RCXRef" Name="RC Xref"
			Layer="JBTFE__DIVERSE" Color="ByLayer"
			Group="Xref"
	/>



<!--========================================================================================================
	OMRÅDER
	FELLES
	FE-DIV OCP område
	Operation / Control Point area declaration
=========================================================================================================-->
	<ObjectType DataType="eOcp" Class="RailwayArea" Name="FE-DIV OCP område"
				Layer="JBTFE_OMRÅDER" Color="ByLayer"
				Group="Områder" Linetype="RC-OCP"
				>

		<RelationSourceSpace>område</RelationSourceSpace>

		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___TAG_OBJECTINFO_VAR"/>
		<xpp:expand select="NOBN_com_STD_TEXTATTRIBUTES___HORIZONTAL_AND_CLOSE___JBTFE"/>
		<xpp:expand select="NOBN_com_DISCIPLINE_JBTFE"/>

		<CustomAttribute DataType="String" ReadOnly="true" Category="Model check" Name="mc_PointObjectsToBeRefreshed" 
			DisplayName="Point objects to modelcheck" 
			Description="When this area is refreshed or model checked, then all visible point objects in the area will be checked, too."/>

		<LuaExpression Name="mc_PointObjectsToBeRefreshed" IsModelCheck="true">
			<Formula>NOBN_com_chkTriggerPointObjectModelChecks()</Formula>
		</LuaExpression>

		<PropertyPrompt Key="code" DefaultValue="" AcceptEmptyValue="false"/>
		
		<Variants DefaultValue="OCP">
			<Variant Name="OCP" />
		</Variants>
		
		<InsertArea DisplayName="OCP" VariantName="OCP" Group="OCP" DisplayBlockName="NO-BN-2D-JBTFE-THUMBNAIL-OMRAADE-GENERELL" DefaultToTangentContinuity="false">
			<IncludeSegmentType>Tangent</IncludeSegmentType>
		</InsertArea>
		
	</ObjectType>

	
	
<!--========================================================================================================
	OMRÅDER
	FELLES
	FE-DIV Område
	Diverse områdetyper
	TODO: Definere områdetyper for øvrige JBT-fag og underbygning
	TODO: Lage brukerdefinerte linjetyper med siffer i linjen, evt flere ulike mønstere
	NB: Unik forbokstav sikrer at brukervalg ved innsetting blir riktig. Ellers tas første forekomst av forbokstav.
=========================================================================================================-->
	<ObjectType DataType="tElementWithIDAndName" Class="RailwayArea" Name="FE-DIV Område"
				Layer="JBTFE_OMRÅDER" Color="ByLayer"
				Group="Områder"
				Linetype="
					{% if Variant == 'Arbeidsområde' %}RC-Arbeidsområde
					{% elsif Variant == 'Lokalområde' %}RC-Lokalområde
					{% elsif Variant == 'Grense for parsell' %}RC-Parsellgrense
					{% elsif Variant == 'Plattform' %}RC-Plattform
					{% elsif Variant == 'Bro' %}RC-Bro
					{% elsif Variant == 'Viewport' %}RC-Viewport
					{% elsif Variant == 'Brukerdefinert' %}RC-Brukerdefinert
					{% endif %}"
				>

		<RelationSourceSpace>område</RelationSourceSpace>

		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___TAG_OBJECTINFO_VAR"/>
		<xpp:expand select="NOBN_com_STD_TEXTATTRIBUTES___HORIZONTAL_AND_CLOSE___JBTFE"/>
		<xpp:expand select="NOBN_com_DISCIPLINE_JBTFE"/>
				
		<Variants DefaultValue="Brukerdefinert">
			<Variant Name="Brukerdefinert"/>
			<Variant Name="Arbeidsområde"/>
			<Variant Name="Lokalområde"/>
			<Variant Name="Grense for parsell"/>
			<Variant Name="Plattform"/>
			<Variant Name="Bro"/>
			<Variant Name="Viewport"/>
			<Variant Name="JordingsMaskenett"/>
		</Variants>

		<CustomAttribute DataType="String" ReadOnly="true" Category="Model check" Name="mc_PointObjectsToBeRefreshed" 
			DisplayName="Point objects to modelcheck" 
			Description="When this object is refreshed, then all visible point objects in the area are refreshed as well."
		/>
		<LuaExpression Name="mc_PointObjectsToBeRefreshed" IsModelCheck="true"><Formula>NOBN_com_chkTriggerPointObjectModelChecks()</Formula></LuaExpression>

		<PropertyPrompt Key="code" DefaultValue="" AcceptEmptyValue="false"/>
				
		<InsertArea DisplayName="Brukerdefinert" VariantName="Brukerdefinert" Group="Brukerdefinert" DisplayBlockName="NO-BN-2D-JBTFE-THUMBNAIL-OMRAADE-GENERELL" DefaultToTangentContinuity="false">
			<IncludeSegmentType>Tangent</IncludeSegmentType>
		</InsertArea>
		<InsertArea DisplayName="Arbeidsområde" VariantName="Arbeidsområde" Group="Arbeidsområde" DisplayBlockName="NO-BN-2D-JBTFE-THUMBNAIL-OMRAADE-GENERELL" DefaultToTangentContinuity="false">
			<IncludeSegmentType>Tangent</IncludeSegmentType>
		</InsertArea>
		<InsertArea DisplayName="Lokalområde" VariantName="Lokalområde" Group="Lokalområde" DisplayBlockName="NO-BN-2D-JBTFE-THUMBNAIL-OMRAADE-GENERELL" DefaultToTangentContinuity="false">
			<IncludeSegmentType>Tangent</IncludeSegmentType>
		</InsertArea>
		<InsertArea DisplayName="Grense for parsell" VariantName="Grense for parsell" Group="Grense for parsell" DisplayBlockName="NO-BN-2D-JBTFE-THUMBNAIL-OMRAADE-GENERELL" DefaultToTangentContinuity="false">
			<IncludeSegmentType>Tangent</IncludeSegmentType>
		</InsertArea>
		<InsertArea DisplayName="Plattform" VariantName="Plattform" Group="Plattform" DisplayBlockName="NO-BN-2D-JBTFE-THUMBNAIL-OMRAADE-GENERELL" DefaultToTangentContinuity="false">
			<IncludeSegmentType>Tangent</IncludeSegmentType>
		</InsertArea>
		<InsertArea DisplayName="Bro" VariantName="Bro" Group="Bro" DisplayBlockName="NO-BN-2D-JBTFE-THUMBNAIL-OMRAADE-GENERELL" DefaultToTangentContinuity="false">
			<IncludeSegmentType>Tangent</IncludeSegmentType>
		</InsertArea>
		<InsertArea DisplayName="Viewport" VariantName="Viewport" Group="Viewport" DisplayBlockName="NO-BN-2D-JBTFE-THUMBNAIL-OMRAADE-GENERELL" DefaultToTangentContinuity="false">
			<IncludeSegmentType>Tangent</IncludeSegmentType>
		</InsertArea>
		<InsertArea DisplayName="Jordingsmaskenett" VariantName="JordingsMaskenett" Group="Jording" DisplayBlockName="NO-BN-2D-JBTFE-THUMBNAIL-OMRAADE-GENERELL" DefaultToTangentContinuity="false">
			<IncludeSegmentType>Tangent</IncludeSegmentType>
		</InsertArea>

	</ObjectType>


	
<!--========================================================================================================
	FELLES
	WATCH
	FE-DIV Watch
	Watch object - objekt som bindes til ett eller flere andre objekter for å overvåke dem. 
=========================================================================================================-->
	<ObjectType DataType="RailCOMPLETEWatch" Class="RailwayPlacedObject" Name="FE-DIV Watch" 
				Layer="JBTFE_WATCH" Color="ByLayer"
				Group="Felles/Watch"
				AttMirrorY="{% if RightSided %}true{% else %}false{% endif %}"
				>

		<RelationSourceSpace>watch</RelationSourceSpace>

		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___TAG_OBJECTINFO_VAR"/>
		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___MILEAGE_INCREASES_TOWARDS_LEFT"/> 
		<xpp:expand select="NOBN_com_STD_TEXTATTRIBUTES___HORIZONTAL_AND_CLOSE___JBTFE"/>
		<xpp:expand select="NOBN_com_DISCIPLINE_JBTFE"/>
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___ALIGNMENT_ANNOTATION_OBJECT"/>
		
		<Variants DefaultValue="Watch">
			<Variant Name="Watch" >
				<SetValue Key="name" Value="Relate Watch with 'Is watch for anything' or edit the 'Text' property directly." />
			</Variant>
		</Variants>

		<LuaExpression Name="text"><Formula>_FE_DIV_text()</Formula></LuaExpression>
		<LuaFunction Name="_FE_DIV_text()" ReturnType="String"
			HideFromUser="false"
			Description="Returns a text to be displayed inside the Watch symbol's frame. The text consists of the code from each visible object related with 'Is watch for anything'." >
			<Constructor>String _FE_DIV_text()</Constructor>
			<Formula>
				function _FE_DIV_text()
					local r,n,t,i
					r,n = RC__getCollectionOfRelatedObjects("Is watch for anything")
					if n == 0 then 
						t = "?"
					else
						t = r[0].code
						for i = 1,n-1 do
							t = t..", "..r[i].code
						end
					end
					return t
				end
			</Formula>
		</LuaFunction>

		<InsertSymbol VariantName="Watch" DisplayBlockName="NO-BN-2D-JBTFE-WATCH-JIGSYMBOL">
			<SetValue Key="MileageIncreasesTowardsLeft" Value="{{alignmentRotation | minus:ucsRotation | cosisnegative}}" />
			<SetValue Key="SymbolFrame" Value="Watch" />
		</InsertSymbol>      
		
		<SymbolDefinition X="0.0" Y="0.0" DefaultBlockName="NO-BN-2D-JBTFE-WATCH-SYMBOL" AllowSymbolMove="true">
			<Rotation AddAngle="{% if MileageIncreasesTowardsLeft == 'True'%}180{% else %}0{% endif %}" />
			<SymbolAttribute Tag="W">
				<Value>{{Text}}</Value>
			</SymbolAttribute>
		</SymbolDefinition>

		<SymbolDefinition X="0.0" Y="0.0" DefaultBlockName="NO-BN-2D-INSERTION-POINT" />

	</ObjectType>



<!--========================================================================================================
	FELLES
	KOF
	FE-DIV KOF
	Watch object - Henter objektinfo i databasen og returnerer en formatert tekststreng med KOF-record type 05
=========================================================================================================-->
 	<LuaFunction Name="NOBN_com_getKof05Records()" ReturnType="String"
		HideFromUser="false"
		Description="Returns text in KOF file 05 format (Northing, Easting, Elevation). ThemeCode is an optional Norwegian SOSI code. SearchArea is the name of an optional RcArea." >
        <Constructor>String NOBN_com_getKof05Records([int ThemeCode[,string SearchArea]])</Constructor>
		<Formula>
function NOBN_com_getKof05Records(ThemeCode, SearchArea)
	local d, df, n, r, t, s, i, areas 
	if ThemeCode == nil then -- No arguments given, return description:
		return "Returns text in the Norwegian KOF file 05 format (Northing, Easting, Elevation), for objects with RcType given by\n"
		    .."the first object that this KOF watch is related to, using the 'Is watch for anything' watch relation. Specify the\n"
			.."desired theme code as the first argument to this function. The theme code denotes the 4-digit SOSI survey object\n"
			.."type, to be printed along with the KOF records. If an optional search area name has been given, then the object\n"
			.."search will be restricted to that area. Note: Only visible objects are considered.",_warning
	end
	if SearchArea == nil then 
		SearchArea = "" -- Don't care
	end
	if SearchArea == "" then 
		d = DocumentData.ObjectCollection
	else
		areas = DocumentData.ObjectCollection:filter(function (x) return x.RcType:match("Area") ~= nil end)
		areas = areas:filter(function (x) return x.code == SearchArea end)
		if getCollectionLength(areas) == 0 then 
			return "No search area was found with code '"..SearchArea.."'.",_warning
		else
			d = DocumentData.ObjectCollection:filter(function (x) return x.area.code == areas[0].code end) --TODO: Doesn't work as expected!
			return "Object search with specified area name such as '"..SearchArea.."' is not yet implemented - sorry about that.",_warning
		end
	end
	r = Relations["Is watch for anything"]
	if (getCollectionLength(r) == 0) then
		return "Please relate KOF watch object to any object of the desired RcType, using the 'Is watch for anything' relation.",_warning
	end
	t = r[0].RcType
	df = d:filter(function (x) return (x.RcType == t) end)
	n = getCollectionLength(df)
	if n == 0 then 
		if SearchArea ~= "" then
			return "No objects found in area '"..SearchArea.."' of type '"..t.."'.",_warning
		else
			return "No objects found of type '"..t.."'.",_warning
		end
	else
		--Make formatted string in KOF (Norway) format: "05 = KOORDINATBLOKK"
		--
		--Type            Point name     Pos    Beskrivelse
		-- -------------- -------------- ------ -----------
		--Linjestatus     ” ” eller ”-”  1      Angir om dataene i linja skal leses (” ”) eller ignoreres (”-”).
		--Datablokk type  05             2..3   Datablokk type, der 05 = koordinatblokk. Må ikke endres
		--Punktnavn       PPPPPPPPPP     5..14  Navn på målepunkt. Punktnavnet kan bestå av både tall og
	    --                                      bokstaver og påvirker ikke sorteringsrekkefølgen i netLIN 3.
		--Temakode        KKKKKKKK       16..23 Temakode/SOSI-kode. Kan endres, se tabeller nedenfor.
		--                                      Viktig: For horisontale retningsendringer langs traseen
		--                                      (horisontalvinkler) i må ”HV” legges inn som temakode.
		--X-koordinat     XXXXXXXX.XXX   25..36 North-koordinat.
		--Y-koordinat     YYYYYYY.YYY    38..48 East-koordinat.
		--Høyde           ZZZZ.ZZZ       50..57 Ortometrisk høyde.
		--Beregningskode  Bk             59     Brukes ikke av RailCOMPLETE
		--Kommentar                      61..79 Brukes ikke av RailCOMPLETE
		-- Alfanumeriske felt VENSTRE-justeres, numeriske felt HØYREjusteres. Rader har maks 80 tegn.
		--
		s = "-KOF file for "..n.." objects found with RcType matching '"..t.."'\n"
		s = s.."-Type Obj.name Theme NNNNNNNN.NNN EEEEEEE.EEE HHHH.HHH (Northing, Easting, Height)\n"
		for i = 1, n do 
			local c = df[i-1].geoCoord
			s = s..string.format(" 05 %10d %8d %12.3f %11.3f %8.3f\n",i,ThemeCode,c.Y,c.X,c.Z)
		end
		return s
	end
end
       </Formula>
    </LuaFunction>
 
 
 
	<ObjectType DataType="RailCOMPLETEWatch" Class="RailwayPlacedObject" Name="FE-DIV KOF-format koordinatliste" 
				Layer="JBTFE_WATCH" Color="ByLayer"
				Group="Felles/Watch"
				AttMirrorY="{% if RightSided %}true{% else %}false{% endif %}"
				>

		<RelationSourceSpace>watch</RelationSourceSpace>

		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___TAG_OBJECTINFO_VAR"/>
		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___MILEAGE_INCREASES_TOWARDS_LEFT"/> 
		<xpp:expand select="NOBN_com_STD_TEXTATTRIBUTES___HORIZONTAL_AND_CLOSE___JBTFE"/>
		<xpp:expand select="NOBN_com_DISCIPLINE_JBTFE"/>
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___ALIGNMENT_ANNOTATION_OBJECT"/>

		<CustomAttribute DataType="String" Name="KofSearchArea" DisplayName="KOF_område" DefaultValue="" 
			Description="The 'KofSearchArea' custom attribute is void or should be assigned a valid name for an existing RcArea object. If non-empty, then only objects within this area are considered." /> 
		<CustomAttribute DataType="UInt16" Name="KofThemeCode" DisplayName="KOF_sosikode" DefaultValue="7871" 
			Description="The 'KofThemeCode' custom attribute [UInt16] should hold a 3- or 4-digit SOSI cartographic object nomenclature code according to Norwegian standard." /> 

		<Variants DefaultValue="KOF Koordinatliste">
			<Variant Name="KOF Koordinatliste" >
				<SetValue Key="name" Value="" />
				<SetValue Key="Text" Value="KOF Koordinatliste" />
			</Variant>
		</Variants>

		<InsertSymbol VariantName="KOF Koordinatliste" DisplayBlockName="NO-BN-2D-JBTFE-WATCH-JIGSYMBOL" >
			<SetValue Key="MileageIncreasesTowardsLeft" Value="{{alignmentRotation | minus:ucsRotation | cosisnegative}}" />
			<SetValue Key="SymbolFrame" Value="Watch" />
		</InsertSymbol>      
		
		<LuaExpression Name="Text"><Formula>NOBN_com_getKof05Records(KofThemeCode,KofSearchArea)</Formula></LuaExpression>

		<SymbolDefinition X="0.0" Y="0.0" DefaultBlockName="NO-BN-2D-JBTFE-WATCH-SYMBOL" AllowSymbolMove="true">
			<Rotation AddAngle="{% if MileageIncreasesTowardsLeft == 'True'%}180{% else %}0{% endif %}" />
			<SymbolAttribute Tag="W">
				<Value>{{Text}}</Value>
			</SymbolAttribute>
		</SymbolDefinition>

		<SymbolDefinition X="0.0" Y="0.0" DefaultBlockName="NO-BN-2D-INSERTION-POINT" />

	</ObjectType>



<!--========================================================================================================
	FELLES
	MARKØRER
	FE-DIV Markør
	Knappenål / gåsenebb / snakkeboble / ballong / middelmerke osv
=========================================================================================================-->
	<ObjectType DataType="tMarker" Class="RailwayPlacedObject" Name="FE-DIV Markør" 
				Layer="JBTFE_MARKØRER" Color="ByLayer"
				Group="Felles/Markører"
				AttMirrorY="{% if RightSided %}true{% else %}false{% endif %}"
				>

		<RelationSourceSpace>markør</RelationSourceSpace>
		
		<!-- Note: Using the NOBN_com_STD_CUSTOMATTRIBUTES___TAG_OBJECTINFO_VAR macro avoids inserting lots of metadata -->
		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___TAG_OBJECTINFO_VAR"/>
		<xpp:expand select="NOBN_com_STD_TEXTATTRIBUTES___HORIZONTAL_AND_CLOSE___JBTFE"/>
		<xpp:expand select="NOBN_com_DISCIPLINE_JBTFE"/>
		<xpp:expand select="NOBN_com_CHK_NUMBER_OF_OCP_AREAS"/>
		<xpp:expand select="RC_com_SET_OCP_STATION_REF"/>
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___TRACKBOUND_OBJECT"/>

		<LuaExpression Name="DistanceToAlignment"><Formula>NOBN_trk_getDistanceToAlignmentFromCantAndTrackPlaneDistance(RightSided and 4e-4 or -4e-4)</Formula></LuaExpression>

		<Variants DefaultValue="Knappenål">
			<Variant Name="Knappenål" />
			<Variant Name="Posisjonsmarkering">
				<SetValue Key="Annotations3D" Value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; &lt;ArrayOfCadAnnotation xmlns:xsd=&quot;http://www.w3.org/2001/XMLSchema&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&gt;  &lt;CadAnnotation Tag=&quot;3D spornavn&quot; Invisible=&quot;false&quot; Height=&quot;0.15&quot;&gt;       &lt;Formula&gt;Annotation3dAlignmentName&lt;/Formula&gt;       &lt;Offset X=&quot;-0.75&quot; Y=&quot;0&quot; Z=&quot;1.00&quot; /&gt;       &lt;Attitude X=&quot;90&quot; Y=&quot;0&quot; Z=&quot;0&quot; /&gt;     &lt;/CadAnnotation&gt;  &lt;CadAnnotation Tag=&quot;3D km&quot; Invisible=&quot;false&quot; Height=&quot;0.25&quot;&gt;       &lt;Formula&gt;Annotation3dAlignmentPos&lt;/Formula&gt;       &lt;Offset X=&quot;-0.75&quot; Y=&quot;0&quot; Z=&quot;0.50&quot; /&gt;       &lt;Attitude X=&quot;90&quot; Y=&quot;0&quot; Z=&quot;0&quot; /&gt;     &lt;/CadAnnotation&gt; &lt;/ArrayOfCadAnnotation&gt;" />
				<SetValue Key="Farge" Value="Gul"/>
			</Variant>
		</Variants>
		
		<CustomAttribute DataType="Enumeration" Name="markerColor" DisplayName="Farge" DefaultValue="Rød" 
			Description="The 'markerColor' custom enum property [Rød | Gul | Grønn | Blå] holds the marker's color." 
			>
			<Values Variant="Knappenål">
				<Value>Rød</Value>
				<Value>Gul</Value>
				<Value>Grønn</Value>
				<Value>Blå</Value>
			</Values>
			<Values Variant="Posisjonsmarkering">
				<Value>Gul</Value>
			</Values>
		</CustomAttribute>

		<LuaExpression Name="Model3DName"><Formula>_FE_DIV_marker_Model3dName()</Formula></LuaExpression>
		<LuaFunction Name="_FE_DIV_marker_Model3dName()" ReturnType="String"
				Description="Obtains the marker's 3D model name." >
			<Constructor>String _FE_DIV_marker_Model3dName()</Constructor>
			<Formula>
				function _FE_DIV_marker_Model3dName()
					if (Variant == "Posisjonsmarkering") then
						return "NO-BN-3D-FE-DIV-POSISJONSMARKERING" 
					elseif (Variant == "Knappenål") then
						return "NO-BN-3D-FE-DIV-MARKØR-KNAPPENÅL-"..markerColor:upper()
					end
				end
			</Formula>
		</LuaFunction>
		
		<LuaExpression Name="name"><Formula>_FE_DIV_marker_name()</Formula></LuaExpression>
		<LuaFunction Name="_FE_DIV_marker_name()" ReturnType="String"
				Description="Obtains marker's name, a list of 'code' for all objects related to this marker with 'Er markør for anything'." >
			<Constructor>String _FE_DIV_marker_name([RailwayPlacedObject obj])</Constructor>
			<Formula>
				function _FE_DIV_marker_name(obj)
					if obj == nil then obj = this end
					local RelationName = "Er markør for anything"
					local r,n = RC__getCollectionOfRelatedObjects(RelationName)
					if n == 0 then 
						return "UNFINISHED - Relate with '"..RelationName.."'."
					else
						local s,i
						s = "("..r[0].code
						for i = 1, n-1 do
							s = s..", "..r[i].code
						end
						return s..")"
					end
				end
			</Formula>
		</LuaFunction>

		<!-- Snap to any type of alignment: -->
		<InsertSymbol VariantName="Knappenål" DisplayBlockName="NO-BN-2D-JBTFE-MARKOER-KNAPPENAAL" 
				DefaultSnapMode="Alignment" SnapToAlignment="true" SnapDistance="0" SnapSensitivityDistance="3" >
			<Rotation Direction="true" />
		</InsertSymbol>      

		<InsertSymbol VariantName="Posisjonsmarkering" DisplayBlockName="NO-BN-2D-JBTFE-MARKOER-KNAPPENAAL" 
				DefaultSnapMode="Alignment" SnapToAlignment="true" SnapDistance="0" SnapSensitivityDistance="3" >
			<Rotation Direction="true" />
		</InsertSymbol>

		<SymbolDefinition X="0.0" Y="0.0" DefaultBlockName="NO-BN-2D-JBTFE-MARKOER-KNAPPENAAL" AllowSymbolMove="true">
			<Rotation RotateDirection="true" />
			<SymbolAttribute Tag="FARGE">
				<Value>{{FARGE}}</Value>
			</SymbolAttribute>
		</SymbolDefinition>
	</ObjectType>



<!--========================================================================================================
	FELLES
	DIVERSE
	FE-DIV Cross section
	Benyttes for å angi et 'sted' på en stasjon, som kan være i flere spor. Brukes som railML i LUKS og OpenTrack.
=========================================================================================================-->
	<ObjectType DataType="tCrossSection" Class="RailwayPlacedObject" Name="FE-DIV Cross section" 
				Layer="JBTFE_DIVERSE" Color="ByLayer"
				Group="Felles/Diverse"
				AttMirrorY="{% if RightSided %}true{% else %}false{% endif %}"
	>

		<RelationSourceSpace>cross_section</RelationSourceSpace>

		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___TAG_OBJECTINFO_VAR"/>
		<xpp:expand select="NOBN_com_STD_TEXATTRIBUTES___VERTICAL_AND_FAR___JBTFE"/>
		<xpp:expand select="NOBN_com_DISCIPLINE_JBTFE"/>
		<xpp:expand select="NOBN_com_CHK_NUMBER_OF_OCP_AREAS"/>
		<xpp:expand select="RC_com_SET_OCP_STATION_REF"/>
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___ALIGNMENT_ANNOTATION_OBJECT"/>
				
		<InsertSymbol VariantName="Cross section" DisplayBlockName="NO-BN-2D-JBTFE-MARKOER-KNAPPENAAL" >
			<Rotation Direction="true" />
			<SetValue Key="Model3DName" Value="NO-BN-3D-FE-MARKØR-KNAPPENÅL-RØD"/>
		</InsertSymbol>      

		<SymbolDefinition X="0.0" Y="0.0" DefaultBlockName="NO-BN-2D-JBTFE-MARKOER-KNAPPENAAL" AllowSymbolMove="true">
			<Rotation RotateDirection="true" />
		</SymbolDefinition>
		
	</ObjectType>

	
	
<!--========================================================================================================
	FELLES
	SPORBRUK
	FE-DIV Sporbruk
	Ring med navn på typen anvendelse som sporet er beregnet for. Denne betegnelsen "sprer seg" ut til de
	omkransende sporbrukgrense-objektene, se dette. Fungerer tilsvarende som f.eks. SA-SPF Sporfelt.
=========================================================================================================-->
	<ObjectType DataType="RailCOMPLETESection" Class="RailwayPlacedObject" Name="FE-DIV Sporbruk"
				Layer="JBTFE_DIVERSE" Color="ByLayer"
				Group="Felles/Sporbruk"
				AttMirrorY="{% if RightSided %}true{% else %}false{% endif %}"
				>

		<RelationSourceSpace>track_usage</RelationSourceSpace>

		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___TAG_OBJECTINFO_VAR"/>
		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___MILEAGE_INCREASES_TOWARDS_LEFT"/>
		<xpp:expand select="NOBN_com_STD_TEXTATTRIBUTES___HORIZONTAL_AND_CLOSE___JBTFE"/>
		<xpp:expand select="NOBN_com_DISCIPLINE_JBTFE"/>
		<xpp:expand select="NOBN_com_CHK_NUMBER_OF_OCP_AREAS"/>
		<xpp:expand select="RC_com_SET_OCP_STATION_REF"/>
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___ALIGNMENT_ANNOTATION_OBJECT"/>

		<Variants DefaultValue="Hovedspor">
			<Variant Name="Hovedspor"/>
			<Variant Name="Togspor"/>
			<Variant Name="Hensettingsspor"/>
			<Variant Name="Skiftespor"/>
			<Variant Name="Sidespor"/>
		</Variants>
		
		<LuaExpression Name="code"><Formula>_FE_DIV_sporbruk_code()</Formula></LuaExpression>
		<LuaFunction Name="_FE_DIV_sporbruk_code()" ReturnType="String"
				Description="Obtains the code for the track usage (Sporbruk) object [String]." >
			<Constructor>String _FE_DIV_sporbruk_code()</Constructor>
			<Formula>
				function _FE_DIV_sporbruk_code()
					if Variant == "Hovedspor" then return "Hv" 
					elseif Variant == "Togspor" then return "Tg" 
					elseif Variant == "Hensettingsspor" then return "He" 
					elseif Variant == "Skiftespor" then return "Sk" 
					elseif Variant == "Sidespor" then return "Si" 
					else return "Bad Variant ["..Variant.."].",_error
					end
				end
		</Formula>
		</LuaFunction>

		<InsertSymbol VariantName="Hovedspor" DisplayName="Sporbruk" DisplayBlockName="NO-BN-2D-JBTFE-SECTION-JIGSYMBOL">
			<Rotation Direction="true" />
			<SetValue Key="MileageIncreasesTowardsLeft" Value="{{alignmentRotation | minus:ucsRotation | cosisnegative}}" />
			<SetValue Key="SymbolFrame" Value="TvdSectionFrame-2.75" />
			<SetValue Key="DelimiterType" Value="FE-DIV Sporbrukgrense" />
		</InsertSymbol>
		
		<!-- NB - The RailCOMPLETE SymbolFrame forms the frame around the section's visible text. -->
		<SymbolDefinition X="0.0" Y="0.0" DefaultBlockName="NO-BN-2D-JBTFE-SECTION-SYMBOL" AllowSymbolMove="true">
			<Rotation AddAngle="{% if MileageIncreasesTowardsLeft == 'True'%}180{% else %}0{% endif %}" />
			<SymbolAttribute Tag="X">
				<Value>{{Variant}}</Value>
			</SymbolAttribute>
		</SymbolDefinition>
	
	</ObjectType>
	
	
	
<!--========================================================================================================
	FELLES
	SPORBRUK
	FE-DIV Sporbrukgrense
	Objekt som settes som en knappemål (markør) i sporene, slik at de henter typen sin fra sporbruk-objektet
	som de omkranser. Fungerer på tilsvarende vis som sporfelt og tellepunktavsnitt.
=========================================================================================================-->
	<ObjectType DataType="tDelimitedOrientedElement" Class="RailwayPlacedObject" Name="FE-DIV Sporbrukgrense"
				Layer="JBTFE_DIVERSE" Color="ByLayer"
				Group="Felles/Sporbruk"
				AttMirrorY="{% if RightSided %}true{% else %}false{% endif %}"
				>

		<RelationSourceSpace>track_usage_border</RelationSourceSpace>

		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___TAG_OBJECTINFO_VAR"/>
		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___MILEAGE_INCREASES_TOWARDS_LEFT"/>
		<xpp:expand select="NOBN_com_STD_TEXATTRIBUTES___VERTICAL_AND_FAR___JBTFE"/>
		<xpp:expand select="NOBN_com_DISCIPLINE_JBTFE"/>
		<xpp:expand select="NOBN_com_CHK_NUMBER_OF_OCP_AREAS"/>
		<xpp:expand select="RC_com_SET_OCP_STATION_REF"/>
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___TRACKBOUND_OBJECT"/>

		<LuaExpression Name="DistanceToAlignment">
			<Formula>RightSided and 4e-4 or -4e-4</Formula>
		</LuaExpression>
			
		<LuaExpression Name="name"><Formula>_FE_DIV_sporbrukgrense_name()</Formula></LuaExpression>
		<LuaFunction Name="_FE_DIV_sporbrukgrense_name()" ReturnType="String"
				Description="Obtains the name of a track usage delimiter element, inherited from the two surrounding track usage section elements." >
			<Constructor>String _FE_DIV_sporbrukgrense_name()</Constructor>
			<Formula>
				function _FE_DIV_sporbrukgrense_name()
					first = DownSections.Count == 0  and "-" or DownSections[0].Code
					second = UpSections.Count == 0  and "-" or UpSections[0].Code
					if (MileageIncreasesTowardsLeft == 'True') then	first,second = second,first end
					return "(" .. first .. "/" .. second .. ")"
				end
			</Formula>
		</LuaFunction>
		
	   <LuaExpression Name="ObjectInfo"><Formula>_FE_DIV_sporbrukgrense_objectInfo()</Formula></LuaExpression>
		<LuaFunction Name="_FE_DIV_sporbrukgrense_objectInfo()" ReturnType="String"
				Description="Obtains the 'ObjectInfo' text for the track usage delimiter element." >
			<Constructor>String _FE_DIV_sporbrukgrense_objectInfo()</Constructor>
			<Formula>
				function _FE_DIV_sporbrukgrense_objectInfo()
					first = DownSections.Count == 0  and "-" or DownSections[0].Variant
					second = UpSections.Count == 0  and "-" or UpSections[0].Variant
					if (MileageIncreasesTowardsLeft == 'True') then	first,second = second,first end
					return "Sporbruk: " .. first .. "/" .. second
				end
			</Formula>
		</LuaFunction>

		<InsertSymbol VariantName="Sporbrukgrense" DisplayBlockName="NO-BN-2D-JBTFE-MARKOER-KNAPPENAAL"
				SnapToAlignment="true" SnapDistance="0.0" >
				<Rotation Direction="true"/>
				<SetValue Key="MileageIncreasesTowardsLeft" Value="{{alignmentRotation | minus:ucsRotation | cosisnegative}}" />
				<SetValue Key="dir" Value="both" />
		</InsertSymbol>

		<SymbolDefinition X="0.0" Y="0.0" DefaultBlockName="NO-BN-2D-JBTFE-MARKOER-KNAPPENAAL" AllowSymbolMove="true">
			<Rotation AddAngle="{% if MileageIncreasesTowardsLeft == 'True'%}180{% else %}0{% endif %}" />
			<SymbolAttribute Tag="FARGE">
				<Value>{{name}}</Value>
			</SymbolAttribute>
		</SymbolDefinition>

		<SymbolDefinition X="0.0" Y="0.0" DefaultBlockName="NO-BN-2D-INSERTION-POINT" >
			<Rotation />
		</SymbolDefinition>

	</ObjectType>



<!--========================================================================================================
  RAILCOMPLETECloneObject
  TODO 2018-07-06 Fortsatt ikke ferdig modellert eller gjennomtenkt!!!!!
=========================================================================================================-->
	<!--Holds a reference to the original object. Used for schematic tracks.-->
	<ObjectType DataType="RailCOMPLETECloneObject" Class="CloneRailwayObject" Name="CloneObject" DisplayName="Clone object"/>


	
<!--========================================================================================================
    End of file 
=========================================================================================================-->
</xpp:bloc>
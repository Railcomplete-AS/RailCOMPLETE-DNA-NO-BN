<!--========================================================================================================

    NO-BN-OcsObjects.xml
	
	Include in DNA file using XPPq XML preprocessor directive <xpp:expand href="fileName.xml" />.

	(c) Railcomplete AS, Norway, 2015-2020. All rights reserved.
	
=========================================================================================================-->
<xpp:bloc>



<!--========================================================================================================
	ocs - Overhead catenary System Lua formulas (including return current and earthing).
	Domain-specific Lua functions, stored in Global Extension Dictionary (not in each object).

English					Norwegian
contact wire			kontakttråd
catenary wire			bæreline
stitch wire				y-line
droppers				hengetråd
current ladder			strømstige
jumper					strømbru
switch wires			bryterline
reinforcing feeder		forsterkningsledning
by-pass feeders			forbigangsledning
by-pass cables			forbigangskabel
feeder line				mateledning
return feeder			returledning
return cable			returkabel
tension line			avspenningsline
bracing line			avspenningsbardunline
soldering line			kurvebardunline
tensioning wire			loddavspenningsline
insulated earth wire	isolert jordleder
flexible by-pass wire	forbikoblingslisse
connection cable for grounding apparatus	kabel for jordingsapparat
connection feeders		forbindelsesleder
negative feeder in AT system	negativ leder i AT-system
positive feeder in AT system	positiv leder i AT-system

=========================================================================================================-->
	<!-- Note: We let these OCS functions be globally accessible, since we want them to be shared between several OCS mast object types. -->
	<!-- We let HideFromUser="false" so that users may benefit from these functions in their own Lua. -->

	<LuaFunction Name="NOBN_ocs_getRollFromCant()" ReturnType="Double"
		Description="Returns a roll angle deduced from an OCS wire alignment's cant. NB! Cant is interpreted as decimal degrees CW/CCW for non-tracks." >
		<Constructor>Double NOBN_ocs_getRollFromCant([_position])</Constructor>
		<Formula>
			function NOBN_ocs_getRollFromCant(where)
				--If called to express e.g. wire clamps or sweeping a contact wire, then '_position' is provided by RC, sampled along the alignment.
				if where == nil then
					ai = getAlignmentInfo()
				else
					ai = getAlignmentInfo(where)
				end
				angleInDecimalDegrees = ai.Cant --  NB! Cant is interpreted as decimal degrees CW/CCW for non-tracks.
				if (RC__isNan(angleInDecimalDegrees)) then
					return 0,_info("UNFINISHED - No cant (to be interpreted as an angle in decimal degrees) data in non-track alignment, assuming zero cant.")
				elseif angleInDecimalDegrees == 0 then
					return 0
				else
					-- Cant is measured in millimeter superelevation, with rotation clockwise or counterclockwise in the track's direction
					-- Assume that only one rail is lifted at a time.
					cr = tostring(ai.CantRotation)
					if  cr:upper() == "CW" then
						return angleInDecimalDegrees
					elseif cr:upper() == "CCW" then 
						return -angleInDecimalDegrees
					else
						return 45,_error,_info("Bad cant rotation data ["..CantRotation.."], assuming 90 degrees roll as a visual warning.")
					end
				end
			end
		</Formula>
	</LuaFunction>


	
<!-- ========================================================================================================
	ELEKTRO HØYSPENT
	KONTAKTLEDNINGER
	EH-KTL Kontaktledning
	TODO: Modelleres ferdig, krever ny funksjonalitet
 =========================================================================================================-->
	<ObjectType DataType="tElementWithAlignment" Class="RailwayAlignment" Name="EH-KTL Kontaktledning"
				Layer="JBTKL_EH_KTL_Kontaktledning_Kjørbar" Color="ByLayer"
				Group="Kontaktledning/Kontaktledninger"
				>
		
		<RelationSourceSpace>kontaktledning</RelationSourceSpace>

		<AlignmentSystems DefaultSystemName="Kontaktledning" >
			<AlignmentSystem Name="Kontaktledning"
				CantGauge="0.010"
				AlignmentGauge="0.010"
				QuickMode3DLiftWithCant="true"
			 />
		</AlignmentSystems>

		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___TAG_OBJECTINFO_METADATA_VAR" />
		<xpp:expand select="NOBN_com_STD_TEXTATTRIBUTES___HORIZONTAL_AND_CLOSE___JBTKL" />
		<xpp:expand select="NOBN_com_DISCIPLINE_JBTKL" />

		<Variants DefaultValue="Kontaktledning, Sort, kjørbar">
			<Variant Name="Kontaktledning, Sort, kjørbar"> 
			</Variant>
			<Variant Name="Kontaktledning, Sort, ikke kjørbar"> 
			</Variant>
			<Variant Name="Kontaktledning, Blå, kjørbar"> 
			</Variant>
			<Variant Name="Kontaktledning, Blå, ikke kjørbar"> 
			</Variant>
			<Variant Name="Kontaktledning, Lilla, kjørbar"> 
			</Variant>
			<Variant Name="Kontaktledning, Lilla, ikke kjørbar"> 
			</Variant>
			<Variant Name="Kontaktledning, Rød, kjørbar"> 
			</Variant>
			<Variant Name="Kontaktledning, Rød, ikke kjørbar"> 
			</Variant>
			<Variant Name="Kontaktledning, Brun, kjørbar"> 
			</Variant>
			<Variant Name="Kontaktledning, Brun, ikke kjørbar"> 
			</Variant>
			<Variant Name="Kontaktledning, Oransje, kjørbar"> 
			</Variant>
			<Variant Name="Kontaktledning, Oransje, ikke kjørbar"> 
			</Variant>
			<Variant Name="Kontaktledning, Grønn, kjørbar"> 
			</Variant>
			<Variant Name="Kontaktledning, Grønn, ikke kjørbar"> 
			</Variant>
		</Variants>

		<!-- Wire material is set the very first time, i.e. changing color and linetype later will not alter the wire material: -->
		<SetValue Key="WireMaterial" Value="Ri 100" />

		<!-- https://trv.banenor.no/ts/Kontaktledning/Liner,_tr%C3%A5d,_ledning_og_kabel#EN_50149 -->
		<CustomAttribute DataType="Enumeration" Name="WireMaterial" DisplayName="Ledningsmateriale" DefaultValue="Ri 100"
			Description="The overhead catenary system (OCS) contact wire material [Ri 100 | RiS 100 | Ri 120 | RiS 120]." >
			<Value>Ri 100</Value>
			<Value>RiS 100</Value>
			<Value>Ri 120</Value>
			<Value>RiS 120</Value>
		</CustomAttribute>
		
		<!-- Linetype is by default set to ByLayer, and further defined in the style definition XML file. -->
 
		<LuaExpression Name="Layer"><Formula>_EH_KTL_Layer()</Formula></LuaExpression>
		<LuaFunction Name="_EH_KTL_Layer()" ReturnType="String"
			Description="Obtains the CAD system layer name for the catenary wire, based on its Variant.">
			<Constructor>String _EH_KTL_Layer()</Constructor>
			<Formula>
				function _EH_KTL_Layer()
					if Variant:lower():match("ikke kjørbar") then
						return "JBTKL_EH_KTL_Kontaktledning_Ikke_kjørbar"
					else 
						return "JBTKL_EH_KTL_Kontaktledning_Kjørbar"
					end
				end
			</Formula>
		</LuaFunction>

		<LuaExpression Name="Linetype"><Formula>_EH_KTL_Linetype()</Formula></LuaExpression>
		<LuaFunction Name="_EH_KTL_Linetype()" ReturnType="String"
			Description="Obtains the CAD system linetype (continuous / dashed) for the catenary wire, based on its Variant.">
			<Constructor>String _EH_KTL_Linetype()</Constructor>
			<Formula>
				function _EH_KTL_Linetype()
					if Variant:lower():match("ikke kjørbar") then
						return "RC-DASHED"
					else 
						return "Continuous"
					end
				end
			</Formula>
		</LuaFunction>

		<LuaExpression Name="Color"><Formula>_EH_KTL_Color()</Formula></LuaExpression>
		<LuaFunction Name="_EH_KTL_Color()" ReturnType="String"
			Description="Obtains the CAD system color for the catenary wire, based on its Variant. If your CAD system uses a color table translator, then colors may indirectly control line color and width in print.">
			<Constructor>String _EH_KTL_Color()</Constructor>
			<Formula>
				function _EH_KTL_Color()
					if Variant:lower():match("sort") then return "White"
					elseif Variant:lower():match("blå") then return "30,144,255"
					elseif Variant:lower():match("lilla") then return "148,0,211"
					elseif Variant:lower():match("rød") then return "252,10,28"
					elseif Variant:lower():match("brun") then return "139,69,19"
					elseif Variant:lower():match("oransje") then return "255,140,0"
					elseif Variant:lower():match("grønn") then return "50,205,50"
					end
				end
			</Formula>
		</LuaFunction>

		<LuaExpression Name="Lineweight"><Formula>_EH_KTL_Lineweight()</Formula></LuaExpression>
		<LuaFunction Name="_EH_KTL_Lineweight()" ReturnType="Double"
			Description="Obtains the CAD system lineweight (line width in print) for the catenary wire, based on its Variant.">
			<Constructor>Double _EH_KTL_Lineweight()</Constructor>
			<Formula>
				--AutoCAD needs lineweights to be of the form "x.yy mm":
				function _EH_KTL_Lineweight()
					if Variant:lower():match("sort") then
						return "0.35 mm"
					else
						return "0.40 mm"
					end
				end
			</Formula>
		</LuaFunction>

		<SetValue Key="Sweep3D" Value="True" />
		<SetValue Key="QuickMode3D" Value="True" />

		<!-- RailCOMPLETE provides the '_position' reserved identifier, sampled along the alignment, to be used in e.g. getAlignmentInfo() etc. -->
		<LuaExpression Name="Rotation3D.X"><Formula>NOBN_trk_getPitchFromGradient(_position)</Formula></LuaExpression>
		<LuaExpression Name="Rotation3D.Y"><Formula>NOBN_ocs_getRollFromCant(_position)</Formula></LuaExpression>
		<LuaExpression Name="Rotation3D.Z"><Formula>0.0</Formula></LuaExpression>
		
		<!-- The 2D Sweep profile: -->
		<LuaExpression Name="Model3DName"><Formula>"NO-BN-3D-SWEEP-EH-KTL-KONTAKTTRÅD-"..WireMaterial:gsub(" ","-")</Formula></LuaExpression>
		
		<!-- The Model3DSeparation is needed during sweep in order to sweep the entire length of the underlying alignment 2D length -->
		<LuaExpression Name="Model3DSeparation" IsModelCheck="false"><Formula>RC__getNearest3DStep(1.0)</Formula></LuaExpression>
		<SetValue Key="Model3DOffset" Value="0.0" />

		<LuaExpression Name="name" ><Formula>"L"..code</Formula></LuaExpression>
		<PropertyPrompt Key="code" DefaultValue="Kontaktledning" AcceptEmptyValue="false" />
		
		<InsertAlignment VariantName="Kontaktledning, Sort, kjørbar" DisplayBlockName="NO-BN-2D-JBTKL-THUMBNAIL-KONTAKTLEDNING" DefaultToTangentContinuity="false">
			<IncludeSegmentType>Tangent</IncludeSegmentType>
		</InsertAlignment>

		<InsertAlignment VariantName="Kontaktledning, Sort, ikke kjørbar" DisplayBlockName="NO-BN-2D-JBTKL-THUMBNAIL-KONTAKTLEDNING" DefaultToTangentContinuity="false">
			<IncludeSegmentType>Tangent</IncludeSegmentType>
		</InsertAlignment>

		<InsertAlignment VariantName="Kontaktledning, Blå, kjørbar" DisplayBlockName="NO-BN-2D-JBTKL-THUMBNAIL-KONTAKTLEDNING" DefaultToTangentContinuity="false">
			<IncludeSegmentType>Tangent</IncludeSegmentType>
		</InsertAlignment>

		<InsertAlignment VariantName="Kontaktledning, Blå, ikke kjørbar" DisplayBlockName="NO-BN-2D-JBTKL-THUMBNAIL-KONTAKTLEDNING" DefaultToTangentContinuity="false">
			<IncludeSegmentType>Tangent</IncludeSegmentType>
		</InsertAlignment>

		<InsertAlignment VariantName="Kontaktledning, Lilla, kjørbar" DisplayBlockName="NO-BN-2D-JBTKL-THUMBNAIL-KONTAKTLEDNING" DefaultToTangentContinuity="false">
			<IncludeSegmentType>Tangent</IncludeSegmentType>
		</InsertAlignment>

		<InsertAlignment VariantName="Kontaktledning, Lilla, ikke kjørbar" DisplayBlockName="NO-BN-2D-JBTKL-THUMBNAIL-KONTAKTLEDNING" DefaultToTangentContinuity="false">
			<IncludeSegmentType>Tangent</IncludeSegmentType>
		</InsertAlignment>

		<InsertAlignment VariantName="Kontaktledning, Rød, kjørbar" DisplayBlockName="NO-BN-2D-JBTKL-THUMBNAIL-KONTAKTLEDNING" DefaultToTangentContinuity="false">
			<IncludeSegmentType>Tangent</IncludeSegmentType>
		</InsertAlignment>

		<InsertAlignment VariantName="Kontaktledning, Rød, ikke kjørbar" DisplayBlockName="NO-BN-2D-JBTKL-THUMBNAIL-KONTAKTLEDNING" DefaultToTangentContinuity="false">
			<IncludeSegmentType>Tangent</IncludeSegmentType>
		</InsertAlignment>

		<InsertAlignment VariantName="Kontaktledning, Brun, kjørbar" DisplayBlockName="NO-BN-2D-JBTKL-THUMBNAIL-KONTAKTLEDNING" DefaultToTangentContinuity="false">
			<IncludeSegmentType>Tangent</IncludeSegmentType>
		</InsertAlignment>

		<InsertAlignment VariantName="Kontaktledning, Brun, ikke kjørbar" DisplayBlockName="NO-BN-2D-JBTKL-THUMBNAIL-KONTAKTLEDNING" DefaultToTangentContinuity="false">
			<IncludeSegmentType>Tangent</IncludeSegmentType>
		</InsertAlignment>

		<InsertAlignment VariantName="Kontaktledning, Oransje, kjørbar" DisplayBlockName="NO-BN-2D-JBTKL-THUMBNAIL-KONTAKTLEDNING" DefaultToTangentContinuity="false">
			<IncludeSegmentType>Tangent</IncludeSegmentType>
		</InsertAlignment>

		<InsertAlignment VariantName="Kontaktledning, Oransje, ikke kjørbar" DisplayBlockName="NO-BN-2D-JBTKL-THUMBNAIL-KONTAKTLEDNING" DefaultToTangentContinuity="false">
			<IncludeSegmentType>Tangent</IncludeSegmentType>
		</InsertAlignment>

		<InsertAlignment VariantName="Kontaktledning, Grønn, kjørbar" DisplayBlockName="NO-BN-2D-JBTKL-THUMBNAIL-KONTAKTLEDNING" DefaultToTangentContinuity="false">
			<IncludeSegmentType>Tangent</IncludeSegmentType>
		</InsertAlignment>

		<InsertAlignment VariantName="Kontaktledning, Grønn, ikke kjørbar" DisplayBlockName="NO-BN-2D-JBTKL-THUMBNAIL-KONTAKTLEDNING" DefaultToTangentContinuity="false">
			<IncludeSegmentType>Tangent</IncludeSegmentType>
		</InsertAlignment>

	</ObjectType>



<!-- ========================================================================================================
	ELEKTRO HØYSPENT
	KONTAKTLEDNINGER
	EH-KLO Kontaktledningsoppheng
	Merk: Dette er liner annet enn selve kontaktledningen, som spennes opp med strekkraft (strever: med trykk-kraft).
	TODO Avklare med Bane NOR om foreslått Banedata kategori kan benyttes.
 =========================================================================================================-->
	<ObjectType DataType="tElementWithAlignment" Class="RailwayAlignment" Name="EH-KLO Kontaktledningsoppheng"
				Layer="JBTKL_EH_KLO" Color="ByLayer"
				Group="Kontaktledning/Kontaktledningsoppheng"
				>
		
		<RelationSourceSpace>kl-oppheng</RelationSourceSpace>
		
		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___TAG_OBJECTINFO_METADATA_VAR" />
		<xpp:expand select="NOBN_com_STD_TEXTATTRIBUTES___HORIZONTAL_AND_CLOSE___JBTKL" />
		<xpp:expand select="NOBN_com_DISCIPLINE_JBTKL" />

		<Variants DefaultValue="Bæreline">
			<Variant Name="Bæreline" >
				<SetValue Key="WireMaterial" Value="Bz II 50/19" />
			</Variant>
			<Variant Name="Hengetråd">
				<SetValue Key="WireMaterial" Value="Bz II 50/19" />
			</Variant>
			<Variant Name="Y-line">
				<SetValue Key="WireMaterial" Value="Bz II 50/19" />
			</Variant>
			<Variant Name="Fixline">
				<SetValue Key="WireMaterial" Value="Bz II 50/19" />
			</Variant>
			<Variant Name="Z-line">
				<SetValue Key="WireMaterial" Value="Bz II 50/19" />
			</Variant>
			<Variant Name="Bardun">
				<SetValue Key="WireMaterial" Value="Stålwire 50mm2" />
			</Variant>
			<Variant Name="Strever">
				<SetValue Key="WireMaterial" Value="Stålstag" />
			</Variant>
		</Variants>

		<!-- Dimensjon på firkantstål i strevere: Se EH.800240, HUP120x120x6,3 -->
		<!-- https://trv.banenor.no/ts/Kontaktledning/Liner,_tr%C3%A5d,_ledning_og_kabel#EN_50149 -->
		<CustomAttribute DataType="Enumeration" Name="WireMaterial" DisplayName="Ledningsmateriale" DefaultValue="Bz II 50/19" 
			Description="The overhead catenary system (OCS) support (catenary/dropper/stich/fix/'Z') wire material [Bz II 50/19 | Bz II 70/19 | Bz II 50/19 isolert]." >
			<Value>Bz II 50/19</Value>
			<Value>Bz II 70/19</Value>
			<Value>Bz II 50/19 isolert</Value>
			<Value>Firkantstål HUP120x120</Value>
		</CustomAttribute>

		<LuaExpression Name="code"><Formula>_EH_KLO_code()</Formula></LuaExpression>
		<LuaFunction Name="_EH_KLO_code()" ReturnType="String"
			Description="Obtains the code for the OCS catenary wire supsension system component, inherited from the associated contact wire, through the 'Er oppheng for kontaktledning' relation.">
			<Constructor>String _EH_KLO_code()</Constructor>
			<Formula>
				function _EH_KLO_code()
					local s,r,n
					s = "Er oppheng for kontaktledning"
					r,n = RC__getCollectionOfRelatedObjects(s)
					if n == 0 then
						return "UNFINISHED - Relate OCS suspension wires with '"..s.."' to its contact wire."
					else
						return r[0].code
					end
				end
			</Formula>
		</LuaFunction>

		<LuaExpression Name="name" ><Formula>_EH_KLO_name()</Formula></LuaExpression>
		<LuaFunction Name="_EH_KLO_name()" ReturnType="String"
				HideFromUser="false"
				Description="Obtains the name for the OCS catenary wire suspension system component, from its 'code'." >
			<Constructor>String _EH_KLO_name()</Constructor>
			<Formula>
				function _EH_KLO_name()
					--Assume that each wire part has been related to the contact wire through a relation
					if Variant == "Bæreline" then return "Bl."..code
					elseif Variant == "Hengetråd" then return "Ht."..code
					elseif Variant == "Y-line" then return "Yl."..code
					elseif Variant == "Fixline" then return "Fl."..code
					elseif Variant == "Z-line" then return "Zl."..code
					elseif Variant == "Bardun" then return "Bar."..code
					elseif Variant == "Strever" then return "Str."..code
					else return _error,"Bad contact wire support Variant ["..Variant.."]."
					end
				end
			</Formula>
		</LuaFunction>

		<!-- TODO Lage modelchecks. -->
		<!-- Bardun: Se EH-707162. Vinkel 40-50 grader med vertikalen. Totallengde fra mast til bardunfeste skal være mellom 13 og 18 meter. -->
			
		<!-- Spør etter relasjon til 'sin' kontaktledning, og hente koden derfra -->
		<!-- <PropertyPrompt Key="code" DefaultValue="Bæreline" AcceptEmptyValue="false" /> 		 -->

		<SetValue Key="Sweep3D" Value="True" />
		<SetValue Key="QuickMode3D" Value="False" />

		<!-- RailCOMPLETE provides the '_position' reserved identifier, sampled along the alignment, to be used in e.g. getAlignmentInfo() etc. -->
		<LuaExpression Name="Rotation3D.X"><Formula>NOBN_trk_getPitchFromGradient(_position)</Formula></LuaExpression>
		<LuaExpression Name="Rotation3D.Y"><Formula>NOBN_ocs_getRollFromCant(_position)</Formula></LuaExpression>
		<LuaExpression Name="Rotation3D.Z"><Formula>0</Formula></LuaExpression>
		
		<!-- The Model3DSeparation is needed during sweep in order to sweep the entire length of the underlying alignment 2D length -->
		<LuaExpression Name="Model3DSeparation" IsModelCheck="false"><Formula>RC__getNearest3DStep(1.0)</Formula></LuaExpression>
		<SetValue Key="Model3DOffset" Value="0.0" />
		
		<InsertAlignment VariantName="Bæreline" DisplayBlockName="NO-BN-2D-JBTKL-THUMBNAIL-KONTAKTLEDNINGSOPPHENG" DefaultToTangentContinuity="false"> 
			<IncludeSegmentType>Tangent</IncludeSegmentType>
			<SetValue Key="WireMaterial" Value="Bz II 70/19" />
			<SetValue Key="Model3DName" Value="NO-BN-SWEEP-FE-WIR-WIRE-GRÅ-DIAMETER-010" />
		</InsertAlignment>

		<InsertAlignment VariantName="Hengetråd" DisplayBlockName="NO-BN-2D-JBTKL-THUMBNAIL-KONTAKTLEDNINGSOPPHENG"  DefaultToTangentContinuity="false"> 
			<IncludeSegmentType>Tangent</IncludeSegmentType>
			<SetValue Key="WireMaterial" Value="Bz II 70/19" />
			<SetValue Key="Model3DName" Value="NO-BN-SWEEP-FE-WIR-WIRE-GRÅ-DIAMETER-010" />
		</InsertAlignment>

		<InsertAlignment VariantName="Y-line" DisplayBlockName="NO-BN-2D-JBTKL-THUMBNAIL-KONTAKTLEDNINGSOPPHENG" DefaultToTangentContinuity="false"> 
			<IncludeSegmentType>Tangent</IncludeSegmentType>
		</InsertAlignment>

		<InsertAlignment VariantName="Fixline" DisplayBlockName="NO-BN-2D-JBTKL-THUMBNAIL-KONTAKTLEDNINGSOPPHENG" DefaultToTangentContinuity="false"> 
			<IncludeSegmentType>Tangent</IncludeSegmentType>
			<SetValue Key="Linetype" Value="RC-DASHED" />
			<SetValue Key="WireMaterial" Value="Bz II 70/19" />
			<SetValue Key="Model3DName" Value="NO-BN-SWEEP-FE-WIR-WIRE-GRÅ-DIAMETER-010" />
		</InsertAlignment>

		<InsertAlignment VariantName="Z-line" DisplayBlockName="NO-BN-2D-JBTKL-THUMBNAIL-KONTAKTLEDNINGSOPPHENG" DefaultToTangentContinuity="false"> 
			<IncludeSegmentType>Tangent</IncludeSegmentType>
			<SetValue Key="WireMaterial" Value="Bz II 70/19" />
			<SetValue Key="Model3DName" Value="NO-BN-SWEEP-FE-WIR-WIRE-GRÅ-DIAMETER-010" />
		</InsertAlignment>

		<InsertAlignment VariantName="Bardun" DisplayBlockName="NO-BN-2D-JBTKL-THUMBNAIL-KONTAKTLEDNINGSOPPHENG" DefaultToTangentContinuity="false"> 
			<IncludeSegmentType>Tangent</IncludeSegmentType>
			<SetValue Key="WireMaterial" Value="Bz II 70/19" />
			<SetValue Key="Model3DName" Value="NO-BN-SWEEP-FE-WIR-WIRE-GRÅ-DIAMETER-010" />
		</InsertAlignment>

		<InsertAlignment VariantName="Strever" DisplayBlockName="NO-BN-2D-JBTKL-THUMBNAIL-KONTAKTLEDNINGSOPPHENG" DefaultToTangentContinuity="false"> 
			<IncludeSegmentType>Tangent</IncludeSegmentType>
			<SetValue Key="WireMaterial" Value="Firkantstål HUP120x120" />
			<SetValue Key="Model3DName" Value="NO-BN-SWEEP-FE-DIV-STEEL-BEAM-HUP-120-120" />
		</InsertAlignment>

	</ObjectType>



<!--========================================================================================================
	ELEKTRO HØYSPENT
	JORDLEDERE
	EH-JOR Jordleder
	Al needs 56% more cross-section than Cu for the same resistivity.
	Source: https://help.leonardo-energy.org/hc/en-us/articles/205394842-Why-use-copper-rather-than-aluminium-as-the-conductor-in-power-cables-
 =========================================================================================================-->
	<ObjectType DataType="tEarthWire" Class="RailwayAlignment" Name="EH-JOR Jordleder" 
				Layer="JBTKL_EH_JOR" Color="ByLayer"
				Group="Kontaktledning/Jording"
				>
			
		<RelationSourceSpace>jordleder</RelationSourceSpace>
		
		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___TAG_OBJECTINFO_VAR" />
		<xpp:expand select="NOBN_com_STD_TEXTATTRIBUTES___HORIZONTAL_AND_CLOSE___JBTKL" />
		<xpp:expand select="NOBN_com_DISCIPLINE_JBTKL" />

		<Variants DefaultValue="Isolert jordleder">
   <!-- TODO Innføre Description attributt i både Variants og i Variant -->
   <!-- <Variant Name="Isolert jordleder" Description="Jordleder i lavspentløpet i kabelkanal langs sporet." /> -->
   <!-- <Variant Name="Blank jordleder" Description="Jording som føres fra KL-mast til KL-mast, eller opphengt i tunneltak eller ført langs tunnelvegg." /> -->
   <!-- <Variant Name="Tverrforbinder" Description="Forbinder skinnestrenger i samme spor, f.eks. trekke returstrøm over til andre skinnen ifbm dobbelisolert skjøt. Kabelforlegning i sporet (dvs TXXI kappe)." /> -->
   <!-- <Variant Name="Utjevningsforbinder" Description="Forbinder jordskinnen i ett spor med jordskinnen i et annet spor i nærheten. Kabelforlegning er typisk i føringsvei (dvs IX kappe)." /> -->
			<Variant Name="Isolert jordleder" >
			</Variant>
			<Variant Name="Blank jordleder" >
			</Variant>
			<Variant Name="Tverrforbinder" >
			</Variant>
			<Variant Name="Utjevningsforbinder" >
			</Variant>
		</Variants>
		
		<!-- Tverrsnitt og materialer iht oversikt gitt av Norconsult v/ Magnus Brevik, juli 2018 -->
		<CustomAttribute DataType="Enumeration" Name="WireType" DisplayName="Ledertype" DefaultValue="Cu95"
			Description="The earthing wire type (ewt) [6/16/25/35/50/70/95/120/150 mm2 Cu], or aluminum corresponding to the copper conductivities.">
			<Values>
				<Value>Cu150</Value>
				<Value>Cu120</Value>
				<Value>Cu95</Value>
				<Value>Cu70</Value>
				<Value>Cu50</Value>
				<Value>Cu35</Value>
				<Value>Cu25</Value>
				<Value>Cu16</Value>
				<Value>Cu06</Value>
				<Value>Alu240</Value>
				<Value>Alu190</Value>
				<Value>Alu150</Value>
				<Value>Alu120</Value>
				<Value>Alu80</Value>
				<Value>Alu50</Value>
				<Value>Alu35</Value>
			</Values>
		</CustomAttribute>

		<CustomAttribute DataType="Enumeration" Name="Sheath" DisplayName="Kappe" DefaultValue="IX"
			Description="The earthing wire sheath type [KHF | UX | TXXI | IX], where KFH:naked conductor for air suspension, UX:insulated for object earthing, TXXI:connecting tracks in tunnels (Cl-free, flame retardant), IX:insulated for indoor or outdoor object earthing. Other Nexans abbreviations are:G:'glødet', H:'hardtrukket', F:'flertrådet'.">
			<Values>
				<Value>KHF</Value>
				<Value>UX</Value>
				<Value>TXXI</Value>
				<Value>IX</Value>
			</Values>
		</CustomAttribute>
		
		<LuaExpression Name="name"><Formula>code.." ("..Variant..")"</Formula></LuaExpression>
		<LuaExpression Name="Linetype"><Formula>"RC-EARTHING-"..WireType"</Formula></LuaExpression>
	
		<PropertyPrompt Key="code" DefaultValue="JL-" AcceptEmptyValue="false" />
			
		<!-- Jordleder i lavspentløpet i kabelkanal langs sporet. -->
		<InsertAlignment VariantName="Isolert jordleder" DisplayBlockName="NO-BN-2D-JBTKL-THUMBNAIL-JORDLEDER" DefaultToTangentContinuity="false">
			<IncludeSegmentType>Tangent</IncludeSegmentType>
			<IncludeSegmentType>Curve</IncludeSegmentType>
			<SetValue Key="WireType" Value="Cu95" />
			<SetValue Key="Sheath" Value="IX" />
		</InsertAlignment>

		<!-- Jording som føres fra KL-mast til KL-mast, eller opphengt i tunneltak eller ført langs tunnelvegg. -->
		<!-- Hva med blank leder i pukken? Brukes ikke mye, det er frare for overslag til sporfelt-skinne. -->
		<InsertAlignment VariantName="Blank jordleder" DisplayBlockName="NO-BN-2D-JBTKL-THUMBNAIL-JORDLEDER" DefaultToTangentContinuity="false">
			<IncludeSegmentType>Tangent</IncludeSegmentType>
			<IncludeSegmentType>Curve</IncludeSegmentType>
			<SetValue Key="WireType" Value="Cu95" />
			<SetValue Key="Sheath" Value="KHF" />
		</InsertAlignment>

		<!-- Forbinder skinnestrenger i samme spor, f.eks. trekke returstrøm over til andre skinnen ifbm dobbelisolert skjøt. Kabelforlegning i sporet (dvs TXXI kappe). -->
		<InsertAlignment VariantName="Tverrforbinder" DisplayBlockName="NO-BN-2D-JBTKL-THUMBNAIL-JORDLEDER" DefaultToTangentContinuity="false">
			<IncludeSegmentType>Tangent</IncludeSegmentType>
			<IncludeSegmentType>Curve</IncludeSegmentType>
			<SetValue Key="WireType" Value="Cu70" />
			<SetValue Key="Sheath" Value="TXXI" />
		</InsertAlignment>

		<!-- Forbinder jordskinnen i ett spor med jordskinnen i et annet spor i nærheten. Kabelforlegning er typisk i føringsvei (dvs IX kappe). -->
		<InsertAlignment VariantName="Utjevningsforbinder" DisplayBlockName="NO-BN-2D-JBTKL-THUMBNAIL-JORDLEDER" DefaultToTangentContinuity="false">
			<IncludeSegmentType>Tangent</IncludeSegmentType>
			<IncludeSegmentType>Curve</IncludeSegmentType>
			<SetValue Key="WireType" Value="Cu95" />
			<SetValue Key="Sheath" Value="IX" />
		</InsertAlignment>
	</ObjectType>
	
	
	
<!--========================================================================================================
	KONTAKTLEDNING
	MASTER
	EH-MAS KL-mast
=========================================================================================================-->
	<!-- Note: Functions which are called from 'EH-MAS KL-mast' and 'EH-MAS Hengemast for bru og tunnel' and 'EH-MAS Hengemast for åk': -->

	<LuaFunction Name="_EH_MAS_non_yoke_mast_code()" ReturnType="String"
		Description="Obtains the code for the OCS mast, as a concatenation of the mast's reference mileage km-value and the current 'seq' local variable.">
		<Constructor>String _EH_MAS_non_yoke_mast_code()</Constructor>
		<Formula>
			function _EH_MAS_non_yoke_mast_code()
				entireKm = math.floor(ReferenceMileage/1000)
				return string.format("%d-%02d",entireKm,seq),_info("Mast's code is inherited from reference mileage ("..ReferenceMileage..") and the local variable seq ("..seq..").")
			end
		</Formula>
	</LuaFunction>

	<LuaFunction Name="_EH_MAS_SpanLength()" ReturnType="Double" 
			HideFromUser="false"
			Description="Returns the shortest span length [m] between this catenary mast and its related next mast (at higher reference mileage value).">
		<Constructor>Double _EH_MAS_SpanLength()</Constructor>
		<Formula>
			function _EH_MAS_SpanLength()
				local s = "Neste kl-mast"
				local r,n = RC__getCollectionOfRelatedObjects(s)
				if n == 0 then
					return 0.0,_info("UNFINISHED - Relate with '"..s.."' to next OCS mast (at a higher reference mileage), otherwise span length cannot be computed.")
				else
					local d,closest,i,dist
					d = math.huge
					closest = "(none)" --Closest mast's code
					for i = 0, n-1 do
						--Assume no chain break here...
						dist = math.abs(r[i].ReferenceMileage - ReferenceMileage)
						if dist &lt; d then
							d = dist
							closest = r[i].code
						end
					end
					return string.format("%.03f",d),_info(RC__round(d,3).." span length deduced from mast "..this.code.." to  "..closest..".")
				end
			end
		</Formula>
	</LuaFunction>

	<LuaFunction Name="_EH_MAS_SpanLengthDisplay()" ReturnType="String"
			HideFromUser="false"
			Description="Returns the shortest span length [m].">
		<Constructor>String _EH_MAS_SpanLengthDisplay()</Constructor>
		<Formula>
			function _EH_MAS_SpanLengthDisplay()
				local tol1 = 3.0
				local tol2 = 0.75
				local sl = getPropertyValue("SpanLength")
				--Look for nearby masts/suspension masts:
				local npo1 = getNearbyPointObjects2D(tol1,"EH-MAS KL-mast") 
				local npo2 = getNearbyPointObjects2D(tol1,"EH-MAS Hengemast for bru og tunnel")
				local npo3 = getNearbyPointObjects2D(tol1,"EH-MAS Hengemast for åk")
				local npo = getUnionOfCollections({npo1,npo2,npo3}):filter(function (x) return x:isVisible() end)
				for i = 0, npo.count-1 do
					obj = npo[i]
					osl = obj:getPropertyValue("SpanLength")
					--If a nearby mast belongs to same track but is located at a higher mileage (closer to next
					--mast [at higher mileage]), then suppress showing spanlength for this mast... 
					if (obj.Alignment.id == this.Alignment.id) and (obj.ReferenceMileage &gt; this.ReferenceMileage) 
						and math.abs(osl-sl) &lt; tol2 then 
						return "",_info("Spanlength display intentionally suppressed due to other prevailing spanlength.")
					end
				end 
				if math.abs(sl) &gt; 4e-4 then
					return string.format("-%.01f-",sl) 
				else 
					return "",_info("Very small spanlengths are not shown.")
				end
			end
		</Formula>
	</LuaFunction>

	<LuaFunction Name="_EH_MAS_SpanLength2()" ReturnType="Double" 
			HideFromUser="false"
			Description="Returns the second shortest span length [m] between this catenary mast and its related next mast (at higher reference mileage value).">
		<Constructor>Double _EH_MAS_SpanLength2()</Constructor>
		<Formula>
			function _EH_MAS_SpanLength2()
				local s = "Neste kl-mast"
				local r,n = RC__getCollectionOfRelatedObjects(s)
				if n == 0 or n == 1 then
					return 0.0,_info("No second spanlength.")
				else
					-- n &gt;= 2:
					local d,d2,closest,closest2,i,dist
					d = math.huge
					d2 = math.huge
					closest = "(none)" --Closest mast's code
					closest2 = "(none)" --Second closest mast's code
					for i = 0, n-1 do
						--Assume no chain break here...
						dist = math.abs(r[i].ReferenceMileage - ReferenceMileage)
						if dist &lt; d then
							d2 = d
							closest2 = closest
							d = dist
							closest = r[i].code
						elseif dist &lt; d2 then
							d2 = dist
							closest2 = r[i].code
						end
					end
					return string.format("%.03f",d2),_info(RC__round(d2,3).." span length deduced from mast "..this.code.." to  "..closest2..".")
				end
			end
		</Formula>
	</LuaFunction>

	<LuaFunction Name="_EH_MAS_SpanLengthDisplay2()" ReturnType="String"
			HideFromUser="false"
			Description="Returns the second shortest span length [m].">
		<Constructor>String _EH_MAS_SpanLengthDisplay2()</Constructor>
		<Formula>
			function _EH_MAS_SpanLengthDisplay2()
				local sl2 = getPropertyValue("SpanLength2")
				--Look other nearby masts/suspension masts:
				local npo1 = getNearbyPointObjects2D(3.0,"EH-MAS KL-mast") 
				local np2 = getNearbyPointObjects2D(3.0,"EH-MAS Hengemast for åk")
				local npo = getUnionOfCollections({npo1},{npo2})
				for i = 0, npo.count-1 do
					obj = npo[i]
					osl = getPropertyValue(obj.SpanLength)
					--If a nearby mast belongs to same track but is located at a higher mileage (closer to next mast [at higher mileage]), then suppress showing spanlength for this mast... 
					if (obj.Alignment.id == this.Alignment.id) and (obj.ReferenceMileage &gt; this.ReferenceMileage) and (string.format("%.01f",osl) == string.format("%.01f",sl)) then 
						return "",_info("Spanlength display intentionally suppressed due to other prevailing spanlength.")
					end
				end 
				if math.abs(sl2) &gt; 4e-4 then
					return string.format("-%.01f-",sl2) 
				else 
					return "",_info("Very small spanlengths are not shown.")
				end
			end
				</Formula>
	</LuaFunction>

	<LuaFunction Name="_EH_MAS_SpanLengthTextOffset()" ReturnType="Vector2D" 
			HideFromUser="false" 
			Description="Returns a (dX,dY) offset for the span length custom text attribute, from the object's insertion point and halfway to the subsequent mast. Optionally, specify and (addX,addY) offset.">
		<Constructor>Vector2D _EH_MAS_SpanLengthTextOffset([Double addX,[Double addY]])</Constructor>
		<Formula>
			function _EH_MAS_SpanLengthTextOffset(addX,addY)
				if addX == nil then addX = 0 end
				if addY == nil then addY = 0 end
				local r,n = RC__getCollectionOfRelatedObjects("Neste kl-mast")
				if n == 0 then
					return {addX,addY}
				else
					local d,closest,i,closestMastCoords
					d = math.huge
					closest = r[0]
					for i = 0, n-1 do
						dist = RC__getDistance2D(r[i])
						if dist &lt; d then
							d = dist
							closest = r[i]
						end
					end
					closestMastCoords = closest.geoCoord
					return {addX + (closestMastCoords.X - geoCoord.X)/2, addY + (closestMastCoords.Y - geoCoord.Y)/2}
				end
			end
		</Formula>
	</LuaFunction>

	<LuaFunction Name="_EH_MAS_SpanLengthTextOffset2()" ReturnType="Vector2D"
			HideFromUser="false"
			Description="Returns a (dX,dY) offset for the second shortest span length custom text attribute, from the object's insertion point and halfway to the subsequent mast. Optionally, specify and (addX,addY) offset.">
		<Constructor>Vector2D _EH_MAS_SpanLengthTextOffset2(([Double addX[,Double addY]]))</Constructor>
		<Formula>
			function _EH_MAS_SpanLengthTextOffset2()		
				local r,n = RC__getCollectionOfRelatedObjects("Neste kl-mast")
				if addX == nil then addX = 0 end
				if addY == nil then addY = 0 end
				if n == 0 or n == 1 then
					return {addX,addY}
				else
					local d,d2,closest,closest2,i,secondClosestMastCoords
					d = math.huge
					d2 = math.huge
					closest = r[0]
					for i = 0, n-1 do
						dist = RC__getDistance2D(r[i])
						if dist &lt; d then
							d2 = d
							closest2 = closest
							d = dist
							closest = r[i]
						elseif dist &lt; d2 then
							d2 = dist
							closest2 = r[i]
						end
					end
					secondClosestMastCoords = closest2.geoCoord
					return {addX + (secondClosestMastCoords.X - geoCoord.X)/2, addY + (secondClosestMastCoords.Y - geoCoord.Y)/2}
				end
			end
		</Formula>
	</LuaFunction>

	<LuaFunction Name="_EH_MAS_SpanLengthTextRotation()" ReturnType="Double" 
			HideFromUser="false" 
			Description="Returns the text attribute's rotation for the shortest span length custom text attribute, to place the text nicely between its two masts.">
		<Constructor>Double _EH_MAS_SpanLengthTextRotation()</Constructor>
		<Formula>
			function _EH_MAS_SpanLengthTextRotation()
				local r,n = RC__getCollectionOfRelatedObjects("Neste kl-mast")
				local d,closest,i,closestMastCoords
				if n == 0 then 
					local tg = getAlignmentInfo().tangent
					return math.atan(tg.Y,tg.X) * (180/math.pi)
				else 
					d = math.huge
					closest = r[0]
					for i = 0, n-1 do
						dist = RC__getDistance2D(r[i])
						if dist &lt; d then
							d = dist
							closest = r[i]
						end
					end
					closestMastCoords = closest.geoCoord
					return math.atan(closestMastCoords.Y - geoCoord.Y, closestMastCoords.X - geoCoord.X) * (180/math.pi)
				end
			end
		</Formula>
	</LuaFunction>

	<LuaFunction Name="_EH_MAS_SpanLengthTextRotation2()" ReturnType="Double" 
			HideFromUser="false" 
			Description="Returns the text attribute's rotation for the second shortest span length custom text attribute, to place the text nicely between its two masts.">
		<Constructor>Double _EH_MAS_SpanLengthTextRotation2()</Constructor>
		<Formula>
			function _EH_MAS_SpanLengthTextRotation2()
				local r,n = RC__getCollectionOfRelatedObjects("Neste kl-mast")
				local d,d2,closest,closest2,i,secondClosestMastCoords
				if n == 0 then
					local tg = getAlignmentInfo().tangent
					return math.atan(tg.Y,tg.X) * (180/math.pi)
				else
					d = math.huge
					d2 = math.huge
					closest = r[0]
					for i = 0, n-1 do
						dist = RC__getDistance2D(r[i])
						if dist &lt; d then
							d2 = d
							closest2 = closest
							d = dist
							closest = r[i]
						elseif dist &lt; d2 then
							d2 = dist
							closest2 = r[i]
						end
					end
					secondClosestMastCoords = closest2.geoCoord
					closestMastCoords = closest.geoCoord
					return math.atan(secondClosestMastCoords.Y - geoCoord.Y, secondClosestMastCoords.X - geoCoord.X)
				end
			end
		</Formula>
	</LuaFunction>

	<ObjectType DataType="tOrientedElement" Class="RailwayPlacedObject" Name="EH-MAS KL-mast"
				Layer="JBTKL_EH_MAS" Color="ByLayer"
				Group="Kontaktledning/Master"
				AttMirrorX="{% if MileageIncreasesTowardsLeft %}true{% else %}false{% endif %}"
				AttMirrorY="{% if RightSided %}true{% else %}false{% endif %}"
				>
				<!-- Note: AttMirrorX is in use because the span length shall be shown on the hi-mileage side also if M.i.t.l. -->

		<RelationSourceSpace>kl-mast</RelationSourceSpace>
		<AttachmentCategory Name="kl-mast" />
		
		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___ANGULAROFFSET_TAG_OBJECTINFO_METADATA_VAR" />
		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___MILEAGE_INCREASES_TOWARDS_LEFT" />
		<xpp:expand select="NOBN_com_STD_TEXTATTRIBUTES___HORIZONTAL_AND_CLOSE___JBTKL" />
		<xpp:expand select="NOBN_com_DISCIPLINE_JBTKL" />
		<xpp:expand select="NOBN_com_CHK_NUMBER_OF_OCP_AREAS" />
		<xpp:expand select="RC_com_SET_OCP_STATION_REFERENCE" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___WAYSIDE_GENERAL_OBJECT" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___EARTHED_TO_RAIL" />

		<Variants DefaultValue="Bjelkemast">
			<Variant Name="Bjelkemast" >
				<SetValue Key="OcsMastProfile" Value="HEB240" />
				<SetValue Key="OcsMastHeight" Value="8500" />
			</Variant>
			<!-- TODO: Få ekte data for GMB-mastene -->
			<Variant Name="GMB-mast" >
				<SetValue Key="OcsMastProfile" Value="GMB" />
				<SetValue Key="OcsMastHeight" Value="8500" />
			</Variant>
			<Variant Name="H-mast" >
				<SetValue Key="OcsMastProfile" Value="H3" />
				<SetValue Key="OcsMastHeight" Value="7500" />
			</Variant>
			<Variant Name="B-mast" >
				<SetValue Key="OcsMastProfile" Value="B3" />
				<SetValue Key="OcsMastHeight" Value="7500" />
			</Variant>
			<Variant Name="Betongmast" >
				<!-- Assuming that masts always extend 2m under ground -->
				<!-- See EH.800065 (EK.800065), concrete masts & load computations -->
				<SetValue Key="OcsMastProfile" Value="Kvadratisk" />
				<SetValue Key="OcsMastDepth" Value="2000" />
				<SetValue Key="OcsMastHeight" Value="8000" />
			</Variant>
			<Variant Name="Tremast" >
				<SetValue Key="OcsMastProfile" Value="Ø260" />
				<SetValue Key="OcsMastDepth" Value="1600" />
				<SetValue Key="OcsMastHeight" Value="7500" />
			</Variant>
		</Variants>
		
		<CustomAttribute DataType="Enumeration" Name="OcsMastProfile" DisplayName="Masteprofil"
			Description="The overhead catenary system (OCS) mast profile (omp) [HEB200..280 | H3..H6 | B2..B6 | 240x240 | Ø260]." >
			<Values Variant="Bjelkemast">
				<Value>HEB280</Value>
				<Value>HEB260</Value>
				<Value>HEB240</Value>
				<Value>HEB220</Value>
				<Value>HEB200</Value>
			</Values>
			<!-- TODO: Få ekte data for GMB-mastene -->
			<Values Variant="GMB-mast">
				<Value>HEB280</Value>
				<Value>HEB260</Value>
				<Value>HEB240</Value>
				<Value>HEB220</Value>
				<Value>HEB200</Value>
			</Values>
			<Values Variant="H-mast">
				<Value>H6</Value>
				<Value>H5</Value>
				<Value>H3</Value>
			</Values>
			<Values Variant="B-mast">
				<!-- Note: B2:UNP120 - B3:UNP140 - B4:UNP160 - B5: UNP180 - B6:UNP200 -->
				<Value>B6</Value>
				<Value>B5</Value>
				<Value>B4</Value>
				<Value>B3</Value>
				<Value>B2</Value>
			</Values>
			<Values Variant="Betongmast">
				<!-- Se EK.800025 -->
				<!-- Kvadratiske har navn "13", "14" etc. -->
				<!-- Type 13 er 192x192 i toppen, bunnmål sidekanter ved 2+6m=263, 2+7m=274, 2+8m=285, 2+9m=296, 2+10m=308, 2+11m=320, 2+12m=333, 2+13m=346 -->
				<!-- Type 14 sidelem er 200x200, type 15 er 208x208 i topp etc.-->
				<!-- Rektangulære "smal-master" har navn "13S", "14S" etc.  -->
				<!-- Smalmast 13S har toppmål 130/239, Bunnmål 2+4m=152/296m 2+5m=158/308, 2+6m=154/320, 2+7m=171/333, 2+8m=178/346, 2+9m=185/360, 2+10m=192/374. -->
				<!-- Smalmast 14S har toppmål 130x253, 15S=130/274, 16S=130/285, 17S=130/296, 18S=130/320, 19S=130/346 -->
				<!-- Bredside smalmast type 13S er altså som type 18 mast, bredside 14S som 20-mast, 15S som 22-mast, 16S som 23-mast, 17S som 24-mast, 18S som 26, 19S som "28". (litt uten system...)-->
				<Value>27</Value>
				<Value>26</Value>
				<Value>25</Value>
				<Value>24</Value>
				<Value>23</Value>
				<Value>22</Value>
				<Value>21</Value>
				<Value>20</Value>
				<Value>19</Value>
				<Value>18</Value>
				<Value>17</Value>
				<Value>16</Value>
				<Value>15</Value>
				<Value>14</Value>
				<Value>13</Value> 	<!-- TODO: 2020-09-26 Dimensjon 13 (2+6m..2+13m) er modellert i 3D -->
				<Value>19S</Value>
				<Value>18S</Value>
				<Value>17S</Value>
				<Value>16S</Value>
				<Value>15S</Value>
				<Value>14S</Value>
				<Value>13S</Value> 	<!-- TODO: 2020-09-26 Smal dimensjon type 13S (2+6m..2+10m) er modellert i 3D -->
			</Values>
			<Values Variant="Tremast">
				<Value>Ø260</Value>
			</Values>
		</CustomAttribute>
		
		<CustomAttribute DataType="Enumeration" Name="OcsMastHeight" DisplayName="Mastehøyde" DefaultValue="7000"
			Description="The overhead catenary system (OCS) mast height (omh) [mm], given in predefined lengths in 100 millimeter steps." >
			<Values Variant="Bjelkemast">
				<Value>13000</Value>
				<Value>12500</Value>
				<Value>12000</Value>
				<Value>11500</Value>
				<Value>11000</Value>
				<Value>10500</Value>
				<Value>10000</Value>
				<Value>9500</Value>
				<Value>9000</Value>
				<Value>8500</Value>
				<Value>8000</Value>
				<Value>7500</Value>
				<Value>7000</Value>
				<Value>6500</Value>
				<Value>6000</Value>
			</Values>
			<Values Variant="GMB-mast">
				<!-- TODO: Få ekte data for GMB-mastene -->
				<Value>13000</Value>
				<Value>12500</Value>
				<Value>12000</Value>
				<Value>11500</Value>
				<Value>11000</Value>
				<Value>10500</Value>
				<Value>10000</Value>
				<Value>9500</Value>
				<Value>9000</Value>
				<Value>8500</Value>
				<Value>8000</Value>
				<Value>7500</Value>
				<Value>7000</Value>
				<Value>6500</Value>
				<Value>6000</Value>
			</Values>
			<Values Variant="H-mast">
				<Value>13000</Value>
				<Value>12500</Value>
				<Value>12000</Value>
				<Value>11500</Value>
				<Value>11000</Value>
				<Value>10500</Value>
				<Value>10000</Value>
				<Value>9500</Value>
				<Value>9000</Value>
				<Value>8500</Value>
				<Value>8000</Value>
				<Value>7500</Value>
				<Value>7000</Value>
				<Value>6500</Value>
				<Value>6000</Value>
			</Values>
			<Values Variant="B-mast">
				<Value>13000</Value>
				<Value>12500</Value>
				<Value>12000</Value>
				<Value>11500</Value>
				<Value>11000</Value>
				<Value>10500</Value>
				<Value>10000</Value>
				<Value>9500</Value>
				<Value>9000</Value>
				<Value>8500</Value>
				<Value>8000</Value>
				<Value>7500</Value>
			</Values>
			<Values Variant="Betongmast">
				<!-- Betongmast. Se tegning 'EK.800265-000_000_001 Betongmaster - mål og beregninger'. -->
				<!-- Mangler data her - EK.800025 sier ikke noe om hvor dypt masta må stikke -->
				<Value>13000</Value>
				<Value>12000</Value>
				<Value>11000</Value>
				<Value>10000</Value>
				<Value>9000</Value>
				<Value>8000</Value>
				<Value>7000</Value>
				<Value>6000</Value>
			</Values>
			<Values Variant="Betongmast, smal">
				<!-- Betongmast. Se tegning 'EK.800265-000_000_001 Betongmaster - mål og beregninger'. -->
				<Value>13000</Value>
				<Value>12000</Value>
				<Value>11000</Value>
				<Value>10000</Value>
				<Value>9000</Value>
				<Value>8000</Value>
				<Value>7000</Value>
				<Value>6000</Value>
			</Values>
			<Values Variant="Tremast">
				<!-- Tremast er kun modellert som Ø260. Se tegning 'EH-701770-000_005_001 Tremast oppsetting og bardunfeste'-->
				<Value>12000</Value>
				<Value>11500</Value>
				<Value>11000</Value>
				<Value>10500</Value>
				<Value>10000</Value>
				<Value>9500</Value>
				<Value>9000</Value>
				<Value>8500</Value>
				<Value>8000</Value>
				<Value>7500</Value>
				<Value>7000</Value>
				<Value>6500</Value>
				<Value>6000</Value>
			</Values>
		</CustomAttribute>
		
		<CustomAttribute DataType="Enumeration" Name="OcsMastDepth" DisplayName="Mastedybde" DefaultValue="0"
			Description="The overhead catenary system (OCS) mast depth below ground reference level (omd) [mm]." >
			<Values Variant="Bjelkemast">
				<Value>0</Value>
			</Values>
			<Values Variant="GMB-mast">
				<Value>0</Value>
			</Values>
			<Values Variant="H-mast">
				<Value>0</Value>
			</Values>
			<Values Variant="B-mast">
				<Value>0</Value>
			</Values>
			<Values Variant="Betongmast">
				<Value>2000</Value>
			</Values>
			<!-- TODO: Få ekte data for tremastene -->
			<Values Variant="Tremast">
				<Value>2000</Value>
				<Value>1800</Value>
				<Value>1600</Value> <!-- Kun nedstikk 1600 er modellert i 3D -->
			</Values>
		</CustomAttribute>
		
		<CustomAttribute DataType="Enumeration" Name="NewOrExisting" DisplayName="Ny eller eksisterende" DefaultValue="Ny"
			Description="The overhead catenary system (OCS) mast's age [Ny | Eksisterende] (New/Existing)." >
			<Value>Ny</Value>
			<Value>Eksisterende</Value>
		</CustomAttribute>

		<CustomAttribute DataType="Double" Name="SpanLength" DisplayName="Spennlengde" DefaultValue="30" 
			Description="The span length (sl) [m] denotes the distance traveled along the associated alignment's reference alignment (projected onto the XY plane) from this mast to the closest next mast, related using 'Neste kl-mast'/'Forrige kl-mast'." />
		<CustomAttribute DataType="String" Name="SpanLengthDisplay" DisplayName="Spennlengde visning" DefaultValue="" 
			Description="The span length value [m] being displayed close to the OCS mast." />
        <TextAttribute BindingProperty="SpanLengthDisplay" CadAttributeTag="SPENNLENGDE" X="15" Y="5" 
				Layer="JBTKL__SPENNLENGDE" Justify="MiddleCenter" Height="0.9" Width="0" Rotation="0" ObliqueAngle="0" Constant="false" 
				Invisible="false" Lock="false" MText="false" Preset="false" Verifiable="false" /> 
		<TextPositionLuaExpression Name="SPENNLENGDE"><Formula>_EH_MAS_SpanLengthTextOffset()</Formula></TextPositionLuaExpression>
		<TextRotationLuaExpression Name="SPENNLENGDE"><Formula>_EH_MAS_SpanLengthTextRotation()</Formula></TextRotationLuaExpression>

		<CustomAttribute DataType="Double" Name="SpanLength2" DisplayName="Spennlengde 2" DefaultValue="30.0" 
			Description="The span length 2 (sl) [m] denotes the distance traveled along the associated alignment's reference alignment (projected onto the XY plane) from this mast to the second closest next mast, related using 'Neste kl-mast'/'Forrige kl-mast'." />
		<CustomAttribute DataType="String" Name="SpanLengthDisplay2" DisplayName="Spennlengde visning 2" DefaultValue="" 
			Description="The span length 2 value [m] being displayed close to the OCS mast, rounded to the closest integer value." />
        <TextAttribute BindingProperty="SpanLengthDisplay2" CadAttributeTag="SPENNLENGDE2" X="15" Y="7" 
				Layer="JBTKL__SPENNLENGDE" Justify="MiddleCenter" Height="0.9" Width="0" Rotation="0" ObliqueAngle="0" Constant="false" 
				Invisible="false" Lock="false" MText="false" Preset="false" Verifiable="false" /> 
		<TextPositionLuaExpression Name="SPENNLENGDE2"><Formula>_EH_MAS_SpanLengthTextOffset2()</Formula></TextPositionLuaExpression>
		<TextRotationLuaExpression Name="SPENNLENGDE2"><Formula>_EH_MAS_SpanLengthTextRotation2()</Formula></TextRotationLuaExpression>

		<LuaExpression Name="dir"><Formula>"both"</Formula></LuaExpression>
		<LuaExpression Name="code"><Formula>_EH_MAS_non_yoke_mast_code()</Formula></LuaExpression>
		<LuaExpression Name="name"><Formula>code</Formula></LuaExpression>
		<LuaExpression Name="SpanLength"><Formula>_EH_MAS_SpanLength()</Formula></LuaExpression>
		<LuaExpression Name="SpanLengthDisplay"><Formula>_EH_MAS_SpanLengthDisplay()</Formula></LuaExpression>
		<LuaExpression Name="SpanLength2"><Formula>_EH_MAS_SpanLength2()</Formula></LuaExpression>
		<LuaExpression Name="SpanLengthDisplay2"><Formula>_EH_MAS_SpanLengthDisplay2()</Formula></LuaExpression>

		<LuaExpression Name="AngularOffset"><Formula>_EH_MAS_mast_AngularOffset()</Formula></LuaExpression>
		<LuaFunction Name="_EH_MAS_mast_AngularOffset()" ReturnType="Double"
				HideFromUser="false"
				Description="Returns an angular offset, to orient the (ordinary) mast colinear with its yoke (if any)." >
			<Constructor>Double _EH_MAS_mast_AngularOffset()</Constructor>
			<Formula>
				function _EH_MAS_mast_AngularOffset()
					local yRelationName = "Er åk-mast for åk"
					yr,yn = RC__getCollectionOfRelatedObjects(yRelationName)
					if yn == 0 then
						return getPropertyValue("AngularOffset"),_info("No control input - adjust angular offset manually or relate with '"..yRelationName.."' to a yoke (which has second support mast).")
				
					else
						local yoke = yr[0]
						local s = "Er åk holdt oppe av kl-mast"
						local r,n = RC__getCollectionOfRelatedObjects(s,yoke)
				
						if n == 0 then
							return getPropertyValue("AngularOffset"),_error,
								_info("*** ERROR Mast has bad connection to galley '"..RC__identify(yoke).."'.")
				
						elseif n == 1 then
							--Galley:
							return getPropertyValue("AngularOffset"),
								_info("Mast is connected to a galley '"..RC__identify(yoke)..
								"' - adjust mast's angular offset manually or change galley into yoke (which has one more yoke support mast).")
						
						elseif n == 2 then
							--Assume that the first two related masts are located at the yoke's extremities:
							local m1 = r[0]
							local m2 = r[1]
							if RC__getDistance2D(this,m1) &gt; RC__getDistance2D(this,m2) then m1,m2 = m2,m1 end 
							local x1 = m1.geoCoord.X		
							local y1 = m1.geoCoord.Y
							local x2 = m2.geoCoord.X
							local y2 = m2.geoCoord.Y
							local yokeAngle = math.atan(y2-y1,x2-x1) * (180/math.pi) 
							local tg = getAlignmentInfo().Tangent
							local baseAngle = math.atan(tg.Y,tg.X) * (180/math.pi)
							local info = "Angular Offset deduced using yoke support masts '"..RC__identify(m1).."' and '"..RC__identify(m2).."'."
							return (2*360.0 + RC__round(yokeAngle - (baseAngle-90.0),3)) % 360.0,_info(info)
				
						else
							--TODO: Locate the two support masts at each end of yoke, uses this to find angular offset, then turn yourself if you 
							--are a support mast at one or the other end, or just adapt if you are in between ends.
							return getPropertyValue("AngularOffset"),
								_info("Mast is connected to a yoke '"..RC__identify(yoke).." with total 3 or more supporting masts"..
								"' - adjust mast's angular offset manually.")
						end
					end
				end
			</Formula>
		</LuaFunction>
		
		<LuaExpression Name="Model3DName"><Formula>_EH_MAS_KlMast_Model3DName()</Formula></LuaExpression>
		<LuaFunction Name="_EH_MAS_KlMast_Model3DName()" 
			ReturnType="String"
			Description="Obtains the 'Model3DName' for this KL mast." >
			<Formula>
				function _EH_MAS_KlMast_Model3DName()
					if Variant:lower():match("bjelkemast") then
						return "NO-BN-3D-EH-MAS-BJELKEMAST-" ..OcsMastProfile .."-191x374xM36-"..OcsMastHeight
					elseif Variant:lower():match("gmb%-mast") then
						--TODO: Få ekte data for GMB-mastene, Lage 3D GMB-master
						return "NO-BN-3D-EH-MAS-GMBMAST-" ..OcsMastProfile .."-" ..OcsMastHeight
					elseif Variant:lower():match("h%-mast") then
						--Assume the 191x374 modern type:
						return "NO-BN-3D-EH-MAS-GITTERMAST-" ..OcsMastProfile .."-191x374xM36-"..OcsMastHeight
					elseif Variant:lower():match("b%-mast") then
						--Assume the 191x374 modern type:
						return "NO-BN-3D-EH-MAS-GITTERMAST-" ..OcsMastProfile .."-191x374xM36-"..OcsMastHeight
					elseif Variant:lower():match("betongmast") then
						return "NO-BN-3D-EH-MAS-BETONGMAST-" ..OcsMastProfile .."-"..OcsMastDepth.."-"..OcsMastHeight
					elseif Variant:lower():match("tremast") then
						return "NO-BN-3D-EH-MAS-TREMAST-" ..OcsMastProfile .."-"..OcsMastDepth.."-"..OcsMastHeight
					else
						return "Ukjent Variant ["..Variant.."]",_warning
					end
				end
			</Formula>
		</LuaFunction>

		<!-- CLFEY: Dropp formel for mastehøyde på funksjon av utliggerhøyde - må gjøres mye mer avansert, eller helt manuelt. -->
		<!-- <LuaExpression Name="OcsMastHeight"> -->
			<!-- <Formula>if (getCollectionLength(Relations["Er kl-mast for utligger"]) == 0) then return 8500 end -->
				<!-- local h = Relations["Er kl-mast for utligger"][0].RelativeElevation -->
				<!-- if (Relations["Er kl-mast for utligger"][0].Variant == 20) then h = h + 2.186 end -->
				<!-- h = h * 10 -->
				<!-- return math.floor(h + 5 - (h%5))*100 -->
			<!-- </Formula> -->
		<!-- </LuaExpression> -->
			
		<InsertSymbol VariantName="Bjelkemast" DisplayBlockName="NO-BN-2D-JBTKL-MAST-BJELKEMAST" 
				DefaultSnapMode="Alignment" SnapToAlignment="true" SnapDistance="4" SubGroup="Ordinære master" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<Rotation AddAngle="0" Direction="false" RotateIfRightSideOfAlignment="true" />
			<SetValue Key="MileageIncreasesTowardsLeft" Value="{{alignmentRotation | minus:ucsRotation | cosisnegative}}" />
		</InsertSymbol>
		
		<InsertSymbol VariantName="GMB-mast" DisplayBlockName="NO-BN-2D-JBTKL-MAST-GMBMAST" 
				DefaultSnapMode="Alignment" SnapToAlignment="true" SnapDistance="4" SubGroup="Ordinære master" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<Rotation AddAngle="0" Direction="false" RotateIfRightSideOfAlignment="true" />
			<SetValue Key="MileageIncreasesTowardsLeft" Value="{{alignmentRotation | minus:ucsRotation | cosisnegative}}" />
		</InsertSymbol>
		
		<InsertSymbol VariantName="H-mast" DisplayBlockName="NO-BN-2D-JBTKL-MAST-GITTERMAST-H" 
				DefaultSnapMode="Alignment" SnapToAlignment="true" SnapDistance="4" SubGroup="Ordinære master" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<Rotation AddAngle="0" Direction="false" RotateIfRightSideOfAlignment="true" />
			<SetValue Key="MileageIncreasesTowardsLeft" Value="{{alignmentRotation | minus:ucsRotation | cosisnegative}}" />
		</InsertSymbol>
		
		<InsertSymbol VariantName="B-mast" DisplayBlockName="NO-BN-2D-JBTKL-MAST-GITTERMAST-B" 
				DefaultSnapMode="Alignment" SnapToAlignment="true" SnapDistance="4" SubGroup="Ordinære master" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<Rotation AddAngle="0" Direction="false" RotateIfRightSideOfAlignment="true" />
			<SetValue Key="MileageIncreasesTowardsLeft" Value="{{alignmentRotation | minus:ucsRotation | cosisnegative}}" />
		</InsertSymbol>
		
		<InsertSymbol VariantName="Betongmast" DisplayBlockName="NO-BN-2D-JBTKL-MAST-BETONGMAST" 
				DefaultSnapMode="Alignment" SnapToAlignment="true" SnapDistance="4" SubGroup="Ordinære master" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<Rotation AddAngle="0" Direction="false" RotateIfRightSideOfAlignment="true" />
			<SetValue Key="MileageIncreasesTowardsLeft" Value="{{alignmentRotation | minus:ucsRotation | cosisnegative}}" />
		</InsertSymbol>
		
		<InsertSymbol VariantName="Tremast" DisplayBlockName="NO-BN-2D-JBTKL-MAST-TREMAST" 
				DefaultSnapMode="Alignment" SnapToAlignment="true" SnapDistance="4" SubGroup="Ordinære master" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<Rotation AddAngle="0" Direction="false" RotateIfRightSideOfAlignment="true" />
			<SetValue Key="MileageIncreasesTowardsLeft" Value="{{alignmentRotation | minus:ucsRotation | cosisnegative}}" />
		</InsertSymbol>
		
		<SymbolDefinition X="0.0" Y="0.0" AllowSymbolMove="true" DefaultBlockName="NO-BN-2D-JBTKL-MAST-BJELKEMAST" >
			<Rotation RotateDirection="false" AddAngle="{% if dir == 'up' %}{{270.0|plus:AngularOffset}}
														{% elsif dir == 'down' %}{{90.0|plus:AngularOffset}}
														{% elsif dir == 'both' and RightSided %}{{180.0|plus:AngularOffset}}
														{% elsif dir == 'both' and LeftSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and RightSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and LeftSided %}{{180.0|plus:AngularOffset}}
														{% else %}45.0
														{% endif %}" />	
			<BlockNameFormat JoinBy="-">
				NO-BN-2D-JBTKL-MAST
				{%    if Variant == 'Bjelkemast' %}BJELKEMAST
				{% elsif Variant == 'GMB-mast' %}GMBMAST
				{% elsif Variant == 'B-mast' %}GITTERMAST-B
				{% elsif Variant == 'H-mast' %}GITTERMAST-H
				{% elsif Variant == 'Betongmast' %}BETONGMAST
				{% elsif Variant == 'Tremast' %}TREMAST
				{% else %}BAD_VARIANT
				{% endif %}
			</BlockNameFormat>
		</SymbolDefinition>
		
		<SymbolDefinition X="0.0" Y="0.0" DefaultBlockName="NO-BN-2D-INSERTION-POINT" />

		<SnapPointsDefinitions>
			<SnapPoints>
				<SnapPoint X="0.0" Y="0.0" TargetSpace="åk" />
				<SnapPoint X="0.0" Y="0.0" TargetSpace="skilt" />
				<SnapPoint X="0.0" Y="0.0" TargetSpace="utligger" />
				<SnapPoint X="0.0" Y="0.0" TargetSpace="avspenning" />
				<SnapPoint X="0.0" Y="0.0" TargetSpace="kl-fundament" /> 
				<SnapPoint X="0.0" Y="0.0" TargetSpace="autotransformator" /> 
				<SnapPoint X="0.0" Y="0.0" TargetSpace="beskyttelse" /> 
				<SnapPoint X="0.0" Y="0.0" TargetSpace="seksjonsutliggerkonsoll" /> 
			</SnapPoints>
		</SnapPointsDefinitions>
	</ObjectType>



<!--========================================================================================================
	KONTAKTLEDNING
	MASTER
	EH-MAS Hengemast for bru og tunnel
=========================================================================================================-->
	<ObjectType DataType="tOrientedElement" Class="RailwayPlacedObject" Name="EH-MAS Hengemast for bru og tunnel"
				Layer="JBTKL_EH_MAS_HGM_TUNNEL" Color="ByLayer"
				Group="Kontaktledning/Master"
				AttMirrorY="{% if RightSided %}true{% else %}false{% endif %}"
				>
				
		<RelationSourceSpace>kl-mast</RelationSourceSpace>

		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___ANGULAROFFSET_TAG_OBJECTINFO_METADATA_VAR" />
		<xpp:expand select="NOBN_com_STD_TEXTATTRIBUTES___HORIZONTAL_RIGHT_SIDE___JBTKL" />
		<xpp:expand select="NOBN_com_DISCIPLINE_JBTKL" />
		<xpp:expand select="NOBN_com_CHK_NUMBER_OF_OCP_AREAS" />
		<xpp:expand select="RC_com_SET_OCP_STATION_REFERENCE" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___WAYSIDE_GENERAL_OBJECT" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___EARTHED_TO_NONE" />
 		
		<Variants DefaultValue="Hengemast for bru og tunnel">
			<Variant Name="Hengemast for bru og tunnel" >
				<SetValue Key="OcsMastProfile" Value="Sirkulær, Ø120" />
				<SetValue Key="OcsMastHeight" Value="3100" />
			</Variant>
			<Variant Name="Hengemast Cariboni" >
				<SetValue Key="OcsMastProfile" Value="Rektangulær, 100x150" />
				<SetValue Key="OcsMastHeight" Value="3100" />
			</Variant>
		</Variants>
		
			<!-- TODO: 100x100 suspension masts - Description="The overhead catenary system (OCS) suspension mast profile (smp) [Sirkulær, Ø120 | Kvadratisk, 100x100 | Rektangulær, 100x150 | Rektangulær, 100x200]." > -->
		<CustomAttribute DataType="Enumeration" Name="OcsMastProfile" DisplayName="Masteprofil" DefaultValue="Sirkulær, Ø120"
			Description="The overhead catenary system (OCS) suspension mast profile (smp) [Sirkulær, Ø120 | Rektangulær, 100x150 | Rektangulær, 100x200]." >
			<Values Variant="Hengemast for bru og tunnel">
				<Value>Sirkulær, Ø120</Value>
				<!-- <Value>Kvadratisk, 100x100</Value> -->
				<Value>Rektangulær, 100x150</Value>
				<Value>Rektangulær, 100x200</Value>				
			</Values>
			<Values Variant="Hengemast Cariboni">
				<!-- <Value>Kvadratisk, 100x100</Value> -->
				<Value>Rektangulær, 100x150</Value>
			</Values>
		</CustomAttribute>
		
		<CustomAttribute DataType="Enumeration" Name="OcsMastHeight" DisplayName="Høyde" DefaultValue="3600" 
			Description="The overhead catenary system (OCS) suspension mast height (smh) [mm], given in predefined lengths 0.5m - 5.0m in 50 millimeter steps." >
			<Values Variant="Hengemast for bru og tunnel">	
				<Value>5000</Value>
				<Value>4950</Value>
				<Value>4900</Value>
				<Value>4850</Value>
				<Value>4800</Value>
				<Value>4750</Value>
				<Value>4700</Value>
				<Value>4650</Value>
				<Value>4600</Value>
				<Value>4550</Value>
				<Value>4500</Value>
				<Value>4450</Value>
				<Value>4400</Value>
				<Value>4350</Value>
				<Value>4300</Value>
				<Value>4250</Value>
				<Value>4200</Value>
				<Value>4150</Value>
				<Value>4100</Value>
				<Value>4050</Value>
				<Value>4000</Value>
				<Value>3950</Value>
				<Value>3900</Value>
				<Value>3850</Value>
				<Value>3800</Value>
				<Value>3750</Value>
				<Value>3700</Value>
				<Value>3650</Value>
				<Value>3600</Value>
				<Value>3550</Value>
				<Value>3500</Value>
				<Value>3450</Value>
				<Value>3400</Value>
				<Value>3350</Value>
				<Value>3300</Value>
				<Value>3250</Value>
				<Value>3200</Value>
				<Value>3150</Value>
				<Value>3100</Value>
				<Value>3050</Value>
				<Value>3000</Value>
				<Value>2950</Value>
				<Value>2900</Value>
				<Value>2850</Value>
				<Value>2800</Value>
				<Value>2750</Value>
				<Value>2700</Value>
				<Value>2650</Value>
				<Value>2600</Value>
				<Value>2550</Value>
				<Value>2500</Value>
				<Value>2450</Value>
				<Value>2400</Value>
				<Value>2350</Value>
				<Value>2300</Value>
				<Value>2250</Value>
				<Value>2200</Value>
				<Value>2150</Value>
				<Value>2100</Value>
				<Value>2050</Value>
				<Value>2000</Value>
				<Value>1950</Value>
				<Value>1900</Value>
				<Value>1850</Value>
				<Value>1800</Value>
				<Value>1750</Value>
				<Value>1700</Value>
				<Value>1650</Value>
				<Value>1600</Value>
				<Value>1550</Value>
				<Value>1500</Value>
				<Value>1450</Value>
				<Value>1400</Value>
				<Value>1350</Value>
				<Value>1300</Value>
				<Value>1250</Value>
				<Value>1200</Value>
				<Value>1150</Value>
				<Value>1100</Value>
				<Value>1050</Value>
				<Value>1000</Value>
				<Value>950</Value>
				<Value>900</Value>
				<Value>850</Value>
				<Value>800</Value>
				<Value>750</Value>
				<Value>700</Value>
				<Value>650</Value>
				<Value>600</Value>
				<Value>550</Value>
				<Value>500</Value>
			</Values>
			<Values Variant="Hengemast Cariboni">
				<Value>5000</Value>
				<Value>4950</Value>
				<Value>4900</Value>
				<Value>4850</Value>
				<Value>4800</Value>
				<Value>4750</Value>
				<Value>4700</Value>
				<Value>4650</Value>
				<Value>4600</Value>
				<Value>4550</Value>
				<Value>4500</Value>
				<Value>4450</Value>
				<Value>4400</Value>
				<Value>4350</Value>
				<Value>4300</Value>
				<Value>4250</Value>
				<Value>4200</Value>
				<Value>4150</Value>
				<Value>4100</Value>
				<Value>4050</Value>
				<Value>4000</Value>
				<Value>3950</Value>
				<Value>3900</Value>
				<Value>3850</Value>
				<Value>3800</Value>
				<Value>3750</Value>
				<Value>3700</Value>
				<Value>3650</Value>
				<Value>3600</Value>
				<Value>3550</Value>
				<Value>3500</Value>
				<Value>3450</Value>
				<Value>3400</Value>
				<Value>3350</Value>
				<Value>3300</Value>
				<Value>3250</Value>
				<Value>3200</Value>
				<Value>3150</Value>
				<Value>3100</Value>
				<Value>3050</Value>
				<Value>3000</Value>
				<Value>2950</Value>
				<Value>2900</Value>
				<Value>2850</Value>
				<Value>2800</Value>
				<Value>2750</Value>
				<Value>2700</Value>
				<Value>2650</Value>
				<Value>2600</Value>
				<Value>2550</Value>
				<Value>2500</Value>
				<Value>2450</Value>
				<Value>2400</Value>
				<Value>2350</Value>
				<Value>2300</Value>
				<Value>2250</Value>
				<Value>2200</Value>
				<Value>2150</Value>
				<Value>2100</Value>
				<Value>2050</Value>
				<Value>2000</Value>
				<Value>1950</Value>
				<Value>1900</Value>
				<Value>1850</Value>
				<Value>1800</Value>
				<Value>1750</Value>
				<Value>1700</Value>
				<Value>1650</Value>
				<Value>1600</Value>
				<Value>1550</Value>
				<Value>1500</Value>
				<Value>1450</Value>
				<Value>1400</Value>
				<Value>1350</Value>
				<Value>1300</Value>
				<Value>1250</Value>
				<Value>1200</Value>
				<Value>1150</Value>
				<Value>1100</Value>
				<Value>1050</Value>
				<Value>1000</Value>
				<Value>950</Value>
				<Value>900</Value>
				<Value>850</Value>
				<Value>800</Value>
				<Value>750</Value>
				<Value>700</Value>
				<Value>650</Value>
				<Value>600</Value>
				<Value>550</Value>
				<Value>500</Value>
			</Values>
        </CustomAttribute>

		<CustomAttribute DataType="Enumeration" Name="NewOrExisting" DisplayName="Ny eller eksisterende" DefaultValue="Ny"
			Description="The overhead catenary system (OCS) mast's age [Ny | Eksisterende]." >
			<Value>Ny</Value>
			<Value>Eksisterende</Value>
		</CustomAttribute>

		<CustomAttribute DataType="Double" Name="SpanLength" DisplayName="Spennlengde" DefaultValue="30" 
			Description="The span length (sl) [m] denotes the distance traveled along the associated alignment's reference alignment (projected onto the XY plane) from this mast to the closest next mast, related using 'Neste kl-mast'/'Forrige kl-mast'." />
		<CustomAttribute DataType="String" Name="SpanLengthDisplay" DisplayName="Spennlengde visning" DefaultValue="" 
			Description="The span length value [m] being displayed close to the OCS mast." />
        <TextAttribute BindingProperty="SpanLengthDisplay" CadAttributeTag="SPENNLENGDE" X="15" Y="5" 
				Layer="JBTKL__INFO" Justify="MiddleCenter" Height="0.9" Width="0" Rotation="0" ObliqueAngle="0" Constant="false" 
				Invisible="false" Lock="false" MText="false" Preset="false" Verifiable="false" /> 
		<TextPositionLuaExpression Name="SPENNLENGDE"><Formula>_EH_MAS_SpanLengthTextOffset()</Formula></TextPositionLuaExpression>

		<CustomAttribute DataType="Double" Name="SpanLength2" DisplayName="Spennlengde 2" DefaultValue="30" 
			Description="The span length 2 (sl) [m] denotes the distance traveled along the associated alignment's reference alignment (projected onto the XY plane) from this mast to the second closest next mast, related using 'Neste kl-mast'/'Forrige kl-mast'." />
		<CustomAttribute DataType="String" Name="SpanLengthDisplay2" DisplayName="Spennlengde visning 2" DefaultValue="" 
			Description="The span length 2 value [m] being displayed close to the OCS mast, rounded to the closest integer value." />
        <TextAttribute BindingProperty="SpanLengthDisplay2" CadAttributeTag="SPENNLENGDE2" X="15" Y="7" 
				Layer="JBTKL__INFO" Justify="MiddleCenter" Height="0.9" Width="0" Rotation="0" ObliqueAngle="0" Constant="false" 
				Invisible="false" Lock="false" MText="false" Preset="false" Verifiable="false" /> 
		<TextPositionLuaExpression Name="SPENNLENGDE2"><Formula>_EH_MAS_SpanLengthTextOffset2()</Formula></TextPositionLuaExpression>
		
		<LuaExpression Name="SpanLength"><Formula>_EH_MAS_SpanLength()</Formula></LuaExpression>
		<LuaExpression Name="SpanLengthDisplay"><Formula>_EH_MAS_SpanLengthDisplay()</Formula></LuaExpression>
		<LuaExpression Name="SpanLength2"><Formula>_EH_MAS_SpanLength2()</Formula></LuaExpression>
		<LuaExpression Name="SpanLengthDisplay2"><Formula>_EH_MAS_SpanLengthDisplay2()</Formula></LuaExpression>

		<LuaExpression Name="dir"><Formula>"both"</Formula></LuaExpression>
		<LuaExpression Name="code"><Formula>_EH_MAS_non_yoke_mast_code()</Formula></LuaExpression>
		<LuaExpression Name="name"><Formula>code</Formula></LuaExpression>

		<LuaExpression Name="RelativeElevation"><Formula>_EH_MAS_tunnel_suspension_mast_RelativeElevation()</Formula></LuaExpression>
		<LuaFunction Name="_EH_MAS_tunnel_suspension_mast_RelativeElevation()" ReturnType="Double"
				HideFromUser="false"
				Description="Returns the relative elevation for a ocs mast suspended from a yoke, based on the yoke's type and relative elevation.">
			<Constructor>Double _EH_MAS_tunnel_suspension_mast_RelativeElevation()</Constructor>
			<Formula>
				function _EH_MAS_tunnel_suspension_mast_RelativeElevation()
					s = "Har kl-fundament"
					r,n = RC__getCollectionOfRelatedObjects(s)
					if n == 0 then
						-- Belongs to a bridge underside (with no bolt group/foundation object), or has not (yet) received its bolt group relation:
						return 7.0,_info(
						"UNFINISHED - Relate mast with 'Har kl-fundament' to OCS ceiling bolt group, or delete formula and replace by actual relative height if bolt group is irrelevant.")
					else
						-- Has bolt group:
						return r[0].RelativeElevation,_info("Value obtained from foundation '"..RC__identify(r[0]).."'.")
					end
				end
			</Formula>
		</LuaFunction>

		<LuaExpression Name="Model3DName"><Formula>_EH_MAS_tunnel_mast_Model3DName()</Formula></LuaExpression>
		<LuaFunction Name="_EH_MAS_tunnel_mast_Model3DName()" 
			ReturnType="String"
			Description="Obtains the 'Model3DName' for this OCS suspension mast." >
			<Constructor>String _EH_MAS_tunnel_mast_Model3DName()</Constructor>
			<Formula>
				function _EH_MAS_tunnel_mast_Model3DName()
					local h = (math.floor((125 + OcsMastHeight) / 250)) * 250 -- Assume 3D models in steps of 250 mm
					if Variant:match("Hengemast for bru og tunnel") ~= nil then
						if (OcsMastProfile == "Sirkulær, Ø120") then
							return "NO-BN-3D-EH-MAS-HENGEMAST-FOR-BRU-OG-TUNNEL-350x350xM24-Ø120-"..h
						elseif (OcsMastProfile == "Rektangulær, 100x150") then 
							return "NO-BN-3D-EH-MAS-HENGEMAST-FOR-BRU-OG-TUNNEL-350x350xM24-HUP-100x150-"..h
						elseif (OcsMastProfile == "Rektangulær, 100x200") then
							return "NO-BN-3D-EH-MAS-HENGEMAST-FOR-BRU-OG-TUNNEL-350x350xM24-HUP-100x200-"..h
						end
					elseif Variant:match("Hengemast Cariboni") ~= nil then
						if (OcsMastProfile == "Rektangulær, 100x150") then 
							return "NO-BN-3D-EH-MAS-HENGEMAST-FOR-BRU-OG-TUNNEL-350x350xM24-HUP-100x150-"..h
						end
					else 
						return "Bad OCS suspension mast Variant ["..Variant.."].",_warning
					end
				end
			</Formula>
		</LuaFunction>
		
		<InsertSymbol VariantName="Hengemast for bru og tunnel" DisplayBlockName="NO-BN-2D-JBTKL-HENGEMAST-FOR-BRU-OG-TUNNEL"
				DefaultSnapMode="Alignment" SnapToAlignment="true" SnapDistance="2.65" SubGroup="Hengemast for bru og tunnel" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<Rotation AddAngle="0" />
		</InsertSymbol>
		
		<InsertSymbol VariantName="Hengemast Cariboni" DisplayBlockName="NO-BN-2D-JBTKL-HENGEMAST-CARIBONI" 
				DefaultSnapMode="Alignment" SnapToAlignment="true" SnapDistance="1.2" SubGroup="Hengemast for bru og tunnel" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<Rotation AddAngle="0" RotateIfRightSideOfAlignment="true" />
		</InsertSymbol>
		
		<SymbolDefinition X="0.0" Y="0.0" AllowSymbolMove="true" DefaultBlockName="NO-BN-2D-JBTKL-HENGEMAST-FOR-BRU-OG-TUNNEL" >
			<Rotation RotateDirection="false" AddAngle="{% if dir == 'up' %}{{270.0|plus:AngularOffset}}
														{% elsif dir == 'down' %}{{90.0|plus:AngularOffset}}
														{% elsif dir == 'both' and RightSided %}{{180.0|plus:AngularOffset}}
														{% elsif dir == 'both' and LeftSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and RightSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and LeftSided %}{{180.0|plus:AngularOffset}}
														{% else %}45.0
														{% endif %}" />	
			<BlockNameFormat JoinBy="-">
				NO-BN-2D-JBTKL-HENGEMAST
				{% if Variant == 'Hengemast for bru og tunnel' %}FOR-BRU-OG-TUNNEL
				{% elsif Variant == 'Hengemast Cariboni' %}CARIBONI
				{% else %}BAD_VARIANT
				{% endif %}
			</BlockNameFormat>
		</SymbolDefinition>
		
		<SymbolDefinition X="0.0" Y="0.0" DefaultBlockName="NO-BN-2D-INSERTION-POINT" />

		<SnapPointsDefinitions>
			<SnapPoints>
				<SnapPoint X="0.0" Y="0.0" TargetSpace="skilt" />
				<SnapPoint X="0.0" Y="0.0" TargetSpace="utligger" />
				<SnapPoint X="0.0" Y="0.0" TargetSpace="beskyttelse" />
			</SnapPoints>
		</SnapPointsDefinitions>

	</ObjectType>

 

<!--========================================================================================================
	KONTAKTLEDNING
	MASTER
	EH-MAS Hengemast for åk
=========================================================================================================-->
	<ObjectType DataType="tOrientedElement" Class="RailwayPlacedObject" Name="EH-MAS Hengemast for åk"
				Layer="JBTKL_EH_MAS_HGM_ÅK" Color="ByLayer"
				Group="Kontaktledning/Master"
				AttMirrorY="{% if RightSided %}true{% else %}false{% endif %}"
				>
				
		<RelationSourceSpace>kl-mast</RelationSourceSpace>

		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___ANGULAROFFSET_TAG_OBJECTINFO_METADATA_VAR" />
		<xpp:expand select="NOBN_com_STD_TEXTATTRIBUTES___HORIZONTAL_RIGHT_SIDE___JBTKL" />
		<xpp:expand select="NOBN_com_DISCIPLINE_JBTKL" />
		<xpp:expand select="NOBN_com_CHK_NUMBER_OF_OCP_AREAS" />
		<xpp:expand select="RC_com_SET_OCP_STATION_REFERENCE" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___WAYSIDE_GENERAL_OBJECT" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___EARTHED_TO_NONE" />
 		
		<Variants DefaultValue="Hengemast for åk type 12">
			<Variant Name="Hengemast for åk type 12" >
				<SetValue Key="OcsMastProfile" Value="Rektangulær, 100x150" />
				<SetValue Key="OcsMastHeight" Value="3100" />
			</Variant>
			<Variant Name="Hengemast for åk type 14" >
				<SetValue Key="OcsMastProfile" Value="Rektangulær, 100x150" />
				<SetValue Key="OcsMastHeight" Value="3500" />
			</Variant>
			<Variant Name="Hengemast for åk type 40" >
				<SetValue Key="OcsMastProfile" Value="Kvadratisk, 100x100" />
				<SetValue Key="OcsMastHeight" Value="3500" />
			</Variant>
		</Variants>
		
		<CustomAttribute DataType="Enumeration" Name="NewOrExisting" DisplayName="Ny eller eksisterende" DefaultValue="Ny"
			Description="The overhead catenary system (OCS) mast's age [Ny | Eksisterende]." >
			<Value>Ny</Value>
			<Value>Eksisterende</Value>
		</CustomAttribute>

		<CustomAttribute DataType="Enumeration" Name="OcsMastProfile" DisplayName="Masteprofil" DefaultValue="Sirkulær, Ø120"
			Description="The overhead catenary system (OCS) suspension mast profile (smp) [Kvadratisk, 100x100 | Rektangulær, 100x150]." >
			<Values Variant="Hengemast for åk type 12">
				<Value>Rektangulær, 100x150</Value>
			</Values>
			<Values Variant="Hengemast for åk type 14">
				<Value>Rektangulær, 100x150</Value>
			</Values>
			<Values Variant="Hengemast for åk type 40">
				<Value>Kvadratisk, 100x100</Value>
			</Values>
		</CustomAttribute>
		
		<!-- No default value - too different choices... -->
		<CustomAttribute DataType="Enumeration" Name="OcsMastHeight" DisplayName="Høyde" 
			Description="The overhead catenary system (OCS) suspension mast height (smh) [mm], given in predefined lengths in 100 millimeter steps." >
			<Values Variant="Hengemast for åk type 12">
				<Value>3100</Value>
			</Values>
			<Values Variant="Hengemast for åk type 14">
				<Value>4000</Value>
				<Value>3500</Value>
			</Values>
			<Values Variant="Hengemast for åk type 40">
				<Value>3500</Value>
			</Values>
        </CustomAttribute>
		
		<CustomAttribute DataType="Double" Name="SpanLength" DisplayName="Spennlengde" DefaultValue="30" 
			Description="The span length (sl) [m] denotes the distance traveled along the associated alignment's reference alignment (projected onto the XY plane) from this mast to the closest next mast, related using 'Neste kl-mast'/'Forrige kl-mast'." />
		<CustomAttribute DataType="String" Name="SpanLengthDisplay" DisplayName="Spennlengde visning" DefaultValue="" 
			Description="The span length value [m] being displayed close to the OCS mast." />
        <TextAttribute BindingProperty="SpanLengthDisplay" CadAttributeTag="SPENNLENGDE" X="15" Y="5" 
				Layer="JBTKL__INFO" Justify="MiddleCenter" Height="0.9" Width="0" Rotation="0" ObliqueAngle="0" Constant="false" 
				Invisible="false" Lock="false" MText="false" Preset="false" Verifiable="false" /> 
		<TextPositionLuaExpression Name="SPENNLENGDE"><Formula>_EH_MAS_SpanLengthTextOffset()</Formula></TextPositionLuaExpression>

		<CustomAttribute DataType="Double" Name="SpanLength2" DisplayName="Spennlengde 2" DefaultValue="30" 
			Description="The span length 2 (sl) [m] denotes the distance traveled along the associated alignment's reference alignment (projected onto the XY plane) from this mast to the second closest next mast, related using 'Neste kl-mast'/'Forrige kl-mast'." />
		<CustomAttribute DataType="String" Name="SpanLengthDisplay2" DisplayName="Spennlengde visning 2" DefaultValue="" 
			Description="The span length 2 value [m] being displayed close to the OCS mast, rounded to the closest integer value." />
        <TextAttribute BindingProperty="SpanLengthDisplay2" CadAttributeTag="SPENNLENGDE2" X="15" Y="7" 
				Layer="JBTKL__INFO" Justify="MiddleCenter" Height="0.9" Width="0" Rotation="0" ObliqueAngle="0" Constant="false" 
				Invisible="false" Lock="false" MText="false" Preset="false" Verifiable="false" /> 
		<TextPositionLuaExpression Name="SPENNLENGDE2"><Formula>_EH_MAS_SpanLengthTextOffset2()</Formula></TextPositionLuaExpression>

		<LuaExpression Name="SpanLength"><Formula>_EH_MAS_SpanLength()</Formula></LuaExpression>
		<LuaExpression Name="SpanLengthDisplay"><Formula>_EH_MAS_SpanLengthDisplay()</Formula></LuaExpression>
		<LuaExpression Name="SpanLength2"><Formula>_EH_MAS_SpanLength2()</Formula></LuaExpression>
		<LuaExpression Name="SpanLengthDisplay2"><Formula>_EH_MAS_SpanLengthDisplay2()</Formula></LuaExpression>

		<LuaExpression Name="Variant"><Formula>_EH_MAS_yoke_suspension_mast_Variant()</Formula></LuaExpression>
		<LuaFunction Name="_EH_MAS_yoke_suspension_mast_Variant()" 
			ReturnType="String"
			Description="Obtains the Variant for this OCS suspension mast." >
			<Constructor>String _EH_MAS_yoke_suspension_mast_Variant()</Constructor>
			<Formula>
				function _EH_MAS_yoke_suspension_mast_Variant()
					s = "Er hengemast festet til åk"
					r,n = RC__getCollectionOfRelatedObjects(s)
					if n == 0 then
						return getPropertyValue("Variant"),_info("UNFINISHED - Relate OCS suspension mast to yoke with '"..s.."'.")
					else
						return "Hengemast for åk type "..r[0].Variant:lower():match("type (%d+)")
					end
				end
			</Formula>
		</LuaFunction>
	
	<LuaExpression Name="dir"><Formula>"both"</Formula></LuaExpression>
	
	<LuaExpression Name="code"><Formula>_EH_MAS_yoke_suspension_mast_code()</Formula></LuaExpression>
		<LuaFunction Name="_EH_MAS_yoke_suspension_mast_code()" 
			ReturnType="String"
			Description="Obtains the code for this OCS suspension mast." >
			<Constructor>String _EH_MAS_yoke_suspension_mast_code()</Constructor>
			<Formula>
			function _EH_MAS_yoke_suspension_mast_code()
					local yokeRelation = "Er hengemast festet til åk"
					local yokes, nYokes = RC__getCollectionOfRelatedObjects(yokeRelation)
					if nYokes == 0 then
						return "UNFINISHED - Relate with '"..yokeRelation.."'."
					elseif nYokes &gt; 1 then
							return _warning,"UNFINISHED - Suspended OCS mast belongs to more than one yoke "
									.." - remove unintended relations '"..yokeRelation.."' or adjust the active stage using layer names."
					else
						--One yoke:
						local supportMastRelation = "Har åk-mast - kl-mast"
						local supportMasts, nSupportMasts = RC__getCollectionOfRelatedObjects(supportMastRelation,yokes[0]) 
						if nSupportMasts == 0 then 
							return "UNFINISHED - Cannot deduce suspended OCS mast name since yoke '"..RC__identify(yokes[0]).."' has no support mast yet."
						else
							--Find the reference support mast - being closest to the yoke's own insertion point (there may be many yoke support masts):
							local i
							local shortestDist = math.huge
							local referenceSupportMast = nil 
							for i = 0, nSupportMasts-1 do
								local newDist = RC__getDistance2D(yokes[0].geoCoord,supportMasts[i].geoCoord)
								if newDist &lt; shortestDist then
									shortestDist = newDist
									referenceSupportMast = i
								end
							end
					
							--Start suspended mast's code with support mast's code:
							local suspendedMastCode = supportMasts[referenceSupportMast].code
							
							--Assign sequence number to this suspended OCS mast (counted from the support mast closest to yoke's insertion point):
							local suspendedMastRelation = "Er åk for hengemast - kl-mast"
							local suspendedMasts, nSuspendedMasts = RC__getCollectionOfRelatedObjects(suspendedMastRelation,yokes[0])
					
							local sequenceNumber = 0
							for i = 0, nSuspendedMasts-1 do
								if suspendedMasts[i].id == this.id then
									sequenceNumber = i + 1
								end
							end
							return supportMasts[referenceSupportMast].code..string.format("-%02d",sequenceNumber),
								_info("Code deduced from yoke '"..yokes[0].code.."' and its related components.")
						end
					end
				end
			</Formula>
		</LuaFunction>

		<LuaExpression Name="name"><Formula>code</Formula></LuaExpression>

		<LuaExpression Name="Mileage"><Formula>_EH_MAS_yoke_suspension_mast_Mileage()</Formula></LuaExpression>
		<LuaFunction Name="_EH_MAS_yoke_suspension_mast_Mileage()" ReturnType="Double"
			Description="Deduces the yoke suspension mast's mileage, based on its relation to a yoke/galley and this one's support mast(s)." >
			<Constructor>Double _EH_MAS_yoke_suspension_mast_Mileage()</Constructor>
			<Formula>
				function _EH_MAS_yoke_suspension_mast_Mileage()
					local ys = "Er hengemast festet til åk"
					local yr,yn = RC__getCollectionOfRelatedObjects(ys)
					if yn == 0 then
						return getPropertyValue("Mileage"),_info("UNFINISHED - Relate to yoke/galley with '"..ys.."' to set mileage automatically.")
				
					elseif yn &gt; 1 then
						return getPropertyValue("Mileage"),
							_info("ERROR - Suspension mast is related to more than one yoke ("..RC__identify(yr[0])..", "..RC__identify(yr[1])..").")
						
					else
						--yn == 1
						
						local s = "Er åk holdt oppe av kl-mast"
						local r,n = RC__getCollectionOfRelatedObjects(s,yr[0])
						if n == 0 then
							return RC__getMileageFromRelatedObject(s),
								_info("Mileage deduced from yoke/galley lacking support mast(s) '"..RC__identify(yr[0]).."'.")
					
						elseif n == 1 then 
							--Galley:
							return RC__getMileageFromRelatedObject(s),_info("Mileage deduced from support mast '"..RC__identify(r[0]).."'.")
							
						elseif n &gt;= 2 then
							--Our mast is suspended from a yoke yr[0] being supported by OCS masts r[0] and r[1]:
							local m1 = r[0]
							local m2 = r[1]
							-- Not needed: if RC__getDistance2D(this,m1) &gt; RC__getDistance2D(this,m2) then m1,m2 = m2,m1 end 
							local x1 = m1.geoCoord.X		
							local y1 = m1.geoCoord.Y
							local dx = m2.geoCoord.X - x1
							local dy = m2.geoCoord.Y - y1
							
							--Find point Q on the straight line betweeen m1 and m2 with the yoke suspension mast's specified DistanceToAlignment:
							function err(t) 
								local Qx = x1+t*dx  
								local Qy = y1+t*dy  
								return getAlignmentInfo(Alignment.id,Qx,Qy).DistanceToAlignment - this.DistanceToAlignment
							end
							local tq = getZeros(err,{tolerance = 1e-4, interval = {0,1}, timeLimit = 3})[0]
							local Qx = x1 + tq*dx  
							local Qy = y1 + tq*dy  
							return getAlignmentInfo(Alignment.id,Qx,Qy).Mileage
						end
					end
				end
			</Formula>
		</LuaFunction>

		<!-- Crude formula - mounted with a few cm above top of its yoke: -->
		<LuaExpression Name="RelativeElevation"><Formula>_EH_MAS_yoke_suspension_mast_RelativeElevation()</Formula></LuaExpression>
		<LuaFunction Name="_EH_MAS_yoke_suspension_mast_RelativeElevation()" 
				ReturnType="Double"
				HideFromUser="false"
				Description="Returns the relative elevation for a ocs mast suspended from a yoke, based on the yoke's type and relative elevation.">
			<Constructor>Double _EH_MAS_yoke_suspension_mast_RelativeElevation()</Constructor>
			<Formula>
				function _EH_MAS_yoke_suspension_mast_RelativeElevation()
					local s,r,n,e,v
					local extensionAboveTopOfYoke = 0.10
					s = "Er hengemast festet til åk"
					r,n = RC__getCollectionOfRelatedObjects(s)
					if n == 0 then
						return 0.0,_info("UNFINISHED - Relate with '"..s.."' to its OCS yoke.") 
					else 
						e = (r[0].geoCoord.Z - getAlignmentInfo().Elevation) --Yoke's elevation above this susp. mast's own alignment
						v = r[0].Variant
						if v:match("12") then return e + 0.8 + extensionAboveTopOfYoke
						elseif v:match("14") then return e + 1.2 + extensionAboveTopOfYoke
						elseif v:match("40") then return e + 0.4 + extensionAboveTopOfYoke
						else
							return 0.0,_error,_info("Bad related OCS yoke '"..RC__identify(r[0]).."' Variant: ["..v.."].")
						end
					end
				end
			</Formula>
		</LuaFunction>

		<LuaExpression Name="AngularOffset"><Formula>_EH_MAS_yoke_suspension_mast_AngularOffset()</Formula></LuaExpression>
		<LuaFunction Name="_EH_MAS_yoke_suspension_mast_AngularOffset()" ReturnType="Double"
				HideFromUser="false"
				Description="Returns an angular offset, to orient the mast colinear with its yoke (if any)." >
			<Constructor>Double _EH_MAS_yoke_suspension_mast_AngularOffset()</Constructor>
			<Formula>
				function _EH_MAS_yoke_suspension_mast_AngularOffset()
					local ys = "Er hengemast festet til åk"
					yr,yn = RC__getCollectionOfRelatedObjects(ys)
					if yn == 0 then
						return getPropertyValue("AngularOffset"),_info("UNFINISHED - relate to yoke with '"..ys.."'.")
				
					else
						local yoke = yr[0]
						local s = "Er åk holdt oppe av kl-mast"
						local r,n = RC__getCollectionOfRelatedObjects(s,yoke)
				
						if n == 0 then
							return getPropertyValue("AngularOffset"),_error,
								_info("*** ERROR Mast has bad connection to galley '"..RC__identify(yoke).."'.")
				
						elseif n == 1 then
							--Galley:
							return getPropertyValue("AngularOffset"),
								_info("Mast is connected to a galley '"..RC__identify(yoke)..
								"' - adjust mast's angular offset manually or change galley into yoke (which has one more yoke support mast).")
						
						elseif n == 2 then
							--Assume that the first two related masts are located at the yoke's extremities:
							local m1 = r[0]
							local m2 = r[1]
							if RC__getDistance2D(this,m1) &gt; RC__getDistance2D(this,m2) then m1,m2 = m2,m1 end 
							local x1 = m1.geoCoord.X		
							local y1 = m1.geoCoord.Y
							local x2 = m2.geoCoord.X
							local y2 = m2.geoCoord.Y
							local yokeAngle = math.atan(y2-y1,x2-x1) * (180/math.pi) 
							local tg = getAlignmentInfo().Tangent
							local baseAngle = math.atan(tg.Y,tg.X) * (180/math.pi)
							local info = "Angular Offset deduced using yoke support masts '"..RC__identify(m1).."' and '"..RC__identify(m2).."'."
							return (2*360.0 + RC__round(yokeAngle - (baseAngle-90),3)) % 360.0,_info(info)
				
						else
							--TODO: Locate the two support masts at each end of yoke, uses this to find angular offset, then turn yourself if you 
							--are a support mast at one or the other end, or just adapt if you are in between ends.
							return getPropertyValue("AngularOffset"),
								_info("Mast is connected to a yoke '"..RC__identify(yoke).." with total 3 or more supporting masts"..
								"' - adjust mast's angular offset manually.")
						end
					end
				end
			</Formula>
		</LuaFunction>

		<LuaExpression Name="Model3DName"><Formula>_EH_MAS_yoke_suspension_mast_Model3DName()</Formula></LuaExpression>
		<LuaFunction Name="_EH_MAS_yoke_suspension_mast_Model3DName()" 
			ReturnType="String"
			Description="Obtains the 'Model3DName' for this OCS suspension mast." >
			<Constructor>String _EH_MAS_yoke_suspension_mast_Model3DName()</Constructor>
			<Formula>
				function _EH_MAS_yoke_suspension_mast_Model3DName()
					if Variant:match("12") then
						return "NO-BN-3D-EH-MAS-HENGEMAST-FOR-ÅK-TYPE-12-3100"
					elseif Variant:match("14") then
						if (OcsMastHeight == "3500") then
							return "NO-BN-3D-EH-MAS-HENGEMAST-FOR-ÅK-TYPE-14-3500"
						else 
							return "NO-BN-3D-EH-MAS-HENGEMAST-FOR-ÅK-TYPE-14-4000"
						end
					elseif Variant:match("40") then
						return "NO-BN-3D-EH-MAS-HENGEMAST-FOR-ÅK-TYPE-40-3500"
					else 
						return "Bad OCS suspension mast Variant ["..Variant.."].",_warning
					end
				end
			</Formula>
		</LuaFunction>

		<LuaExpression Name="SymbolFrame"><Formula>NOBN__setSymbolFrame()</Formula></LuaExpression>

		<CustomAttribute DataType="String" ReadOnly="true" Category="Model check" Name="mc_YokeMastsToBeRefreshed" 
			DisplayName="Yoke masts to be refreshed" 
			Description="If mast belongs to a yoke (suspended or supporting), then the whole structure will be refreshed."
		 />
		<LuaExpression Name="mc_YokeMastsToBeRefreshed" IsModelCheck="true"><Formula>_EH_MAS_chkTriggerRelatedObjects()</Formula></LuaExpression>

		<LuaFunction Name="_EH_MAS_chkTriggerRelatedObjects()" 
			ReturnType="String"
			Description="Triggers modelchecking in the yoke's masts." >
			<Constructor>_EH_MAS_chkTriggerRelatedObjects()</Constructor>
			<Formula>
				function _EH_MAS_chkTriggerRelatedObjects()
					local yokeRelation = "Er hengemast festet til åk"
					local yokes, nYokes = RC__getCollectionOfRelatedObjects(yokeRelation)
					if nYokes == 0 then 
						return 0,_info("UNFINISHED - Relate with '"..yokeRelation.."'.")
					elseif nYokes &gt;= 1 then
						local t = {}
						local i
						local s1 = "Er åk holdt oppe av kl-mast"
						local r1,n1 = RC__getCollectionOfRelatedObjects(s1,yokes[0])
						for i = 0, n1-1 do
							table.insert(t,r1[i])
						end
						s2 = "Er åk for hengemast - kl-mast"
						local r2,n2 = RC__getCollectionOfRelatedObjects(s2,yokes[0])
						for i = 0, n2-1 do
							table.insert(t,r2[i])
						end
						--if true then return nYokes,yokes,n1,r1,n2,r2 end
						return n1+n2,t,_info(n1+n2.." masts have been refreshed.")
					end
				end
			</Formula>
		</LuaFunction> 

		<InsertSymbol VariantName="Hengemast for åk type 12" DisplayBlockName="NO-BN-2D-JBTKL-HENGEMAST-FOR-AAK" 
				DefaultSnapMode="Alignment" SnapToAlignment="true" SnapDistance="2.65" SubGroup="Hengemast for åk" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<Rotation AddAngle="0" Direction="true" /> 
		</InsertSymbol>
		
		<InsertSymbol VariantName="Hengemast for åk type 14" DisplayBlockName="NO-BN-2D-JBTKL-HENGEMAST-FOR-AAK" 
				DefaultSnapMode="Alignment" SnapToAlignment="true" SnapDistance="2.65" SubGroup="Hengemast for åk" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<Rotation AddAngle="0" Direction="true" />
		</InsertSymbol>
		
		<InsertSymbol VariantName="Hengemast for åk type 40" DisplayBlockName="NO-BN-2D-JBTKL-HENGEMAST-FOR-AAK" 
				DefaultSnapMode="Alignment" SnapToAlignment="true" SnapDistance="2.65" SubGroup="Hengemast for åk" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<Rotation AddAngle="0" Direction="true" />
		</InsertSymbol>
		
		<SymbolDefinition X="0.0" Y="0.0" AllowSymbolMove="true" DefaultBlockName="NO-BN-2D-JBTKL-HENGEMAST-FOR-AAK" >
			<Rotation RotateDirection="false" AddAngle="{% if dir == 'up' %}{{270.0|plus:AngularOffset}}
														{% elsif dir == 'down' %}{{90.0|plus:AngularOffset}}
														{% elsif dir == 'both' and RightSided %}{{180.0|plus:AngularOffset}}
														{% elsif dir == 'both' and LeftSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and RightSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and LeftSided %}{{180.0|plus:AngularOffset}}
														{% else %}45.0
														{% endif %}" />	
			<BlockNameFormat JoinBy="-">
				NO-BN-2D-JBTKL-HENGEMAST
				{% if Variant == 'Hengemast for åk type 12' %}FOR-AAK
				{% elsif Variant == 'Hengemast for åk type 14' %}FOR-AAK
				{% elsif Variant == 'Hengemast for åk type 40' %}FOR-AAK
				{% else %}BAD_VARIANT
				{% endif %}
			</BlockNameFormat>
		</SymbolDefinition>
		
		<SymbolDefinition X="0.0" Y="0.0" DefaultBlockName="NO-BN-2D-INSERTION-POINT" />

		<SnapPointsDefinitions>
			<SnapPoints>
				<SnapPoint X="0.0" Y="0.0" TargetSpace="skilt" />
				<SnapPoint X="0.0" Y="0.0" TargetSpace="utligger" />
				<SnapPoint X="0.0" Y="0.0" TargetSpace="beskyttelse" />
			</SnapPoints>
		</SnapPointsDefinitions>

	</ObjectType>



<!--========================================================================================================
	KONTAKTLEDNING
	ÅK
	EH-AAK Åk
=========================================================================================================-->
	<ObjectType DataType="tOrientedElement" Class="RailwayPlacedObject" Name="EH-AAK Åk"
				Layer="JBTKL_EH_AAK" Color="ByLayer"
				Group="Kontaktledning/Åk"
				AttMirrorY="{% if RightSided %}true{% else %}false{% endif %}"
				>
				
		<RelationSourceSpace>åk</RelationSourceSpace>
		<AttachmentCategory Name="åk" />

		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___ANGULAROFFSET_TAG_OBJECTINFO_METADATA_VAR" />
		<xpp:expand select="NOBN_com_STD_TEXTATTRIBUTES___HORIZONTAL_AND_MEDIUM_FAR___JBTKL" />
		<xpp:expand select="NOBN_com_DISCIPLINE_JBTKL" />
		<xpp:expand select="NOBN_com_CHK_NUMBER_OF_OCP_AREAS" />
		<xpp:expand select="RC_com_SET_OCP_STATION_REFERENCE" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___EARTHED_TO_NONE" />

		<Variants DefaultValue="Type 12">
			<Variant Name="Type 12" >
				<SetValue Key="code" Value="Type 12" />
			</Variant>
			<Variant Name="Type 14" >
				<SetValue Key="code" Value="Type 14" />
			</Variant>
			<Variant Name="Type 40" >
				<SetValue Key="code" Value="Type 40" />
			</Variant>
			<Variant Name="Utliggeråk" >
				<SetValue Key="code" Value="Utliggeråk" />
			</Variant>
		</Variants>
		
		<CustomAttribute DataType="Enumeration" Name="Length" DisplayName="Lengde" DefaultValue="11m"
			Description="The overhead catenary system (OCS) yoke length (oyl), given in predefined lengths in 1 meter steps. Each may be composed of subparts, where the joints may hinder suspension mast mounting." >
			<Values Variant="Type 12">
				<Value Description="Type XXIII">33m</Value>
				<Value>32m</Value>
				<Value>31m</Value>
				<Value>30m</Value>
				<Value>29m</Value>
				<Value>28m</Value>
				<Value>27m</Value>
				<Value>26m</Value>
				<Value>25m</Value>
				<Value>24m</Value>
				<Value>23m</Value>
				<Value>22m</Value>
				<Value>21m</Value>
				<Value>20m</Value>
				<Value>19m</Value>
				<Value>18m</Value>
				<Value>17m</Value>
				<Value>16m</Value>
				<Value>15m</Value>
				<Value>14m</Value>
				<Value>13m</Value>
				<Value>12m</Value>
				<Value>11m</Value>
			</Values>
			<Values Variant="Type 14">
				<Value>43m</Value>
				<Value>42m</Value>
				<Value>41m</Value>
				<Value>40m</Value>
				<Value>39m</Value>
				<Value>38m</Value>
				<Value>37m</Value>
				<Value>36m</Value>
				<Value>35m</Value>
				<Value>34m</Value>
				<Value>33m</Value>
				<Value>32m</Value>
				<Value>31m</Value>
				<Value>30m</Value>
				<Value>29m</Value>
				<Value>28m</Value>
			</Values>
			<Values Variant="Type 40">
				<Value>16m</Value>
				<Value>15m</Value>
				<Value>14m</Value>
				<Value>13m</Value>
				<Value>12m</Value>
				<Value>11m</Value>
				<Value>10m</Value>
			</Values>
			<Values Variant="Utliggeråk">
				<Value>6m</Value>
			</Values>
		</CustomAttribute>

		<LuaExpression Name="name"><Formula>"KL-åk "..code.." ("..Variant..", "..Length..")"</Formula></LuaExpression>
		<LuaExpression Name="dir"><Formula>"both"</Formula></LuaExpression>

        <LuaExpression Name="DistanceToAlignment"><Formula>_EH_AAK_DistanceToAlignment()</Formula></LuaExpression>
		<LuaFunction Name="_EH_AAK_DistanceToAlignment()" ReturnType="Enum"
			Description="Returns the distance to alignment for the yoke." >
			<Constructor>Double _EH_AAK_DistanceToAlignment()</Constructor>
			<Formula>
				function _EH_AAK_DistanceToAlignment()
					-- Ref Bane NOR, lærebok "Bygging av kontaktledningsanlegg" Del 2:2, Kap. 14
				
					function _EH_AAK_get_mastDistanceToAlignment(mast)
						if mast.Alignment == nil then 
							return RightSided and 4e-4 or -4e-4,_warning,_info("Closest OCS support mast is not connected to a track (own alignment).")
						else
							local mv = mast.Variant
							local mp = mast.OcsMastProfile
							local d
							if mv:match("Bjelkemast") ~= nil then
								d = string.sub(mp,4,6)/2000 --Assume mast profile names "HEB200", "HEB220" etc
							elseif mv:match("GMB%-mast") ~= nil then
								d = string.sub(mp,4,6)/2000 --Assume mast profile names "HEB200", "HEB220" etc TODO: Finn ekte profiler for GMB-mast
							elseif mv:match("B%-mast") ~= nil then
								d = (mast.OcsMastHeight - RelativeElevation) * math.tan(23/1000000)
							elseif mv:match("H%-mast") ~= nil then
								d = (mast.OcsMastHeight - RelativeElevation) * math.tan(1/50000)
							elseif mv:lower():match("hengemast") ~= nil then
								if (mp == 'Sirkulær, Ø120') then 
									d = 0.06
								elseif (mp == 'Kvadratisk, 100x100') then 
									d = 0.05
								elseif (mp == 'Rektangulær, 100x150') then
									d = 0.075
								elseif (mp == 'Rektangulær, 100x200') then 
									d = 0.1
								else
									return 0,_warning,_info("Bad OCS mast profile ["..mp.."].")
								end
							else 
								return 0,_warning,_info("Bad OCS mast variant ["..mv.."].")
							end
							-- OCS mast and yoke may belong to different tracks (when OCS mast is located between tracks):
							mdist = getAlignmentInfo(alignment.id,mast.geoCoord.X,mast.geoCoord.Y).DistanceToAlignment --Distance from center closest OCS mast to yoke's alignment
							if (mast.RightSided) then
								if (mast.Alignment.id == Alignment.id) then return mdist-d else return mdist+d end
							else
								if (mast.Alignment.id == Alignment.id) then return mdist+d else return mdist-d end
							end
						end
					end --function
				
					local s = "Er åk holdt oppe av kl-mast"
					local r,n = RC__getCollectionOfRelatedObjects(s)
					if n == 0 then
						if Variant == "Utliggeråk" then
							return getPropertyValue("DistanceToAlignment"),_warning,_info("UNFINISHED: Relate galley to an OCS mast with relation '"..s.."'.")
						else
							return getPropertyValue("DistanceToAlignment"),_warning,_info(
								"UNFINISHED: Relate yoke to OCS mast(s) with relation '"..s.."', or change Variant to galley (Utliggeråk).")
						end
				
					elseif n == 1 then
						if Variant == "Utliggeråk" then 
							return _EH_AAK_get_mastDistanceToAlignment(r[0]),_info("Galley yoke (Utliggeråk) extending from mast '"..RC__identify(r[0]).."'.")
						else
							return getPropertyValue("DistanceToAlignment"),_warning,_info(
								"UNFINISHED: Relate yoke to one more OCS mast with relation 'Har åk-mast / kl-mast', or change Variant to galley (Utliggeråk).")
						end
				
					elseif n &gt;= 2 then 
						local m1 = r[0]
						local m2 = r[1]
						if RC__getDistance2D(this,m1) &gt; RC__getDistance2D(this,m2) then m1,m2 = m2,m1 end 
						local d1 = RC__getDistance2D(m1,m2)
						local L = math.floor(1.500 + d1) --Assume min 0.5 and max 1.5 meter total yoke length overshoot
						local d2 = 0.5 * (L - d1) --Share overshoot between masts
						local x1 = m1.geoCoord.X		
						local y1 = m1.geoCoord.Y
						local x2 = m2.geoCoord.X
						local y2 = m2.geoCoord.Y
						local x = x1 - (d2/d1)*(x2-x1)
						local y = y1 - (d2/d1)*(y2-y1)
						local info = "Distance to alignment deduced through support mast '"..RC__identify(m1).."' related by '"..RelationName.."'."
						return getAlignmentInfo(Alignment.id,x,y).DistanceToAlignment,_info(info)
					end
				end
			</Formula>
		</LuaFunction>

		<!-- Ref lærebok del 2:2 side 86 punkt 14.8 - utregning av standard høyde underkant åk over høyeste spors SOK -->

		<LuaExpression Name="Rotation3D.Z"><Formula>NOBN_trk_getYawFromDir()</Formula></LuaExpression>

		<LuaExpression Name="Length"><Formula>_EH_AAK_Length()</Formula></LuaExpression>
		<LuaFunction Name="_EH_AAK_Length()" ReturnType="Enum"
			Description="Returns the length of the yoke, being the mast-mast center distance plus 1.50 meter, rounded down." >
			<Constructor>Enum _EH_AAK_Length()</Constructor>
			<Formula>
				function _EH_AAK_Length()
					-- Ref Bane NOR, lærebok "Bygging av kontaktledningsanlegg" Del 2:2, Kap. 14
					local RelationName = "Er åk holdt oppe av kl-mast"
					local r,n = RC__getCollectionOfRelatedObjects(RelationName)
					local L
					if n == 0 then
						if Variant == "Utliggeråk" then 
							L = "6m"
							return L,_warning,_info("UNFINISHED: Relate galley to an OCS mast with relation '"..RelationName.."'.")
						else
							if Variant == "Type 12" then L = "11m"
							elseif Variant == "Type 14" then L = "28m"
							elseif Variant == "Type 40" then L = "10m"
							end
							return L,_warning,_info(
								"UNFINISHED: Relate yoke to OCS mast(s) with relation '"..RelationName.."', or change Variant to galley (Utliggeråk).")
						end
				
					elseif n == 1 then
						local m1 = r[0]
						if Variant == "Utliggeråk" then 
							return "6m",_info("Galley yoke (Utliggeråk) extending from mast "..m1.code..".")
						else
							if Variant == "Type 12" then L = "11m"
							elseif Variant == "Type 14" then L = "28m"
							elseif Variant == "Type 40" then L = "10m"
							end
							return L,_warning,_info(
								"UNFINISHED: Relate yoke to one more OCS mast with relation 'Har åk-mast / kl-mast', or change Variant to galley (Utliggeråk).")
						end
				
					elseif n &gt;= 2 then 
						local m1 = r[0]
						local m2 = r[1]
						local P1 = m1.geoCoord
						local P2 = m2.geoCoord
						local len = RC__getDistance2D(P1,P2)
						L = math.floor(len + 1.5)
						if Variant == "Type 12" then
							if L &lt; 11 then return "11m",_warning,_info("L="..L.." required, but Type 12 yokes can't be shorter than 11 meter. Change to type 40 or galley (Utliggeråk).")
							elseif L &gt; 33 then return "33m",_warning,_info("L="..L.." required, but Type 12 yokes can't be longer than 33 meter, change to Type 14.")
							end
						elseif Variant == "Type 14" then
							if L &lt; 28 then return "28m",_warning,_info("L="..L.." required, but Type 14 yokes can't be made shorter than 28 meter. Change to Type 12 or 40.")
							elseif L &gt; 43 then return "43m",_warning,_info("L="..L.." required, but Type 14 yokes can't be made longer than 43 meter.")
							end
						elseif Variant == "Type 40" then
							if L &lt; 10 then return "10m",_warning,_info("L="..L.." required, but Type 40 yokes can't be made shorter than 10 meter. Change to galley (Utliggeråk).")
							elseif L &gt; 16 then return "16m",_warning,_info("L="..L.." required, but Type 40 yokes can't be made longer than 16 meter, change to Type 12 or 14.")
							end
						else
							return getPropertyValue("Length"),_error,_info("Remove excess yoke support mast(s), or change yoke Variant into Type 12/14/40.")
						end
						return L.."m",_info("Length deduced from mast "..m1.code.." and "..m2.code.." ("..RC__round(len,3).." m).")
					end
				end
			</Formula>
		</LuaFunction>
		
		<LuaExpression Name="AngularOffset"><Formula>_EH_AAK_AngularOffset()</Formula></LuaExpression>
		<LuaFunction Name="_EH_AAK_AngularOffset()" ReturnType="Double"
			HideFromUser="false"
			Description="Returns the angular offset needed to orient the yoke between its two masts, or a galley according to its mast.">
			<Constructor>Double _EH_AAK_AngularOffset()</Constructor>
			<Formula>
				function _EH_AAK_AngularOffset()
					local RelationName = "Er åk holdt oppe av kl-mast"
					local r,n = RC__getCollectionOfRelatedObjects(RelationName)

					if n == 0 then
						return getPropertyValue("AngularOffset"),_info("No control input - adjust angular offset manually. Relate to one (galley) or two (yoke) masts using '"..RelationName.."' to set angular offset automatically.")

					elseif n == 1 then 
						-- Galley "åk-unge", "utliggeråk"
						-- Assume galley belongs to same alignment as the supporting OCS mast
						return r[0].AngularOffset,_info("AngularOffset for galley deduced from object '"..RC__identify(r[0]).."' related by '"..RelationName.."'.")

					elseif n == 2 then 
						--Assume that the first two related masts are located at the yoke's extremities:
						local m1 = r[0]
						local m2 = r[1]
						local x1 = m1.geoCoord.X
						local y1 = m1.geoCoord.Y
						local x2 = m2.geoCoord.X
						local y2 = m2.geoCoord.Y
						local yokeAngle = math.atan(y2-y1,x2-x1) * (180/math.pi) 
						local tg = getAlignmentInfo().Tangent
						local baseAngle = math.atan(tg.Y,tg.X) * (180/math.pi) - RC__getAngleFromDir()
						local info = "AngularOffset for yoke deduced from support masts '"..
							RC__identify(m1).."' and '"..RC__identify(m2).."' related by '"..RelationName.."'."
						return RC__round((2*360 + yokeAngle - baseAngle) % 360, 3),_info(info)

					else
						--TODO: Locate the two support masts at each end of yoke, uses thes to find angular offset, then turn yourself if you 
						--are a support mast at one or the other end, or just adapt if you are in between ends.
						return getPropertyValue("AngularOffset"),
							_info("Mast is connected to a yoke '"..RC__identify(yoke).." with total 3 or more supporting masts"..
							"' - adjust mast's angular offset manually.")
					end
				end
			</Formula>
		</LuaFunction>

		<LuaExpression Name="Mileage"><Formula>_EH_AAK_Mileage()</Formula></LuaExpression>
		<LuaFunction Name="_EH_AAK_Mileage()" ReturnType="Double"
			Description="Deduces the galley's / yoke's mileage, based on relation to one or two yoke support masts." >
			<Constructor>Double _EH_AAK_Mileage()</Constructor>
			<Formula>
				function _EH_AAK_Mileage()
					local s = "Er åk holdt oppe av kl-mast"
					local r,n = RC__getCollectionOfRelatedObjects(s)
					if n == 0 then
						return getPropertyValue("Mileage"),
							_info("No control input - adjust mileage manually. Relate yoke to one or two masts using '"..s.."' to set mileage automatically.")
				
					elseif n == 1 then 
						-- Move to related mast (assuming galley (Utliggeråk))
						return RC__getMileageFromRelatedObject(s),_info("Mileage deduced from support mast '"..RC__identify(r[0]).."'.")
						
					elseif n &gt;= 2 then
						local m1 = r[0]
						local m2 = r[1]
						if RC__getDistance2D(this,m1) &gt; RC__getDistance2D(this,m2) then m1,m2 = m2,m1 end 
						local d1 = RC__getDistance2D(m1,m2)
						local L = math.floor(1.500 + d1) --Assume min 0.5 and max 1.5 meter total yoke length overshoot
						local d2 = 0.5 * (L - d1) --Share overshoot between masts
						local x1 = m1.geoCoord.X		
						local y1 = m1.geoCoord.Y
						local x2 = m2.geoCoord.X
						local y2 = m2.geoCoord.Y
						local x = x1 - (d2/d1)*(x2-x1)
						local y = y1 - (d2/d1)*(y2-y1)
						local info = "Mileage deduced through support mast '"..RC__identify(m1).."' related by '"..s.."'."
						return getAlignmentInfo(Alignment.id,x,y).Mileage,_info(info)
					end
				end
			</Formula>
		</LuaFunction>

		<LuaExpression Name="Model3DName"><Formula>_EH_AAK_Model3DName()</Formula></LuaExpression>
		<LuaFunction Name="_EH_AAK_Model3DName()" ReturnType="String"
			Description="Returns the yoke's 3D object model name." >
			<Constructor>String _EH_AAK_Model3DName()</Constructor>
			<Formula>
				function _EH_AAK_Model3DName()
					local t = "NO-BN-3D-EH-AAK-"
					if Variant == "Type 12" then 
						return string.format("NO-BN-3D-EH-AAK-KONTAKTLEDNINGSÅK-TYPE-12-%02d-%s",Length:sub(1,-2)-10,Length)
					elseif Variant == "Type 14" then 
						return string.format("NO-BN-3D-EH-AAK-KONTAKTLEDNINGSÅK-TYPE-14-%02d-%s",Length:sub(1,-2)-27,Length)
					elseif Variant == "Type 40" then 
						return string.format("NO-BN-3D-EH-AAK-KONTAKTLEDNINGSÅK-TYPE-40-%02d-%s",Length:sub(1,-2)-9,Length)
					elseif Variant == "Utliggeråk" then return t.."UTLIGGERÅK"
					else
						return "Bad OCS yoke Variant ["..Variant.."]",_warning
					end
				end
			</Formula>
		</LuaFunction>
		
		<InsertSymbol VariantName="Type 12" DisplayBlockName="NO-BN-2D-JBTKL-AAK-11000" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="4" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<Rotation AddAngle="0" Direction="true" RotateIfRightSideOfAlignment="true" />
			<SetValue Key="RelativeElevation" Value="7.90" />
		</InsertSymbol>
		
		<InsertSymbol VariantName="Type 14" DisplayBlockName="NO-BN-2D-JBTKL-AAK-28000" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="4" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<Rotation AddAngle="0" Direction="true" RotateIfRightSideOfAlignment="true" />
			<SetValue Key="RelativeElevation" Value="7.90" />
		</InsertSymbol>
		
		<InsertSymbol VariantName="Type 40" DisplayBlockName="NO-BN-2D-JBTKL-AAK-10000" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="4" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<Rotation AddAngle="0" Direction="true" RotateIfRightSideOfAlignment="true" />
			<SetValue Key="RelativeElevation" Value="7.90" />
		</InsertSymbol>
		
		<InsertSymbol VariantName="Utliggeråk" DisplayBlockName="NO-BN-2D-JBTKL-AAK-UTLIGGERAAK-6000" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="4" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<Rotation AddAngle="0" Direction="true" RotateIfRightSideOfAlignment="true" />
			<SetValue Key="RelativeElevation" Value="7.90" />
		</InsertSymbol>
		
		<SymbolDefinition X="0.0" Y="0.0" AllowSymbolMove="true" DefaultBlockName="NO-BN-2D-JBTKL-AAK-11000" >
			<Rotation RotateDirection="false" AddAngle="{% if dir == 'up' %}{{270.0|plus:AngularOffset}}
														{% elsif dir == 'down' %}{{90.0|plus:AngularOffset}}
														{% elsif dir == 'both' and RightSided %}{{180.0|plus:AngularOffset}}
														{% elsif dir == 'both' and LeftSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and RightSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and LeftSided %}{{180.0|plus:AngularOffset}}
														{% else %}45.0
														{% endif %}" />	
			<BlockNameFormat JoinBy="-">
				NO-BN-2D-JBTKL-AAK
				{% if Variant == 'Utliggeråk' %}UTLIGGERAAK-6000
				{% elsif Length == '10m' %}10000
				{% elsif Length == '11m' %}11000
				{% elsif Length == '12m' %}12000
				{% elsif Length == '13m' %}13000
				{% elsif Length == '14m' %}14000
				{% elsif Length == '15m' %}15000
				{% elsif Length == '16m' %}16000
				{% elsif Length == '17m' %}17000
				{% elsif Length == '18m' %}18000
				{% elsif Length == '19m' %}19000
				{% elsif Length == '20m' %}20000
				{% elsif Length == '21m' %}21000
				{% elsif Length == '22m' %}22000
				{% elsif Length == '23m' %}23000
				{% elsif Length == '24m' %}24000
				{% elsif Length == '25m' %}25000
				{% elsif Length == '26m' %}26000
				{% elsif Length == '27m' %}27000
				{% elsif Length == '28m' %}28000
				{% elsif Length == '29m' %}29000
				{% elsif Length == '30m' %}30000
				{% elsif Length == '31m' %}31000
				{% elsif Length == '32m' %}32000
				{% elsif Length == '33m' %}33000
				{% elsif Length == '34m' %}34000
				{% elsif Length == '35m' %}35000
				{% elsif Length == '36m' %}36000
				{% elsif Length == '37m' %}37000
				{% elsif Length == '38m' %}38000
				{% elsif Length == '39m' %}39000
				{% elsif Length == '40m' %}40000
				{% elsif Length == '41m' %}41000
				{% elsif Length == '42m' %}42000
				{% elsif Length == '43m' %}43000
				{% else %}BAD_VARIANT
				{% endif %}
			</BlockNameFormat>
		</SymbolDefinition>
		
		<SymbolDefinition X="0.0" Y="0.0" DefaultBlockName="NO-BN-2D-INSERTION-POINT" />

		<SnapPointsDefinitions>
			<SnapPoints>
				<SnapPoint X="0.0" Y="0.0" TargetSpace="kl-mast" />
			</SnapPoints>
		</SnapPointsDefinitions>

	</ObjectType>



<!--========================================================================================================
	KONTAKTLEDNING
	UTLIGGERE
	EH-UTL SeksjonsutliggerKONSOLL-FOR-SEKSJONSUTLIGGER
	Brakett for feste av multiple utliggere til samme mast (på den ene siden av masten).
=========================================================================================================-->
	<ObjectType DataType="tOrientedElement" Class="RailwayPlacedObject" Name="EH-UTL Seksjonsutliggerkonsoll"
				Layer="JBTKL_EH_UTL" Color="ByLayer"
				Group="Kontaktledning/Utliggere"
				AttMirrorY="{% if RightSided %}true{% else %}false{% endif %}"
				>
				
		<RelationSourceSpace>seksjonsutliggerkonsoll</RelationSourceSpace>

		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___ANGULAROFFSET_TAG_OBJECTINFO_METADATA_VAR" />
		<xpp:expand select="NOBN_com_STD_TEXTATTRIBUTES___HORIZONTAL_AND_MEDIUM_CLOSE___JBTKL" />
		<xpp:expand select="NOBN_com_DISCIPLINE_JBTKL" />
		<xpp:expand select="NOBN_com_CHK_NUMBER_OF_OCP_AREAS" />
		<xpp:expand select="RC_com_SET_OCP_STATION_REFERENCE" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___WAYSIDE_GENERAL_OBJECT" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___EARTHED_TO_NONE" />

		<Variants DefaultValue="H-300" >
			<!-- The variant' number is the c-c spacing between M20 threaded irons. -->
			<!-- Note: The H-300 variant is also suitable for HEB masts up to HEB280 -->
			<Variant Name="B-120" ></Variant>
			<Variant Name="B-140" ></Variant>
			<Variant Name="B-160" ></Variant>
			<Variant Name="B-180" ></Variant>
			<Variant Name="B-200" ></Variant>
			<Variant Name="H-270" ></Variant>
			<Variant Name="H-300" ></Variant>
			<Variant Name="H-330" ></Variant>
			<Variant Name="H-360" ></Variant>
			<Variant Name="H-390" ></Variant>
		</Variants>

		<LuaExpression Name="name"><Formula>"Seksj.utl.kons."..Variant</Formula></LuaExpression>
		<LuaExpression Name="Model3DName"><Formula>"NO-BN-3D-EH-UTL-SEKSJONSUTLIGGERKONSOLL-1440-"..Variant</Formula></LuaExpression>

		<!-- TODO SeksjonsutliggerKONSOLL-FOR-SEKSJONSUTLIGGER skal snappe til mast, og skal selv tilby snapping for utliggere -->
		<!-- TODO SeksjonsutliggerKONSOLL-FOR-SEKSJONSUTLIGGER skal bevege seg mot sporet på funksjon av mastens tykkelse (som utliggere) -->
		<InsertSymbol VariantName="Seksjonsutliggerkonsoll" DisplayBlockName="NO-BN-2D-JBTKL-KONSOLL-FOR-SEKSJONSUTLIGGER" 
				DefaultSnapMode="Point" SnapToAlignment="false" SnapDistance="4.0">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace> 
		</InsertSymbol>
		
		<!-- TODO Lage 2D-symbol for brakett til multiple utliggere på samme mast -->
		<SymbolDefinition X="0.0" Y="0.0" AllowSymbolMove="true" DefaultBlockName="NO-BN-2D-JBTKL-KONSOLL-FOR-SEKSJONSUTLIGGER" >
			<Rotation RotateDirection="false" AddAngle="{% if dir == 'up' %}{{270.0|plus:AngularOffset}}
														{% elsif dir == 'down' %}{{90.0|plus:AngularOffset}}
														{% elsif dir == 'both' and RightSided %}{{180.0|plus:AngularOffset}}
														{% elsif dir == 'both' and LeftSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and RightSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and LeftSided %}{{180.0|plus:AngularOffset}}
														{% else %}45.0
														{% endif %}" />	
			<BlockNameFormat JoinBy="-">
				NO-BN-2D-JBTKL-KONSOLL-FOR-SEKSJONSUTLIGGER
			</BlockNameFormat>
		</SymbolDefinition>
		
		<SymbolDefinition X="0.0" Y="0.0" DefaultBlockName="NO-BN-2D-INSERTION-POINT" />

		<SnapPointsDefinitions>
			<SnapPoints>
				<SnapPoint X="0.0" Y="0.0" TargetSpace="utligger" />
			</SnapPoints>
		</SnapPointsDefinitions>

	</ObjectType>



<!--========================================================================================================
	KONTAKTLEDNING
	UTLIGGERE
	EH-UTL Utligger
	Ref. Bane NOR Teknisk Regelverk, Kontaktledning/Prosjektering og Bygging/Mekanisk utforming
=========================================================================================================-->
	<LuaFunction Name="_EH_UTL_StandardValues()" 
		ReturnType="Table[6*Double]"
		Description="Returns standard cantilever values table: [cwh]=contact wire height, [sh]=system height, [shmin]=min. sh, [shmax]=max. sh, [lco]=lower console offset from cwh." >
		<Constructor>Table[6*Double] _EH_UTL_StandardValues(String Variant)</Constructor>
		<Formula>
			function _EH_UTL_StandardValues(v)
				if v == nil then v = Variant end
				variants = {"System 20A","System 20B","System 20C","System 25","System 35","Cariboni"}
				if not RC__isMemberOf(variants,v) then 
					return 0,_warning,_info("Bad cantilever Variant ["..v.."]. ")
				end
				t = {
					["System 20A"] = {cwh=5.60, sh=1.60, shmin=1.20, shmax=1.60, lco=-0.30},
					["System 20B"] = {cwh=5.60, sh=1.60, shmin=1.20, shmax=1.60, lco=-0.30},
					["System 20C"] = {cwh=5.30, sh=0.75, shmin=0.75, shmax=1.60, lco=-0.30},
					["System 25"] = {cwh=5.10, sh=1.80, shmin=0.70, shmax=1.80, lco=-0.35},
					["System 35"] = {cwh=5.60, sh=1.60, shmin=1.20, shmax=1.60, lco=-0.30},
					["Cariboni"] = {cwh=5.05, sh=0.60, shmin=0.25, shmax=0.60, lco=0.70}
				}
				return t[v]
			end 
		</Formula>
	</LuaFunction>

	<LuaFunction Name="_EH_UTL_ReferenceMileage()" ReturnType="Double" Description="Returns cantilever's reference mileage, based on its OCS mast's reference mileage. If more cantilevers are located on noe side of the mast, they will arbitrate positions." HideFromUser="false">
		<Constructor>Double _EH_UTL_ReferenceMileage()</Constructor>
		<Formula>
			function _EH_UTL_ReferenceMileage()
				local StandardCantileverSpacing = 0.60 --60 cm separation to allow cantilevers to swing towards each other with temperature movements
				local s = "Tilhører kl-mast"
				local r,n = RC__getCollectionOfRelatedObjects(s)
				if n == 0 then
					if (Alignment == nil) then
						return 0,_info("UNFINISHED - Relate with '"..s.."' to OCS mast and assign cantilever to an aligment.")
					else
						return getPropertyValue("ReferenceMileage") == nil and 0 or getPropertyValue("ReferenceMileage"),
							_info("UNFINISHED - Relate with '"..s.."' to OCS mast.")
					end
				else
					local mast = r[0]
					local sc = "Er kl-mast for utligger"
					local cantilevers,nc = RC__getCollectionOfRelatedObjects(sc,mast)
					local me = nil --who am I?
					local i
					for i = 0, nc-1 do
						if id == cantilevers[i].id then
							me = i 
						end
					end
					if me == nil then 
						return mast.ReferenceMileage,_warning,_info("Corrupt relation '"..sc.."' to OCS mast - cannot compute cantilever position.")
					end
					--Anyone else on my side of OCS mast?
					--Note: Cantilevers on same side may serve the same track (change of OCS wire) or different tracks (in a switch)
					local d1 = getAlignmentInfo(Alignment.id,mast.geoCoord.X,
												mast.geoCoord.Y).DistanceToAlignment --distance from OCS to my cantilever's alignment
					local myLastPal = nil
					local nPals = 0
					for i = 0, nc-1 do
						if i ~= me then
							--find signed distance from mast to both cantilever's alignments - if same sign, then they are on the same side: 
							local d2 = getAlignmentInfo(getObjectFromId(cantilevers[i].id).Alignment.id,
																		mast.geoCoord.X,mast.geoCoord.Y).DistanceToAlignment
							if d1 * d2 &gt; 0 then
								--same side
								myLastPal = i
								nPals = nPals + 1
							end
						end
					end
					if nPals == 0 then
						return mast.ReferenceMileage 
					elseif nPals == 1 then
						if me &lt; myLastPal then 
							return mast.ReferenceMileage - StandardCantileverSpacing
						else
							return mast.ReferenceMileage + StandardCantileverSpacing
						end
					else 
						return mast.ReferenceMileage,_warning,_info("Too many ["..(nPals+1).."] cantilevers on same side of OCS mast.")
					end
				end
			end
		</Formula>
	</LuaFunction>

	<!-- TODO: Adjust cantilever position towards track if they should adapt to a bracket holding more cantilevers -->
	<LuaFunction Name="_EH_UTL_DistanceToAlignment()" 
		ReturnType="Double"
		Description="Returns cantilever's distance to own alignment, based on its OCS mast's type and position. (2020-02-16: Formula does not take into account the angularOffset of the mast.)" >
		<Constructor>Double _EH_UTL_DistanceToAlignment()</Constructor>
		<Formula>
			function _EH_UTL_DistanceToAlignment()
				if (Alignment == nil) then 
					--If cantilever has no alignment, set to 4e-4 (maintain sideOfAlignment)
					return RightSided and 4e-4 or -4e-4,_warning,_info("Cantilever is not connected to a track (own alignment).")
				end
				local s = "Tilhører kl-mast"
				local r,n = RC__getCollectionOfRelatedObjects(s)
				if n == 0 then
					return RightSided and 4e-4 or -4e-4,_warning,_info("Cantilever is missing relation '"..s.."' to OCS mast.")
				else
					if (r[0].Alignment == nil) then 
						return RightSided and 4e-4 or -4e-4,_warning,
							_info("Cantilever's OCS mast is not connected to a track - cannot deduce cantilever's distance to own alignment.")
					else
						local mast = r[0]
						local mv = mast.Variant
						local mp = mast.OcsMastProfile
						local d
						if mv:lower():match("bjelkemast") ~= nil then
							d = string.sub(mp,4,6)/2000 --Assume mast profile names "HEB200", "HEB220" etc
						elseif mv:lower():match("gmb%-mast") ~= nil then
							d = string.sub(mp,4,6)/2000 --Assume mast profile names "HEB200", "HEB220" etc TODO: Finn ekte profiler for GMB-mast
						elseif mv:lower():match("b%-mast") ~= nil then
							d = (r[0].OcsMastHeight - RelativeElevation) * math.tan(23/1000000) --mast is not straight!
						elseif mv:lower():match("h%-mast") ~= nil then
							d = (r[0].OcsMastHeight - RelativeElevation) * math.tan(1/50000)
						elseif mv:lower():match("hengemast") ~= nil then
							if (mp == 'Sirkulær, Ø120') then 
								d = 0.06
							elseif (mp == 'Kvadratisk, 100x100') then 
								d = 0.05
							elseif (mp == 'Rektangulær, 100x150') then
								d = 0.075
							elseif (mp == 'Rektangulær, 100x200') then 
								d = 0.1
							else
								return 0,_warning,_info("Bad OCS mast profile ["..mp.."].")
							end
						else 
							return 0,_warning,_info("Bad OCS mast variant ["..mv.."].")
						end
						-- OCS mast and cantilever may belong to different tracks (when OCS mast is located between tracks):
						mdist = getAlignmentInfo(alignment.id,
								mast.geoCoord.X,mast.geoCoord.Y).DistanceToAlignment --Distance from center OCS mast to *cantilever's* alignment
						if mast.DistanceToAlignment &gt; 0 then 
							return mdist - d
						else
							return mdist + d
						end
					end
				end
			end
		</Formula>
	</LuaFunction>

	<LuaFunction Name="_EH_UTL_Model3DName()" 
		ReturnType="String"
		Description="Returns cantilever's 3D model name, based on its OCS mast's type, push/pull setting and cantilever's length [mm]." >
		<Constructor>String _EH_UTL_Model3DName(int CantileverLengthDisplay)</Constructor>
		<Formula>
			function _EH_UTL_Model3DName(CantileverLengthDisplay)
				if CantileverLength == nil then 
					--Default length is 4.0m:
					CantileverLengthDisplay = "4000" 
				end
				--TODO: Lage flere 3D-modeller for alle utligger-varianter.
				-- TODO: ...men siden 20, 25 og 35 er veldig like, så bruker vi S20 som 3D-modell for alle sammen inntil videre.
				if (Variant == "System 20A") then 
					if (PushDirection == "Strekk") then return "NO-BN-3D-EH-UTL-UTLIGGER-SYSTEM-20-STREKK-"..CantileverLengthDisplay
					elseif (PushDirection == "Trykk") then return "NO-BN-3D-EH-UTL-UTLIGGER-SYSTEM-20-TRYKK-"..CantileverLengthDisplay
					else return "Ukjent Kraftretning ["..PushDirection.."]",_warning
					end
				elseif (Variant == "System 20B") then 
					if (PushDirection == "Strekk") then return "NO-BN-3D-EH-UTL-UTLIGGER-SYSTEM-20-STREKK-"..CantileverLengthDisplay
					elseif (PushDirection == "Trykk") then return "NO-BN-3D-EH-UTL-UTLIGGER-SYSTEM-20-TRYKK-"..CantileverLengthDisplay
					else return "Ukjent Kraftretning ["..PushDirection.."]",_warning
					end
				elseif (Variant == "System 20C") then 
					if (PushDirection == "Strekk") then return "NO-BN-3D-EH-UTL-UTLIGGER-SYSTEM-20-STREKK-"..CantileverLengthDisplay
					elseif (PushDirection == "Trykk") then return "NO-BN-3D-EH-UTL-UTLIGGER-SYSTEM-20-TRYKK-"..CantileverLengthDisplay
					else return "Ukjent Kraftretning ["..PushDirection.."]",_warning
					end
				elseif (Variant == "System 25") then 
					if (PushDirection == "Strekk") then return "NO-BN-3D-EH-UTL-UTLIGGER-SYSTEM-20-STREKK-"..CantileverLengthDisplay
					elseif (PushDirection == "Trykk") then return "NO-BN-3D-EH-UTL-UTLIGGER-SYSTEM-20-TRYKK-"..CantileverLengthDisplay
					else return "Ukjent Kraftretning ["..PushDirection.."]",_warning
					end
				elseif (Variant == 'System 35') then
					if (PushDirection == "Strekk") then return "NO-BN-3D-EH-UTL-UTLIGGER-SYSTEM-20-STREKK-"..CantileverLengthDisplay
					elseif (PushDirection == "Trykk") then return "NO-BN-3D-EH-UTL-UTLIGGER-SYSTEM-20-TRYKK-"..CantileverLengthDisplay
					else return "Ukjent Kraftretning ["..PushDirection.."]",_warning
					end
				elseif (Variant == "Cariboni") then
					return "NO-BN-3D-EH-UTL-CARIBONI-UTLIGGER"
				else
					return "Ukjent Variant ["..Variant.."].",_warning
				end
			end
		</Formula>
	</LuaFunction>

	<LuaFunction Name="_EH_UTL_AddVisual2dAngularOffset()" 
		ReturnType="Double"
		Description="Adds 17 Decimal Degrees rotation to the cantilever's angle in 2D whenever it is located in a yoke or in a galley, to make it visible in 2D drawings. AngularOffset and 3D rendering are not affected" >
		<Constructor>Double _EH_UTL_AddVisual2dAngularOffset()</Constructor>
		<Formula>
			function _EH_UTL_AddVisual2dAngularOffset()
				s = "Tilhører kl-mast"
				r,n = RC__getCollectionOfRelatedObjects(s)
				if n == 0 then
					--Cantilevers mounted on yoke support masts are not found and treated here - too complicated for now.
					return 0
				else
					--Make cantilever "rod" visible even if located under a yoke:
					return 17 --Decimal Degrees
				end
			end
		</Formula>
	</LuaFunction>

	<ObjectType DataType="tOrientedElement" Class="RailwayPlacedObject" Name="EH-UTL Utligger"
				Layer="JBTKL_EH_UTL" Color="ByLayer"
				Group="Kontaktledning/Utliggere"
				AttMirrorY="{% if RightSided %}true{% else %}false{% endif %}"
				>
			
		<RelationSourceSpace>utligger</RelationSourceSpace>

		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___ANGULAROFFSET_TAG_OBJECTINFO_METADATA_VAR" />
		<xpp:expand select="NOBN_com_STD_TEXATTRIBUTES___VERTICAL_AND_FAR___JBTKL" />
		<xpp:expand select="NOBN_com_DISCIPLINE_JBTKL" />
		<xpp:expand select="NOBN_com_CHK_NUMBER_OF_OCP_AREAS" />
		<xpp:expand select="RC_com_SET_OCP_STATION_REFERENCE" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___WAYSIDE_GENERAL_OBJECT" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___EARTHED_TO_NONE" />

		<Variants DefaultValue="System 20A">
			<Variant Name="System 20A"> 
				<!-- Fri strekning, 200 km/h -->
				<SetValue Key="SubVariant" Value="Standard" />
			</Variant>
			<Variant Name="System 20B">
				<!-- Redusert hastighet 160 km/h, kortere spennlengder / lavere systemhøyder -->
				<SetValue Key="SubVariant" Value="Standard" />
			</Variant>
			<Variant Name="System 20C">
				<!-- Tunnel, 200 km/h, kortere spennlengder / lavere systemhøyder -->
				<SetValue Key="SubVariant" Value="C1" />
			</Variant>
			<Variant Name="System 25" >
				<!-- 250 km/h -->
				<SetValue Key="SubVariant" Value="N/A" />
			</Variant>
			<Variant Name="System 35" >
				<!-- Kl for eksisterende baner -->
				<SetValue Key="SubVariant" Value="N/A" />
			</Variant>
			<Variant Name="Cariboni" >
				<!-- Tunneler -->
				<SetValue Key="SubVariant" Value="N/A" />
				<SetValue Key="PushDirection" Value="N/A" />
			</Variant>
		</Variants>
		
		<!-- PushDirection is only set at creation time. Subsequent changing of Variant will not change push/pull directions. -->
		<SetValue Key="PushDirection" Value="Strekk" />

		<CustomAttribute DataType="Enumeration" Name="SubVariant" DisplayName="SubVariant" 
			Description=
			"The cantilever subvariant [Standard | Redusert] is 'Standard' when built for its line design speed, and 'Redusert' when built for less tense wires and lesser speeds.">
			<Values Variant="System 20A">
				<Value>Standard</Value>
				<Value>Redusert</Value>
			</Values>
			<Values Variant="System 20B">
				<Value>Standard</Value>
				<Value>Redusert</Value>
			</Values>
			<Values Variant="System 20C">
				<Value>C1</Value>
				<Value>C2</Value>
			</Values>
			<Values Variant="System 25">
				<Value>N/A</Value>
			</Values>
			<Values Variant="System 35">
				<Value>N/A</Value>
			</Values>
			<Values Variant="Cariboni">
				<Value>N/A</Value>
			</Values>
		</CustomAttribute>

		<CustomAttribute DataType="Enumeration" Name="PushDirection" DisplayName="Kraftretning" DefaultValue="Strekk"
			Description=
			"The cantilever push direction (cpd) [Strekk | Trykk] is denoted 'Strekk' if the cantilever pulls the contact wire towards the cantilever console(s), and 'Trykk' if it pushes it away.">
			<Values Variant="System 20A">
				<Value>Strekk</Value>
				<Value>Trykk</Value>
			</Values>
			<Values Variant="System 20B">
				<Value>Strekk</Value>
				<Value>Trykk</Value>
			</Values>
			<Values Variant="System 20C">
				<Value>Strekk</Value>
				<Value>Trykk</Value>
			</Values>
			<Values Variant="System 25">
				<Value>Strekk</Value>
				<Value>Trykk</Value>
			</Values>
			<Values Variant="System 35">
				<Value>Strekk</Value>
				<Value>Trykk</Value>
			</Values>
			<Values Variant="Cariboni">
				<Value>N/A</Value>
			</Values>
		</CustomAttribute>
		
		<CustomAttribute DataType="Double" Name="CantileverLength" DisplayName="Utliggerlengde" DefaultValue="4.0"
			Description="The cantilever's length [m] is measured from concole (mast side) to contact wire, perpendicularly to the track. Cariboni is more restricted.">
		</CustomAttribute>
		<CustomAttribute DataType="Int32" Name="CantileverLengthDisplay" DisplayName="Utliggerlengde visning" DefaultValue="4000"
			Description="The cantilever's display length [mm] [1000..6000], rounded to closest multiple of 500 mm, except Cariboni (always 1200).">
		</CustomAttribute>
		<LuaFunction Name="_EH_UTL_CantileverLengthDisplay()" 
			ReturnType="String"
			Description="Returns cantilever's display length, min 1000mm, max 6000mm, rounded to nearest multiple of 500mm (and Cariboni being always 1200)." >
			<Constructor>Int _EH_UTL_CantileverLengthDisplay(Double CantileverLength)</Constructor>
			<Formula>
				function _EH_UTL_CantileverLengthDisplay(CantileverLength)
					if Variant == "Cariboni" then
						return "1200"
					else
						local L = string.format("%04d",500*((1000.0*CantileverLength + 250)//500))
						if tonumber(L) &lt; 1000 then return 1000
						elseif tonumber(L) &gt; 6000 then return 6000
						else return L
						end
					end
				end
			</Formula>
		</LuaFunction>
		<LuaExpression Name="CantileverLengthDisplay"><Formula>_EH_UTL_CantileverLengthDisplay(CantileverLength)</Formula></LuaExpression>

		<CustomAttribute DataType="Double" Name="ContactWireHeight" DisplayName="Kontakttrådhøyde" DefaultValue="5.00" 
			Description="The contact wire height (cwh) [m] denotes the orthogonal distance from the plane formed by the top-of-rails to the contact wire clamp." />
		<LuaExpression Name="ContactWireHeight"><Formula>_EH_UTL_StandardValues(Variant)["cwh"]</Formula></LuaExpression>

		<CustomAttribute DataType="Double" Name="SystemHeight" DisplayName="Systemhøyde" DefaultValue="1.00" 
			Description="The cantilever system height (sh) [m] denotes the vertical Z coordinate difference from the contact wire clamp to the catenary clamp." />
		<LuaExpression Name="SystemHeight"><Formula>_EH_UTL_StandardValues(Variant)["sh"]</Formula></LuaExpression>

		<CustomAttribute DataType="Double" Name="WireClampOffset" DisplayName="Trådklemme offset" DefaultValue="0.00" 
			Description="The wire clamp offset (wco) [m] denotes the distance to a sideways neutral clamp posision. The wco is positive for offsets to the right side of the alignment in the direction of increasing mileage." />

		<CustomAttribute DataType="Double" Name="CatenaryClampOffset" DisplayName="Bæretråd offset" DefaultValue="0.00" 
			Description="The catenary clamp offset (cco) [m] denotes the distance to a sideways neutral clamp posision. The cco is positive for offsets to the right side of the alignment in the direction of increasing mileage." />

		<CustomAttribute DataType="Double" Name="StitchWireLength" DisplayName="Y-line lengde" DefaultValue="0.00" 
			Description="The stitch wire length (swl) [m] denotes the length, measured as a difference in mileage, from start to end (where it attaches to the catenary wire). Zero length means 'no stitch wire'." />

        <CustomAttribute DataType="Double" Name="Stagger" DisplayName="Sikk-sakk" DefaultValue="0.000"
			Description=
			"Stagger [m] denotes the distance from contact wire clamp to centre track, measured co-linearly with the top-of-rails plane. Positive stagger means pushing away from mast, negative means pulling towards mast." />
		
		<CustomAttribute DataType="String" Name="StaggerDisplay" DisplayName="Sikk-sakk visning" DefaultValue="" 
			Description="The stagger value, as shown next to the cantilever [cm]." />
        
		<TextAttribute BindingProperty="StaggerDisplay" CadAttributeTag="SIKKSAKK" X="-2.75" Y="-1" 
			Layer="JBTKL__SIKKSAKK" Justify="MiddleCenter" Height="1.25" Width="0" Rotation="0"
			ObliqueAngle="0" Constant="false" Invisible="false" Lock="false" MText="false" Preset="false" Verifiable="false" />       
		
		<LuaExpression Name="dir"><Formula>"both"</Formula></LuaExpression>

		<LuaExpression Name="code"><Formula>_EH_UTL_code()</Formula></LuaExpression>
		<LuaFunction Name="_EH_UTL_code()" 
			ReturnType="String"
			Description="Obtains the 'code' for this OCS cantilever. Uses relation 'Tilhører kl-mast' to access the related object's data." >
			<Constructor>String _EH_UTL_code()</Constructor>
			<Formula>
				function _EH_UTL_code()
					s = "Tilhører kl-mast"
					r,n = RC__getCollectionOfRelatedObjects(s)
					if n == 0 then
						return "UNFINISHED - Relate with '"..s.."' to an OCS mast."
					else
						return "",_info("Cantilever belongs to mast "..RC__identify(r[0])) --Empty string as code, just show the info tooltip.
					end
				end
			</Formula>
		</LuaFunction>
		
		<CustomAttribute DataType="String" Name="OcsWireDisplay" DisplayName="Ledning visning" DefaultValue="" 
			Description="The cantilever's associated OCS wire." />
        <TextAttribute BindingProperty="OcsWireDisplay" CadAttributeTag="LEDNING" X="0" Y="1.5" 
				Layer="JBTKL__LEDNING" Justify="MiddleCenter" Height="0.9" Width="0" Rotation="-90" ObliqueAngle="0" Constant="false" 
				Invisible="false" Lock="false" MText="false" Preset="false" Verifiable="false" /> 
		<LuaExpression Name="OcsWireDisplay"><Formula>_EH_UTL_OcsWireDisplay()</Formula></LuaExpression>
		<LuaFunction Name="_EH_UTL_OcsWireDisplay()" 
			ReturnType="String"
			Description="Identifies this cantilever's associated OCS wire. Uses relation 'Tilhører kl-mast' to access the related object's data." >
			<Constructor>String _EH_UTL_OcsWireDisplay(cantilever)</Constructor>
			<Formula>
				function _EH_UTL_OcsWireDisplay(cantilever)
					if cantilever == nil then cantilever = this end
					if cantilever.RcType ~= "EH-UTL Utligger" then return nil,_info("Bad calling object type ["..cantilever.RcType.."].") end
					local s = "Utligger for kontaktledning"
					local r,n = RC__getCollectionOfRelatedObjects(s)
					if n == 1 then return 
						"("..RC__identify(r[0])..")"
					else
						return "UNFINISHED - Relate cantilever to OCS wire with relation '"..s.."'"
					end		
				end
			</Formula>
		</LuaFunction>
		
		<LuaExpression Name="name"><Formula>code</Formula></LuaExpression>
		<LuaExpression Name="ReferenceMileage"><Formula>_EH_UTL_ReferenceMileage()</Formula></LuaExpression>
		<LuaExpression Name="DistanceToAlignment"><Formula>_EH_UTL_DistanceToAlignment()</Formula></LuaExpression>
		<LuaExpression Name="RelativeElevation"><Formula>ContactWireHeight + _EH_UTL_StandardValues(Variant)["lco"]</Formula></LuaExpression>

		<CustomAttribute DataType="Double" Name="AddVisual2dAngularOffset" DisplayName="2D vinkeltillegg" DefaultValue="0" 
			Description="The 'AddVisual2dAngularOffset' [Double] adds 16.7 decimal degrees to the 2D symbol's angle. Cantilevers mounted in a yoke or galley will not be visible unless the 2D symbol is given an extra angle." />
		<LuaExpression Name="AddVisual2dAngularOffset"><Formula>_EH_UTL_AddVisual2dAngularOffset()</Formula></LuaExpression>

		<LuaExpression Name="Model3DName"><Formula>_EH_UTL_Model3DName(CantileverLengthDisplay)</Formula></LuaExpression>
		<!-- Note: The argument "0" to NOBN_trk_getYawFromDir(0) forces RC to use 0 angular offset instead of something else for cantilevers in yokes -->
		<LuaExpression Name="Rotation3D.Z"><Formula>NOBN_trk_getYawFromDir(0.0)</Formula></LuaExpression>
		<LuaExpression Name="StaggerDisplay"><Formula>string.format("%.f",Stagger*100) --Centimeters</Formula></LuaExpression>

		<LuaExpression Name="SymbolFrame"><Formula>NOBN__setSymbolFrame()</Formula></LuaExpression>
		<CustomAttribute DataType="String" Name="mc_OcsSystemHeight" DisplayName="System Height" 
			ReadOnly="true" Category="Model check" 
			Description="Check that cantilever system height (sh) [m] conforms to Technical Regulations for the chosen Variant / SubVariant."
		 />
		<LuaExpression Name="mc_OcsSystemHeight" IsModelCheck="true"><Formula>_EH_UTL_chkSystemHeight()</Formula></LuaExpression>
		<LuaFunction Name="_EH_UTL_chkSystemHeight()" 
			ReturnType="String"
			Description="Checks the cantilever's height as a function of selected OCS system variant's min and max heights." >
			<Constructor>String _EH_UTL_chkSystemHeight()</Constructor>
			<Formula>
				function _EH_UTL_chkSystemHeight()
					min = _EH_UTL_StandardValues(Variant)["shmin"]
					max = _EH_UTL_StandardValues(Variant)["shmax"]
					sh = SystemHeight
					v = Variant
					if sh &lt; min then
						return string.format("%.02f: WARNING - system height is below %s limit (%.02f).",sh,v,min),_warning
					elseif sh &gt; max then
						return string.format("%.02f: WARNING - system height is above %s limit (%.02f).",sh,v,max),_warning
					else
						return string.format("%.02f: OK - system height is within %s limits [%.02f-%0.2f].",sh,v,min,max),_ok
					end
				end
			</Formula>
		</LuaFunction>


		<InsertSymbol VariantName="System 20A" DisplayName="System 20A" DisplayBlockName="NO-BN-2D-JBTKL-UTLIGGER-20A-S" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="4" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<Rotation AddAngle="0" RotateIfRightSideOfAlignment="true" />
			<SetValue Key="CantileverLength" Value="4.0" />
		</InsertSymbol>
		
		<InsertSymbol VariantName="System 20B" DisplayName="System 20B" DisplayBlockName="NO-BN-2D-JBTKL-UTLIGGER-20B-S" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="4" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<Rotation AddAngle="0" RotateIfRightSideOfAlignment="true" />
			<SetValue Key="CantileverLength" Value="4.0" />
		</InsertSymbol>
		
		<InsertSymbol VariantName="System 20C" DisplayName="System 20C" DisplayBlockName="NO-BN-2D-JBTKL-UTLIGGER-20C-S" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="4" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<Rotation AddAngle="0" RotateIfRightSideOfAlignment="true" />
			<SetValue Key="CantileverLength" Value="4.0" />
		</InsertSymbol>
		
		<InsertSymbol VariantName="System 25" DisplayName="System 25" DisplayBlockName="NO-BN-2D-JBTKL-UTLIGGER-25-S" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="4" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<Rotation AddAngle="0" RotateIfRightSideOfAlignment="true" />
			<SetValue Key="CantileverLength" Value="4.0" />
		</InsertSymbol>
		
		<InsertSymbol VariantName="System 35" DisplayName="System 35" DisplayBlockName="NO-BN-2D-JBTKL-UTLIGGER-35-S" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="4" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<Rotation AddAngle="0" RotateIfRightSideOfAlignment="true" />
			<SetValue Key="CantileverLength" Value="4.0" />
		</InsertSymbol>
		
		<InsertSymbol VariantName="Cariboni" DisplayBlockName="NO-BN-2D-JBTKL-UTLIGGER-CARIBONI" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="4" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<Rotation AddAngle="0" RotateIfRightSideOfAlignment="true" />
			<SetValue Key="PushDirection" Value="N/A" />
			<SetValue Key="CantileverLength" Value="1.2" />
		</InsertSymbol>
		
		<SymbolDefinition X="0.0" Y="0.0" AllowSymbolMove="true" DefaultBlockName="NO-BN-2D-JBTKL-UTLIGGER-20B-S">
			<Rotation RotateDirection="false" AddAngle="{% if dir == 'up' %}{{270.0|plus:AngularOffset|plus:AddVisual2dAngularOffset}}
														{% elsif dir == 'down' %}{{90.0|plus:AngularOffset|plus:AddVisual2dAngularOffset}}
														{% elsif dir == 'both' and RightSided %}{{180.0|plus:AngularOffset|plus:AddVisual2dAngularOffset}}
														{% elsif dir == 'both' and LeftSided %}{{0.0|plus:AngularOffset|plus:AddVisual2dAngularOffset}}
														{% elsif dir == 'none' and RightSided %}{{0.0|plus:AngularOffset|plus:AddVisual2dAngularOffset}}
														{% elsif dir == 'none' and LeftSided %}{{180.0|plus:AngularOffset|plus:AddVisual2dAngularOffset}}
														{% else %}45.0
														{% endif %}" />	
			<BlockNameFormat JoinBy="-">
				NO-BN-2D-JBTKL-UTLIGGER
				{% if Variant == 'System 20A' %}20A{% if PushDirection == 'Strekk' %}-S{% else %}-T{% endif %}-{{CantileverLengthDisplay}}
				{% elsif Variant == 'System 20B' %}20B{% if PushDirection == 'Strekk' %}-S{% else %}-T{% endif %}-{{CantileverLengthDisplay}}
				{% elsif Variant == 'System 20C' %}20C{% if PushDirection == 'Strekk' %}-S{% else %}-T{% endif %}-{{CantileverLengthDisplay}}
				{% elsif Variant == 'System 25' %}25{% if PushDirection == 'Strekk' %}-S{% else %}-T{% endif %}-{{CantileverLengthDisplay}}
				{% elsif Variant == 'System 35' %}35{% if PushDirection == 'Strekk' %}-S{% else %}-T{% endif %}-{{CantileverLengthDisplay}}
				{% elsif Variant == 'Cariboni' %}CARIBONI
				{% else %}BAD_VARIANT
				{% endif %}
			</BlockNameFormat>
		</SymbolDefinition>
		
		<SymbolDefinition X="0.0" Y="0.0" DefaultBlockName="NO-BN-2D-INSERTION-POINT" />
	
	</ObjectType>



<!--========================================================================================================
	KONTAKTLEDNING
	KLEMMER
	EH-KLK Kontakttrådklemme
	Festes til en utligger. Representerer punktet der utliggeren/lett direksjonsstag holder tråden fast.
	Klemmens plasseres i "skinneplansystemet", dvs med høyde over sporplanet (etter overhøyde) og sideveis
	forflytning iht ZigZag. Klemmen plasseres seg i sporets lengderetning på samme ReferenceMileage som 
	utliggeren. Kobles til utligger med relasjon (da blir lengderetningen låst).
	Utligger kan dermed kontrollere seg selv, at den blir lang nok til å nå fram til klemmen.
	
	Snapping: Primært snapper klempunktet til en utligger, men det kan også snappes til sporet sitt 
	med null sikk-sakk (som et utgangspunkt). OwnAlignmentTargetSpace skal være "spor", klemmen er
	alltid hardt koblet til et spor, og sporet kommer før ledningen. 

	Utligger kan sjekke at spor klemme og utligger tilhører det samme sporet.
	
	Du kan sette inn trådklemmer uten at utliggere eller master er definert ennå. Dvs at all matematikk
	rundt utplassering av ledning kan legges i trådklemmene (vindutblåsing, ramper etc).
=========================================================================================================-->
	<ObjectType DataType="tOrientedElement" Class="RailwayPlacedObject" Name="EH-KLK Kontakttrådklemme"
				Layer="JBTKL_EH_KLK" Color="ByLayer"
				Group="Kontaktledning/Klemmer"
				AttMirrorY="{% if RightSided %}true{% else %}false{% endif %}"
				>
				
		<RelationSourceSpace>kl-klemmer</RelationSourceSpace>

		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___ANGULAROFFSET_TAG_OBJECTINFO_METADATA_VAR" />
		<xpp:expand select="NOBN_com_STD_TEXATTRIBUTES___VERTICAL_AND_FAR___JBTKL" />
		<xpp:expand select="NOBN_com_DISCIPLINE_JBTKL" />
		<xpp:expand select="NOBN_com_CHK_NUMBER_OF_OCP_AREAS" />
		<xpp:expand select="RC_com_SET_OCP_STATION_REFERENCE" />
		<xpp:expand select="NOBN_ocs_STD_LUAEXPRESSIONS___OVERHEADLINEBOUND_OBJECT" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___EARTHED_TO_NONE" />

		<Variants DefaultValue="Kontakttrådklemme">
			<Variant Name="Kontakttrådklemme" >
				<SetValue Key="name" Value="Tr.kl." />
				<!-- <SetValue Key="Model3DName" Value="NO-BN-3D-EH-KLK-KONTAKTTRÅDKLEMME" /> -->
				<SetValue Key="Model3DName" Value="NO-BN-3D-EH-KLK-KONTAKTTRÅDKLEMME" />
			</Variant>
		</Variants>

		<LuaExpression Name="code"><Formula>_EH_KLK_code()</Formula></LuaExpression>
		<LuaFunction Name="_EH_KLK_code()" 
			ReturnType="String"
			Description="Obtains the 'code' for this OCS contact wire clamp. Uses relation 'Tilhører utligger' to access the related object's data." >
			<Constructor>String _EH_KLK_code()</Constructor>
			<Formula>
				function _EH_KLK_code()
					s = "Tilhører utligger"
					r,n = RC__getCollectionOfRelatedObjects(s)
					if n == 0 then
						return "UNFINISHED - Relate with '"..s.."' to a cantilever."
					else
						return "",_info("Contact wire clamp belongs to cantilever "..RC__identify(r[0]))
					end
				end
			</Formula>
		</LuaFunction>

		<!-- XXXXXXXXXXXXXXXXXXXXX Problem: OVERHEADLINEBOUNDOBJECT blir også feil - klempunkt kommer jo før ledning: -->
		<!-- <LuaExpression Name="DistanceToAlignment"><Formula>0</Formula></LuaExpression> -->
		<!-- <LuaExpression Name="RelativeElevation"><Formula>0</Formula></LuaExpression> -->
		<!-- <LuaExpression Name="Rotation3D.X"><Formula>NOBN_trk_getPitchFromGradient()</Formula></LuaExpression> -->
		<!-- <LuaExpression Name="Rotation3D.Y"><Formula>NOBN_ocs_getRollFromCant()</Formula></LuaExpression> -->
		<!-- <LuaExpression Name="Rotation3D.Z"><Formula>NOBN_trk_getYawFromDir()</Formula></LuaExpression> -->
		
		<LuaExpression Name="ReferenceMileage"><Formula>_EH_KLK_ReferenceMileage()</Formula></LuaExpression>
		<LuaFunction Name="_EH_KLK_ReferenceMileage()" 
			ReturnType="Double"
			Description="Returns contact wire clamp's reference mileage, equal to its cantilever's reference mileage." >
			<Constructor>Double _EH_KLK_ReferenceMileage()</Constructor>
			<Formula>
				function _EH_KLK_ReferenceMileage()
					s = "Tilhører utligger"
					r,n = RC__getCollectionOfRelatedObjects(s)
					if n == 0 then 
						-- Do nothing, stay where you are...
						return getPropertyValue("ReferenceMileage"),_info("UNFINISHED - Relate with '"..s.."' to a cantilever.")
					else
						return r[0].ReferenceMileage,_info("Inherited from related cantilever "..RC__identify(r[0])..".")
					end
				end
			</Formula>
		</LuaFunction>
		
		
		<!-- Compute distance to alignment (in XY plane) based on cantilever's stored ZigZag-value and track's local superelevation: -->
		<LuaExpression Name="DistanceToAlignment"><Formula>_EH_KLK_DistanceToAlignment()</Formula></LuaExpression>
		<LuaFunction Name="_EH_KLK_DistanceToAlignment()" 
			ReturnType="String"
			Description="Obtains the 'DistanceToAlignment' for this OCS contact wire clamp. Uses relation 'Tilhører utligger' to access the related object's data." >
			<Constructor>String _EH_KLK_code()</Constructor>
			<Formula>
				function _EH_KLK_DistanceToAlignment()
					s = "Tilhører utligger"
					r,n = RC__getCollectionOfRelatedObjects(s)
					if n == 0 then 
						return 0,_info("UNFINISHED - Relate with '"..s.."' to a cantilever.")
					else
						cwh = r[0].ContactWireHeight
						zigzag = r[0].Stagger
						if Alignment == nil then
							return 0,_warning,_info("UNFINISHED - own alignment must be assigned.")
						end
						ai = getAlignmentInfo()
						if not ai.NormalProjectionExists then
							return 0,_warning,_info("UNFINISHED - object is misplaced wrt own alignment.")
						end
						h = ai.Cant -- The track's superelevation in millimeters
						cr = ai.CantRotation -- CW or CCW
						return 0,_info("TODO: Lua code for this property is not yet ready for use.")
					end
				end
			</Formula>
		</LuaFunction>

		<!-- <InsertSymbol VariantName="Kontakttrådklemme" DisplayBlockName="NO-BN-2D-JBTKL-KLEMPUNKT-KONTAKTTRAADKLEMME"  -->
		<InsertSymbol VariantName="Kontakttrådklemme" DisplayBlockName="NO-BN-2D-JBTKL-KLEMPUNKT-KONTAKTTRAADKLEMME" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="4e-4" >
			<OwnAlignmentTargetSpace>kl-oppheng</OwnAlignmentTargetSpace>
			<Rotation AddAngle="-90" Direction="true" />
		</InsertSymbol>
		
		<SymbolDefinition X="0.0" Y="0.0" AllowSymbolMove="true" DefaultBlockName="NO-BN-2D-JBTKL-KLEMPUNKT-KONTAKTTRAADKLEMME">
			<Rotation RotateDirection="false" AddAngle="{% if dir == 'up' %}{{270.0|plus:AngularOffset}}
														{% elsif dir == 'down' %}{{90.0|plus:AngularOffset}}
														{% elsif dir == 'both' and RightSided %}{{180.0|plus:AngularOffset}}
														{% elsif dir == 'both' and LeftSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and RightSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and LeftSided %}{{180.0|plus:AngularOffset}}
														{% else %}45.0
														{% endif %}" />	
			<BlockNameFormat JoinBy="-">
				NO-BN-2D-JBTKL-KLEMPUNKT-KONTAKTTRAADKLEMME
			</BlockNameFormat>
		</SymbolDefinition>
		
		<SymbolDefinition X="0.0" Y="0.0" DefaultBlockName="NO-BN-2D-INSERTION-POINT" />

		<!-- 4 meter er ca avstand fra utligger til senter spor der klemmen skal plasseres -->
		<SnapPointsDefinitions>
			<SnapPoints>
				<SnapPoint X="0.0" Y="4.0" TargetSpace="utligger" />
			</SnapPoints>
		</SnapPointsDefinitions>

	</ObjectType>



<!--========================================================================================================
	KONTAKTLEDNING
	"BARDUNER"
	EH-BAR Bardunfeste
	NB! Dekker både bardunerfeste og streverfeste, samt fiks-ferdig strever for innfesting i tunneltak, for Ø120 hentemaster.
	(endepunktobjekt for bardun, dvs festepunkt for bardun, ikke bardunen i seg selv), OG feste for strever.
	Settes inn i en "bardun" alignment for kl-oppheng (som represetnerer BÅDE bardun=wire og strever=rod).
 	Merk: En KL-mast kan ha 0 til 4 barduner, men aldri mer enn to til samme bardunfeste / bardunfundament.
	Merk: Dette er kun 2D-symbolet, wire / rod må modelleres separat som linjeobjekt.
	Se tegning EH-707162 Bardunering, EH-800262 / EH-800263 fotplate for bardunfeste. 
	Se tegning EH-800257 mastefundament og EH-800258 Streverfundament og EH-800242 Strevere (utgått?). 
	TODO Opplyse brukeren om at det først må strekkes en wire eller strever fra mast til fundament / veggfeste-brakett
=========================================================================================================-->
	<ObjectType DataType="tOrientedElement" Class="RailwayPlacedObject" Name="EH-BAR Bardunfeste"
				Layer="JBTKL_EH_BAR" Color="ByLayer"
				Group="Kontaktledning/Kraftavlasting"
				AttMirrorY="{% if RightSided %}true{% else %}false{% endif %}"
				>
				
		<RelationSourceSpace>kraftavlasting</RelationSourceSpace>
		<!-- <AttachTo Category="bardunfundament" /> ??? -->

		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___ANGULAROFFSET_TAG_OBJECTINFO_METADATA_VAR" />
		<xpp:expand select="NOBN_com_STD_TEXATTRIBUTES___VERTICAL_AND_FAR___JBTKL" />
		<xpp:expand select="NOBN_com_DISCIPLINE_JBTKL" />
		<xpp:expand select="NOBN_com_CHK_NUMBER_OF_OCP_AREAS" />
		<xpp:expand select="RC_com_SET_OCP_STATION_REFERENCE" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___WAYSIDE_GENERAL_OBJECT" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___EARTHED_TO_NONE" />

		<Variants DefaultValue="Bardunfeste fotplate, enkel">
			<Variant Name="Bardunfeste fotplate, enkel" >
			</Variant>
			<Variant Name="Bardunfeste mot bjelkemast" >
			</Variant>
			<Variant Name="Bardunfeste fotplate, dobbel" >
			</Variant>
			<Variant Name="Streverfeste fotplate" >
			</Variant>
			<Variant Name="Strever med festeplater, 2.08m fra sidekant KL-mast" >
			</Variant>
			<Variant Name="Strever med festeplate for Ø120 hengemast for bru og tunnel" >
			</Variant>
		</Variants>

        <LuaExpression Name="code"><Formula>_EH_BAR_Model3DName()</Formula></LuaExpression>
		<LuaFunction Name="_EH_BAR_Model3DName()" 
			ReturnType="String"
			Description="Obtains the Model 3D Name for this OCS contact wire strecher/spanner object (the point object). Deduces its dimensions from the closest OCS mast." >
			<Constructor>String _EH_BAR_Model3DName()</Constructor>
			<Formula>
				function _EH_BAR_Model3DName()
					--Look for mast near start of associated wire (alignment).
					local tol = 0.25 
					local t
					if Variant:match("Bardunfeste fotplate, enkel") then 
						t = "NO-BN-3D-EH-BAR-BARDUNFESTE-FOTPLATE-191x374xM36"
						
					elseif Variant:match("Bardunfeste mot bjelkemast") then 
						local m = getNearbyPointObjects2D(tol,"EH-MAS KL-mast")
						local n = getCollectionLength(m)
						if n &gt; 0 then 
							local a = m[0].OcsMastProfile:match("HEB(%d%d%d)") --'HEB220' etc: Capture three digits.
							a = a or "240" --Default size if not a HEB mast...
							t = "NO-BN-3D-EH-BAR-STREVERFESTE-KONSOLL-FOR-SEKSJONSUTLIGGER-400x300-FOR-HEB"..a
						else
							t = "UNIFINSHED: No OCS mast found near stretcher / spanner, cannot deduce 3D model name."
						end
						
					elseif Variant:match("Bardunfeste fotplate, dobbel") then
						t = "NO-BN-3D-EH-BAR-BARDUNFESTE-FOTPLATE-191x374xM36"
						
					elseif Variant:match("Streverfeste fotplate") then
						t = "NO-BN-3D-EH-BAR-STREVERFESTE-FOTPLATE-525x350-191x374xM36"
						
					elseif Variant:match("Strever med festeplater, 2.08m fra sidekant KL-mast") then 
						t = "NO-BN-3D-EH-BAR-STREVER-L7000-D2080-H6654"
						
					elseif Variant:match("Strever med festeplate for Ø120 hengemast for bru og tunnel") then
						local m = getNearbyPointObjects2D(tol,"EH-MAS Hengemast for bru og tunnel")
						local n = getCollectionLength(m)
						if n &gt; 0 then 
							-- Assume spanner 3D models exist in steps of 500 mm range 500..2500.
							-- Let default spanner choice be half the height of the supported OCS suspension mast.
							local h = (math.floor((250 + (OcsMastHeight/2)) / 500)) * 500
							h = (h &lt; 500) and 500 or h -- At least 500
							h = (h &gt; 2500) and 2500 or h -- No more than 2500
							t = "NO-BN-3D-EH-BAR-STREVER-FOR-HENGEMAST-Ø120-H"..string.format("%03d",h)
						else
							t = "UNIFINSHED: No OCS suspension mast found near stretcher / spanner, cannot deduce 3D model name."
						end
					else 
					
						return "Bad strecher / spanner fastening Variant ["..Variant.."]."
					end
				end
			</Formula>
		</LuaFunction>

        <LuaExpression Name="code"><Formula>_EH_BAR_code()</Formula></LuaExpression>
		<LuaFunction Name="_EH_BAR_code()" 
			ReturnType="String"
			Description="Obtains the code for this OCS contact wire strecher/spanner object (the point object). Deduces code from OCS mast at start of associated wire." >
			<Constructor>String _EH_BAR_code()</Constructor>
			<Formula>
				function _EH_BAR_code()
					--Look for mast near start of associated wire (alignment).
					--Spanner rod / stretcher wire alignments always start at high elevation (top of OCS mast) and extend down to the ground, where the fixation element is.
					--Note that spanner fixations snap to the low-mileage end of the spanner (at the OCS mast), strecher fixations snap to the hi-mileage (at the foundation)
					--Both stretchers and spanners require an OCS mast at the START of the wire / the rod. 
					local tol = 0.25 
					local t
					if Alignment == nil then 
						return "UNFINISHED - spanner / stretcher fastening has no reference to strecher wire / spanner rod alignment - please assign an own alignment." 
					else
						if Variant:lower():match("bardun") then 
							t = "-B"
						elseif Variant:lower():match("strever") then 
							t = "-S"
						else 
							return "Bad strecher / spanner fastening Variant ["..Variant.."]."
						end
					end					
					local m = getNearbyPointObjects2D(tol,"EH-MAS KL-mast",Alignment.RcAlignment.StartPoint)
					local n = getCollectionLength(m)
					if n &gt; 0 then 
						return m[0].code..t
					else 
						return "UNFINISHED - no OCS mast found at start of strecher wire / spanner rod alignment - cannot deduce stretcher / spanner code."
					end
				end
			</Formula>
		</LuaFunction>

        <LuaExpression Name="name"><Formula>tostring(code):upper():match("UNFINISHED") and code or ""</Formula></LuaExpression>

		<LuaExpression Name="Mileage"><Formula>_EH_BAR_Mileage()</Formula></LuaExpression>
		<LuaFunction Name="_EH_BAR_Mileage()" 
			ReturnType="Double"
			Description="Returns mileage for this OCS contact wire strecher/spanner object. Snaps to the extremity of its associated spanner/strecher wire." >
			<Constructor>Double _EH_BAR_Mileage()</Constructor>
			<Formula>
				function _EH_BAR_Mileage()
				if Variant:lower():match("strever") then
					local ps = Alignment.RcAlignment.StartPoint
					m = getNearbyPointObjects2D(1,"EH-MAS KL-mast",ps.X,ps.Y)
					n = getCollectionLength(m)
					if n &gt; 0 and m[0].Variant:lower():match("bjelke") then 
						return m[0].OcsMastProfile:match("HEB(%d+)")/2000
					else 
						return 0.0
					end
				else
					--bardun enkel/dobbel:
					return Alignment.RcAlignment.HorizontalProfile.Length
				end
			end
			</Formula>
		</LuaFunction>

		<!-- Strechers' dir = DOWN, spanner's dir = UP -->
		<LuaExpression Name="dir"><Formula>Variant:lower():match("strever") and "up" or "down"</Formula></LuaExpression>
		<LuaExpression Name="DistanceToAlignment"><Formula>RightSided and 4e-4 or -4e-4</Formula></LuaExpression>

		<LuaExpression Name="RelativeElevation"><Formula>
		</Formula></LuaExpression>
		<LuaFunction Name="_EH_BAR_RelativeElevation()" 
			ReturnType="Double"
			Description="Returns the releative elevation mileage for this OCS contact wire strecher/spanner object." >
			<Constructor>Double _EH_BAR_RelativeElevation()</Constructor>
			<Formula>
				function _EH_BAR_RelativeElevation()
					local Pe = Alignment.RcAlignment.EndPoint
					local f1 = getNearbyPointObjects2D(1.0,"EH-FUN Bardunfundament",Pe) --TODO: deprecated from DNA 2020.1
					local f2 = getNearbyPointObjects2D(1.0,"EH-FUN KL-fundament",Pe)
					local f = getUnionOfCollections({f1,f2})
					local e --absolute elevation
					if getCollectionLength(f) == 0 then
						--Use nearest track's elevation when no foundation is present:
						local t = getClosestTracks(Pe.X,Pe.Y)
						e = getAlignmentInfo(t[0].id,Pe.X,Pe.Y).Point.Z
					else
						--Foundation is present:
						e = f[0].geoCoord.Z + 0.085 --Start a little above foundation
					end
					return e - getAlignmentInfo().Point.Z --Elevation relative to own alignment's elevation here.
				end
			</Formula>
		</LuaFunction>

		<InsertSymbol VariantName="Bardunfeste fotplate, enkel" DisplayBlockName="NO-BN-2D-JBTKL-KRAFTAVLASTING-FOR-BARDUN-ENKEL" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="4e-4" >
			<OwnAlignmentTargetSpace>kl-oppheng</OwnAlignmentTargetSpace>
			<Rotation AddAngle="-90" Direction="true" />
		</InsertSymbol>
		
		<InsertSymbol VariantName="Bardunfeste fotplate, dobbel" DisplayBlockName="NO-BN-2D-JBTKL-KRAFTAVLASTING-FOR-BARDUN-DOBBEL" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="4e-4" >
			<OwnAlignmentTargetSpace>kl-oppheng</OwnAlignmentTargetSpace>
			<Rotation AddAngle="-90" Direction="true" />
		</InsertSymbol>
		
		<InsertSymbol VariantName="Streverfeste fotplate" DisplayBlockName="NO-BN-2D-JBTKL-KRAFTAVLASTING-FOR-STREVER" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="4e-4" >
			<OwnAlignmentTargetSpace>kl-oppheng</OwnAlignmentTargetSpace>
			<Rotation AddAngle="-90" Direction="true" />
		</InsertSymbol>
		
		<InsertSymbol VariantName="Strever med festeplate for Ø120 hengemast for bru og tunnel"
				DisplayBlockName="NO-BN-2D-JBTKL-KRAFTAVLASTING-STREVER-MED-FESTEPLATE-FOR-BRU-OG-TUNNEL-120" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="4e-4" >
			<OwnAlignmentTargetSpace>kl-oppheng</OwnAlignmentTargetSpace>
			<Rotation AddAngle="-90" Direction="true" />
		</InsertSymbol>

		<SymbolDefinition X="0.0" Y="0.0" AllowSymbolMove="true" DefaultBlockName="NO-BN-2D-JBTKL-KRAFTAVLASTING-FOR-BARDUN-ENKEL">
			<Rotation RotateDirection="false" AddAngle="{% if dir == 'up' %}{{270.0|plus:AngularOffset}}
														{% elsif dir == 'down' %}{{90.0|plus:AngularOffset}}
														{% elsif dir == 'both' and RightSided %}{{180.0|plus:AngularOffset}}
														{% elsif dir == 'both' and LeftSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and RightSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and LeftSided %}{{180.0|plus:AngularOffset}}
														{% else %}45.0
														{% endif %}" />	
			<BlockNameFormat JoinBy="-">
				{% if Variant == 'Bardunfeste fotplate, enkel' %}NO-BN-2D-JBTKL-KRAFTAVLASTING-FOR-BARDUN-ENKEL
				{% elsif Variant == 'Bardunfeste fotplate, dobbel' %}NO-BN-2D-JBTKL-KRAFTAVLASTING-FOR-BARDUN-DOBBEL
				{% elsif Variant == 'Streverfeste' %}NO-BN-2D-JBTKL-KRAFTAVLASTING-FOR-STREVER
				{% elsif Variant == 'Strever med festeplate for Ø120 hengemast for bru og tunnel'
					%}NO-BN-2D-JBTKL-KRAFTAVLASTING-STREVER-MED-FESTEPLATE-FOR-BRU-OG-TUNNEL-120
				{% else %}BAD_VARIANT
				{% endif %}
			</BlockNameFormat>
		</SymbolDefinition>
		
		<SymbolDefinition X="0.0" Y="0.0" DefaultBlockName="NO-BN-2D-INSERTION-POINT" />

		<SnapPointsDefinitions>
			<SnapPoints>
				<SnapPoint X="0.0" Y="0.0" TargetSpace="kl-fundament" />
			</SnapPoints>
			<SnapPoints>
				<!-- TODO: Remove reference to 'bardunfundament', it has been replaced with ordinary OCS mast foundations. When the soil is bad then more sturdy foundations are needed. -->
				<SnapPoint X="0.0" Y="0.0" TargetSpace="bardunfundament" />
			</SnapPoints>
			<SnapPoints>
				<SnapPoint X="0.0" Y="0.0" TargetSpace="tunnelfeste" />
			</SnapPoints>
		</SnapPointsDefinitions>

	</ObjectType>


<!--========================================================================================================
	KONTAKTLEDNING
	TUNNELFESTER
	EH-KLO Tunnelfeste
	Et fast punkt på tunnelvegg - typisk til å feste en fix-line.
	TODO Be Bane NOR akseptere ny kategori "kontaktledningsoppheng", EH-KLO.
	Merk: Dette er ikke et fundament. En 'EH-KLO Tunnelfeste' trenger en passende boltegruppe som gyses
	inn i fjell eller i en armert betongblokk mot fjell.
=========================================================================================================-->
	<ObjectType DataType="tOrientedElement" Class="RailwayPlacedObject" Name="EH-KLO Tunnelfeste"
				Layer="JBTKL_EH_KLO" Color="ByLayer"
				Group="Kontaktledning/Kraftavlasting"
				AttMirrorY="{% if RightSided %}true{% else %}false{% endif %}"
				>
				
		<RelationSourceSpace>tunnelfeste</RelationSourceSpace>

		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___ANGULAROFFSET_TAG_OBJECTINFO_METADATA_VAR" />
		<xpp:expand select="NOBN_com_STD_TEXTATTRIBUTES___HORIZONTAL_AND_MEDIUM_CLOSE___JBTKL" />
		<xpp:expand select="NOBN_com_DISCIPLINE_JBTKL" />
		<xpp:expand select="NOBN_com_CHK_NUMBER_OF_OCP_AREAS" />
		<xpp:expand select="RC_com_SET_OCP_STATION_REFERENCE" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___WAYSIDE_GENERAL_OBJECT" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___EARTHED_TO_RAIL" />

		<Variants DefaultValue="Veggfeste for KL-avspenning i tunnel" >
			<Variant Name="Veggfeste for KL-avspenning i tunnel" >
				<SetValue Key="name" Value="KL tunnelfeste" />
				<!-- TODO Lage 3D-objekt fra tegning EH.-->
				<SetValue Key="Model3DName" Value="NO-BN-3D-EH-KLO-KRAFTAVLASTING-TUNNELFESTE" />
			</Variant>
		</Variants>

		<LuaExpression Name="dir"><Formula>"both"</Formula></LuaExpression>

		<InsertSymbol VariantName="Veggfeste for KL-avspenning i tunnel" DisplayBlockName="NO-BN-2D-JBTKL-KRAFTAVLASTING-FOR-TUNNELBARDUN" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="4.0" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<Rotation AddAngle="0" Direction="false" RotateIfRightSideOfAlignment="true" />
		</InsertSymbol>

		<SymbolDefinition X="0.0" Y="0.0" AllowSymbolMove="true" DefaultBlockName="NO-BN-2D-JBTKL-KRAFTAVLASTING-FOR-TUNNELBARDUN" >
			<Rotation RotateDirection="false" AddAngle="{% if dir == 'up' %}{{270.0|plus:AngularOffset}}
														{% elsif dir == 'down' %}{{90.0|plus:AngularOffset}}
														{% elsif dir == 'both' and RightSided %}{{180.0|plus:AngularOffset}}
														{% elsif dir == 'both' and LeftSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and RightSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and LeftSided %}{{180.0|plus:AngularOffset}}
														{% else %}45.0
														{% endif %}" />	
			<BlockNameFormat JoinBy="-">
				NO-BN-2D-JBTKL-KRAFTAVLASTING
				{% if Variant == 'Tunnelfeste' %}TUNNELFESTE
				{% else %}BAD_VARIANT
				{% endif %}
			</BlockNameFormat>
		</SymbolDefinition>
		
		<SymbolDefinition X="0.0" Y="0.0" DefaultBlockName="NO-BN-2D-INSERTION-POINT" />
		
		<!-- Snapper ikke til noe spesielt - dette er litt som et boret fundament for barduner i friluft -->
	
	</ObjectType>



<!--========================================================================================================
	KONTAKTLEDNING
	ANNOTERING
	EH-DIV Annotering
	TODO Hør med Bane NOR om det er OK å benytte 'EH-DIV'.
=========================================================================================================-->
	<ObjectType DataType="tMarker" Class="RailwayPlacedObject" Name="EH-DIV Annotering" 
				Layer="JBTKL_EH_ANNOTERING" Color="ByLayer"
				Group="Kontaktledning/Annotering"
				AttMirrorY="{% if RightSided %}true{% else %}false{% endif %}"
				>

		<RelationSourceSpace>kl-annotering</RelationSourceSpace>
		
		<!-- Note: Using the NOBN_com_STD_CUSTOMATTRIBUTES___TAG_OBJECTINFO_VAR macro avoids inserting lots of metadata -->
		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___OBJECTINFO_VAR" />
		<xpp:expand select="NOBN_com_STD_TEXTATTRIBUTES___HORIZONTAL_AND_40_OFF_NO_TAG___JBTKL" />
		<xpp:expand select="NOBN_com_DISCIPLINE_JBTKL" />
		<xpp:expand select="NOBN_com_CHK_NUMBER_OF_OCP_AREAS" />
		<xpp:expand select="RC_com_SET_OCP_STATION_REFERENCE" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___TRACKBOUND_OBJECT" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___EARTHED_TO_NONE" />

		<LuaExpression Name="DistanceToAlignment"><Formula>RightSided and 4e-4 or -4e-4</Formula></LuaExpression>

		<Variants DefaultValue="Vekslingsfelt annotering">
			<Variant Name="Seksjonsfelt annotering" />
			<Variant Name="Vekslingsfelt annotering" />
			<Variant Name="Sugefelt annotering" />
			<Variant Name="Fritekst annotering" />
		</Variants>
	
		<LuaExpression Name="name"><Formula>_FE_DIV_ocs_annotation_name()</Formula></LuaExpression>
		<LuaFunction Name="_FE_DIV_ocs_annotation_name()" 
			ReturnType="String"
			Description="Obtains the 'name' for a OCS annotation item." >
			<Constructor>String _FE_DIV_ocs_annotation_name()</Constructor>
			<Formula>
				function _FE_DIV_ocs_annotation_name()
					local RelationName = "Er KL-annotering for anything"
					local r,n = RC__getCollectionOfRelatedObjects(RelationName)
					if Variant:match("felt") then 
						if n == 0 then 
							return "UNFINISHED - Relate OCS contact wire change annotation to its two catenary wire alignments with '"..RelationName.."'."
						elseif n == 1 then
							return "UNFINISHED - Relate OCS contact wire change annotation for contact wire '"
								..r[0].code.."' to one more catenary wire alignment with '"..RelationName.."'."
						elseif n == 2 then
							-- NB! The user should use the ManageProperties Relations tab and just drag-and-drop relations in 
							-- the datagrid to modify the sequence of relations (which modifies the text shown in modelspace).
							local a = r[0]
							local b = r[1]
							if (Variant == "Vekslingsfelt annotering") then 
								return "VEKSLINGSFELT".." L"..a.code.." / L"..b.code
							elseif (Variant == "Seksjonsfelt annotering") then 
								return "SEKSJONSFELT".." L"..a.code.." / L"..b.code
							elseif (Variant == "Sugefelt annotering") then 
								return "SUGEFELT".." L"..a.code.." / L"..b.code
							end
						else 
							return _warning,"Too many ["..n.."] related items - relate OCS contact wire change annotation to exactly two catenary wire alignments with '"
								..RelationName.."', or adjust stage settings using layer names."
						end
					elseif Variant:lower():match("fritekst") then 
						if code ~= nil and code ~= "" then 
							return code
						else
							if n == 0 then 
								return "UNFINISHED - Relate OCS annotation with variant '"..Variant.."' to its items with '"
									..RelationName.."' and define the 'code' or 'name' property."
							else
								local s,i
								s = RC__identify(r[0])
								for i = 1, n-1 do
									s = s..", "..RC__identify(r[i])
								end
								return "UNFINISHED - Define the 'code' property or change the 'name' property to annotate related items ["..s.."]."
							end
						end
					else
						return _error,"Bad variant ["..Variant.."] - cannot annotate items"
					end
				end
			</Formula>
		</LuaFunction>

		<!-- Snap to any type of alignment: -->
		<InsertSymbol VariantName="Vekslingsfelt annotering" DisplayBlockName="NO-BN-2D-INSERTION-POINT" 
				DefaultSnapMode="Alignment" SnapToAlignment="true" SnapDistance="0" SnapSensitivityDistance="3" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
		</InsertSymbol>      

		<InsertSymbol VariantName="Seksjonsfelt annotering" DisplayBlockName="NO-BN-2D-INSERTION-POINT" 
				DefaultSnapMode="Alignment" SnapToAlignment="true" SnapDistance="0" SnapSensitivityDistance="3" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
		</InsertSymbol>      

		<InsertSymbol VariantName="Sugefelt annotering" DisplayBlockName="NO-BN-2D-INSERTION-POINT" 
				DefaultSnapMode="Alignment" SnapToAlignment="true" SnapDistance="0" SnapSensitivityDistance="3" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
		</InsertSymbol>      

		<InsertSymbol VariantName="Fritekst annotering" DisplayBlockName="NO-BN-2D-INSERTION-POINT" 
				DefaultSnapMode="Alignment" SnapToAlignment="true" SnapDistance="0" SnapSensitivityDistance="3" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
		</InsertSymbol>      

		<SymbolDefinition X="0.0" Y="0.0" DefaultBlockName="NO-BN-2D-INSERTION-POINT" />

	</ObjectType>



<!--========================================================================================================
	KONTAKTLEDNING
	AVSPENNINGER
	EH-AEH Avspenning
	TODO Skal snappe til mast som default. Kan også plasseres f.eks. rett på vegg.
=========================================================================================================-->
	<LuaFunction Name="NOBN_ocs_getTensioningStandardValues()" 
		ReturnType="Table[4*Double]"
		Description="Returns a standard tensile force (tf) values table: [cwtf]=contact wire tf, [catf]=catenary tf, [swtf]=stitch wire tf, [awtf]=anchor wire tf. See NO-BN TRV." >
		<Constructor>Table[4*Double] NOBN_ocs_getTensioningStandardValues([String OcsSystem])</Constructor>
		<Formula>
			function NOBN_ocs_getTensioningStandardValues(os)
				if os == nil then os = OcsSystem end
				local OcsSystems = {
					"Unknown", 
					"S20A",
					"S20AR",
					"S20B",
					"S20BR",
					"S20C1",
					"S20C2",
					"S25",
					"S35",
					"S35MS",
					"Cariboni"
				}
				--(20C1 and 20C2 use the same tensile forces)
				local TensileForces = {
					["Unknown"] = 	{cwtf=0, 	catf=0, 	swtf=0,		awtf=0},
					["S20A"] = 		{cwtf=10, 	catf=10,	swtf=2.3,	awtf=10},
					["S20AR"] = 	{cwtf=7.06,	catf=7.06,	swtf=2.3, 	awtf=10},
					["S20B"] = 		{cwtf=10,	catf=10,	swtf=0, 	awtf=10},
					["S20BR"] = 	{cwtf=7.06,	catf=7.06,	swtf=0, 	awtf=10},
					["S20C1"] = 	{cwtf=13,	catf=13,	swtf=2.3, 	awtf=10},
					["S20C2"] = 	{cwtf=13,	catf=13,	swtf=2.3, 	awtf=10},
					["S25"] = 		{cwtf=15,	catf=15,	swtf=2.8, 	awtf=10},
					["S35"] = 		{cwtf=7.06,	catf=7.06,	swtf=0, 	awtf=10},
					["S35MS"] = 	{cwtf=7.06,	catf=7.06,	swtf=0, 	awtf=10},
					["Cariboni"] = 	{cwtf=13,	catf=13,	swtf=0, 	awtf=13}
				}
--TODO: Code does not work when more than 10 items in table! Lua is fishy here:
--				if not RC__isMemberOf(OcsSystems,os) then 
--					return TensileForces.Unknown,_warning,_info("Bad tensioning device OCS System ["..os.."]. ")
--				end
				return TensileForces[os]
			end 
		</Formula>
	</LuaFunction>

	<ObjectType DataType="tOrientedElement" Class="RailwayPlacedObject" Name="EH-AEH Avspenning"
				Layer="JBTKL_EH_AEH" Color="ByLayer"
				Group="Kontaktledning/Avspenninger"
				AttMirrorY="{% if RightSided %}true{% else %}false{% endif %}"
				>
				
		<RelationSourceSpace>avspenning</RelationSourceSpace>

		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___ANGULAROFFSET_TAG_OBJECTINFO_METADATA_VAR" />
		<xpp:expand select="NOBN_com_STD_TEXTATTRIBUTES___HORIZONTAL_AND_MEDIUM_CLOSE___JBTKL" />
		<xpp:expand select="NOBN_com_DISCIPLINE_JBTKL" />
		<xpp:expand select="NOBN_com_CHK_NUMBER_OF_OCP_AREAS" />
		<xpp:expand select="RC_com_SET_OCP_STATION_REFERENCE" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___WAYSIDE_GENERAL_OBJECT" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___EARTHED_TO_NONE" />

		<Variants DefaultValue="Fixpunkt" >
			<Variant Name="Fixpunkt" />
			<Variant Name="Fastavspenning, enkel" />
			<Variant Name="Fastavspenning, dobbel" />
			<Variant Name="Loddavspenning, enkel" />
			<Variant Name="Loddavspenning, dobbel" />
			<Variant Name="Fjæravspenning, enkel" />
			<Variant Name="Fjæravspenning, dobbel" />
		</Variants>
		
        <LuaExpression Name="DistanceToAlignment"><Formula>RightSided and 4e-4 or -4e-4</Formula></LuaExpression>

        <LuaExpression Name="dir"><Formula>_EH_AEH_dir()</Formula></LuaExpression>
		<LuaFunction Name="_EH_AEH_dir()" 
			ReturnType="String"
			Description="Obtains the 'dir' for this OCS tensioning device, related to its alignment's direction." >
			<Constructor>String _EH_AEH_dir()</Constructor>
			<Formula>
				function _EH_AEH_dir()
					if Alignment == nil then
						return "unknown",_info("UNFINISHED: Own Alignment (contact wire) undefined for OCS tensioning device.")
					else
						return RC__getDistance2D(Alignment.RcAlignment.StartPoint) &lt; RC__getDistance2D(Alignment.RcAlignment.EndPoint) and "up" or "down"
					end
				end
			</Formula>
		</LuaFunction>

		<LuaExpression Name="code"><Formula>_EH_AEH_code()</Formula></LuaExpression>
		<LuaFunction Name="_EH_AEH_code()" 
			ReturnType="String"
			Description="Obtains the 'code' for this OCS tensioning device, related to its wire with 'Avspenner kontaktledning'." >
			<Constructor>String _EH_AEH_code()</Constructor>
			<Formula>
				function _EH_AEH_code()
					if Alignment == nil then
						return _warning,"UNFINISHED: Own Alignment (contact wire) undefined for OCS tensioning device."
					else
						if Variant:lower():match("fix") then
							local RelationName = "Avspenner kontaktledning"
							local r,n = RC__getCollectionOfRelatedObjects(RelationName)
							if n == 0 then 
								return "UNFINISHED - Relate fixpoint tensioning device with its catenary wire alignments with '"..RelationName.."'."
							else
								return r[0].code
							end
						else
							return Alignment.code
						end
					end
				end
			</Formula>
		</LuaFunction>
	
		<LuaExpression Name="name"><Formula>_EH_AEH_name()</Formula></LuaExpression>
		<LuaFunction Name="_EH_AEH_name()" 
			ReturnType="String"
			Description="Obtains the 'name' for this OCS tensioning device, related to its wire with 'Avspenner kontaktledning'." >
			<Constructor>String _EH_AEH_name()</Constructor>
			<Formula>
				function _EH_AEH_name()
					if Variant:match("Fix") then return "L"..code .. " - [FIX]"
					elseif Variant:match("Fjær") then return "L"..code .. " - [FJ]"
					elseif Variant:match("Fast") then return "L"..code .. " - [F]"
					elseif Variant:match("Lodd") then return "L"..code .. " - [L]"
					else return "Bad tensioning device variant ["..Variant.."].",_warning
					end
				end
			</Formula>
		</LuaFunction>
		
		<LuaExpression Name="Model3DName"><Formula>_EH_AEH_Model3DName()</Formula></LuaExpression>
		<LuaFunction Name="_EH_AEH_Model3DName()" 
			ReturnType="String"
			Description="Obtains the 3D Model Name for this OCS tensioning device." >
			<Constructor>String _EH_AEH_Model3DName()</Constructor>
			<Formula>
				function _EH_AEH_Model3DName()
					t = "NO-BN-3D-EH-AEH-AVSPENNING"
					if Variant:match("Fix") then return t.."-FIXPUNKT"
					else
						if Variant:match("Fjær") then t = t.."-FJÆR"
						elseif Variant:match("Fast") then t = t.."-FAST"
						elseif Variant:match("Lodd") then t = t.."-LODD"
						end
						if Variant:match("enkel") then return t.."-ENKEL"
						elseif Variant:match("dobbel") then return t.."-DOBBEL"
						end
					end
					return _info("Bad tensioning device variant ["..Variant.."].")
				end
			</Formula>
		</LuaFunction>
		
		<CustomAttribute DataType="Enumeration" Name="OcsSystem" DisplayName="KL-system" DefaultValue="Unknown"
			Description="The OCS System is one of [Unknown | S20A | S20AR (redusert) | S20B | S20BR | S20C1 | S20C2 | S25 | S35 | S35MS | Cariboni]." >
			<Values>
				<Value>Unknown</Value>
				<Value>S20A</Value>
				<Value>S20AR</Value>
				<Value>S20B</Value>
				<Value>S20BR</Value>
				<Value>S20C1</Value>
				<Value>S20C2</Value>
				<Value>S25</Value>
				<Value>S35</Value>
				<Value>S35MS</Value>
				<Value>Cariboni</Value>
			</Values>
		</CustomAttribute>

		<CustomAttribute DataType="String" Name="TensileForce" DisplayName="Strekkraft" DefaultValue="(not in use)" 
			Description="The tensile force/forces (tf) exerted on the tensioning device [kN]." />

		<CustomAttribute DataType="String" Name="TensileForceDisplay" DisplayName="Strekkraft visning" DefaultValue="" 
			Description="The tensile force value, as shown close to the tensioning device [kN]." />
		<TextAttribute BindingProperty="TensileForceDisplay" CadAttributeTag="STREKKRAFT" 
			X="0" Y="20" 
			Layer="JBTKL__STREKKRAFT" Justify="MiddleCenter" Height="0.9" Width="0" Color="ByBlock"
			Rotation="0" ObliqueAngle="0" Constant="false" Invisible="false" Lock="false" MText="false" Preset="false" Verifiable="false" />  
		<LuaExpression Name="TensileForceDisplay"><Formula>_EH_AEH_TensileForces(OcsSystem)</Formula></LuaExpression>
		<LuaFunction Name="_EH_AEH_TensileForces()" 
			ReturnType="String"
			Description="Obtains the tensile forces for this OCS tensioning device, of OcsSystem type The OCS System is one of [Unknown | S20A | S20AR (redusert) | S20B | S20BR | S20C1 | S20C2 | S25 | S35 | S35MS | Cariboni]." >
			<Constructor>String _EH_AEH_TensileForces(String OcsSystem)</Constructor>
			<Formula>
				function _EH_AEH_TensileForces(os)
					tf = NOBN_ocs_getTensioningStandardValues(os)
					if os == "Unknown" then 
						return "?/? kN (UNFINISHED - unknown OcsSystem)."
					elseif Variant:match("Fix") then 
						return tf.awtf.." kN (fix)"
					else
						if Variant:match("Fjær") or Variant:match("Fast") or Variant:match("Lodd") then
							return tf.cwtf.."/"..tf.catf.." kN"
						end
					end
					return _info("Bad tensioning device variant ["..Variant.."].")
				end
			</Formula>
		</LuaFunction>

		<!-- Note: They snap to the contact wire alignment even if they might actually work on the suspension catenary wire or a strecher wire or fix wire -->
		<InsertSymbol VariantName="Fixpunkt" DisplayBlockName="NO-BN-2D-JBTKL-AVSPENNING-FIXPUNKT" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="4e-4" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<Rotation AddAngle="-90" Direction="true" />
		</InsertSymbol>
		
		<InsertSymbol VariantName="Fastavspenning, enkel" DisplayBlockName="NO-BN-2D-JBTKL-AVSPENNING-FAST-ENKEL" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="4e-4" >
			<OwnAlignmentTargetSpace>kontaktledning</OwnAlignmentTargetSpace>
			<Rotation AddAngle="-90" Direction="true" />
		</InsertSymbol>
		
		<InsertSymbol VariantName="Fastavspenning, dobbel" DisplayBlockName="NO-BN-2D-JBTKL-AVSPENNING-FAST-DOBBEL" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="4e-4" >
			<OwnAlignmentTargetSpace>kontaktledning</OwnAlignmentTargetSpace>
			<Rotation AddAngle="-90" Direction="true" />
		</InsertSymbol>
		
		<InsertSymbol VariantName="Loddavspenning, enkel" DisplayBlockName="NO-BN-2D-JBTKL-AVSPENNING-LODD-ENKEL" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="4e-4" >
			<OwnAlignmentTargetSpace>kontaktledning</OwnAlignmentTargetSpace>
			<Rotation AddAngle="-90" Direction="true" />
		</InsertSymbol>
		
		<InsertSymbol VariantName="Loddavspenning, dobbel" DisplayBlockName="NO-BN-2D-JBTKL-AVSPENNING-LODD-DOBBEL" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="4e-4" >
			<OwnAlignmentTargetSpace>kontaktledning</OwnAlignmentTargetSpace>
			<Rotation AddAngle="-90" Direction="true" />
		</InsertSymbol>
		
		<InsertSymbol VariantName="Fjæravspenning, enkel" DisplayBlockName="NO-BN-2D-JBTKL-AVSPENNING-FJAER-ENKEL" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="4e-4" >
			<OwnAlignmentTargetSpace>kontaktledning</OwnAlignmentTargetSpace>
			<Rotation AddAngle="-90" Direction="true" />
		</InsertSymbol>
		
		<InsertSymbol VariantName="Fjæravspenning, dobbel" DisplayBlockName="NO-BN-2D-JBTKL-AVSPENNING-FJAER-DOBBEL" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="4e-4" >
			<OwnAlignmentTargetSpace>kontaktledning</OwnAlignmentTargetSpace>
			<Rotation AddAngle="0" Direction="true" />
		</InsertSymbol>
		
		<SymbolDefinition X="0.0" Y="0.0" AllowSymbolMove="true" DefaultBlockName="NO-BN-2D-JBTKL-AVSPENNING-FIXPUNKT" >
			<Rotation RotateDirection="false" AddAngle="{% if dir == 'up' %}{{270.0|plus:AngularOffset}}
														{% elsif dir == 'down' %}{{90.0|plus:AngularOffset}}
														{% elsif dir == 'both' and RightSided %}{{180.0|plus:AngularOffset}}
														{% elsif dir == 'both' and LeftSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and RightSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and LeftSided %}{{180.0|plus:AngularOffset}}
														{% else %}45.0
														{% endif %}" />	
			<BlockNameFormat JoinBy="-">
				NO-BN-2D-JBTKL-AVSPENNING
				{% if Variant == 'Fixpunkt' %}FIXPUNKT
				{% elsif Variant == 'Fastavspenning, enkel' %}FAST-ENKEL
				{% elsif Variant == 'Fastavspenning, dobbel' %}FAST-DOBBEL
				{% elsif Variant == 'Loddavspenning, enkel' %}LODD-ENKEL
				{% elsif Variant == 'Loddavspenning, dobbel' %}LODD-DOBBEL
				{% elsif Variant == 'Fjæravspenning, enkel' %}FJAER-ENKEL
				{% elsif Variant == 'Fjæravspenning, dobbel' %}FJAER-DOBBEL
				{% else %}BAD_VARIANT
				{% endif %}
			</BlockNameFormat>
		</SymbolDefinition>
		
		<SymbolDefinition X="0.0" Y="0.0" DefaultBlockName="NO-BN-2D-INSERTION-POINT" />

		<!-- TODO: Kan avspenningene være snappepunkt for ALIGNMENT av type Wire? -->
		<!-- <SnapPointsDefinitions> -->
			<!-- <SnapPoints> -->
				<!-- <SnapPoint X="0.0" Y="0.0" TargetSpace="bardunfeste" /> -->
				<!-- <SnapPoint X="0.0" Y="0.0" TargetSpace="Streverfeste fotplate" /> -->
			<!-- </SnapPoints> -->
		<!-- </SnapPointsDefinitions> -->

	</ObjectType>



<!--========================================================================================================
	KONTAKTLEDNING
	SEKSJONSISOLATORER
	EH-SIL Seksjonsisolator
=========================================================================================================-->
	<ObjectType DataType="tOrientedElement" Class="RailwayPlacedObject" Name="EH-SIL Seksjonsisolator"
				Layer="JBTKL_EH_SIL" Color="ByLayer"
				Group="Kontaktledning/Isolatorer"
				AttMirrorY="{% if RightSided %}true{% else %}false{% endif %}"
				>
				
		<RelationSourceSpace>seksjonsisolator</RelationSourceSpace>

		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___ANGULAROFFSET_TAG_OBJECTINFO_METADATA_VAR" />
		<xpp:expand select="NOBN_com_STD_TEXTATTRIBUTES___HORIZONTAL_AND_VERY_CLOSE___JBTKL" />
		<xpp:expand select="NOBN_com_DISCIPLINE_JBTKL" />
		<xpp:expand select="NOBN_com_CHK_NUMBER_OF_OCP_AREAS" />
		<xpp:expand select="RC_com_SET_OCP_STATION_REFERENCE" />
		<xpp:expand select="NOBN_ocs_STD_LUAEXPRESSIONS___OVERHEADLINEBOUND_OBJECT" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___EARTHED_TO_NONE" />
	
		<Variants DefaultValue="Seksjonsisolator" >
			<Variant Name="Seksjonsisolator" >
			</Variant>
		</Variants>

		<LuaExpression Name="name">
			<Formula>
				if Variant == "Seksjonsisolator" then return "SI"
				else return "Unknown section insulator variant ["..Variant.."].",_warning
				end
			</Formula>
		</LuaExpression>

		<LuaExpression Name="Model3DName">
			<Formula>
				-- Ref. EK.704790, for speeds up to 80 km/h. Not drawn entirely to scale!
				if Variant == "Seksjonsisolator" then return "NO-BN-3D-EH-SIL-SEKSJONSISOLATOR-BICC"
				else return "Unknown section insulator variant ["..Variant.."].",_warning
				end
			</Formula>
		</LuaExpression>

		<InsertSymbol VariantName="Seksjonsisolator" DisplayBlockName="NO-BN-2D-JBTKL-ISOLATOR-SEKSJONSISOLATOR" 
				DefaultSnapMode="Alignment" SnapToAlignment="true" SnapDistance="4e-4" >
			<OwnAlignmentTargetSpace>kontaktledning</OwnAlignmentTargetSpace>
			<Rotation AddAngle="-90" Direction="true" />
		</InsertSymbol>
		
		<SymbolDefinition X="0.0" Y="0.0" AllowSymbolMove="true" DefaultBlockName="NO-BN-2D-JBTKL-ISOLATOR-SEKSJONSISOLATOR" >
			<Rotation RotateDirection="false" AddAngle="{% if dir == 'up' %}{{270.0|plus:AngularOffset}}
														{% elsif dir == 'down' %}{{90.0|plus:AngularOffset}}
														{% elsif dir == 'both' and RightSided %}{{180.0|plus:AngularOffset}}
														{% elsif dir == 'both' and LeftSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and RightSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and LeftSided %}{{180.0|plus:AngularOffset}}
														{% else %}45.0
														{% endif %}" />	
			<BlockNameFormat JoinBy="-">
				NO-BN-2D-JBTKL-ISOLATOR
				{% if Variant == 'Seksjonsisolator' %}SEKSJONSISOLATOR
				{% else %}BAD_VARIANT
				{% endif %}
			</BlockNameFormat>
		</SymbolDefinition>
		
		<SymbolDefinition X="0.0" Y="0.0" DefaultBlockName="NO-BN-2D-INSERTION-POINT" />

	</ObjectType>



<!--========================================================================================================
	KONTAKTLEDNING
	ISOLATORER
	EH-ISO Isolator
	TODO Avklare med Bane NOR / Banedata at vi kan benytte "EH-ISO" som ny kategori for Objekt-ID.
=========================================================================================================-->
	<ObjectType DataType="tOrientedElement" Class="RailwayPlacedObject" Name="EH-ISO Isolator"
				Layer="JBTKL_EH_ISO" Color="ByLayer"
				Group="Kontaktledning/Isolatorer"
				AttMirrorY="{% if RightSided %}true{% else %}false{% endif %}"
				>
				
		<RelationSourceSpace>lineisolator</RelationSourceSpace>

		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___ANGULAROFFSET_TAG_OBJECTINFO_METADATA_VAR" />
		<xpp:expand select="NOBN_com_STD_TEXTATTRIBUTES___HORIZONTAL_AND_VERY_CLOSE___JBTKL" />
		<xpp:expand select="NOBN_com_DISCIPLINE_JBTKL" />
		<xpp:expand select="NOBN_com_CHK_NUMBER_OF_OCP_AREAS" />
		<xpp:expand select="RC_com_SET_OCP_STATION_REFERENCE" />
		<xpp:expand select="NOBN_ocs_STD_LUAEXPRESSIONS___OVERHEADLINEBOUND_OBJECT" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___EARTHED_TO_NONE" />

		<Variants DefaultValue="Lineisolator" >
			<Variant Name="Lineisolator" >
			</Variant>
			<Variant Name="Stavisolator" >
			</Variant>
		</Variants>

		<LuaExpression Name="name">
			<Formula>
				if Variant == "Lineisolator" then return "Isol."
				elseif Variant == "Stavisolator" then return "Stavisol."
				else return "Unknown line insulator variant ["..Variant.."].",_warning
				end
			</Formula>
		</LuaExpression>

		<!-- TODO lage 3D for stavisolator -->
		<LuaExpression Name="Model3DName">
			<Formula>
				if Variant == "Lineisolator" then return "NO-BN-3D-EH-ISO-LINEISOLATOR-600x100"
				elseif Variant == "Stavisolator" then return "NO-BN-3D-EH-ISO-STAVISOLATOR"
				else return "Unknown line insulator variant ["..Variant.."].",_warning
				end
			</Formula>
		</LuaExpression>

		<InsertSymbol VariantName="Lineisolator" DisplayBlockName="NO-BN-2D-JBTKL-ISOLATOR-LINEISOLATOR" 
				DefaultSnapMode="Alignment" SnapToAlignment="true" SnapDistance="4e-4" >
			<OwnAlignmentTargetSpace>kontaktledning</OwnAlignmentTargetSpace>
			<OwnAlignmentTargetSpace>kl-oppheng</OwnAlignmentTargetSpace> 
			<Rotation AddAngle="-90" Direction="true" />
		</InsertSymbol>
		
		<InsertSymbol VariantName="Stavisolator" DisplayBlockName="NO-BN-2D-JBTKL-ISOLATOR-STAVISOLATOR" 
				DefaultSnapMode="Alignment" SnapToAlignment="true" SnapDistance="4e-4" >
			<OwnAlignmentTargetSpace>kontaktledning</OwnAlignmentTargetSpace>
			<OwnAlignmentTargetSpace>kl-oppheng</OwnAlignmentTargetSpace> 
			<Rotation AddAngle="-90" Direction="true" />
		</InsertSymbol>
		
		<SymbolDefinition X="0.0" Y="0.0" AllowSymbolMove="true" DefaultBlockName="NO-BN-2D-JBTKL-ISOLATOR-LINEISOLATOR" >
			<!-- <Rotation AddAngle="-90" Direction="false" RotateIfRightSideOfAlignment="true" /> -->
			<Rotation RotateDirection="false" AddAngle="{% if dir == 'up' %}{{270.0|plus:AngularOffset}}
														{% elsif dir == 'down' %}{{90.0|plus:AngularOffset}}
														{% elsif dir == 'both' and RightSided %}{{180.0|plus:AngularOffset}}
														{% elsif dir == 'both' and LeftSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and RightSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and LeftSided %}{{180.0|plus:AngularOffset}}
														{% else %}45.0
														{% endif %}" />	
			<BlockNameFormat JoinBy="-">
				NO-BN-2D-JBTKL-ISOLATOR
				{% if Variant == 'Lineisolator' %}LINEISOLATOR
				{% elsif Variant == 'Stavisolator' %}STAVISOLATOR
				{% else %}BAD_VARIANT
				{% endif %}
			</BlockNameFormat>
		</SymbolDefinition>
		
		<SymbolDefinition X="0.0" Y="0.0" DefaultBlockName="NO-BN-2D-INSERTION-POINT" />

	</ObjectType>



<!--========================================================================================================
	KONTAKTLEDNING
	BESKYTTELSE
	EH-XBE Beskyttelsesskjerm
	See EH.705338, 900x1400 single screen construction.
	See EH.704042, 2000x775 double-screen construction.
	See EH.705339, Utførelse type I, II, III, IV/V - various ways to mount 2 x 900x1400 screens.
=========================================================================================================-->
	<ObjectType DataType="tOrientedElement" Class="RailwayPlacedObject" Name="EH-XBE Beskyttelsesskjerm"
				Layer="JBTKL_EH_XBE" Color="ByLayer"
				Group="Kontaktledning/Beskyttelse"
				AttMirrorY="{% if RightSided %}true{% else %}false{% endif %}"
				>
				 
		<RelationSourceSpace>beskyttelse</RelationSourceSpace>

		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___ANGULAROFFSET_TAG_OBJECTINFO_METADATA_VAR" />
		<xpp:expand select="NOBN_com_STD_TEXTATTRIBUTES___HORIZONTAL_AND_MEDIUM_CLOSE___JBTKL" />
		<xpp:expand select="NOBN_com_DISCIPLINE_JBTKL" />
		<xpp:expand select="NOBN_com_CHK_NUMBER_OF_OCP_AREAS" />
		<xpp:expand select="RC_com_SET_OCP_STATION_REFERENCE" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___WAYSIDE_GENERAL_OBJECT" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___EARTHED_TO_NONE" />

		<Variants DefaultValue="Beskyttelsesskjerm 2x900x1400xØ32 på betongmast / bjelkemast" >
			<Variant Name="Beskyttelsesskjerm 2x900x1400xØ32 på tunnelmast / tremast" >
				<!-- See EH.705338, Utførelse type I, II, III, IV/V-->
			</Variant>
			<Variant Name="Beskyttelsesskjerm 2x900x1400xØ32 på betongmast / bjelkemast" >
				<!-- See EH.705338, Utførelse type VI -->
				<!-- Assume HEB mast 200..280, or 240x240 concrete mast (3D models are made only for 240x240): -->
			</Variant>
			<Variant Name="Beskyttelsesskjerm 2x900x1400xØ32 på B-mast bredside" >
				<!-- See EH.705338, Utførelse type VI -->
			</Variant>
			<Variant Name="Beskyttelsesskjerm 2x900x1400xØ32 på B-mast smalside / H-mast" >
				<!-- See EH.705338, Utførelse type VI -->
			</Variant>
			<Variant Name="Beskyttelsesskjerm 2x900x1400xØ32 på hengemast" >
				<!-- See EH.705338, Utførelse type VI -->
			</Variant>
			<Variant Name="Beskyttelsesskjerm 2000x775xØ32 i åk, ett felt" >
				<!-- See EH.704042 type I+II (two plus two ears, placed one pair above the other) -->
			</Variant>
			<Variant Name="Beskyttelsesskjerm 2000x775xØ32 i åk, to felt" >
				<!-- See EH.704042 type I+II (two plus two ears, placed one pair above the other) -->
			</Variant>
		</Variants>

		<CustomAttribute DataType="Enumeration" Name="Tilt" DisplayName="Tilt"
			Description=
			"900x1400 protective screen inclination [00|01|10|11]: 00=none tilted, 01=tilted right, 10=tilted left, 11=both tilted.">
			<Values >
				<Value>00</Value>
				<Value>01</Value>
				<Value>10</Value>
				<Value>11</Value>
			</Values>
		</CustomAttribute>
		
		<LuaExpression Name="name">
			<Formula>
				if Variant:match("Beskyttelsesskjerm") then return "Beskyttelseskjerm"
				else return "Unknown protective screen variant ["..Variant.."].",_warning
				end
			</Formula>
		</LuaExpression>

		<!-- Reference 3D elevation is assumed to be be center of upper Ø32 tube frame -->
		<LuaExpression Name="Model3DName">
			<Formula>
				local s = "NO-BN-3D-EH-XBE-BESKYTTELSE-SKJERM-2x900x1400xØ32-UTF"
				local t = "NO-BN-3D-EH-XBE-BESKYTTELSE-SKJERM-2000x775xØ32"
				if Variant == "Beskyttelsesskjerm 2x900x1400xØ32 på tunnelmast / tremast" then 
					return string.format("%s-%d-%02d",s,1,tonumber(Tilt))
				elseif Variant == "Beskyttelsesskjerm 2x900x1400xØ32 på betongmast / bjelkemast" then 
					return string.format("%s-%d-%02d",s,2,tonumber(Tilt))
				elseif Variant == "Beskyttelsesskjerm 2x900x1400xØ32 på B-mast bredside" then 
					return string.format("%s-%d-%02d",s,3,tonumber(Tilt))
				elseif Variant == "Beskyttelsesskjerm 2x900x1400xØ32 på B-mast smalside / H-mast" then 
					return string.format("%s-%d-%02d",s,45,tonumber(Tilt))
				elseif Variant == "Beskyttelsesskjerm 2x900x1400xØ32 på hengemast" then 
					return string.format("%s-%d-%02d",s,6,tonumber(Tilt))
				elseif Variant == "Beskyttelsesskjerm 2000x775xØ32 i åk, ett felt" then 
					return string.format("%s-%s",t,"A")
				elseif Variant == "Beskyttelsesskjerm 2000x775xØ32 i åk, to felt" then 
					return string.format("%s-%s",t,"B")
				else 
					return "Unknown protective screen Variant ["..Variant.."].",_warning
				end
			</Formula>
		</LuaExpression>

		<InsertSymbol VariantName="Beskyttelsesskjerm 2x900x1400xØ32 på tunnelmast / tremast"
				DisplayBlockName="NO-BN-2D-JBTKL-BESKYTTELSE-SKJERM-1"
				DefaultSnapMode="Point" SnapToAlignment="false" SnapDistance="4.0">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace> 
			<Rotation AddAngle="0" Direction="false" RotateIfRightSideOfAlignment="true" />
			<SetValue Key="Tilt" Value="00" />
			<SetValue Key="dir" Value="both" />
			<SetValue Key="RelativeElevation" Value="6.8" />
		</InsertSymbol>
		
		<InsertSymbol VariantName="Beskyttelsesskjerm 2x900x1400xØ32 på betongmast / bjelkemast" 
				DisplayBlockName="NO-BN-2D-JBTKL-BESKYTTELSE-SKJERM-2"
				DefaultSnapMode="Point" SnapToAlignment="false" SnapDistance="4.0">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace> 
			<Rotation AddAngle="0" Direction="false" RotateIfRightSideOfAlignment="true" />
			<SetValue Key="Tilt" Value="00" />
			<SetValue Key="dir" Value="both" />
			<SetValue Key="RelativeElevation" Value="6.8" />
		</InsertSymbol>

		<InsertSymbol VariantName="Beskyttelsesskjerm 2x900x1400xØ32 på B-mast bredside" 
				DisplayBlockName="NO-BN-2D-JBTKL-BESKYTTELSE-SKJERM-3"
				DefaultSnapMode="Point" SnapToAlignment="false" SnapDistance="4.0">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace> 
			<Rotation AddAngle="0" Direction="false" RotateIfRightSideOfAlignment="true" />
			<SetValue Key="Tilt" Value="00" />
			<SetValue Key="dir" Value="both" />
			<SetValue Key="RelativeElevation" Value="6.8" />
		</InsertSymbol>
		
		<InsertSymbol VariantName="Beskyttelsesskjerm 2x900x1400xØ32 på B-mast smalside / H-mast" 
				DisplayBlockName="NO-BN-2D-JBTKL-BESKYTTELSE-SKJERM-45"
				DefaultSnapMode="Point" SnapToAlignment="false" SnapDistance="4.0">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace> 
			<Rotation AddAngle="0" Direction="false" RotateIfRightSideOfAlignment="true" />
			<SetValue Key="Tilt" Value="00" />
			<SetValue Key="dir" Value="both" />
			<SetValue Key="RelativeElevation" Value="6.8" />
		</InsertSymbol>
		
		<InsertSymbol VariantName="Beskyttelsesskjerm 2x900x1400xØ32 på hengemast" 
				DisplayBlockName="NO-BN-2D-JBTKL-BESKYTTELSE-SKJERM-6"
				DefaultSnapMode="Point" SnapToAlignment="false" SnapDistance="4.0">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace> 
			<Rotation AddAngle="0" Direction="false" RotateIfRightSideOfAlignment="true" />
			<SetValue Key="Tilt" Value="00" />
			<SetValue Key="dir" Value="both" />
			<SetValue Key="RelativeElevation" Value="6.8" />
		</InsertSymbol>
		
		<InsertSymbol VariantName="Beskyttelsesskjerm 2000x775xØ32 i åk, ett felt" 
				DisplayBlockName="NO-BN-2D-JBTKL-BESKYTTELSE-SKJERM-704042"
				DefaultSnapMode="Point" SnapToAlignment="false" SnapDistance="4.0">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace> 
			<Rotation AddAngle="0" Direction="false" RotateIfRightSideOfAlignment="true" />
			<SetValue Key="Tilt" Value="00" />
			<SetValue Key="dir" Value="both" />
			<SetValue Key="RelativeElevation" Value="6.8" />
		</InsertSymbol>
		
		<InsertSymbol VariantName="Beskyttelsesskjerm 2000x775xØ32 i åk, to felt" 
				DisplayBlockName="NO-BN-2D-JBTKL-BESKYTTELSE-SKJERM-704042"
				DefaultSnapMode="Point" SnapToAlignment="false" SnapDistance="4.0">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace> 
			<Rotation AddAngle="0" Direction="false" RotateIfRightSideOfAlignment="true" />
			<SetValue Key="Tilt" Value="00" />
			<SetValue Key="dir" Value="both" />
			<SetValue Key="RelativeElevation" Value="6.8" />
		</InsertSymbol>
		
		<SymbolDefinition X="0.0" Y="0.0" AllowSymbolMove="true" DefaultBlockName="NO-BN-2D-JBTKL-BESKYTTELSE-SKJERM-1" >
			<Rotation RotateDirection="false" AddAngle="{% if dir == 'up' %}{{270.0|plus:AngularOffset}}
														{% elsif dir == 'down' %}{{90.0|plus:AngularOffset}}
														{% elsif dir == 'both' and RightSided %}{{180.0|plus:AngularOffset}}
														{% elsif dir == 'both' and LeftSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and RightSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and LeftSided %}{{180.0|plus:AngularOffset}}
														{% else %}45.0
														{% endif %}" />	
			<BlockNameFormat JoinBy="-">
				NO-BN-2D-JBTKL-BESKYTTELSE
				{% if Variant == 'Beskyttelsesskjerm 2x900x1400xØ32 på tunnelmast / tremast' %}SKJERM-1
				{% elsif Variant == 'Beskyttelsesskjerm 2x900x1400xØ32 på betongmast / bjelkemast' %}SKJERM-2
				{% elsif Variant == 'Beskyttelsesskjerm 2x900x1400xØ32 på B-mast bredside' %}SKJERM-3
				{% elsif Variant == 'Beskyttelsesskjerm 2x900x1400xØ32 på B-mast smalside / H-mast' %}SKJERM-45
				{% elsif Variant == 'Beskyttelsesskjerm 2x900x1400xØ32 på hengemast' %}SKJERM-6
				{% elsif Variant == 'Beskyttelsesskjerm 2000x775xØ32 i åk, ett felt' %}SKJERM-704042
				{% elsif Variant == 'Beskyttelsesskjerm 2000x775xØ32 i åk, to felt' %}SKJERM-704042
				{% else %}BAD_VARIANT
				{% endif %}
			</BlockNameFormat>
		</SymbolDefinition>
		
		<SymbolDefinition X="0.0" Y="0.0" DefaultBlockName="NO-BN-2D-INSERTION-POINT" />

	</ObjectType>



<!--========================================================================================================
	ELEKTRO HØYSPENT
	JORDELEKTRODER
	EH-JEL Jordelektrode
 =========================================================================================================-->
	<ObjectType DataType="tOrientedElement" Class="RailwayPlacedObject" Name="EH-JEL Jordelektrode"
				Layer="JBTKL_EH_JEL" Color="ByLayer"
				Group="Kontaktledning/Jording"
				AttMirrorY="{% if RightSided %}true{% else %}false{% endif %}"
				>
				
		<RelationSourceSpace>jordelektrode</RelationSourceSpace>

		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___ANGULAROFFSET_TAG_OBJECTINFO_METADATA_VAR" />
		<xpp:expand select="NOBN_com_STD_TEXTATTRIBUTES___HORIZONTAL_AND_MEDIUM_CLOSE___JBTKL" />
		<xpp:expand select="NOBN_com_DISCIPLINE_JBTKL" />
		<xpp:expand select="NOBN_com_CHK_NUMBER_OF_OCP_AREAS" />
		<xpp:expand select="RC_com_SET_OCP_STATION_REFERENCE" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___WAYSIDE_GENERAL_OBJECT" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___EARTHED_TO_NONE" />

		<Variants DefaultValue="Kråkefot" >
			<Variant Name="Kråkefot" >
			</Variant>
		</Variants>

		<LuaExpression Name="name">
			<Formula>
if Variant == "Kråkefot" then return "Kråkefot"
else return "Unknown ground spike earthing device variant ["..Variant.."].",_warning
end
			</Formula>
		</LuaExpression>

		<!-- TODO Lage 3D-modeller for kråkefot osv -->
		<LuaExpression Name="Model3DName">
			<Formula>
if Variant == "Kråkefot" then return "NO-BN-3D-EH-JORDING-KRÅKEFOT"
else return "Unknown ground spike earthing device variant ["..Variant.."].",_warning
end
			</Formula>
		</LuaExpression>

		<InsertSymbol VariantName="Kråkefot" DisplayBlockName="NO-BN-2D-JBTKL-JORDING-JORDPOTENSIAL" 
				DefaultSnapMode="Alignment" SnapToAlignment="false" SnapDistance="4.0">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace> 
		</InsertSymbol>
		
		<SymbolDefinition X="0.0" Y="0.0" AllowSymbolMove="true" DefaultBlockName="NO-BN-2D-JBTKL-JORDING-JORDPOTENSIAL" >
			<Rotation RotateDirection="false" AddAngle="{% if dir == 'up' %}{{270.0|plus:AngularOffset}}
														{% elsif dir == 'down' %}{{90.0|plus:AngularOffset}}
														{% elsif dir == 'both' and RightSided %}{{180.0|plus:AngularOffset}}
														{% elsif dir == 'both' and LeftSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and RightSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and LeftSided %}{{180.0|plus:AngularOffset}}
														{% else %}45.0
														{% endif %}" />	
			<BlockNameFormat JoinBy="-">
				NO-BN-2D-JBTKL-JORDING
				{% if Variant == 'Kråkefot' %}JORDPOTENSIAL
				{% else %}BAD_VARIANT
				{% endif %}
			</BlockNameFormat>
		</SymbolDefinition>
		
		<SymbolDefinition X="0.0" Y="0.0" DefaultBlockName="NO-BN-2D-INSERTION-POINT" />

	</ObjectType>



<!--========================================================================================================
	ELEKTRO HØYSPENT
	JORDFORBINDELSER
	EH-JOF Jordforbinder
	TODO Avklare med Bane NOR / Banedata om vi kan opprette ny kategori "EH-JOF"
	TODO Lage model checks som kontrollerer spenningsnivåer - ikke kortslutte høyspent til jord 
 =========================================================================================================-->
	<ObjectType DataType="tOrientedElement" Class="RailwayPlacedObject" Name="EH-JOF Jordforbinder" 
				Layer="JBTKL_EH_JOF" Color="ByLayer"
				Group="Kontaktledning/Jording"
				AttMirrorY="{% if RightSided %}true{% else %}false{% endif %}"
				>
			
		<RelationSourceSpace>jordforbinder</RelationSourceSpace>

		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___ANGULAROFFSET_TAG_OBJECTINFO_METADATA_VAR" />
		<xpp:expand select="NOBN_com_STD_TEXTATTRIBUTES___HORIZONTAL_AND_MEDIUM_CLOSE___JBTKL" />
		<xpp:expand select="NOBN_com_DISCIPLINE_JBTKL" />
		<xpp:expand select="NOBN_com_CHK_NUMBER_OF_OCP_AREAS" />
		<xpp:expand select="RC_com_SET_OCP_STATION_REFERENCE" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___WAYSIDE_GENERAL_OBJECT" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___EARTHED_TO_RAIL" />

		<Variants DefaultValue="Skinnejord" >
			<Variant Name="Skinnejord" >
			</Variant>
		</Variants>

		<LuaExpression Name="name">
			<Formula>
				if Variant == "Skinnejord" then return "Skinnejord"
				else return "Unknown earthing connection device variant ["..Variant.."].",_warning
				end
			</Formula>
		</LuaExpression>

		<!-- TODO Lage 3D-modeller for kråkefot osv -->
		<LuaExpression Name="Model3DName">
			<Formula>
				if Variant == "Skinnejord" then return "NO-BN-3D-EH-JORDING-SKINNEJORD"
				else return "Unknown earthing connection device variant ["..Variant.."].",_warning
				end
			</Formula>
		</LuaExpression>

		<LuaExpression Name="dir"><Formula>"both"</Formula></LuaExpression>	

		<!-- TODO Lage relasjoner for automatisk ruting av kabel for jording av objekt til "sin" skinnejord -->
		<InsertSymbol VariantName="Skinnejord" DisplayBlockName="NO-BN-2D-JBTKL-JORDING-SKINNEJORD" 
				DefaultSnapMode="Alignment" SnapToAlignment="false" SnapDistance="0.75">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace> 
			<Rotation AddAngle="0" RotateIfRightSideOfAlignment="true" />
		</InsertSymbol>
		
		<SymbolDefinition X="0.0" Y="0.0" AllowSymbolMove="true" DefaultBlockName="NO-BN-2D-JBTKL-JORDING-SKINNEJORD" >
			<Rotation RotateDirection="false" AddAngle="{% if dir == 'up' %}{{270.0|plus:AngularOffset}}
														{% elsif dir == 'down' %}{{90.0|plus:AngularOffset}}
														{% elsif dir == 'both' and RightSided %}{{180.0|plus:AngularOffset}}
														{% elsif dir == 'both' and LeftSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and RightSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and LeftSided %}{{180.0|plus:AngularOffset}}
														{% else %}45.0
														{% endif %}" />	
			<BlockNameFormat JoinBy="-">
				NO-BN-2D-JBTKL-JORDING
				{% if Variant == 'Skinnejord' %}SKINNEJORD
				{% else %}BAD_VARIANT
				{% endif %}
			</BlockNameFormat>
		</SymbolDefinition>
		
		<SymbolDefinition X="0.0" Y="0.0" DefaultBlockName="NO-BN-2D-INSERTION-POINT" />

	</ObjectType>



<!--========================================================================================================
	ELEKTRO HØYSPENT
	JORDINGSSKINNER
	EH-JSK Jordingsskinne
=========================================================================================================-->
	<ObjectType DataType="tOrientedElement" Class="RailwayPlacedObject" Name="EH-JSK Jordingsskinne"
				Layer="JBTKL_EH_JSK" Color="ByLayer"
				Group="Kontaktledning/Jording"
				AttMirrorY="{% if RightSided %}true{% else %}false{% endif %}"
				>
				
		<RelationSourceSpace>jordingsskinne</RelationSourceSpace>

		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___ANGULAROFFSET_TAG_OBJECTINFO_METADATA_VAR" />
		<xpp:expand select="NOBN_com_STD_TEXTATTRIBUTES___HORIZONTAL_AND_MEDIUM_CLOSE___JBTKL" />
		<xpp:expand select="NOBN_com_DISCIPLINE_JBTKL" />
		<xpp:expand select="NOBN_com_CHK_NUMBER_OF_OCP_AREAS" />
		<xpp:expand select="RC_com_SET_OCP_STATION_REFERENCE" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___WAYSIDE_GENERAL_OBJECT" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___EARTHED_TO_RAIL" />

		<Variants DefaultValue="Jordingsskinne" >
			<Variant Name="Jordingsskinne" >
			</Variant>
		</Variants>

		<LuaExpression Name="name">
			<Formula>
				if Variant == "Jordingsskinne" then return "Jordingsskinne"
				else return "Unknown earthing bus bar variant ["..Variant.."].",_warning
				end
			</Formula>
		</LuaExpression>

		<!-- TODO Lage 3D-modeller for kråkefot osv -->
		<LuaExpression Name="Model3DName">
			<Formula>
				if Variant == "Jordingsskinne" then return "NO-BN-3D-EH-JORDING-JORDINGSSKINNE"
				else return "Unknown earthing connection device variant ["..Variant.."].",_warning
				end
			</Formula>
		</LuaExpression>

		<!-- TODO Lage relasjoner som assist-funksjoner for automatisk jording kan benytte. Jordingsskinner plasseres f.eks. i kummer -->
		<InsertSymbol VariantName="Jordingsskinne" DisplayBlockName="NO-BN-2D-JBTKL-JORDING-JORDINGSSKINNE" 
				DefaultSnapMode="Point" SnapToAlignment="false" SnapDistance="0.75">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace> 
		</InsertSymbol>
		
		<SymbolDefinition X="0.0" Y="0.0" AllowSymbolMove="true" DefaultBlockName="NO-BN-2D-JBTKL-JORDING-JORDINGSSKINNE" >
			<Rotation RotateDirection="false" AddAngle="{% if dir == 'up' %}{{270.0|plus:AngularOffset}}
														{% elsif dir == 'down' %}{{90.0|plus:AngularOffset}}
														{% elsif dir == 'both' and RightSided %}{{180.0|plus:AngularOffset}}
														{% elsif dir == 'both' and LeftSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and RightSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and LeftSided %}{{180.0|plus:AngularOffset}}
														{% else %}45.0
														{% endif %}" />	
			<BlockNameFormat JoinBy="-">
				NO-BN-2D-JBTKL-JORDING
				{% if Variant == 'Jordingsskinne' %}JORDINGSSKINNE
				{% else %}BAD_VARIANT
				{% endif %}
			</BlockNameFormat>
		</SymbolDefinition>
		
		<SymbolDefinition X="0.0" Y="0.0" DefaultBlockName="NO-BN-2D-INSERTION-POINT" />

	</ObjectType>



<!--========================================================================================================
	KONTAKTLEDNING
	SVEVENDE KRYSS
	EH-SVE Svevende Kryss
	Ref. EH.707403
=========================================================================================================-->
	<!-- TODO: LA denne være utgangspunkt for connection element mellom kontaktledninger -->
	<ObjectType DataType="tOrientedElement" Class="RailwayPlacedObject" Name="EH-SVE Svevende kryss"
				Layer="JBTKL_EH_SVE" Color="ByLayer"
				Group="Kontaktledning/Svevende kryss"
				AttMirrorY="{% if RightSided %}true{% else %}false{% endif %}"
				>
				
		<RelationSourceSpace>svevendekryss</RelationSourceSpace>

		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___ANGULAROFFSET_TAG_OBJECTINFO_METADATA_VAR" />
		<xpp:expand select="NOBN_com_STD_TEXTATTRIBUTES___HORIZONTAL_AND_MEDIUM_CLOSE___JBTKL" />
		<xpp:expand select="NOBN_com_DISCIPLINE_JBTKL" />
		<xpp:expand select="NOBN_com_CHK_NUMBER_OF_OCP_AREAS" />
		<xpp:expand select="RC_com_SET_OCP_STATION_REFERENCE" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___WAYSIDE_GENERAL_OBJECT" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___EARTHED_TO_NONE" />

		<Variants DefaultValue="Svevende kryss" >
			<Variant Name="Svevende kryss" >
			</Variant>
		</Variants>

		<LuaExpression Name="name">
			<Formula>
				if Variant == "Svevende kryss" then return "Svevende kryss"
				else return _error,"Bad OCS crossing lines conncector variant ["..Variant.."]."
				end
			</Formula>
		</LuaExpression>

		<LuaExpression Name="DistanceToAlignment"><Formula>0</Formula></LuaExpression>

		<!-- TODO Lage 3D-modeller for svevende kryss osv -->
		<LuaExpression Name="Model3DName">
			<Formula>
				if Variant == "Svevende kryss" then return "NO-BN-3D-EH-SVE-SVEVENDE-KRYSS-2500"
				else return _error,"Bad OCS crossing lines connector variant ["..Variant.."]."
				end
			</Formula>
		</LuaExpression>

		<InsertSymbol VariantName="Svevende kryss" DisplayBlockName="NO-BN-2D-JBTKL-FORBINDELSE-SVEVENDE-KRYSS" 
				DefaultSnapMode="Alignment" SnapToAlignment="false" SnapDistance="4e-4">
			<OwnAlignmentTargetSpace>kontaktledning</OwnAlignmentTargetSpace> 
			<SetValue Key="name" Value="Svevende kryss" />
		</InsertSymbol>
		
		<SymbolDefinition X="0.0" Y="0.0" AllowSymbolMove="true" DefaultBlockName="NO-BN-2D-JBTKL-FORBINDELSE-SVEVENDE-KRYSS" >
			<Rotation RotateDirection="false" AddAngle="{% if dir == 'up' %}{{270.0|plus:AngularOffset}}
														{% elsif dir == 'down' %}{{90.0|plus:AngularOffset}}
														{% elsif dir == 'both' and RightSided %}{{180.0|plus:AngularOffset}}
														{% elsif dir == 'both' and LeftSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and RightSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and LeftSided %}{{180.0|plus:AngularOffset}}
														{% else %}45.0
														{% endif %}" />	
			<BlockNameFormat JoinBy="-">
				NO-BN-2D-JBTKL-FORBINDELSE
				{% if Variant == 'Svevende kryss' %}SVEVENDE-KRYSS
				{% else %}BAD_VARIANT
				{% endif %}
			</BlockNameFormat>
		</SymbolDefinition>
		
		<SymbolDefinition X="0.0" Y="0.0" DefaultBlockName="NO-BN-2D-INSERTION-POINT" />

	</ObjectType>



<!--========================================================================================================
	KONTAKTLEDNING
	FORBINDELSER
	EH-FOR Forbindelse (Strømbro "C" mellom kontaktledning og bæreline i to ledninger, med "M" mellom dem)
	Dvs elektrisk sammenkobling av to kontakttråder i et vekslingsfelt (seksjonsfelt har bryter)
	Ref. EH.705051.
=========================================================================================================-->
	<ObjectType DataType="tOrientedElement" Class="RailwayPlacedObject" Name="EH-FOR KL-forbindelse"
				Layer="JBTKL_EH_FOR" Color="ByLayer"
				Group="Kontaktledning/Forbindelser"
				AttMirrorY="{% if RightSided %}true{% else %}false{% endif %}"
				>
				
		<RelationSourceSpace>kl-forbindelse</RelationSourceSpace>

		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___ANGULAROFFSET_TAG_OBJECTINFO_METADATA_VAR" />
		<xpp:expand select="NOBN_com_STD_TEXTATTRIBUTES___HORIZONTAL_AND_MEDIUM_CLOSE___JBTKL" />
		<xpp:expand select="NOBN_com_DISCIPLINE_JBTKL" />
		<xpp:expand select="NOBN_com_CHK_NUMBER_OF_OCP_AREAS" />
		<xpp:expand select="RC_com_SET_OCP_STATION_REFERENCE" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___WAYSIDE_GENERAL_OBJECT" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___EARTHED_TO_NONE" />

		<Variants DefaultValue="Strømbro" >
			<Variant Name="Strømbro" >
			</Variant>
		</Variants>
		
		<!-- TODO 2020-09-26: Add 3D symbols to the library: Single / double Størmbro -->

		<InsertSymbol VariantName="Strømbro" DisplayBlockName="NO-BN-2D-JBTKL-FORBINDELSE-STROEMBRO-H" 
				DefaultSnapMode="Alignment" SnapToAlignment="true" SnapDistance="4e-4">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace> 
			<SetValue Key="name" Value="Strømbro" />
		</InsertSymbol>
		
		<SymbolDefinition X="0.0" Y="0.0" AllowSymbolMove="true" DefaultBlockName="NO-BN-2D-JBTKL-FORBINDELSE-STROEMBRO-H" >
			<Rotation RotateDirection="false" AddAngle="{% if dir == 'up' %}{{270.0|plus:AngularOffset}}
														{% elsif dir == 'down' %}{{90.0|plus:AngularOffset}}
														{% elsif dir == 'both' and RightSided %}{{180.0|plus:AngularOffset}}
														{% elsif dir == 'both' and LeftSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and RightSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and LeftSided %}{{180.0|plus:AngularOffset}}
														{% else %}45.0
														{% endif %}" />	
			<!-- TODO 2020-09-26 There are two types of Strømbro 2D symbols, "STROEMBRO" and "STROEMBRO-V" - why? -->
			<BlockNameFormat JoinBy="-">
				NO-BN-2D-JBTKL-FORBINDELSE
				{% if Variant == 'Strømbro' %}STROEMBRO-H
				{% else %}BAD_VARIANT
				{% endif %}
			</BlockNameFormat>
		</SymbolDefinition>
		
		<SymbolDefinition X="0.0" Y="0.0" DefaultBlockName="NO-BN-2D-INSERTION-POINT">
			<Rotation />
		</SymbolDefinition>
	</ObjectType>



<!--========================================================================================================
	KONTAKTLEDNING
	BRYTERE
	EH-BRY KL-bryter
=========================================================================================================-->
	<ObjectType DataType="tOrientedElement" Class="RailwayPlacedObject" Name="EH-BRY KL-bryter"
				Layer="JBTKL_EH_BRY" Color="ByLayer"
				Group="Kontaktledning/Brytere"
				AttMirrorY="{% if RightSided %}true{% else %}false{% endif %}"
				>
				
		<RelationSourceSpace>kl-bryter</RelationSourceSpace>

		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___ANGULAROFFSET_TAG_OBJECTINFO_METADATA_VAR" />
		<xpp:expand select="NOBN_com_STD_TEXATTRIBUTES___VERTICAL_AND_FAR___JBTKL" />
		<xpp:expand select="NOBN_com_DISCIPLINE_JBTKL" />
		<xpp:expand select="NOBN_com_CHK_NUMBER_OF_OCP_AREAS" />
		<xpp:expand select="RC_com_SET_OCP_STATION_REFERENCE" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___WAYSIDE_GENERAL_OBJECT" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___EARTHED_TO_OBJECT" />

		<Variants DefaultValue="Skillebryter">
			<Variant Name="Skillebryter" >
				<SetValue Key="name" Value="Skillebryter" />
			</Variant>
			<Variant Name="Lastskillebryter" >
				<SetValue Key="name" Value="Lastskillebryter" />
			</Variant>
			<Variant Name="Jordingsbryter" >
				<SetValue Key="name" Value="Jordingsbryter" />
			</Variant>
		</Variants>
		
		<CustomAttribute DataType="Enumeration" Name="NormalPosition" DisplayName="Grunnstilling" DefaultValue="Open"
			Description="Switch circuit normal position [Open | Closed].">
			<Values>
				<Value DisplayName="Åpen">Open</Value>
				<Value DisplayName="Lukket">Closed</Value>
			</Values>
		</CustomAttribute>
		
		<CustomAttribute DataType="Enumeration" Name="Motorized" DisplayName="Motorisert" DefaultValue="No"
			Description="Switch motorization [Yes | No].">
			<Values>
				<Value DisplayName="Ja">Yes</Value>
				<Value DisplayName="Nei">No</Value>
			</Values>
		</CustomAttribute>
		
		<CustomAttribute DataType="Enumeration" Name="Poles" DisplayName="Poler" DefaultValue="One"
			Description="The number of conductors which are opened or closed when using the switch [One | Two | Three].">
			<Values>
				<Value DisplayName="En">One</Value>
				<Value DisplayName="To">Two</Value>
				<Value DisplayName="Tre">Three</Value>
			</Values>
		</CustomAttribute>
		
		<LuaExpression Name="dir"><Formula>"none"</Formula></LuaExpression>

		<!-- Snap distance 0.6 is because the text shall be placed at a suitable distance from centre track. -->
		<!-- TODO: Implement 3D objects, place 2D symbol as point snap to an OCS  mast. -->
		<InsertSymbol VariantName="Skillebryter" DisplayName="Skillebryter" DisplayBlockName="NO-BN-2D-JBTKL-BRYTER-SKILLEBRYTER-AAPEN" 
				DefaultSnapMode="Alignment" SnapToAlignment="false" SnapDistance="0.6">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace> 
			<Rotation Direction="true" />
			<SetValue Key="Poles" Value="One" />
			<SetValue Key="Motorized" Value="No" />
		</InsertSymbol>
		
		<InsertSymbol VariantName="Skillebryter" DisplayName="Topols Skillebryter" DisplayBlockName="NO-BN-2D-JBTKL-BRYTER-SKILLEBRYTER-TOPOLET-AAPEN" 
				DefaultSnapMode="Alignment" SnapToAlignment="false" SnapDistance="0.6">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace> 
			<Rotation Direction="true" />
			<SetValue Key="Poles" Value="Two" />
			<SetValue Key="Motorized" Value="No" />
		</InsertSymbol>
		
		<InsertSymbol VariantName="Skillebryter" DisplayName="Trepols Skillebryter" DisplayBlockName="NO-BN-2D-JBTKL-BRYTER-SKILLEBRYTER-TREPOLET-AAPEN" 
				DefaultSnapMode="Alignment" SnapToAlignment="false" SnapDistance="0.6">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace> 
			<Rotation Direction="true" />
			<SetValue Key="Poles" Value="Three" />
			<SetValue Key="Motorized" Value="No" />
		</InsertSymbol>
		
		<InsertSymbol VariantName="Skillebryter" DisplayName="Motorisert Skillebryter" DisplayBlockName="NO-BN-2D-JBTKL-BRYTER-SKILLEBRYTER-MOTORISERT-AAPEN" 
				DefaultSnapMode="Alignment" SnapToAlignment="false" SnapDistance="0.6">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace> 
			<Rotation Direction="true" />
			<SetValue Key="Poles" Value="One" />
			<SetValue Key="Motorized" Value="Yes" />
		</InsertSymbol>
		
		<InsertSymbol VariantName="Skillebryter" DisplayName="Motorisert Topols Skillebryter" DisplayBlockName="NO-BN-2D-JBTKL-BRYTER-SKILLEBRYTER-MOTORISERT-TOPOLET-AAPEN" 
				DefaultSnapMode="Alignment" SnapToAlignment="false" SnapDistance="0.6">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace> 
			<Rotation Direction="true" />
			<SetValue Key="Poles" Value="Two" />
			<SetValue Key="Motorized" Value="Yes" />
		</InsertSymbol>
		
		<InsertSymbol VariantName="Skillebryter" DisplayName="Motorisert Trepols Skillebryter" DisplayBlockName="NO-BN-2D-JBTKL-BRYTER-SKILLEBRYTER-MOTORISERT-TREPOLET-AAPEN" 
				DefaultSnapMode="Alignment" SnapToAlignment="false" SnapDistance="0.6">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace> 
			<Rotation Direction="true" />
			<SetValue Key="Poles" Value="Three" />
			<SetValue Key="Motorized" Value="Yes" />
		</InsertSymbol>
		
		<InsertSymbol VariantName="Lastskillebryter" DisplayName="Lastskillebryter" DisplayBlockName="NO-BN-2D-JBTKL-BRYTER-LASTSKILLEBRYTER-AAPEN" 
				DefaultSnapMode="Alignment" SnapToAlignment="false" SnapDistance="0.6">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace> 
			<Rotation Direction="true" />
			<SetValue Key="Poles" Value="One" />
			<SetValue Key="Motorized" Value="No" />
		</InsertSymbol>
		
		<InsertSymbol VariantName="Lastskillebryter" DisplayName="Topols Lastskillebryter" DisplayBlockName="NO-BN-2D-JBTKL-BRYTER-LASTSKILLEBRYTER-TOPOLET-AAPEN" 
				DefaultSnapMode="Alignment" SnapToAlignment="false" SnapDistance="0.6">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace> 
			<Rotation Direction="true" />
			<SetValue Key="Poles" Value="Two" />
			<SetValue Key="Motorized" Value="No" />
		</InsertSymbol>
		
		<InsertSymbol VariantName="Lastskillebryter" DisplayName="Trepols Lastskillebryter" DisplayBlockName="NO-BN-2D-JBTKL-BRYTER-LASTSKILLEBRYTER-TREPOLET-AAPEN" 
				DefaultSnapMode="Alignment" SnapToAlignment="false" SnapDistance="0.6">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace> 
			<Rotation Direction="true" />
			<SetValue Key="Poles" Value="Three" />
			<SetValue Key="Motorized" Value="No" />
		</InsertSymbol>
		
		<InsertSymbol VariantName="Lastskillebryter" DisplayName="Motorisert Lastskillebryter" DisplayBlockName="NO-BN-2D-JBTKL-BRYTER-LASTSKILLEBRYTER-MOTORISERT-AAPEN" 
				DefaultSnapMode="Alignment" SnapToAlignment="false" SnapDistance="0.6">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace> 
			<Rotation Direction="true" />
			<SetValue Key="Poles" Value="One" />
			<SetValue Key="Motorized" Value="Yes" />
		</InsertSymbol>
		
		<InsertSymbol VariantName="Lastskillebryter" DisplayName="Motorisert Topols Lastskillebryter" DisplayBlockName="NO-BN-2D-JBTKL-BRYTER-LASTSKILLEBRYTER-MOTORISERT-TOPOLET-AAPEN" 
				DefaultSnapMode="Alignment" SnapToAlignment="false" SnapDistance="0.6">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace> 
			<Rotation Direction="true" />
			<SetValue Key="Poles" Value="Two" />
			<SetValue Key="Motorized" Value="Yes" />
		</InsertSymbol>
		
		<InsertSymbol VariantName="Lastskillebryter" DisplayName="Motorisert Trepols Lastskillebryter" DisplayBlockName="NO-BN-2D-JBTKL-BRYTER-LASTSKILLEBRYTER-MOTORISERT-TREPOLET-AAPEN" 
				DefaultSnapMode="Alignment" SnapToAlignment="false" SnapDistance="0.6">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace> 
			<Rotation Direction="true" />
			<SetValue Key="Poles" Value="Three" />
			<SetValue Key="Motorized" Value="Yes" />
		</InsertSymbol>
		
		<InsertSymbol VariantName="Jordingsbryter" DisplayName="Jordingsbryter" DisplayBlockName="NO-BN-2D-JBTKL-BRYTER-JORDINGSBRYTER-AAPEN" 
				DefaultSnapMode="Alignment" SnapToAlignment="false" SnapDistance="0.6">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace> 
			<Rotation Direction="true" />
			<SetValue Key="Poles" Value="One" />
			<SetValue Key="Motorized" Value="No" />
		</InsertSymbol>
		
		<InsertSymbol VariantName="Jordingsbryter" DisplayName="Topols Jordingsbryter" DisplayBlockName="NO-BN-2D-JBTKL-BRYTER-JORDINGSBRYTER-TOPOLET-AAPEN" 
				DefaultSnapMode="Alignment" SnapToAlignment="false" SnapDistance="0.6">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace> 
			<Rotation Direction="true" />
			<SetValue Key="Poles" Value="Two" />
			<SetValue Key="Motorized" Value="No" />
		</InsertSymbol>
		
		<InsertSymbol VariantName="Jordingsbryter" DisplayName="Trepols Jordingsbryter" DisplayBlockName="NO-BN-2D-JBTKL-BRYTER-JORDINGSBRYTER-TREPOLET-AAPEN" 
				DefaultSnapMode="Alignment" SnapToAlignment="false" SnapDistance="0.6">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace> 
			<Rotation Direction="true" />
			<SetValue Key="Poles" Value="Three" />
			<SetValue Key="Motorized" Value="No" />
		</InsertSymbol>
		
		<InsertSymbol VariantName="Jordingsbryter" DisplayName="Motorisert Jordingsbryter" DisplayBlockName="NO-BN-2D-JBTKL-BRYTER-JORDINGSBRYTER-MOTORISERT-AAPEN" 
				DefaultSnapMode="Alignment" SnapToAlignment="false" SnapDistance="0.6">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace> 
			<Rotation Direction="true" />
			<SetValue Key="Poles" Value="One" />
			<SetValue Key="Motorized" Value="Yes" />
		</InsertSymbol>
		
		<InsertSymbol VariantName="Jordingsbryter" DisplayName="Motorisert Topols Jordingsbryter" DisplayBlockName="NO-BN-2D-JBTKL-BRYTER-JORDINGSBRYTER-MOTORISERT-TOPOLET-AAPEN" 
				DefaultSnapMode="Alignment" SnapToAlignment="false" SnapDistance="0.6">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace> 
			<Rotation Direction="true" />
			<SetValue Key="Poles" Value="Two" />
			<SetValue Key="Motorized" Value="Yes" />
		</InsertSymbol>
		
		<InsertSymbol VariantName="Jordingsbryter" DisplayName="Motorisert Trepols Jordingsbryter" DisplayBlockName="NO-BN-2D-JBTKL-BRYTER-JORDINGSBRYTER-MOTORISERT-TREPOLET-AAPEN" 
				DefaultSnapMode="Alignment" SnapToAlignment="false" SnapDistance="0.6">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace> 
			<Rotation Direction="true" />
			<SetValue Key="Poles" Value="Three" />
			<SetValue Key="Motorized" Value="Yes" />
		</InsertSymbol>
		
		<SymbolDefinition X="0.0" Y="0.0" AllowSymbolMove="true" DefaultBlockName="NO-BN-2D-JBTKL-BRYTER-SKILLEBRYTER-AAPEN">
			<Rotation RotateDirection="false" AddAngle="{% if dir == 'up' %}{{270.0|plus:AngularOffset}}
														{% elsif dir == 'down' %}{{90.0|plus:AngularOffset}}
														{% elsif dir == 'both' and RightSided %}{{180.0|plus:AngularOffset}}
														{% elsif dir == 'both' and LeftSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and RightSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and LeftSided %}{{180.0|plus:AngularOffset}}
														{% else %}45.0
														{% endif %}" />	
			<BlockNameFormat JoinBy="-">
				NO-BN-2D-JBTKL-BRYTER
				{% if Variant == 'Skillebryter' %}SKILLEBRYTER
				{% elsif Variant == 'Lastskillebryter' %}LASTSKILLEBRYTER
				{% elsif Variant == 'Jordingsbryter' %}JORDINGSBRYTER
				{% else %}BAD_VARIANT
				{% endif %}
				{% if Motorized == 'Yes' %}MOTORISERT{% endif %}
				{% if Poles == 'Two' %}TOPOLET
				{% elsif Poles == 'Three' %}TREPOLET
				{% endif %}
				{% if NormalPosition == 'Open' %}AAPEN
				{% else %}LUKKET
				{% endif %}
			</BlockNameFormat>
		</SymbolDefinition>
		
		<SymbolDefinition X="0.0" Y="0.0" DefaultBlockName="NO-BN-2D-INSERTION-POINT" />

		<SnapPointsDefinitions>
			<SnapPoints>
				<SnapPoint X="0.0" Y="0.0" TargetSpace="bryter" />
			</SnapPoints>
		</SnapPointsDefinitions>

	</ObjectType>



<!--========================================================================================================
	KONTAKTLEDNING
	SUGETRANSFORMATORER
	EH-SUG Sugetransformator
=========================================================================================================-->
	<ObjectType DataType="tOrientedElement" Class="RailwayPlacedObject" Name="EH-SUG Sugetransformator"
				Layer="JBTKL_EH_SUG" Color="ByLayer"
				Group="Kontaktledning/Sugetransformatorer"
				AttMirrorY="{% if RightSided %}true{% else %}false{% endif %}"
				>
				
		<RelationSourceSpace>sugetransformator</RelationSourceSpace>

		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___ANGULAROFFSET_TAG_OBJECTINFO_METADATA_VAR" />
		<xpp:expand select="NOBN_com_STD_TEXTATTRIBUTES___HORIZONTAL_AND_MEDIUM_CLOSE___JBTKL" />
		<xpp:expand select="NOBN_com_DISCIPLINE_JBTKL" />
		<xpp:expand select="NOBN_com_CHK_NUMBER_OF_OCP_AREAS" />
		<xpp:expand select="RC_com_SET_OCP_STATION_REFERENCE" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___WAYSIDE_GENERAL_OBJECT" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___EARTHED_TO_OBJECT" />

		<Variants DefaultValue="Sugetransformator" >
			<Variant Name="Sugetransformator" />
			<Variant Name="Sugetransformator i kiosk" />
		</Variants>

		<LuaExpression Name="dir"><Formula>"both"</Formula></LuaExpression>
				   
		<InsertSymbol VariantName="Sugetransformator" DisplayBlockName="NO-BN-2D-JBTKL-TRANSFORMATOR-SUGETRAFO" 
				DefaultSnapMode="Alignment" SnapToAlignment="true" SnapDistance="4e-4">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace> 
			<Rotation RotateIfRightSideOfAlignment="true" AddAngle="0" Direction="false" />
			<SetValue Key="name" Value="Sugetrafo" />
		</InsertSymbol>
		
		<InsertSymbol VariantName="Sugetransformator i kiosk" DisplayBlockName="NO-BN-2D-JBTKL-TRANSFORMATOR-SUGETRAFO-I-KIOSK" 
				DefaultSnapMode="Alignment" SnapToAlignment="true" SnapDistance="4e-4">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace> 
			<Rotation RotateIfRightSideOfAlignment="true" AddAngle="0" Direction="false" />
			<SetValue Key="name" Value="Sugetrafo i kiosk" />
		</InsertSymbol>
		
		<SymbolDefinition X="0.0" Y="0.0" AllowSymbolMove="true" DefaultBlockName="NO-BN-2D-JBTKL-TRANSFORMATOR-SUGETRAFO" >
			<Rotation RotateDirection="false" AddAngle="{% if dir == 'up' %}{{270.0|plus:AngularOffset}}
														{% elsif dir == 'down' %}{{90.0|plus:AngularOffset}}
														{% elsif dir == 'both' and RightSided %}{{180.0|plus:AngularOffset}}
														{% elsif dir == 'both' and LeftSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and RightSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and LeftSided %}{{180.0|plus:AngularOffset}}
														{% else %}45.0
														{% endif %}" />	
			<BlockNameFormat JoinBy="-">
				NO-BN-2D-JBTKL-TRANSFORMATOR
				{% if Variant == 'Sugetransformator' %}SUGETRAFO
				{% elsif Variant == 'Sugetransformator i kiosk' %}SUGETRAFO-I-KIOSK
				{% else %}BAD_VARIANT
				{% endif %}
			</BlockNameFormat>
		</SymbolDefinition>
		
		<SymbolDefinition X="0.0" Y="0.0" DefaultBlockName="NO-BN-2D-INSERTION-POINT">
			<Rotation />
		</SymbolDefinition>
	</ObjectType>



<!--========================================================================================================
	KONTAKTLEDNING
	AUTOTRANSFORMATORER
	EH-AUT Autotransformator
=========================================================================================================-->
	<ObjectType DataType="tOrientedElement" Class="RailwayPlacedObject" Name="EH-AUT Autotransformator"
				Layer="JBTKL_EH_SUG" Color="ByLayer"
				Group="Kontaktledning/Autotransformatorer"
				AttMirrorY="{% if RightSided %}true{% else %}false{% endif %}"
				>
				
		<RelationSourceSpace>autotransformator</RelationSourceSpace>

		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___ANGULAROFFSET_TAG_OBJECTINFO_METADATA_VAR" />
		<xpp:expand select="NOBN_com_STD_TEXTATTRIBUTES___HORIZONTAL_AND_MEDIUM_CLOSE___JBTKL" />
		<xpp:expand select="NOBN_com_DISCIPLINE_JBTKL" />
		<xpp:expand select="NOBN_com_CHK_NUMBER_OF_OCP_AREAS" />
		<xpp:expand select="RC_com_SET_OCP_STATION_REFERENCE" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___WAYSIDE_GENERAL_OBJECT" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___EARTHED_TO_OBJECT" />

		<LuaExpression Name="dir"><Formula>"both"</Formula></LuaExpression>

		<Variants DefaultValue="Autotransformator" >
			<Variant Name="Autotransformator" />
		</Variants>

		<InsertSymbol VariantName="Autotransformator" DisplayBlockName="NO-BN-2D-JBTKL-TRANSFORMATOR-AUTOTRAFO" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="4e-4">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace> 
			<Rotation RotateIfRightSideOfAlignment="true" AddAngle="0" Direction="false" />
			<SetValue Key="name" Value="Autotrafo" />
		</InsertSymbol>
		
		<SymbolDefinition X="0.0" Y="0.0" AllowSymbolMove="true" DefaultBlockName="NO-BN-2D-JBTKL-TRANSFORMATOR-AUTOTRAFO" >
			<Rotation RotateDirection="false" AddAngle="{% if dir == 'up' %}{{270.0|plus:AngularOffset}}
														{% elsif dir == 'down' %}{{90.0|plus:AngularOffset}}
														{% elsif dir == 'both' and RightSided %}{{180.0|plus:AngularOffset}}
														{% elsif dir == 'both' and LeftSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and RightSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and LeftSided %}{{180.0|plus:AngularOffset}}
														{% else %}45.0
														{% endif %}" />	
			<BlockNameFormat JoinBy="-">
				NO-BN-2D-JBTKL-TRANSFORMATOR
				{% if Variant == 'Autotransformator' %}AUTOTRAFO
				{% else %}BAD_VARIANT
				{% endif %}
			</BlockNameFormat>
		</SymbolDefinition>
		
		<SymbolDefinition X="0.0" Y="0.0" DefaultBlockName="NO-BN-2D-INSERTION-POINT">
			<Rotation />
		</SymbolDefinition>
	</ObjectType>



<!--========================================================================================================
    End of file 
=========================================================================================================-->
</xpp:bloc>
<!--========================================================================================================

    NO-BN-SignalingObjects.xml
	
	Include in DNA file using XPPq XML preprocessor directive <xpp:expand href="fileName.xml" />.

	(c) Railcomplete AS, Norway, 2015-2021. All rights reserved.
	
=========================================================================================================-->
<xpp:bloc>



<!--========================================================================================================
	sig - 
	Global Lua formulas for signaling objects (for signals: see other DNA file).
	Domain-specific Lua functions, stored in Global Extension Dictionary (not in each object),
	such that several ObjectType declarations may use theses functions.
=========================================================================================================-->
	<LuaFunction Name="NOBN_sig_getCabinetName()" ReturnType="String"
		Description="Returns a string for each cabinet variant. Keylock cabinets receive a code based on the object's OCP area and the 'seq' property." >
        <Constructor>String NOBN_sig_getCabinetName()</Constructor>
        <Formula>
			function NOBN_sig_getCabinetName()
				if string.find(Variant, "apparat") then
					return "As."..code
				elseif string.find(Variant, "Nøkkel") then 
					local v = "Arbeidsområde"
					local n,a
					n,a = RC_com_getAreasOfVariant(v)
					if n == 1 then
						return "Nøk."..RC_com_getOcpCode().." "..a[0].code.."-"..seq 
					else 
						return "*** Zero or multiple ("..n..") areas found of Variant '"..v.."' - cannot deduce a unique name for keylock cabinet." 
					end
				elseif string.find(Variant, "Sveiv") then
					return "Ss."..code
				elseif string.find(Variant, "Kabel") then
					return "Kabelboks "..code
				else
					return "Unknown variant",_warning
				end
			end
		</Formula>
	</LuaFunction>

	 
	 
<!--========================================================================================================
	SIGNAL
	CABLES
	TODO: Modelleres ferdig, krever ny funksjonalitet
 =========================================================================================================>
	<ObjectType DataType="tElementWithAlignment" Class="RailwayAlignment" Name="JBTSA_KAB Signalkabel" 
				Layer="JBTSA_KAB" Color="ByLayer" 
				Group="Signal/Kabler"
				>
TODO: Ref Issue #5708 fra 2019-07-09: Add element: Description="https://trv.banenor.no/wiki/Vedlegg_b_Skj%C3%B8ting_og_terminering_av_kabel"

		<RelationSpace>signalkabel</RelationSpace>
		
		<Variants DefaultValue="EESI" >
			<Variant Name="EEBI" >
			</Variant>
			<Variant Name="EESI" >
			</Variant>
			<Variant Name="IFSI" >
			</Variant>
		</Variants>
				
		(...diverse makroer med standard-stæsj...)
		
		<CustomAttribute DataType="Enumeration" Name="Wiring" DisplayName="Lederantall" DefaultValue="4A1,5" >
			<Values>
				<Value>4A1,5</Value>
				<Value>3</Value>
				<Value>7</Value>
				<Value>12</Value>
				<Value>19</Value>
				<Value>27</Value>
				<Value>37</Value>
				<Value>48</Value>
				<Value>65</Value>
				<Value>80</Value>
			</Values>
		</CustomAttribute>

		<LuaExpression Name="name" >
			<Formula>"Kab."..code</Formula>
		</LuaExpression>
	
	</ObjectType>
-->	
	
	
	
	
<!--========================================================================================================
	SIGNAL
	KEY LOCK
=========================================================================================================-->
	<ObjectType DataType="tOrientedElement" Class="RailwayPlacedObject" Name="JBTSA_SAM S-lås"
				Layer="JBTSA_SAM" Color="ByLayer"
				Group="Signal/Diverse"
				AttMirrorY="{% if RightSided %}true{% else %}false{% endif %}"
				>
<!-- TODO: Add element: Description="Se også SA-FUN Stolpe for S-lås / https://trv.banenor.no/wiki/Signal/Prosjektering/Andre_anlegg#L.C3.A5sanlegg / https://trv.banenor.no/wiki/Signal/Vedlikehold/Annet_teknisk_utstyr#S-l.C3.A5s" -->

		<RelationSpace>s_lås</RelationSpace>
		<AttachmentCategory Name="s_lås" />
		<AttachTo Category="stolpe_med_fot" />

		<!-- <xpp:expand select="NOBN_xxx_DEPRECATED_MACRO___TO_BE_REMOVED" /> -->
		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___ANGULAROFFSET_VAR" />
		<xpp:expand select="NOBN_com_STD_TEXTATTRIBUTES___HORIZONTAL_AND_CLOSE___SIG" />
		<xpp:expand select="NOBN_com_DISCIPLINE___SIG" />
		<xpp:expand select="NOBN_com_CHK_NUMBER_OF_OCP_AREAS" />
		<xpp:expand select="RC_com_SET_OCP_STATION_REFERENCE" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___WAYSIDE_GENERAL_OBJECT" />
		<!-- Note: The pole to which the S-lock is screwed firmly will be the actual earth provider, but we want the S-lock to appear in earthing drawings / tables. -->
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___EARTHED_TO_RAIL" />

		
		
		<xpp:expand select="NOBN_com_PSET_TITTELFELT" />
		<xpp:expand select="NOBN_com_PSET_FDV_BANEDATA" />
		<xpp:expand select="NOBN_com_PSET_FDV_BANEDATA_SA_SAM" />
		<xpp:expand select="NOBN_com_PSET_HOV_ID" />

		<LuaExpression Name="IsyPostnotat"><Formula>name</Formula></LuaExpression> 

		<Variants>
			<Variant Name="S-lås" >
				<SetValue Key="Model3DName" Value="NO-BN-3D-SA-SAM-SAMLELÅS" />
				<SetValue Key="Offset3D.Z" Value="1.25" />
			</Variant>
			<!--<Variant Name="Overdragstrafo" />-->
		</Variants>

		<LuaExpression Name="name" ><Formula>"S-lås."..code</Formula></LuaExpression>
		
		<InsertPointObject VariantName="S-lås" DisplayBlockName="NO-BN-2D-JBTSA_SAM-SAMLELAAS-{{SymbolMode}}"
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="4.0" AskForAttachment="true" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="false" RotateIfRightSideOfAlignment="true" />
			<SetValue Key="dir" Value="both" />
		</InsertPointObject>

		<SymbolDefinition DefaultBlockName="NO-BN-2D-JBTSA_SAM-SAMLELAAS-{{SymbolMode}}" AllowSymbolMove="true" >
			<Rotation Add180DegreesIfDirIsDown="false" AddAngle="{% if dir == 'up' %}{{270.0|plus:AngularOffset}}
														{% elsif dir == 'down' %}{{90.0|plus:AngularOffset}}
														{% elsif dir == 'both' and RightSided %}{{180.0|plus:AngularOffset}}
														{% elsif dir == 'both' and LeftSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and RightSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and LeftSided %}{{180.0|plus:AngularOffset}}
														{% else %}45.0
														{% endif %}" />	
			<BlockNameFormat JoinBy="-">
				{% if Variant == 'S-lås' %}NO-BN-2D-JBTSA_SAM-SAMLELAAS
				{% else %}BAD_Variant
				{% endif %}
				{{SymbolMode}}
			</BlockNameFormat>
		</SymbolDefinition>

		<Model3DDefinition>
			<Attribute Tag="T01" >
				<Value>{{code}}</Value>
			</Attribute>
		</Model3DDefinition>

		<DockPointDefinitions>
			<SnapPoints>
				<SnapPoint X="0.0" Y="0.0" TargetSpace="stolpe_med_fot" />
			</SnapPoints>
		</DockPointDefinitions>
		
		<SymbolDefinition DefaultBlockName="NO-BN-2D-JBTRC_INNSETTINGSPUNKT-Schematic" />
	</ObjectType>



<!--========================================================================================================
	SIGNAL
	POLES FOR ACTUATORS AND SMALL SIGNALS
	JBTSA_FUN Stolpe med fot
	UNP80 stolper for S-lås, lokalstiller og overdragstrafo på UNP80 medf L-jern fot (med ulike feste plater).
	Ø76 rørmast med L-jern fot for togsporsignal, dvergsignal (2000), dvergsignal+togsporsignal (3000)og kryssvekselsignal (1600)
	Ø127 rørmast for (hvilke?) lyssignaler og for frittstående signalskap og bokser.
	For selve S-låsen, se over
=========================================================================================================-->
	<ObjectType DataType="tOrientedElement" Class="RailwayPlacedObject" Name="JBTSA_FUN Stolpe med fot"
				Layer="JBTSA_FUN" Color="ByLayer"
				Group="Signal/Stolpe med fot"
				AttMirrorY="{% if RightSided %}true{% else %}false{% endif %}"
				>
				
		<RelationSpace>stolpe_med_fot</RelationSpace>
		<AttachmentCategory Name="stolpe_med_fot" PassAttachmentToTarget="true" />
		
		<!-- <xpp:expand select="NOBN_xxx_DEPRECATED_MACRO___TO_BE_REMOVED" /> -->
		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___ANGULAROFFSET_VAR" />
		<xpp:expand select="NOBN_com_STD_TEXATTRIBUTES___VERTICAL_AND_FAR___SIG" />
		<xpp:expand select="NOBN_com_DISCIPLINE___SIG" />
		<xpp:expand select="NOBN_com_CHK_NUMBER_OF_OCP_AREAS" />
		<xpp:expand select="RC_com_SET_OCP_STATION_REFERENCE" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___WAYSIDE_GENERAL_OBJECT" />

		<!-- Earthing = None, since the object that the pole is supporting shall be the one to appear as earthed in the earthing drawings / tables. -->
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___EARTHED_TO_NONE" /> 

		
		
		<xpp:expand select="NOBN_com_PSET_TITTELFELT" />
		<xpp:expand select="NOBN_com_PSET_FDV_BANEDATA" />
		<xpp:expand select="NOBN_com_PSET_HOV_ID" />
		<LuaExpression Name="IsyPostnotat" ><Formula>name</Formula></LuaExpression> 

		<SetValue Key="SupplierName" Value="Bane NOR" />
		<SetValue Key="SupplierArchive" Value="SIGNAL" />

		<Variants>
			<Variant Name="Stolpe for enkel S-lås" >
				<SetValue Key="name" Value="Stolpe, S-lås" />
				<SetValue Key="Model3DName" Value="NO-BN-3D-SA-FUN-NSI63-STOLPE-UNP80-MED-LJERN-FOR-ENKEL-SAMLELÅS" />
			</Variant>
			<Variant Name="Stolpe for dobbel S-lås" >
				<SetValue Key="name" Value="Stolpe, S-lås x2" />
				<SetValue Key="Model3DName" Value="NO-BN-3D-SA-FUN-NSI63-STOLPE-UNP80-MED-LJERN-FOR-DOBBEL-SAMLELÅS" />
			</Variant>
			<Variant Name="Stolpe for lokalstiller" >
				<SetValue Key="name" Value="Stolpe, Lok." />
				<SetValue Key="Model3DName" Value="NO-BN-3D-SA-FUN-NSI63-STOLPE-UNP80-MED-LJERN-FOR-LOKALSTILLER" />
			</Variant>								
			<Variant Name="Stolpe for overdragstrafo" >
				<SetValue Key="name" Value="Stolpe, Lok." />
				<SetValue Key="Model3DName" Value="NO-BN-3D-SA-FUN-NSI63-STOLPE-UNP80-MED-LJERN-FOR-OVERDRAGSTRAFO" />
			</Variant>								

			<!-- Ø76 rørmaster S.002347 med L-jern S.005382 -->
			<Variant Name="Rørmast Ø76 for togsporsignal og dvergsignal, 2m" >
				<SetValue Key="name" Value="Stolpe Ø76, 2m" />
				<SetValue Key="Model3DName" Value="NO-BN-3D-SA-FUN-NSI63-RØRMAST-Ø76-MED-LJERN-FOR-TSS-OG-DS-2000" />
				<SetValue Key="SupplierModelName" Value="Rørmast for dverg- og togsporsignal, normal høyde med L-jern S.005382/S.030065" />
				<SetValue Key="SupplierPartName" Value="Pos.2,3,4" />
				<SetValue Key="SupplierDrawingNumber" Value="S.022896-014" />
				<SetValue Key="SupplierDrawingTitle" Value="Sikringsanlegg, utvendig; Togsporsignal, sammenstilling" />
			</Variant>
			<Variant Name="Rørmast Ø76 for togsporsignal og dvergsignal, 3m" >
				<SetValue Key="name" Value="Stolpe Ø76, 3m" />
				<SetValue Key="Model3DName" Value="NO-BN-3D-SA-FUN-NSI63-RØRMAST-Ø76-MED-LJERN-FOT-FOR-HØYT-TSS-OG-DS-3000" /> 
				<SetValue Key="SupplierModelName" Value="Rørmast for dverg- og togsporsignal, høy med L-jern S.005382/S.030065" />
				<SetValue Key="SupplierPartName" Value="Pos.2,3,4" />
				<SetValue Key="SupplierDrawingNumber" Value="S.022896-014" />
				<SetValue Key="SupplierDrawingTitle" Value="Sikringsanlegg, utvendig; Togsporsignal, sammenstilling" />
			</Variant>	
			<Variant Name="Rørmast Ø76 for kryssvekselsignal, 1.6m" >
				<SetValue Key="name" Value="Stolpe Ø76, 1.6m" />
				<SetValue Key="Model3DName" Value="NO-BN-3D-SA-FUN-NSI63-RØRMAST-Ø76-MED-LJERN-FOT-FOR-KRYSSVEKSELSIGNAL-1600" /> 
				<SetValue Key="SupplierModelName" Value="Rørmast for kryssvekselsignal, med L-jern S.005382/S.030065" />
				<SetValue Key="SupplierPartName" Value="Pos.4,5,6" />
				<SetValue Key="SupplierDrawingNumber" Value="S.004463-000" />
				<SetValue Key="SupplierDrawingTitle" Value="Sikringsanlegg, utvendig; Kryssvekselsignal; Sammenstilling" />
			</Variant>
			<!-- Ø127 rørmast S.013354 med L-jern S.005382 -->
			<Variant Name="Rørmast Ø127 for jernbanesignal, 3.2m" >
				<SetValue Key="name" Value="Rørmast Ø127, 3.2m" />
				<SetValue Key="Model3DName" Value="NO-BN-3D-SA-FUN-NSI63-RØRMAST-Ø76-MED-LJERN-FOT-FOR-SIGNAL-3200" />
				<SetValue Key="SupplierModelName" Value="Rørmast for jernbanesignal, lav med L-jern S.005382/S.030065" />
				<SetValue Key="SupplierPartName" Value="" />
				<SetValue Key="SupplierDrawingNumber" Value="S.013354-000" />
				<SetValue Key="SupplierDrawingTitle" Value="Sikringsanlegg, utvendig; Rørmast for jernbanesignal; Lavt, uten fundament; F.nr.708.215.540" />
			</Variant>
		</Variants>

		<InsertPointObject VariantName="Stolpe for enkel S-lås"
				DisplayBlockName="NO-BN-2D-JBTSA_FUN-STOLPE-MED-LJERN-FOR-ENKEL-SAMLELAAS-{{SymbolMode}}"
                DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="4.0" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="false" RotateIfRightSideOfAlignment="true" />
			<SetValue Key="dir" Value="both" />
		</InsertPointObject>
		
		<InsertPointObject VariantName="Stolpe for dobbel S-lås"
				DisplayBlockName="NO-BN-2D-JBTSA_FUN-STOLPE-MED-LJERN-FOR-DOBBEL-SAMLELAAS-{{SymbolMode}}"
                DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="4.0" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="false" RotateIfRightSideOfAlignment="true" />
			<SetValue Key="dir" Value="both" />
		</InsertPointObject>
		
		<InsertPointObject VariantName="Stolpe for lokalstiller"
				DisplayBlockName="NO-BN-2D-JBTSA_FUN-STOLPE-MED-LJERN-FOR-LOKALSTILLER-{{SymbolMode}}"
                DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="2.5" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="false" RotateIfRightSideOfAlignment="true" />
			<SetValue Key="dir" Value="both" />
		</InsertPointObject>

		<InsertPointObject VariantName="Stolpe for overdragstrafo"
				DisplayBlockName="NO-BN-2D-JBTSA_FUN-STOLPE-MED-LJERN-FOR-OVERDRAGSTRAFO-{{SymbolMode}}"
                DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="2.5" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="false" RotateIfRightSideOfAlignment="true" />
			<SetValue Key="dir" Value="both" />
		</InsertPointObject>

		<InsertPointObject VariantName="Rørmast Ø76 for togsporsignal og dvergsignal, 2m"
				DisplayBlockName="NO-BN-2D-JBTSA_FUN-RØRMAST-76-MED-LJERN-FOR-DS-OG-TSS-2000-{{SymbolMode}}"
                DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="3.5" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="-90" EnableDirectionSetting="true" />
			<SetValue Key="dir" Value="both" />
		</InsertPointObject>
		
		<InsertPointObject VariantName="Rørmast Ø76 for togsporsignal og dvergsignal, 3m"
				DisplayBlockName="NO-BN-2D-JBTSA_FUN-RØRMAST-76-MED-LJERN-FOR-HOEY-DS-OG-TSS-3000-{{SymbolMode}}"
                DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="3.5" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="-90" EnableDirectionSetting="true" />
			<SetValue Key="dir" Value="both" />
		</InsertPointObject>

		<InsertPointObject VariantName="Rørmast Ø76 for kryssvekselsignal, 1.6m"
				DisplayBlockName="NO-BN-2D-JBTSA_FUN-RØRMAST-76-MED-LJERN-FOR-KRYSSVEKSELSIGNAL-1600-{{SymbolMode}}"
                DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="3.5" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="-90" EnableDirectionSetting="true" />
			<SetValue Key="dir" Value="both" />
		</InsertPointObject>
		
		<InsertPointObject VariantName="Rørmast Ø127 for jernbanesignal, 3.2m"
				DisplayBlockName="NO-BN-2D-JBTSA_FUN-RØRMAST-127-MED-LJERN-FOR-SIGNAL-3200-{{SymbolMode}}"
                DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="3.5" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="-90" EnableDirectionSetting="true" />
			<SetValue Key="dir" Value="both" />
		</InsertPointObject>
		
		<SymbolDefinition DefaultBlockName="NO-BN-2D-JBTSA_FUN-RØRMAST-127-MED-LJERN-FOR-SIGNAL-3200-{{SymbolMode}}" AllowSymbolMove="true" >
			<Rotation Add180DegreesIfDirIsDown="false" AddAngle="{% if dir == 'up' %}{{270.0|plus:AngularOffset}}
														{% elsif dir == 'down' %}{{90.0|plus:AngularOffset}}
														{% elsif dir == 'both' and RightSided %}{{180.0|plus:AngularOffset}}
														{% elsif dir == 'both' and LeftSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and RightSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and LeftSided %}{{180.0|plus:AngularOffset}}
														{% else %}45.0
														{% endif %}" />	
			<BlockNameFormat JoinBy="-" >
				NO-BN-2D-JBTSA_FUN
				{% if Variant == 'Stolpe for enkel S-lås' %}STOLPE-MED-LJERN-FOR-ENKEL-SAMLELAAS
				{% elsif Variant == 'Stolpe for dobbel S-lås' %}STOLPE-MED-LJERN-FOR-DOBBEL-SAMLELAAS
				{% elsif Variant == 'Stolpe for lokalstiller' %}STOLPE-MED-LJERN-FOR-LOKALSTILLER
				{% elsif Variant == 'Stolpe for overdragstrafo' %}STOLPE-MED-LJERN-FOR-OVERDRAGSTRAFO
				{% elsif Variant == 'Rørmast Ø76 for togsporsignal og dvergsignal, 2m' %}RØRMAST-76-MED-LJERN-FOR-DS-OG-TSS-2000
				{% elsif Variant == 'Rørmast Ø76 for togsporsignal og dvergsignal, 3m' %}RØRMAST-76-MED-LJERN-FOR-HOEY-DS-OG-TSS-3000
				{% elsif Variant == 'Rørmast Ø76 for kryssvekselsignal, 1.6m' %}RØRMAST-76-MED-LJERN-FOR-KRYSSVEKSELSIGNAL-1600
				{% elsif Variant == 'Rørmast Ø127 for jernbanesignal, 3.2m' %}RØRMAST-127-MED-LJERN-FOR-SIGNAL-3200
				{% else %}BAD_Variant
				{% endif %}
				{{SymbolMode}}
			</BlockNameFormat>
		</SymbolDefinition>
		
		<SymbolDefinition DefaultBlockName="NO-BN-2D-JBTRC_INNSETTINGSPUNKT-Schematic" />

		<DockPointDefinitions>
			<SnapPoints>
				<!-- TODO Hmmm det er så mange ulike objekttyper å tilby snapping for at vi lar det stå åpent for alle inntil videre -->
				<SnapPoint X="0" Y="0" />
			</SnapPoints>
		</DockPointDefinitions>
	</ObjectType>



<!--========================================================================================================
	SIGNAL
	DIVERSE
	JBTSA_AVI Avsporingsindikator
=========================================================================================================-->
	<ObjectType DataType="tOrientedElement" Class="RailwayPlacedObject" Name="JBTSA_AVI Avsporingsindikator"
				Layer="JBTSA_AVI" Color="ByLayer"
				Group="Signal/Diverse"
				AttMirrorY="{% if RightSided %}true{% else %}false{% endif %}"
				>
				
		<RelationSpace>avsporingsindikator</RelationSpace>

		<!-- <xpp:expand select="NOBN_xxx_DEPRECATED_MACRO___TO_BE_REMOVED" /> -->
		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___ANGULAROFFSET_VAR" />
		<xpp:expand select="NOBN_com_STD_TEXATTRIBUTES___VERTICAL_AND_FAR___SIG" />
		<xpp:expand select="NOBN_com_DISCIPLINE___SIG" />
		<xpp:expand select="NOBN_com_CHK_NUMBER_OF_OCP_AREAS" />
		<xpp:expand select="RC_com_SET_OCP_STATION_REFERENCE" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___TRACKBOUND_OBJECT" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___EARTHED_TO_NONE" />

		
		
		<xpp:expand select="NOBN_com_PSET_TITTELFELT" />
		<xpp:expand select="NOBN_com_PSET_FDV_BANEDATA" />
		<xpp:expand select="NOBN_com_PSET_FDV_BANEDATA_SA_AVI" />
		<xpp:expand select="NOBN_com_PSET_HOV_ID" />

		<LuaExpression Name="IsyPostnotat" ><Formula>name</Formula></LuaExpression> 

		<LuaExpression Name="DistanceToAlignment" ><Formula>NOBN_trk_getDistanceToAlignmentFromCantAndTrackPlaneDistance(RightSided and 4e-4 or -4e-4)</Formula></LuaExpression>
		
		<Variants>
			<Variant Name="Avsporingsindikator" >
				<SetValue Key="name" Value="Ai." />
				<SetValue Key="Model3DName" Value="NO-BN-3D-SA-AVI-AVSPORINGSINDIKATOR" />
			</Variant>
		</Variants>	
		
		<InsertPointObject VariantName="Avsporingsindikator" DisplayBlockName="NO-BN-2D-JBTSA_AVI-AVSPORINGSINDIKATOR-{{SymbolMode}}"
                DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="0" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="true" />
		</InsertPointObject>

		<SymbolDefinition DefaultBlockName="NO-BN-2D-JBTSA_AVI-AVSPORINGSINDIKATOR-{{SymbolMode}}" AllowSymbolMove="true" >
			<Rotation Add180DegreesIfDirIsDown="true" />	
		</SymbolDefinition>

		<SymbolDefinition DefaultBlockName="NO-BN-2D-JBTRC_INNSETTINGSPUNKT-Schematic" />
	</ObjectType>



<!--========================================================================================================
	SIGNAL
	SPORSPERRER
	JBTSA_SSP Sporsperre
	NB! SSP er et SA Signalobjekt! Ref epost Bjarne Green til CLFEY, 2016-12-15
	TODO 2018-07-06: Uvisst hvor avsporingstunger skal høre hjemme, vi legger dem inntil videre også på SA-SSP.
=========================================================================================================-->
	<!--SPORSPERRE-->
	<!--TODO modellere enkel og dobbel avsporingstunge-->
	<!--TODO Modellere normalstilling AVLAGT eller PÅLAGT, med tilhørende 2D-symbolfor avlagt stilling (ingen pil, men må vise likevel)-->
	<ObjectType DataType="tDerailer" Class="RailwayPlacedObject" Name="JBTSA_SSP Sporsperre"
				Layer="JBTSA_SSP" Color="ByLayer"
				Group="Signal/Sporsperrer"
				>
				
		<ObjectTypeAttribute 
			Key="quadrant" 
			Value="{% if dir == 'up' and LeftSided == 'True' %}1{% elsif dir == 'down' and LeftSided == 'True' %}2{% elsif dir == 'down' and RightSided == 'True' %}3{% elsif dir== 'up' and RightSided == 'True' %}4{% endif %}"
		 />

		<RelationSpace>sporsperre</RelationSpace>

		<!-- <xpp:expand select="NOBN_xxx_DEPRECATED_MACRO___TO_BE_REMOVED" /> -->
		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___ANGULAROFFSET_VAR" />
		<xpp:expand select="NOBN_com_STD_TEXTATTRIBUTES___HORIZONTAL_AND_CLOSE___SIG" />
		<xpp:expand select="NOBN_com_DISCIPLINE___SIG" />
		<xpp:expand select="NOBN_com_CHK_NUMBER_OF_OCP_AREAS" />
		<xpp:expand select="RC_com_SET_OCP_STATION_REFERENCE" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___TRACKBOUND_OBJECT" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___EARTHED_TO_NONE" />

		
		
		<xpp:expand select="NOBN_com_PSET_TITTELFELT" />
		<xpp:expand select="NOBN_com_PSET_FDV_BANEDATA" />
		<xpp:expand select="NOBN_com_PSET_FDV_BANEDATA_SA_SSP" />
		<xpp:expand select="NOBN_com_PSET_HOV_ID" />
		
		<LuaExpression Name="IsyPostnotat"><Formula>name</Formula></LuaExpression> 


		<LuaExpression Name="name" ><Formula>return "Sp."..code</Formula></LuaExpression>

		<LuaExpression Name="DistanceToAlignment" ><Formula>_JBTSA_SSP_DistanceToAlignment()</Formula></LuaExpression>
		<LuaFunction Name="_JBTSA_SSP_DistanceToAlignment()" ReturnType="Double"
			Description="Returns the XY plane distance to alignment for a derailer or catch points (cant taken into consideration)." >
			<Constructor>Double _JBTSA_SSP_DistanceToAlignment()</Constructor>
			<Formula>
				function _JBTSA_SSP_DistanceToAlignment()
					return NOBN_trk_getDistanceToAlignmentFromCantAndTrackPlaneDistance(RightSided and 0.75 or -0.75)
				end
			</Formula>
		</LuaFunction>

		<CustomAttribute DataType="Enumeration" Name="DerailerState" DisplayName="SporsperreStilling" DefaultValue="derailing" 
			Description="The 'DerailingState' custom attribute [open | closed] reflects the activation state of the derailer." >
			<Values>
				<Value DisplayName="Inaktiv" >passive</Value>
				<Value DisplayName="Avsporende" >derailing</Value>
			</Values>
		</CustomAttribute>

		<LuaExpression Name="derailSide" ><Formula>_JBTSA_SSP_derailSide()</Formula></LuaExpression>
		<LuaFunction Name="_JBTSA_SSP_derailSide()" 
			ReturnType="String"
			Description="Returns the derail side ('Avsporingsretning') for a derailer, deduced from its dir and mounting side (left/right rail)." >
			<Constructor>String _JBTSA_SSP_derailSide()</Constructor>
			<Formula>
				function _JBTSA_SSP_derailSide()
					return ((dir == 'up' and LeftSided) or (dir == 'down' and RightSided)) and "left" or "right"
				end
			</Formula>
		</LuaFunction>

		<LuaExpression Name="Model3DName" ><Formula>_JBTSA_SSP_Model3DName()</Formula></LuaExpression>
		<LuaFunction Name="_JBTSA_SSP_Model3DName()" 
			ReturnType="String"
			Description="Returns the 3D model name for a derailer object (we have no catch points in 3D yet)." >
			<Constructor>String _JBTSA_SSP_Model3DName()</Constructor>
			<Formula>
				function _JBTSA_SSP_Model3DName()
					--Ignore the DerailerState property - always draw the derailer in its derailing state.
					local t = "NO-BN-3D-SA-SSP-SPORSPERRE"
					if Variant:lower():match("enkel") then t = t.."-ENKEL" 
					elseif Variant:lower():match("dobbel") then t = t.."-DOBBEL" 
					else t = t.."-BAD_Variant"
					end
					if derailSide == 'left' then t = t.."-VSIDE"
					elseif derailSide == 'right' then t = t.."-VSIDE"
					else t = t.."-BAD_derailSide"
					end
					return t
				end
			</Formula>
		</LuaFunction>

		<Variants DefaultValue="Enkel sporsperre" >
			<Variant Name="Enkel sporsperre" Description="Single-sided derailer" >
				<SetValue Key="kind" Value="blockDerail" />
			</Variant>
			<Variant Name="Dobbel sporsperre" Description="Double-sided derailer" >
				<SetValue Key="kind" Value="blockDerail" />
			</Variant>
			<Variant Name="Enkel avsporingstunge" Description="Single catch points" >
				<SetValue Key="kind" Value="singleCatchPoints" />
			</Variant>
			<Variant Name="Dobbel avsporingstunge" Description="Double catch points" >
				<SetValue Key="kind" Value="doubleCatchPoints" />
			</Variant>
		</Variants>
		
		<InsertPointObject VariantName="Enkel sporsperre" DisplayBlockName="NO-BN-2D-JBTSA_SSP-SPORSPERRE-ENKEL-AVSPORENDE-1-{{SymbolMode}}" 
                DefaultSnapMode="Alignment" SnapToAlignment="true" SnapDistance="0.75" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance EnableDirectionSetting="true" MirrorAboutJigYAxisIfRightSideOfAlignment="true" />
			<!-- <SetValue Key="derailSide" Value="{{insertionSide}}" /> -->
		</InsertPointObject>
		
		<InsertPointObject VariantName="Dobbel sporsperre" DisplayBlockName="NO-BN-2D-JBTSA_SSP-SPORSPERRE-DOBBEL-AVSPORENDE-1-{{SymbolMode}}" 
                DefaultSnapMode="Alignment" SnapToAlignment="true" SnapDistance="0.75" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance EnableDirectionSetting="true" MirrorAboutJigYAxisIfRightSideOfAlignment="true" />
			<!-- <SetValue Key="derailSide" Value="{{insertionSide}}" /> -->
		</InsertPointObject>
		
		<!-- TODO Mangler 2D-symbol for avsporingstunger enkel og dobbel (EAT, DAT) -->
		<InsertPointObject VariantName="Enkel avsporingstunge" DisplayBlockName="NO-BN-2D-JBTSA_SSP-AVSPORINGSTUNGE-ENKEL-AVSPORENDE-1-{{SymbolMode}}" 
                DefaultSnapMode="Alignment" SnapToAlignment="true" SnapDistance="0.75" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance EnableDirectionSetting="true" MirrorAboutJigYAxisIfRightSideOfAlignment="true" />
			<!-- <SetValue Key="derailSide" Value="{{insertionSide}}" /> -->
		</InsertPointObject>
		
		<InsertPointObject VariantName="Dobbel avsporingstunge" DisplayBlockName="NO-BN-2D-JBTSA_SSP-AVSPORINGSTUNGE-DOBBEL-INAKTIV-1-{{SymbolMode}}"
                DefaultSnapMode="Alignment" SnapToAlignment="true" SnapDistance="0.75" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance EnableDirectionSetting="true" MirrorAboutJigYAxisIfRightSideOfAlignment="true" />
			<!-- <SetValue Key="derailSide" Value="{{insertionSide}}" /> -->
		</InsertPointObject>

		<SymbolDefinition DefaultBlockName="NO-BN-2D-JBTRC_THUMBNAIL-USPESIFISERT-Schematic" AllowSymbolMove="true" >
			<Rotation Add180DegreesIfDirIsDown="false" AddAngle="0" />
			<BlockNameFormat JoinBy="-" >
			NO-BN-2D-JBTSA_SSP
			{% if Variant == 'Enkel sporsperre' %}SPORSPERRE-ENKEL
			{% elsif Variant == 'Dobbel sporsperre' %}SPORSPERRE-DOBBEL
			{% elsif Variant == 'Enkel avsporingstunge' %}AVSPORINGSTUNGE-ENKEL
			{% elsif Variant == 'Dobbel avsporingstunge' %}AVSPORINGSTUNGE-DOBBEL
			{% else %}BAD_Variant
			{% endif %}
			{% if DerailerState == 'passive' %}PASSIV{% else %}AVSPORENDE{% endif %}
			{{quadrant}}
			{{SymbolMode}}
			</BlockNameFormat>
		</SymbolDefinition>

		<SymbolDefinition DefaultBlockName="NO-BN-2D-JBTRC_INNSETTINGSPUNKT-Schematic" />

		<DockPointDefinitions>
			<!-- Note: We account for the derailer being inserted at 0.75 from its track: -->
			<SnapPoints MirrorAboutAlignmentNormal="{% if dir == 'down' %}true{% else %}false{% endif %}"
						MirrorAboutAlignmentTangent="{% if RightSided %}true{% else %}false{% endif %}" >
				<SnapPoint X="-1.0" Y="1.0" TargetSpace="lokalstiller" />
				<SnapPoint X="-1.0" Y="-2.5" TargetSpace="lokalstiller" />
			</SnapPoints>
			<SnapPoints MirrorAboutAlignmentTangent="{% if RightSided %}true{% else %}false{% endif %}" >
				<SnapPoint X="0.0" Y="1.0" TargetSpace="sporsperredrivmaskin" />
				<SnapPoint X="0.0" Y="-2.5" TargetSpace="sporsperredrivmaskin" />
			</SnapPoints>
		</DockPointDefinitions>
		
	</ObjectType>



<!--========================================================================================================
	SIGNALING
	CABINET
=========================================================================================================-->
	<!-- Innvendig og utvendig sikringsanlegg (ikke bokser) -->
	<ObjectType DataType="tOrientedElement" Class="RailwayPlacedObject" Name="JBTSA_APS Apparatskap"
				Layer="JBTSA_APS" Color="ByLayer"
				Group="Signal/Apparatskap"
				AttMirrorY="{% if RightSided %}true{% else %}false{% endif %}"
				>

		<!-- TODO (2018-11-06) The Insert Jig code handles only 2 directions. After inserting the symbol the first time, -->
		<!-- the default direction is defined using the SetValue element in the InsertPointObject element. -->
		<!-- After insertion, the SymbolDefinition code translates strict directions (up, down) or lax directions  -->
		<!-- (up, down, none, both, unknown) into rotations, using DotLiquid code. -->
		<RelationSpace>apparatskap</RelationSpace>

		<AttachmentCategory Name="signalskap" />
		<AttachTo Category="apparatskapfundament" />
		
		<!-- <xpp:expand select="NOBN_xxx_DEPRECATED_MACRO___TO_BE_REMOVED" /> -->
		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___ANGULAROFFSET_VAR" />
		<xpp:expand select="NOBN_com_STD_TEXATTRIBUTES___VERTICAL_AND_FAR___SIG" />
		<xpp:expand select="NOBN_com_DISCIPLINE___SIG" />
		<xpp:expand select="NOBN_com_CHK_NUMBER_OF_OCP_AREAS" />
		<xpp:expand select="RC_com_SET_OCP_STATION_REFERENCE" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___WAYSIDE_GENERAL_OBJECT" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___EARTHED_TO_RAIL" />

		
		
		<xpp:expand select="NOBN_com_PSET_TITTELFELT" />
		<xpp:expand select="NOBN_com_PSET_FDV_BANEDATA" />
		<xpp:expand select="NOBN_com_PSET_FDV_BANEDATA_SA_APS" />
		<xpp:expand select="NOBN_com_PSET_HOV_ID" />

		<LuaExpression Name="IsyPostnotat"><Formula>name</Formula></LuaExpression> 


		<Variants>
			<Variant Name="Stort apparatskap, venstrehengslet" >
				<SetValue Key="Model3DName" Value="NO-BN-3D-FE-DIV-UKJENT" />
			</Variant>
			<Variant Name="Stort apparatskap, høyrehengslet" >
				<SetValue Key="Model3DName" Value="NO-BN-3D-FE-DIV-UKJENT" />
			</Variant>
			<Variant Name="Stort apparatskap, dobbeldør" >
				<SetValue Key="Model3DName" Value="NO-BN-3D-SA-APS-APPARATSKAP-STORT-1200x1200x400-MED-SOKKEL" />
			</Variant>
		</Variants>
	
		<LuaExpression Name="dir" ><Formula>"both"</Formula></LuaExpression>
		<LuaExpression Name="name" ><Formula>NOBN_sig_getCabinetName()</Formula></LuaExpression>

		<LuaExpression Name="Offset3D.Z" ><Formula>if Variant:find("stort") ~= 0 then return -0.1 else return 0.95 end</Formula></LuaExpression>

		<InsertPointObject VariantName="Stort apparatskap, venstrehengslet" DisplayBlockName="NO-BN-2D-JBTSA_APS-APPARATSKAP-STORT-VHENGSLET-{{SymbolMode}}" 
				DefaultSnapMode="Alignment" SnapToAlignment="true" SnapDistance="3.5" AskForAttachment="true" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance RotateIfRightSideOfAlignment="true" AddAngle="0" EnableDirectionSetting="false" />
		</InsertPointObject>
		
		<InsertPointObject VariantName="Stort apparatskap, høyrehengslet" DisplayBlockName="NO-BN-2D-JBTSA_APS-APPARATSKAP-STORT-HHENGSLET-{{SymbolMode}}" 
				DefaultSnapMode="Alignment" SnapToAlignment="true" SnapDistance="3.5" AskForAttachment="true" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance RotateIfRightSideOfAlignment="true" AddAngle="0" EnableDirectionSetting="false" />
		</InsertPointObject>
		
		<InsertPointObject VariantName="Stort apparatskap, dobbeldør" DisplayBlockName="NO-BN-2D-JBTSA_APS-APPARATSKAP-STORT-DOBBEL-{{SymbolMode}}" 
				DefaultSnapMode="Alignment" SnapToAlignment="true" SnapDistance="3.5" AskForAttachment="true" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance RotateIfRightSideOfAlignment="true" AddAngle="0" EnableDirectionSetting="false" />
		</InsertPointObject>

		<SymbolDefinition DefaultBlockName="NO-BN-2D-JBTSA_APS-APPARATSKAP-STORT-VHENGSLET-{{SymbolMode}}" AllowSymbolMove="true" >
			<Rotation Add180DegreesIfDirIsDown="false" AddAngle="{% if dir == 'up' %}{{270.0|plus:AngularOffset}}
														{% elsif dir == 'down' %}{{90.0|plus:AngularOffset}}
														{% elsif dir == 'both' and RightSided %}{{180.0|plus:AngularOffset}}
														{% elsif dir == 'both' and LeftSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and RightSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and LeftSided %}{{180.0|plus:AngularOffset}}
														{% else %}45.0
														{% endif %}" />	
			<BlockNameFormat JoinBy="-" >
				NO-BN-2D-JBTSA_APS-APPARATSKAP
				{% if Variant == 'Stort apparatskap, venstrehengslet' %}STORT-VHENGSLET
				{% elsif Variant == 'Stort apparatskap, høyrehengslet' %}STORT-HHENGSLET
				{% elsif Variant == 'Stort apparatskap, dobbeldør' %}STORT-DOBBEL
				{% else %}BAD_Variant
				{% endif %}
				{{SymbolMode}}
			</BlockNameFormat>
		</SymbolDefinition>

		<Model3DDefinition>
			<Attribute Tag="T01" >
				<Value>{{Name}}</Value>
			</Attribute>
		</Model3DDefinition>

		<SymbolDefinition DefaultBlockName="NO-BN-2D-JBTRC_INNSETTINGSPUNKT-Schematic" />
	
		<DockPointDefinitions>
			<SnapPoints>
				<SnapPoint X="0" Y="0" TargetSpace="apparatskapfundament" />
			</SnapPoints>
		</DockPointDefinitions>
	</ObjectType>

	

<!--========================================================================================================
	SIGNALING
	DISTRIBUTION CABINETS AND BOXES
=========================================================================================================-->
	<!-- Innvendig og utvendig sikringsanlegg (nøkkelskap, sveivskap, bokser på vegg eller stolpe) -->
	<ObjectType DataType="tOrientedElement" Class="RailwayPlacedObject" Name="JBTSA_APS Lite skap og boks"
				Layer="JBTSA_APS" Color="ByLayer"
				Group="Signal/Skap og bokser"
				AttMirrorY="{% if RightSided %}true{% else %}false{% endif %}"
				>

		<RelationSpace>kabelboks</RelationSpace>

		<AttachmentCategory Name="kabelboks" />
		<AttachTo Category="signalfundament" />
		
		<!-- <xpp:expand select="NOBN_xxx_DEPRECATED_MACRO___TO_BE_REMOVED" /> -->
		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___ANGULAROFFSET_VAR" />
		<xpp:expand select="NOBN_com_STD_TEXATTRIBUTES___VERTICAL_AND_FAR___SIG" />
		<xpp:expand select="NOBN_com_DISCIPLINE___SIG" />
		<xpp:expand select="NOBN_com_CHK_NUMBER_OF_OCP_AREAS" />
		<xpp:expand select="RC_com_SET_OCP_STATION_REFERENCE" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___WAYSIDE_GENERAL_OBJECT" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___EARTHED_TO_RAIL" />

		
		
		<xpp:expand select="NOBN_com_PSET_TITTELFELT" />
		<xpp:expand select="NOBN_com_PSET_FDV_BANEDATA" />
		<xpp:expand select="NOBN_com_PSET_FDV_BANEDATA_SA_APS" />
		<xpp:expand select="NOBN_com_PSET_HOV_ID" />

		<LuaExpression Name="IsyPostnotat"><Formula>name</Formula></LuaExpression> 


		<LuaExpression Name="Offset3D.Z" ><Formula>(Variant:lower():find("nøkkelskap") or Variant:lower():find("sveivskap")) and 1.50 or 1.20</Formula></LuaExpression>
		<LuaExpression Name="PoleRouting3D" ><Formula>"Vertical"</Formula></LuaExpression>
		<LuaExpression Name="dir" ><Formula>"both"</Formula></LuaExpression>
		<LuaExpression Name="name" ><Formula>NOBN_sig_getCabinetName()</Formula></LuaExpression>

		<!-- NB already declared in macro -->
		<LuaExpression Name="Tag" >
			<Formula>
				if Variant:lower():match("nøkkel") then return "SA-NØK-nnnnnn"
				else if Variant:lower():match("sveiv") then return "SA-SVB-nnnnnn"
				else if Variant:lower():match("apparat") then return "SA-APS-nnnnnn"
				else if Variant:lower():match("boks") then return "SA-APS-nnnnnn"
				else return "UNFINISHED - Unrecognized variant ["..Variant.."] - cannot deduce Tag - ."
				end
			</Formula>
		</LuaExpression>

		<Variants>
			<Variant Name="Nøkkelskap, venstrehengslet" >
				<SetValue Key="Model3DName" Value="NO-BN-3D-SA-NØK-NØKKELSKAP-250x350x230-Ø76" />
			</Variant>
			<Variant Name="Nøkkelskap, høyrehengslet" >
				<SetValue Key="Model3DName" Value="NO-BN-3D-SA-NØK-NØKKELSKAP-250x350x230-Ø76" />
			</Variant>
			<Variant Name="Sveivskap, venstrehengslet" >
				<SetValue Key="Model3DName" Value="NO-BN-3D-SA-SVB-SVEIVSKAP-500x760x320-Ø76" />
			</Variant>
			<Variant Name="Sveivskap, høyrehengslet" >
				<SetValue Key="Model3DName" Value="NO-BN-3D-SA-SVB-SVEIVSKAP-500x760x320-Ø76" />
			</Variant>
			<Variant Name="Lite apparatskap, venstrehengslet" >
				<SetValue Key="Model3DName" Value="NO-BN-3D-FE-DIV-UKJENT" />
			</Variant>
			<Variant Name="Lite apparatskap, høyrehengslet" >
				<SetValue Key="Model3DName" Value="NO-BN-3D-FE-DIV-UKJENT" />
			</Variant>
			<Variant Name="Kabelboks 280x190x100 på Ø76 rørmast, venstrehengslet" >
				<SetValue Key="Model3DName" Value="NO-BN-3D-SA-SIG-NSI63-KABELBOKS-190x280x100-Ø76" />
			</Variant>
			<Variant Name="Kabelboks 280x190x100 på Ø76 rørmast, høyrehengslet" >
				<SetValue Key="Model3DName" Value="NO-BN-3D-SA-SIG-NSI63-KABELBOKS-190x280x100-Ø76" />
			</Variant>
			<Variant Name="Kabelboks 280x190x100 på Ø127 rørmast, venstrehengslet" >
				<SetValue Key="Model3DName" Value="NO-BN-3D-SA-SIG-NSI63-KABELBOKS-190x280x100-Ø127" />
			</Variant>
			<Variant Name="Kabelboks 280x190x100 på Ø127 rørmast, høyrehengslet" >
				<SetValue Key="Model3DName" Value="NO-BN-3D-SA-SIG-NSI63-KABELBOKS-190x280x100-Ø127" />
			</Variant>
			<Variant Name="Kabelboks 280x190x165 på Ø76 rørmast, venstrehengslet" >
				<SetValue Key="Model3DName" Value="NO-BN-3D-SA-SIG-NSI63-KABELBOKS-190x280x165-Ø76" />
			</Variant>
			<Variant Name="Kabelboks 280x190x165 på Ø76 rørmast, høyrehengslet" >
				<SetValue Key="Model3DName" Value="NO-BN-3D-SA-SIG-NSI63-KABELBOKS-190x280x165-Ø76" />
			</Variant>
			<Variant Name="Kabelboks 280x190x165 på Ø127 rørmast, venstrehengslet" >
				<SetValue Key="Model3DName" Value="NO-BN-3D-SA-SIG-NSI63-KABELBOKS-190x280x165-Ø127" />
			</Variant>
			<Variant Name="Kabelboks 280x190x165 på Ø127 rørmast, høyrehengslet" >
				<SetValue Key="Model3DName" Value="NO-BN-3D-SA-SIG-NSI63-KABELBOKS-190x280x165-Ø127" />
			</Variant>
			<!--TODO: <Variant Name=Kabelboks for overdragstrafo" />-->
		</Variants>
	
		<InsertPointObject VariantName="Nøkkelskap, venstrehengslet" DisplayBlockName="NO-BN-2D-JBTSA_APS-NØKKELSKAP-VHENGSLET-{{SymbolMode}}" 
				DefaultSnapMode="Alignment" SnapToAlignment="true" SnapDistance="4.0" AskForAttachment="true" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance RotateIfRightSideOfAlignment="true" AddAngle="0" EnableDirectionSetting="false" />
		</InsertPointObject>
		
		<InsertPointObject VariantName="Nøkkelskap, høyrehengslet" DisplayBlockName="NO-BN-2D-JBTSA_APS-NØKKELSKAP-HHENGSLET-{{SymbolMode}}" 
				DefaultSnapMode="Alignment" SnapToAlignment="true" SnapDistance="4.0" AskForAttachment="true" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance RotateIfRightSideOfAlignment="true" AddAngle="0" EnableDirectionSetting="false" />
		</InsertPointObject>

		<InsertPointObject VariantName="Sveivskap, venstrehengslet" DisplayBlockName="NO-BN-2D-JBTSA_APS-SVEIVSKAP-VHENGSLET-{{SymbolMode}}"  
				DefaultSnapMode="Alignment" SnapToAlignment="true" SnapDistance="4.0" AskForAttachment="true" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance RotateIfRightSideOfAlignment="true" AddAngle="0" EnableDirectionSetting="false" />
		</InsertPointObject>
		
		<InsertPointObject VariantName="Sveivskap, høyrehengslet" DisplayBlockName="NO-BN-2D-JBTSA_APS-SVEIVSKAP-HHENGSLET-{{SymbolMode}}"  
				DefaultSnapMode="Alignment" SnapToAlignment="true" SnapDistance="4.0" AskForAttachment="true" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance RotateIfRightSideOfAlignment="true" AddAngle="0" EnableDirectionSetting="false" />
		</InsertPointObject>

		<InsertPointObject VariantName="Lite apparatskap, venstrehengslet" DisplayBlockName="NO-BN-2D-JBTSA_APS-APPARATSKAP-LITE-VHENGSLET-{{SymbolMode}}" 
				DefaultSnapMode="Alignment" SnapToAlignment="true" SnapDistance="3.5" AskForAttachment="true" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance RotateIfRightSideOfAlignment="true" AddAngle="0" EnableDirectionSetting="false" />
		</InsertPointObject>

		<InsertPointObject VariantName="Lite apparatskap, høyrehengslet" DisplayBlockName="NO-BN-2D-JBTSA_APS-APPARATSKAP-LITE-HHENGSLET-{{SymbolMode}}" 
				DefaultSnapMode="Alignment" SnapToAlignment="true" SnapDistance="3.5" AskForAttachment="true" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance RotateIfRightSideOfAlignment="true" AddAngle="0" EnableDirectionSetting="false" />
		</InsertPointObject>
		
		<InsertPointObject VariantName="Kabelboks 280x190x100 på Ø76 rørmast, venstrehengslet" DisplayBlockName="NO-BN-2D-JBTSA_APS-KABELBOKS-VHENGSLET-{{SymbolMode}}"
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="3.5" AskForAttachment="true" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance RotateIfRightSideOfAlignment="true" AddAngle="0" EnableDirectionSetting="false" />
		</InsertPointObject>
		
		<InsertPointObject VariantName="Kabelboks 280x190x100 på Ø76 rørmast, høyrehengslet" DisplayBlockName="NO-BN-2D-JBTSA_APS-KABELBOKS-HHENGSLET-{{SymbolMode}}"
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="3.5" AskForAttachment="true" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance RotateIfRightSideOfAlignment="true" AddAngle="0" EnableDirectionSetting="false" />
		</InsertPointObject>
		
		<InsertPointObject VariantName="Kabelboks 280x190x100 på Ø127 rørmast, venstrehengslet" DisplayBlockName="NO-BN-2D-JBTSA_APS-KABELBOKS-VHENGSLET-{{SymbolMode}}"
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="3.5" AskForAttachment="true" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance RotateIfRightSideOfAlignment="true" AddAngle="0" EnableDirectionSetting="false" />
		</InsertPointObject>
		
		<InsertPointObject VariantName="Kabelboks 280x190x100 på Ø127 rørmast, høyrehengslet" DisplayBlockName="NO-BN-2D-JBTSA_APS-KABELBOKS-HHENGSLET-{{SymbolMode}}"
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="3.5" AskForAttachment="true" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance RotateIfRightSideOfAlignment="true" AddAngle="0" EnableDirectionSetting="false" />
		</InsertPointObject>
		
		<InsertPointObject VariantName="Kabelboks 280x190x165 på Ø76 rørmast, venstrehengslet" DisplayBlockName="NO-BN-2D-JBTSA_APS-KABELBOKS-VHENGSLET-{{SymbolMode}}"
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="3.5" AskForAttachment="true" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance RotateIfRightSideOfAlignment="true" AddAngle="0" EnableDirectionSetting="false" />
		</InsertPointObject>
		
		<InsertPointObject VariantName="Kabelboks 280x190x165 på Ø76 rørmast, høyrehengslet" DisplayBlockName="NO-BN-2D-JBTSA_APS-KABELBOKS-HHENGSLET-{{SymbolMode}}"
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="3.5" AskForAttachment="true" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance RotateIfRightSideOfAlignment="true" AddAngle="0" EnableDirectionSetting="false" />
		</InsertPointObject>
		
		<InsertPointObject VariantName="Kabelboks 280x190x165 på Ø127 rørmast, venstrehengslet" DisplayBlockName="NO-BN-2D-JBTSA_APS-KABELBOKS-VHENGSLET-{{SymbolMode}}"
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="3.5" AskForAttachment="true" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance RotateIfRightSideOfAlignment="true" AddAngle="0" EnableDirectionSetting="false" />
		</InsertPointObject>
		
		<InsertPointObject VariantName="Kabelboks 280x190x165 på Ø127 rørmast, høyrehengslet" DisplayBlockName="NO-BN-2D-JBTSA_APS-KABELBOKS-HHENGSLET-{{SymbolMode}}"
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="3.5" AskForAttachment="true" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance RotateIfRightSideOfAlignment="true" AddAngle="0" EnableDirectionSetting="false" />
		</InsertPointObject>
		
		<SymbolDefinition DefaultBlockName="NO-BN-2D-JBTSA_APS-APPARATSKAP-STORT-VHENGSLET-{{SymbolMode}}" AllowSymbolMove="true" >
			<Rotation Add180DegreesIfDirIsDown="false" AddAngle="{% if dir == 'up' %}{{270.0|plus:AngularOffset}}
														{% elsif dir == 'down' %}{{90.0|plus:AngularOffset}}
														{% elsif dir == 'both' and RightSided %}{{180.0|plus:AngularOffset}}
														{% elsif dir == 'both' and LeftSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and RightSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and LeftSided %}{{180.0|plus:AngularOffset}}
														{% else %}45.0
														{% endif %}" />	
			<BlockNameFormat JoinBy="-">
				NO-BN-2D-JBTSA_APS
				{% if Variant == 'Nøkkelskap, venstrehengslet' %}NØKKELSKAP-VHENGSLET
				{% elsif Variant == 'Nøkkelskap, høyrehengslet' %}NØKKELSKAP-HHENGSLET
				{% elsif Variant == 'Sveivskap, venstrehengslet' %}SVEIVSKAP-VHENGSLET
				{% elsif Variant == 'Sveivskap, høyrehengslet' %}SVEIVSKAP-HHENGSLET
				{% elsif Variant == 'Lite apparatskap, venstrehengslet' %}APPARATSKAP-LITE-VHENGSLET
				{% elsif Variant == 'Lite apparatskap, høyrehengslet' %}APPARATSKAP-LITE-HHENGSLET
				{% elsif Variant == 'Kabelboks 280x190x100 på Ø76 rørmast, venstrehengslet' %}KABELBOKS-VHENGSLET
				{% elsif Variant == 'Kabelboks 280x190x100 på Ø127 rørmast, venstrehengslet' %}KABELBOKS-VHENGSLET
				{% elsif Variant == 'Kabelboks 280x190x165 på Ø76 rørmast, venstrehengslet' %}KABELBOKS-VHENGSLET
				{% elsif Variant == 'Kabelboks 280x190x165 på Ø127 rørmast, venstrehengslet' %}KABELBOKS-VHENGSLET
				{% elsif Variant == 'Kabelboks 280x190x100 på Ø76 rørmast, høyrehengslet' %}KABELBOKS-HHENGSLET
				{% elsif Variant == 'Kabelboks 280x190x100 på Ø127 rørmast, høyrehengslet' %}KABELBOKS-HHENGSLET
				{% elsif Variant == 'Kabelboks 280x190x165 på Ø76 rørmast, høyrehengslet' %}KABELBOKS-HHENGSLET
				{% elsif Variant == 'Kabelboks 280x190x165 på Ø127 rørmast, høyrehengslet' %}KABELBOKS-HHENGSLET
				{% else %}BAD_Variant
				{% endif %}
				{{SymbolMode}}
			</BlockNameFormat>
		</SymbolDefinition>

		<Model3DDefinition>
			<Attribute Tag="T01" >
				<Value>{{Name}}</Value>
			</Attribute>
		</Model3DDefinition>

		<SymbolDefinition DefaultBlockName="NO-BN-2D-JBTRC_INNSETTINGSPUNKT-Schematic" />
	
		<DockPointDefinitions>
			<SnapPoints>
				<SnapPoint X="0" Y="0" TargetSpace="signalfundament" />
			</SnapPoints>
		</DockPointDefinitions>
	</ObjectType>



<!--========================================================================================================
	SIGNALING
	TECHNICAL BUILDING
=========================================================================================================-->
	<!-- Relerom, signalkiosk, container med signalanlegg med mer. -->
	<ObjectType DataType="tOrientedElement" Class="RailwayPlacedObject" Name="JBTSA_TER Tekniske bygninger og rom"
				Layer="JBTSA_TER" Color="ByLayer"
				Group="Signal/Tekniske Bygninger"
				AttMirrorY="{% if RightSided %}true{% else %}false{% endif %}"
				>
				
		<RelationSpace>teknisk_bygg</RelationSpace>

		<!-- <xpp:expand select="NOBN_xxx_DEPRECATED_MACRO___TO_BE_REMOVED" /> -->
		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___ANGULAROFFSET_VAR" />
		<xpp:expand select="NOBN_com_STD_TEXATTRIBUTES___VERTICAL_AND_FAR___SIG" />
		<xpp:expand select="NOBN_com_DISCIPLINE___SIG" />
		<xpp:expand select="NOBN_com_CHK_NUMBER_OF_OCP_AREAS" />
		<xpp:expand select="RC_com_SET_OCP_STATION_REFERENCE" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___WAYSIDE_GENERAL_OBJECT" />

		<!-- Connect earth to "jordspyd" typically: -->
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___EARTHED_TO_OBJECT" />

		
		
		<xpp:expand select="NOBN_com_PSET_TITTELFELT" />
		<xpp:expand select="NOBN_com_PSET_FDV_BANEDATA" />
		<xpp:expand select="NOBN_com_PSET_FDV_BANEDATA_SA_TER" />
		<xpp:expand select="NOBN_com_PSET_HOV_ID" />

		<LuaExpression Name="IsyPostnotat"><Formula>name</Formula></LuaExpression> 

		<SetValue Key="name" Value="Relerom" />
		<SetValue Key="Tag" Value="SA-TER-nnnnnn" />
		<SetValue Key="Model3DName" Value="NO-BN-3D-FE-DIV-UKJENT" />

		<SetValue Key="name" Value="Relerom" />
		<Variants>
			<Variant Name="Relerom uten betjeningsplass" />
			<Variant Name="Relerom med betjeningsplass, pos 1" />
			<Variant Name="Relerom med betjeningsplass, pos 2" />
			<Variant Name="Relerom med betjeningsplass, pos 3" />
			<Variant Name="Relerom med betjeningsplass, pos 4" />
		</Variants>
		
		<InsertPointObject VariantName="Relerom uten betjeningsplass" DisplayBlockName="NO-BN-2D-JBTSA_TER-TEKNISK-BEBYGGELSE-RELEROM-0-{{SymbolMode}}" 
				DefaultSnapMode="None" SnapToAlignment="true" SnapDistance="15" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance RotateIfRightSideOfAlignment="true" />
		</InsertPointObject>

		<InsertPointObject VariantName="Relerom med betjeningsplass, pos 1" DisplayBlockName="NO-BN-2D-JBTSA_TER-TEKNISK-BEBYGGELSE-RELEROM-1-{{SymbolMode}}" 
				DefaultSnapMode="None" SnapToAlignment="true" SnapDistance="15" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance RotateIfRightSideOfAlignment="true" />
		</InsertPointObject>

		<InsertPointObject VariantName="Relerom med betjeningsplass, pos 2" DisplayBlockName="NO-BN-2D-JBTSA_TER-TEKNISK-BEBYGGELSE-RELEROM-2-{{SymbolMode}}" 
				DefaultSnapMode="None" SnapToAlignment="true" SnapDistance="15" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance RotateIfRightSideOfAlignment="true" />
		</InsertPointObject>

		<InsertPointObject VariantName="Relerom med betjeningsplass, pos 3" DisplayBlockName="NO-BN-2D-JBTSA_TER-TEKNISK-BEBYGGELSE-RELEROM-3-{{SymbolMode}}" 
				DefaultSnapMode="None" SnapToAlignment="true" SnapDistance="15" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance RotateIfRightSideOfAlignment="true" />
		</InsertPointObject>

		<InsertPointObject VariantName="Relerom med betjeningsplass, pos 4" DisplayBlockName="NO-BN-2D-JBTSA_TER-TEKNISK-BEBYGGELSE-RELEROM-4-{{SymbolMode}}" 
				DefaultSnapMode="None" SnapToAlignment="true" SnapDistance="15" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance RotateIfRightSideOfAlignment="true" />
		</InsertPointObject>

		<SymbolDefinition DefaultBlockName="" AllowSymbolMove="true" >
			<Rotation Add180DegreesIfDirIsDown="true" AddAngle="{% if RightSided %}0{% else %}180{% endif %}" />	
			<BlockNameFormat JoinBy="-" >
				NO-BN-2D-JBTSA_TER-TEKNISK-BEBYGGELSE-RELEROM
				{% if Variant contains '1' %}1
				{% elsif Variant contains '2' %}2
				{% elsif Variant contains '3' %}3
				{% elsif Variant contains '4' %}4
				{% else %}0
				{% endif %}
				{{SymbolMode}}
			</BlockNameFormat>
		</SymbolDefinition>

		<SymbolDefinition DefaultBlockName="NO-BN-2D-JBTRC_INNSETTINGSPUNKT-Schematic" />
		
	</ObjectType>

	

<!--========================================================================================================
    SIGNALING
	TRACK VACANCY DETECTION SECTION FOR AXLE COUNTER SYSTEM
=========================================================================================================-->
	<!-- TVD Section - Track vacancy detection section - Togdeteksjonsavsnitt for akseltellere = tellepunktavsnitt -->
	<!-- Dette er et fiktivt objekt, ringen med avsnitt-nummeret i. Akseltellerne søker etter dem for å tilegne seg nr. -->
	<!-- TODO: Avklare med Bane NOR om vi kan benytte SA-SPF (eller SA-TVD?) for "tellepunktavsnitt" som ny objekt-type for Banedata. -->
	<ObjectType DataType="RailCOMPLETESection" Class="RailwayPlacedObject" Name="JBTSA_TEA Togdeteksjonsavsnitt for akseltellere"
				Layer="JBTSA_TEA" Color="ByLayer"
				Group="Signal/Togdeteksjon/Akseltellere"
				AttMirrorY="{% if RightSided %}true{% else %}false{% endif %}"
	>
		<!-- <xpp:expand select="NOBN_xxx_DEPRECATED_MACRO___TO_BE_REMOVED" /> -->
		<xpp:expand select="NOBN_com_SYMBOLFRAME" />
		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___ANGULAROFFSET_VAR" />
		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___MILEAGE_INCREASES_TOWARDS_LEFT" />
		<xpp:expand select="NOBN_com_STD_TEXATTRIBUTES___VERTICAL_AND_FAR___SIG" />
		<xpp:expand select="NOBN_com_DISCIPLINE___SIG" />
		<xpp:expand select="NOBN_com_CHK_NUMBER_OF_OCP_AREAS" />
		<xpp:expand select="RC_com_SET_OCP_STATION_REFERENCE" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___ANNOTATIVE_DISTANCE_TO_ALIGNMENT" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___EARTHED_TO_NONE" />
		
		<xpp:expand select="NOBN_com_PSET_FDV_BANEDATA" />
		
		<xpp:expand select="NOBN_com_PSET_TITTELFELT" />
		<xpp:expand select="NOBN_com_PSET_HOV_ID" />

		<!-- Ikke ISY beskrivelse - fiktivt objekt -->

		<Variants>
			<Variant Name="Togdeteksjonsavsnitt for akseltellere" >
			</Variant>
		</Variants>

		<SetValue Key="code" Value="OOO" />

		<CustomAttribute DataType="String" ReadOnly="true" Category="Model check" Name="mc_AxleCountersToBeModelchecked" 
			DisplayName="Axle counters to be refreshed" 
			Description="When this section object is refreshed, then the nearest limiting object on each side is refreshed as well." />
		<LuaExpression Name="mc_AxleCountersToBeModelchecked" IsModelCheck="true" ><Formula>_JBTSA_TEA_chkTriggerNeighbourAxleCounters()</Formula></LuaExpression>
		<LuaFunction Name="_JBTSA_TEA_chkTriggerNeighbourAxleCounters()" ReturnType="String"
			Description="Triggers modelchecking in neighbour axle counters." >
			<Constructor>_JBTSA_TEA_chkTriggerNeighbourAxleCounters()</Constructor>
			<Formula>
				function _JBTSA_TEA_chkTriggerNeighbourAxleCounters()
					if Alignment == nil then return "UNFINISHED - Missing own alignment.",_error end
					local n = 0
					local t = {}
					prev = getDownObject("JBTSA_TEL Akselteller sensor") --Axle counter
					if prev then 
						n = n + 1
						table.insert(t,prev)
					end
					next = getUpObject("JBTSA_TEL Akselteller sensor") --Axle counter
					if next then 
						n = n + 1
						table.insert(t,next)
					end
					return n,t, _info(n.." axle counters have been refreshed.")
				end
			</Formula>
		</LuaFunction>

		<LuaExpression Name="name" ><Formula>"Ta("..code..")"</Formula></LuaExpression>	

		<!-- Snap-distance 1.6 means that the snap-function with argument '3' snaps it to dist 3 from track, snapping to the correct track. -->
		<InsertPointObject VariantName="Togdeteksjonsavsnitt for akseltellere" DisplayBlockName="NO-BN-2D-JBTRC_SEKSJON-INNSETTING-SYMBOL-Schematic"
				DefaultSnapMode="Alignment" SnapToAlignment="true" SnapDistance="4e-4" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance EnableDirectionSetting="true" />
			<SetValue Key="KmStigerMotVenstre" Value="{{alignmentRotation | minus:ucsRotation | cosisnegative}}" />
			<SetValue Key="DelimiterType" Value="JBTSA_TEL Akselteller sensor" />
		</InsertPointObject>
		
		<SymbolDefinition DefaultBlockName="NO-BN-2D-JBTFE_SEK-SEKSJON-{{SymbolMode}}" AllowSymbolMove="true" >
			<Rotation AddAngle="{% if KmStigerMotVenstre %}180{% else %}0{% endif %}" />
			<SymbolAttribute Tag="X" >
				<Value>{{code}}</Value>
			</SymbolAttribute>
		</SymbolDefinition>

	</ObjectType>



<!--========================================================================================================
    SIGNALING
	AXLE COUNTER SENSOR
	railML:	2.3
	Element:	<trainDetector>
	Parent: 	<trainDetectionElements>
	Children: <additionalName> (introduced with version 2.1), <any>, <geoCoord>, <states>
=========================================================================================================-->
<!-- Note: If cant has been exaggerated, then the axle counter sensors will move with the superelevated rails and may come closer to the -->
<!-- track / alignment axis than expected, and a model check for XY-plane distance less than 5e-3 to own alignment will flag the axle counter as misplaced... -->
<!-- if (math.abs(math.abs(DistanceToAlignment) - cantGauge/2) &gt; 5e-3) then -->
<!-- 	return string.format("%.3f",DistanceToAlignment)..": WARNING - Distance (2D) to own alignment should be about +/- half railseparation.",_warning -->
<!-- end -->
	<ObjectType DataType="tTrainDetector" Class="RailwayPlacedObject" Name="JBTSA_TEL Akselteller sensor"
				Layer="JBTSA_TEL" Color="ByLayer"
				Group="Signal/Togdeteksjon/Akseltellere"
				AttMirrorY="{% if RightSided %}true{% else %}false{% endif %}"
				>
				
		<RelationSpace>tellepunkt</RelationSpace>
		
		<!-- <xpp:expand select="NOBN_xxx_DEPRECATED_MACRO___TO_BE_REMOVED" /> -->
		<xpp:expand select="NOBN_com_SYMBOLFRAME" />
		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___ANGULAROFFSET_VAR" />
		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___MILEAGE_INCREASES_TOWARDS_LEFT" />
		<xpp:expand select="NOBN_com_STD_TEXTATTRIBUTES___HORIZONTAL_AND_MEDIUM_FAR___SIG" />
		<xpp:expand select="NOBN_com_DISCIPLINE___SIG" />
		<xpp:expand select="NOBN_com_CHK_NUMBER_OF_OCP_AREAS" />
		<xpp:expand select="RC_com_SET_OCP_STATION_REFERENCE" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___TRACKBOUND_OBJECT" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___EARTHED_TO_NONE" />

		
		
		<xpp:expand select="NOBN_com_PSET_TITTELFELT" />
		<xpp:expand select="NOBN_com_PSET_FDV_BANEDATA" />
		<xpp:expand select="NOBN_com_PSET_FDV_BANEDATA_SA_TEL" />
		<xpp:expand select="NOBN_com_PSET_HOV_ID" />

		<LuaExpression Name="IsyPostnotat"><Formula>name</Formula></LuaExpression> 


		<Variants>
			<Variant Name="Tellepunkt" >
				<SetValue Key="controllerRef" Value="" />  <!--This refers to the id attribute of the associated <controller> element-->
				<SetValue Key="detectionObject" Value="axle" />  <!--wheel axle train endOfTrain obstacle other:anything--> 
				<SetValue Key="medium" Value="magnetic" />	<!--mechanical hydraulic pneumatic magnetic inductive optical radio other:anything-->
				<SetValue Key="directionDetection" Value="false" />	<!--boolean-->
				<SetValue Key="model" Value="" />	<!--string-->
				<SetValue Key="axleCounting" Value="true" />	<!--Boolean-->
				<SetValue Key="Model3DName" Value="NO-BN-3D-SA-TEL-L905-TELLEPUNKT-SK30K" />
			</Variant>
		</Variants>

		<LuaExpression Name="DistanceToAlignment" ><Formula>_JBTSA_TEL_DistanceToAlignment()</Formula></LuaExpression>
		<LuaFunction Name="_JBTSA_TEL_DistanceToAlignment()" ReturnType="String"
			Description="Returns the distance to alignment for an axle counter sensor, either +/- 1.5 in schematic drawings or  otherwise +/-0.75." >
			<Constructor>Double _JBTSA_TEL_DistanceToAlignment()</Constructor>
			<Formula>
				function _JBTSA_TEL_DistanceToAlignment()
					cg2 = Alignment.AlignmentSystem.CantGauge/2
					if SymbolMode == "Schematic" then 
						return RightSided and 2 or -2  --TODO: Only guessing...
					else 
						return NOBN_trk_getDistanceToAlignmentFromCantAndTrackPlaneDistance(RightSided and cg2 or -cg2)
					end
				end
			</Formula>
		</LuaFunction>

		<LuaExpression Name="code" ><Formula>_JBTSA_TEL_code()</Formula></LuaExpression>
		<LuaFunction Name="_JBTSA_TEL_code()" ReturnType="String"
			Description="Returns a text string 'DownSection/UpSection' for an axle counter sensor." >
			<Constructor>_JBTSA_TEL_code()</Constructor>
			<Formula>
				function _JBTSA_TEL_code()
					first = "-"
					shortestDistanceSoFar = math.huge
					for i = 0, DownSections.count-1 do
						obj = DownSections[i]
						if obj and obj:isVisible() then
							dist = RC__getDistance2D(obj)
							if dist &lt; shortestDistanceSoFar then
								first = DownSections[i].code
								shortestDistanceSoFar = dist
							end
						end
					end
					second = "-"
					shortestDistanceSoFar = math.huge
					for i = 0, UpSections.count-1 do
						obj = UpSections[i]
						if obj and obj:isVisible() then 
							dist = RC__getDistance2D(obj)
							if dist &lt; shortestDistanceSoFar then
								second = UpSections[i].code
								shortestDistanceSoFar = dist
							end
						end
					end
					if KmStigerMotVenstre then first,second = second,first end
					if first == "-" and second == "-" then
						return first.."/"..second, _info("UNFINISHED - Create axle counter Section object(s) to obtain the section numbers 'a/b' for the sensor.")
					else
						return first.."/"..second
					end
				end
			</Formula>
		</LuaFunction>

		<LuaExpression Name="name" ><Formula>"Tp("..code..")"</Formula></LuaExpression>	
		<LuaExpression Name="dir" ><Formula>"both"</Formula></LuaExpression>	
		
		<LuaFunction Name="_JBTSA_TEL_chkAxleCounterDistanceToPreviousAxleCounter()" ReturnType="String"
			Description="Checks distance to previous axle counter. Error if below 21 m, warning if below 23 m." >
			<Constructor>String _JBTSA_TEL_chkAxleCounterDistanceToPreviousAxleCounter()</Constructor>
			<Formula>
				function _JBTSA_TEL_chkAxleCounterDistanceToPreviousAxleCounter()
					searchDir = "down"
					if Alignment == nil then return "UNFINISHED - Missing own alignment.",_error end
					r,n = RC__getCollectionOfRelatedObjects("Har akseltellersopp")
					if n == 0 then tps = nil else tps = r[0] end --tps (tellepunktsopp) is nil if no tuning unit connected yet (used to trigger check of related object)
					ac = getDownObject(RcType)
					if ac == nil then return "OK - No "..RcType:sub(8).." within reach in the '"..searchDir.."' direction.",_ok end
					dist = distance(ac)
					t = string.format("%.3f", dist)
					Etol = 21.0 --[m] error level tolerance
					Wtol = Etol + 2.0 --[m] warning level tolerance
					if dist &lt; Etol then 
						return string.format("%.03f: ERROR - %s too close in '%s' direction, outside tolerance %0.3f m.", dist,ac.name,searchDir,Etol),{ac,tps},_error
					elseif dist &lt; Wtol then 
						return string.format("%.03f: WARNING - %s close in '%s' direction, but within tolerance %0.3f m.", dist,ac.name,searchDir,Etol),{ac,tps},_warning
					else
						return string.format("%.03f: OK - %s is nearest axle counter in '%s' direction, farther away than tolerance %0.3f m.", dist,ac.name,searchDir,Etol),{ac,tps},_ok
					end
				end
			</Formula>
		</LuaFunction>



		<LuaFunction Name="_JBTSA_TEL_chkAxleCounterDistanceToNextAxleCounter()" ReturnType="String"
			Description="Checks distance to next axle counter. Error if below 21 m, warning if below 23 m." >
			<Constructor>String _JBTSA_TEL_chkAxleCounterDistanceToNextAxleCounter()()</Constructor>
			<Formula>
				function _JBTSA_TEL_chkAxleCounterDistanceToNextAxleCounter()
					searchDir = "up"
					if Alignment == nil then return "UNFINISHED - Missing own alignment.",_error end
					r,n = RC__getCollectionOfRelatedObjects("Har akseltellersopp")
					if n == 0 then tps = nil else tps = r[0] end --tps (tellepunktsopp) is nil if no tuning unit connected yet (used to trigger check of related object)
					ac = getUpObject(RcType)
					if ac == nil then return "OK - No "..RcType:sub(8).." within reach in the '"..searchDir.."' direction.",_ok end
					dist = distance(ac)
					t = string.format("%.3f", dist)
					Etol = 21.0 --[m] error level tolerance
					Wtol = Etol + 2.0 --[m] warning level tolerance
					if dist &lt; Etol then 
						return string.format("%.03f: ERROR - %s too close in '%s' direction, outside tolerance %0.3f m.", dist,ac.name,searchDir,Etol),{ac,tps},_error
					elseif dist &lt; Wtol then 
						return string.format("%.03f: WARNING - %s close in '%s' direction, but within tolerance %0.3f m.", dist,ac.name,searchDir,Etol),{ac,tps},_warning
					else
						return string.format("%.03f: OK - %s is nearest axle counter in '%s' direction, farther away than tolerance %0.3f m.", dist,ac.name,searchDir,Etol),{ac,tps},_ok
					end
				end
			</Formula>
		</LuaFunction>

		<!-- Set railML properties: -->
		<LuaExpression Name="posInTrack" ><Formula>RightSided and "leftRail" or "rightRail"</Formula></LuaExpression>	

		<!-- Model checks -->
		<CustomAttribute DataType="String" ReadOnly="true" Category="Model check" Name="mc_DistanceToPreviousAxleCounter" DisplayName="Avstand til forrige tellepunkt" 
				Description="Axle counters need at least 21 m between any two consecutive sensors, preferably 23 m, such that the longest admissible wagon will not free the track occupation under the wagon." />
		<CustomAttribute DataType="String" ReadOnly="true" Category="Model check" Name="mc_DistanceToNextAxleCounter" DisplayName="Avstand til neste tellepunkt" 
				Description="Axle counters need at least 21 m between any two consecutive sensors, preferably 23 m, such that the longest admissible wagon will not free the track occupation under the wagon." />
		<LuaExpression Name="mc_DistanceToPreviousAxleCounter" IsModelCheck="true" ><Formula>_JBTSA_TEL_chkAxleCounterDistanceToPreviousAxleCounter()</Formula></LuaExpression>
		<LuaExpression Name="mc_DistanceToNextAxleCounter" IsModelCheck="true" ><Formula>_JBTSA_TEL_chkAxleCounterDistanceToNextAxleCounter()</Formula></LuaExpression>
			
		<InsertPointObject VariantName="Tellepunkt" DisplayBlockName="NO-BN-2D-JBTSA_TEL-AKSELTELLER-SENSOR-{{SymbolMode}}" 
				DefaultSnapMode="Alignment" SnapToAlignment="true" SnapDistance="0.75" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="0" RotateIfRightSideOfAlignment="true" />
			<SetValue Key="KmStigerMotVenstre" Value="{{alignmentRotation | minus:ucsRotation | cosisnegative}}" />
		</InsertPointObject>

		<SymbolDefinition DefaultBlockName="NO-BN-2D-JBTSA_TEL-AKSELTELLER-SENSOR-{{SymbolMode}}" AllowSymbolMove="true" >
			<Rotation Add180DegreesIfDirIsDown="false" AddAngle="{% if dir == 'up' %}{{270.0|plus:AngularOffset}}
														{% elsif dir == 'down' %}{{90.0|plus:AngularOffset}}
														{% elsif dir == 'both' and RightSided %}{{180.0|plus:AngularOffset}}
														{% elsif dir == 'both' and LeftSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and RightSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and LeftSided %}{{180.0|plus:AngularOffset}}
														{% else %}45.0
														{% endif %}" />	
			<BlockNameFormat>NO-BN-2D-JBTSA_TEL-AKSELTELLER-SENSOR-{{SymbolMode}}</BlockNameFormat>
		</SymbolDefinition>

		<SymbolDefinition DefaultBlockName="" AllowSymbolMove="true" >
			<Rotation Add180DegreesIfDirIsDown="false" AddAngle="{% if dir == 'up' %}{{270.0|plus:AngularOffset}}
														{% elsif dir == 'down' %}{{90.0|plus:AngularOffset}}
														{% elsif dir == 'both' and RightSided %}{{180.0|plus:AngularOffset}}
														{% elsif dir == 'both' and LeftSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and RightSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and LeftSided %}{{180.0|plus:AngularOffset}}
														{% else %}45.0
														{% endif %}" />	
			<BlockNameFormat>{% if SymbolMode == 'Geographic' %}NO-BN-2D-JBTSA_TEL-AKSELTELLER-SENSOR-Metric{% endif %}</BlockNameFormat>
		</SymbolDefinition>

		<SymbolDefinition DefaultBlockName="NO-BN-2D-JBTRC_INNSETTINGSPUNKT-Schematic" />

		<DockPointDefinitions>
			<SnapPoints>
				<SnapPoint X="0.0" Y="3.0" TargetSpace="akseltellersopp" />
				<SnapPoint X="0.0" Y="4.5" TargetSpace="akseltellersopp" />
				<SnapPoint X="0.0" Y="-3.0" TargetSpace="akseltellersopp" />
				<SnapPoint X="0.0" Y="-4.5" TargetSpace="akseltellersopp" />
			</SnapPoints>
		</DockPointDefinitions>

	</ObjectType>



<!--========================================================================================================
    SIGNALING
	AXLE COUNTER TUNING UNIT
=========================================================================================================-->
	<!-- TODO: Avklare med Bane NOR om vi får innføre SA-TET for Tellepunkt tuningenhet -->
	<ObjectType DataType="tOrientedElement" Class="RailwayPlacedObject" Name="JBTSA_TET Akselteller tuningenhet"
				Layer="JBTSA_TET" Color="ByLayer"
				Group="Signal/Togdeteksjon/Akseltellere"
				AttMirrorY="{% if RightSided %}true{% else %}false{% endif %}"
				>
				
		<RelationSpace>akseltellersopp</RelationSpace>
		
		<!-- <xpp:expand select="NOBN_xxx_DEPRECATED_MACRO___TO_BE_REMOVED" /> -->
		<xpp:expand select="NOBN_com_SYMBOLFRAME" />
		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___ANGULAROFFSET_VAR" />
		<xpp:expand select="NOBN_com_STD_TEXTATTRIBUTES___HORIZONTAL_AND_FAR___SIG" />
		<xpp:expand select="NOBN_com_DISCIPLINE___SIG" />
		<xpp:expand select="NOBN_com_CHK_NUMBER_OF_OCP_AREAS" />
		<xpp:expand select="RC_com_SET_OCP_STATION_REFERENCE" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___WAYSIDE_GENERAL_OBJECT" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___EARTHED_TO_RAIL" />
		
		
		
		<xpp:expand select="NOBN_com_PSET_TITTELFELT" />
		<xpp:expand select="NOBN_com_PSET_FDV_BANEDATA" />
		<xpp:expand select="NOBN_com_PSET_HOV_ID" />
		<LuaExpression Name="IsyPostnotat" ><Formula>name</Formula></LuaExpression> 

		<Variants>
			<Variant Name="Sopp for enkelt tellepunkt" >
				<SetValue Key="name" Value="Tp-sopp, enkel" />
			</Variant>
			<Variant Name="Sopp for dobbelt tellepunkt" >
				<SetValue Key="name" Value="Tp-sopp, dobbel" />
			</Variant>
		</Variants>

		<CustomAttribute DataType="String" ReadOnly="true" Category="Model check" Name="mc_CableDistanceFromMushroomToAxleCounter" 
						DisplayName="Kabelavstand fra sopp til tellepunkt" 
						Description="Axle counters send very weak signals to the nearby tuning box, using impedance-matched coaxial cables of predefined lengths, typically from 3 to 7 meters." />
		<LuaExpression Name="mc_CableDistanceFromMushroomToAxleCounter" IsModelCheck="true" ><Formula>_JBTSA_TET_chkCableDistanceFromTunerToAxleCounter()</Formula></LuaExpression>
		<LuaFunction Name="_JBTSA_TET_chkCableDistanceFromTunerToAxleCounter()" ReturnType="String"
			Description="Checks 'grid distance' (perp to track + along track), from axle counter tuner (mushroom) to its axle counter. Error if outside (1.0 - 7.5), warning if outside (3.0 - 3.4) meter." >
			<Constructor>String _JBTSA_TET_chkCableDistanceFromTunerToAxleCounter()</Constructor>
			<Formula>
				function _JBTSA_TET_chkCableDistanceFromTunerToAxleCounter()
					--Assume mushroom has same own alignment and approximate position as the axle counter it belongs to:
					s = "Er akseltellersopp for tellepunkt"
					r,n = RC__getCollectionOfRelatedObjects(s)
					if n == 0 then
						return "UNFINISHED - Relate with '"..s.."' to  its axle counter sensor."
					else
						tol = 1.0 -- meter
						ac = r[0]
						gridDistancePerpendicular = math.abs(distanceToAlignment - ac.distanceToAlignment)
						gridDistanceColinear = math.abs(mileage - ac.mileage)
						-- Their sum is a cool metric:
						gridDistance = gridDistancePerpendicular + gridDistanceColinear
						msg = "Grid distance is the sum of "..RC__round(gridDistancePerpendicular,1).." (perpendicular to alignment) and "..RC__round(gridDistanceColinear,1).." (colinear to alignment)"
						gt = string.format("%.1f=%.03f+%.03f",gridDistance,gridDistancePerpendicular,gridDistanceColinear)
						if (gridDistance &lt; tol) then return gridDistance..": ERROR - Tuner is located too close to axle counter wrt minimum tolerance 1m.",{ac},_error, _info(msg)
						elseif (gridDistance &gt;= 1.0 and gridDistance &lt; 3.0) then return gt..": WARNING - Tuner is located close to axle counter but above min 1m - try increase to 3.0.",{ac},_warning, _info(msg)
						elseif (gridDistance &gt;= 3.0 and gridDistance &lt; 3.4) then return gt..": OK - Distance from tuner to axle counter is suitable for standard cabling 3m to 3.4m.",{ac},_ok, _info(msg)
						elseif (gridDistance &gt;= 3.4 and gridDistance &lt;= 7.5) then return gt..": WARNING - Tuner is located far from axle counter, but below max 7.5m - try reduce to 3.4.",{ac},_warning, _info(msg)
						else return gt..": ERROR - Tuner is located too far from axle counter, reduce distance.",{ac},_error, _info(msg) end
					end
				end
			</Formula>
		</LuaFunction>

		<LuaExpression Name="dir" ><Formula>"both"</Formula></LuaExpression>
		
		<LuaExpression Name="code" ><Formula>_JBTSA_TET_code()</Formula></LuaExpression>
		<LuaFunction Name="_JBTSA_TET_code()" ReturnType="String"
			Description="Obtains the 'code' for axle counter tuning unit (mushroom). Uses relation 'Er akseltellersopp for tellepunkt'." >
			<Constructor>String _JBTSA_TET_code()</Constructor>
			<Formula>
				function _JBTSA_TET_code()
					s = "Er akseltellersopp for tellepunkt"
					r,n = RC__getCollectionOfRelatedObjects(s)
					if n == 0 then
						return "UNFINISHED - Relate with '"..s.."' to  its axle counter sensor."
					elseif n == 1 then
						return "Tps("..r[0].code..")"
					elseif n == 2 then
						return "Tps("..r[0].code.."+"..r[1].code..")"
					elseif n &gt;= 3 then
						return "*** ERROR - Too many axle counters sensors related to mushroom with '"..s.."."
					end
				end
			</Formula>
		</LuaFunction>

		<LuaExpression Name="name" ><Formula>"Tps("..code..")"</Formula></LuaExpression>
		<LuaExpression Name="Mileage" ><Formula>RC__getMileageFromRelatedObject("Er akseltellersopp for tellepunkt")</Formula></LuaExpression>

		<InsertPointObject VariantName="Sopp for enkelt tellepunkt" DisplayBlockName="NO-BN-2D-JBTSA_TET-AKSELTELLER-TUNING-ENHET-{{SymbolMode}}" 
				DefaultSnapMode="Alignment" SnapToAlignment="true" SnapDistance="3.75" AskForAttachment="true" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance RotateIfRightSideOfAlignment="true" />
		</InsertPointObject>

		<InsertPointObject VariantName="Sopp for dobbelt tellepunkt" DisplayBlockName="NO-BN-2D-JBTSA_TET-AKSELTELLER-TUNING-ENHET-{{SymbolMode}}" 
				DefaultSnapMode="Alignment" SnapToAlignment="true" SnapDistance="3.75" AskForAttachment="true" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance RotateIfRightSideOfAlignment="true" />
		</InsertPointObject>

		<SymbolDefinition DefaultBlockName="NO-BN-2D-JBTSA_TET-AKSELTELLER-TUNING-ENHET-{{SymbolMode}}" AllowSymbolMove="true" >
			<Rotation Add180DegreesIfDirIsDown="false" AddAngle="{% if dir == 'up' %}{{270.0|plus:AngularOffset}}
														{% elsif dir == 'down' %}{{90.0|plus:AngularOffset}}
														{% elsif dir == 'both' and RightSided %}{{180.0|plus:AngularOffset}}
														{% elsif dir == 'both' and LeftSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and RightSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and LeftSided %}{{180.0|plus:AngularOffset}}
														{% else %}45.0
														{% endif %}" />	
		</SymbolDefinition>

		<SymbolDefinition DefaultBlockName="NO-BN-2D-JBTRC_INNSETTINGSPUNKT-Schematic" />

	</ObjectType>

	

<!--========================================================================================================
    SIGNALING
	TRACK VACANTY DETECTION
	TRACK CIRCUIT SECTION
=========================================================================================================-->
	<ObjectType DataType="RailCOMPLETESection" Class="RailwayPlacedObject" Name="JBTSA_SPF Sporfelt"
				Layer="JBTSA_SPF" Color="ByLayer"
				Group="Signal/Togdeteksjon/Sporfelt"
				AttMirrorY="{% if RightSided %}true{% else %}false{% endif %}"
	>
				
		<!-- <xpp:expand select="NOBN_xxx_DEPRECATED_MACRO___TO_BE_REMOVED" /> -->
		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___ANGULAROFFSET_VAR" />
		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___MILEAGE_INCREASES_TOWARDS_LEFT" />
		<xpp:expand select="NOBN_com_STD_TEXATTRIBUTES___VERTICAL_AND_FAR___SIG" />
		<xpp:expand select="NOBN_com_DISCIPLINE___SIG" />
		<xpp:expand select="NOBN_com_CHK_NUMBER_OF_OCP_AREAS" />
		<xpp:expand select="RC_com_SET_OCP_STATION_REFERENCE" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___ANNOTATIVE_DISTANCE_TO_ALIGNMENT" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___EARTHED_TO_NONE" />
		
		<xpp:expand select="NOBN_com_PSET_FDV_BANEDATA" />
		
		<xpp:expand select="NOBN_com_PSET_TITTELFELT" />
		<xpp:expand select="NOBN_com_PSET_FDV_BANEDATA_SA_SPF" />
		<xpp:expand select="NOBN_com_PSET_HOV_ID" />

		<!-- Fiktivt objekt - ikke ISY beskrivelse -->
		
		<Variants>
			<Variant Name="Sporfelt" >
			</Variant>
		</Variants>
		
		<SetValue Key="code" Value="OOO" />

		<LuaExpression Name="DistanceToAlignment" ><Formula>RC__snap(getPropertyValue("DistanceToAlignment"),3)</Formula></LuaExpression>

		<CustomAttribute DataType="String" ReadOnly="true" Category="Model check" Name="mc_IsolatedJointsToBeModelchecked"
			Description="When this section object is refreshed, then the nearest limiting object on each side is refreshed as well." />
		<LuaExpression Name="mc_IsolatedJointsToBeModelchecked" IsModelCheck="true" ><Formula>NOBN_sig_chkTriggerNeighbourIsolatedJoints()</Formula></LuaExpression>
		<LuaFunction Name="NOBN_sig_chkTriggerNeighbourIsolatedJoints()" ReturnType="String"
			Description="Triggers modelchecking in neighbour isolated joints." >
			<Constructor>NOBN_sig_chkTriggerNeighbourIsolatedJoints()</Constructor>
			<Formula>
				function NOBN_sig_chkTriggerNeighbourIsolatedJoints()
					if Alignment == nil then return "INCOMPLET - Aucun axe propre trouvé.",_error end
					--if Alignment == nil then return "UNFINISHED - Missing own alignment.",_error end
					local n = 0
					local t = {}
					prev = getDownObject("TFVA_JOI Joint isolé")
					if prev then 
						n = n + 1
						table.insert(t,prev)
					end
					next = getUpObject("TFVA_JOI Joint isolé")
					if next then 
						n = n + 1
						table.insert(t,next)
					end
					return n,t,_info(n.." isolated joints have been modelchecked.")
				end
			</Formula>
		</LuaFunction>

		<InsertPointObject VariantName="Sporfelt" DisplayBlockName="NO-BN-2D-JBTRC_SEKSJON-INNSETTING-SYMBOL-Schematic"
				DefaultSnapMode="Alignment" SnapToAlignment="true" SnapDistance="4e-4" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<SetValue Key="KmStigerMotVenstre" Value="{{alignmentRotation | minus:ucsRotation | cosisnegative}}" />
			<SetValue Key="SymbolFrame" Value="Symbolramme-R2.75" />
			<SetValue Key="DelimiterType" Value="JBTKO_SKJ Skinneskjøt" />
		</InsertPointObject>
	
		<SymbolDefinition DefaultBlockName="NO-BN-2D-JBTFE_SEK-SEKSJON-{{SymbolMode}}" AllowSymbolMove="true" >
			<Rotation AddAngle="{% if KmStigerMotVenstre %}180{% else %}0{% endif %}" />
			<SymbolAttribute Tag="X" >
				<Value>{{code}}</Value>
			</SymbolAttribute>
		</SymbolDefinition>

		<SymbolDefinition DefaultBlockName="NO-BN-2D-JBTRC_INNSETTINGSPUNKT-Schematic" />

	</ObjectType>



<!--========================================================================================================
    SIGNALING / TRACK AND EMBANKMENT
	ISOLATED JOINT
=========================================================================================================-->
	<!-- JBTKO_SKJ Skinneskjøt -->
	<!-- Isolert skinneskjøt. Tilhører Overbygningsfaget, som har sporet. Brukes også i returstrømkretsen. -->
	<!-- TODO: Vurder om den skal bytte Group i CreatePointObject innsettingsdialogen og i Object Manager. -->

<!--	
	Principle for the object's construction:
	1) The object's DataType is the railML tTrackCircuitBorder, which includes the property insulatedRail with
	enum values [none | left | right | both].
	2) Each isolated joint symbol contains several symbol layers in the same 2D symbol block...
		a) ...showing a thick bar over the track (or similar) in 1-line signaling schematic style drawings.
		b) ...showing a thin bar with track circuit current directions (4 quadrants) over the track (or similar)
			in 1-line geographic style drawings
		c) ...showing a separate icon for each railisolation in a 2-line drawing (schematic or geographic).
-->
	<ObjectType DataType="tTrackCircuitBorder" Class="RailwayPlacedObject" Name="JBTKO_SKJ Skinneskjøt"
				Layer="JBTKO_SKJ" Color="ByLayer"
				Group="Signal/Togdeteksjon/Sporfelt"
				AttMirrorY="{% if RightSided %}true{% else %}false{% endif %}"
				>
				
		<RelationSpace>skinneskjøt</RelationSpace>

		<!-- <xpp:expand select="NOBN_xxx_DEPRECATED_MACRO___TO_BE_REMOVED" /> -->
		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___ANGULAROFFSET_VAR" />
		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___MILEAGE_INCREASES_TOWARDS_LEFT" />
		<xpp:expand select="NOBN_com_STD_TEXATTRIBUTES___VERTICAL_AND_FAR___TRK" />
		<xpp:expand select="NOBN_com_DISCIPLINE___TRK" />
		<xpp:expand select="NOBN_com_CHK_NUMBER_OF_OCP_AREAS" />
		<xpp:expand select="RC_com_SET_OCP_STATION_REFERENCE" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___TRACKBOUND_OBJECT" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___EARTHED_TO_NONE" />

		
		
		<xpp:expand select="NOBN_com_PSET_TITTELFELT" />
		<xpp:expand select="NOBN_com_PSET_FDV_BANEDATA" />
		<xpp:expand select="NOBN_com_PSET_FDV_BANEDATA_KO_SKJ" />
		<xpp:expand select="NOBN_com_PSET_HOV_ID" />

		<LuaExpression Name="IsyPostnotat"><Formula>name</Formula></LuaExpression> 


		<Variants>
			<Variant Name="Skinneskjøt" Description="The object represents an insulated joint plus the isolation of left/right or both rails from here an onwards.">
				<!-- Set railML properties: -->
				<!-- Force schematic plan's isolation symbol to appear when inserting object: -->
				<SetValue Key="insulatedRail" Value="both" />
			</Variant>
		</Variants>

		<LuaExpression Name="DistanceToAlignment" ><Formula>0</Formula></LuaExpression>
		
		<CustomAttribute DataType="Boolean" Name="UpSectionLeftRailDetection" DisplayName="Deteksjon venstreskinne i stigende kilometerretning" DefaultValue="False" />
		<CustomAttribute DataType="Boolean" Name="UpSectionRightRailDetection" DisplayName="Deteksjon høyreskinne i stigende kilometerretning" DefaultValue="False" />
		<CustomAttribute DataType="Boolean" Name="DownSectionLeftRailDetection" DisplayName="Deteksjon venstreskinne i synkende kilometerretning" DefaultValue="False" />
		<CustomAttribute DataType="Boolean" Name="DownSectionRightRailDetection" DisplayName="Deteksjon høyreskinne i synkende kilometerretning" DefaultValue="False" />

		<LuaExpression Name="name" ><Formula>"Iso."..code</Formula></LuaExpression>

		<!-- TODO: Lage 3D-modell for isolasjon med sporfelttilkoblinger -->
		<SetValue Key="Model3DName" Value="" />

		<LuaExpression Name="UpSectionLeftRailDetection" ><Formula>insulatedRail == "left" or insulatedRail == "both"</Formula></LuaExpression>
		<LuaExpression Name="UpSectionRightRailDetection" ><Formula>insulatedRail == "right" or insulatedRail == "both"</Formula></LuaExpression>
		<LuaExpression Name="DownSectionLeftRailDetection" >
			<Formula>
				prev = getDownObject(RcType)
				if prev == nil then return false 
				else
					return prev.insulatedRail == "left" or prev.insulatedRail == "both"
				end
			</Formula>
		</LuaExpression>
		<LuaExpression Name="DownSectionRightRailDetection" >
			<Formula>
				prev = getDownObject(RcType)
				if prev == nil then return false 
				else
					return prev.insulatedRail == "right" or prev.insulatedRail == "both"
				end
			</Formula>
		</LuaExpression>
			
		<!-- NB! Point snapping works for some switches (for those where we had data on insulation joint placements (point on straight / deviating alignment axis). -->
		<InsertPointObject VariantName="Skinneskjøt" DisplayBlockName="NO-BN-2D-JBTKO_SKJ-SKINNESKJOET-0-0-0-0-{{SymbolMode}}"
				DefaultSnapMode="Alignment" SnapToAlignment="true" SnapDistance="0" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="0" RotateIfRightSideOfAlignment="false" />
			<SetValue Key="KmStigerMotVenstre" Value="{{alignmentRotation | minus:ucsRotation | cosisnegative}}" />
		</InsertPointObject>
		
		<SymbolDefinition DefaultBlockName="" AllowSymbolMove="true" Layer="JBTKO_SKJ" >
			<BlockNameFormat JoinBy="-" >
				NO-BN-2D-JBTKO_SKJ-SKINNESKJOET
				{% if UpSectionRightRailDetection %}1{% else %}0{% endif %}
				{% if DownSectionRightRailDetection %}1{% else %}0{% endif %}
				{% if DownSectionLeftRailDetection %}1{% else %}0{% endif %}
				{% if UpSectionLeftRailDetection %}1{% else %}0{% endif %}
				{{SymbolMode}}
			</BlockNameFormat>
		</SymbolDefinition>

		<SymbolDefinition DefaultBlockName="NO-BN-2D-JBTRC_INNSETTINGSPUNKT-Schematic" />

	</ObjectType>



<!--========================================================================================================
    SIGNALING
	TRACK VACANCY DETECTION
	TAIL MAGNET
=========================================================================================================-->



<!--========================================================================================================
    SIGNALING
	POINT MACHINE
	Point machine for turnouts, tongues and movable point frogs
=========================================================================================================-->
	<ObjectType DataType="tOrientedElement" Class="RailwayPlacedObject" Name="JBTSA_DRV Sporvekseldrivmaskin"
				Layer="JBTSA_DRV" Color="ByLayer"
				Group="Signal/Drivmaskiner"
				AttMirrorY="{% if RightSided %}true{% else %}false{% endif %}"
				>
				
		<RelationSpace>sporvekseldrivmaskin</RelationSpace>

		<!-- <xpp:expand select="NOBN_xxx_DEPRECATED_MACRO___TO_BE_REMOVED" /> -->
		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___ANGULAROFFSET_VAR" />
		<xpp:expand select="NOBN_com_STD_TEXATTRIBUTES___VERTICAL_AND_FAR___SIG" />
		<xpp:expand select="NOBN_com_DISCIPLINE___SIG" />
		<xpp:expand select="NOBN_com_CHK_NUMBER_OF_OCP_AREAS" />
		<xpp:expand select="RC_com_SET_OCP_STATION_REFERENCE" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___TRACKBOUND_OBJECT" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___EARTHED_TO_RAIL" />
		
		
		
		<xpp:expand select="NOBN_com_PSET_TITTELFELT" />
		<xpp:expand select="NOBN_com_PSET_FDV_BANEDATA" />
		<xpp:expand select="NOBN_com_PSET_FDV_BANEDATA_SA_DRV" />
		<xpp:expand select="NOBN_com_PSET_HOV_ID" />
		<LuaExpression Name="IsyPostnotat"><Formula>name</Formula></LuaExpression> 


		<LuaExpression Name="DistanceToAlignment" >		   
			<Formula>NOBN_trk_getDistanceToAlignmentFromCantAndTrackPlaneDistance(RightSided and 1.75 or -1.75)</Formula>
		</LuaExpression>

		<CustomAttribute DataType="Boolean" Name="HasHeatingElement" DisplayName="Har varmeelement" DefaultValue="False" >
			<Values>
				<Value>true</Value>
				<Value>false</Value>
			</Values>
		</CustomAttribute>
		
		<Variants DefaultValue="Uspesifisert" >
			<Variant Name="Uspesifisert" >
			</Variant>
			<Variant Name="Alstom MET" >
			</Variant>
			<Variant Name="Siemens Bsg9" >
			</Variant>
			<Variant Name="Siemens ELS 710" >
			</Variant>
		</Variants>
		
		<LuaExpression Name="code" ><Formula>_JBTSA_DRV_code()</Formula></LuaExpression>	
		<LuaFunction Name="_JBTSA_DRV_code()" ReturnType="String"
				Description="Obtains the code for a point machine, derived from the switch it is related to with 'Driver sporveksel'." >
			<Constructor>String _JBTSA_DRV_code()</Constructor>
			<Formula>
				function _JBTSA_DRV_code()
					local s,i,r,n,d,j
					s = "Driver sporveksel"
					r,n = RC__getCollectionOfRelatedObjects(s)
					if n == 0 then
						return "Relate with '"..s.."' to switch object (turnout).",
							_info("Point machines derive their code from the switch they are related to with '"..s.."'.")
					else    
						pm,npm = RC__getCollectionOfRelatedObjects("Har sporvekseldrivmaskin",r[0])
						j = 0
						for i = 0, npm-1 do 
							d = (r[0].dir == "up") and 1 or -1
							if ((ReferenceMileage - pm[i].ReferenceMileage)*d &gt;= 0) then 
								j = j + 1 
							end
						end
						return tonumber(r[0].code) and string.format("%d.%d",r[0].code,j) or string.format("DRV.%d",j)
					end
				end	
			</Formula>
		</LuaFunction>

		<LuaExpression Name="name" ><Formula>"Drv."..code</Formula></LuaExpression>	
		
		<LuaExpression Name="dir" ><Formula>_JBTSA_DRV_dir()</Formula></LuaExpression>
		<LuaFunction Name="_JBTSA_DRV_dir()" ReturnType="String"
				Description="Obtains the direction (dir) for a point machine, derived from the switch it is related to with 'Driver sporveksel'." >
			<Constructor>String _JBTSA_DRV_dir()</Constructor>
			<Formula>
				function _JBTSA_DRV_dir()
					local s,sw,n
					s = "Driver sporveksel"
					sw,n = RC__getCollectionOfRelatedObjects(s)
					if n == 0 then
						return "unknown", _info("Point machines derive their direction from the switch they are related to with '"..s.."'.")
					else
						return sw[0].dir
					end
				end
			</Formula>
		</LuaFunction>

		<!-- Note: None of these point machines are symmetrical, there are separate right / left versions. -->
		<!-- This is mainly due to the need of having the control rods always closest to tip-of-tongue, -->
		<!-- at least in the first oint machine position. -->
		<LuaExpression Name="Model3DName" ><Formula>_JBTSA_DRV_Model3DName()</Formula></LuaExpression>	
		<LuaFunction Name="_JBTSA_DRV_Model3DName()" ReturnType="String"
				Description="Obtains the 3D model name (Model3DName) for a point machine, derived from its Variant, direction (dir) and side of alignment (distanceToAlignment)." >
			<Constructor>String _JBTSA_DRV_Model3DName()</Constructor>
			<Formula>
				function _JBTSA_DRV_Model3DName()
					local t = ""
					if Variant == "Uspesifisert" then
						return "NO-BN-3D-FE-DIV-UKJENT"
					elseif Variant == "Alstom MET" then 
						t = "NO-BN-3D-SA-DRV-SPORVEKSELDRIVMASKIN-ALSTOM-MET-"
					elseif Variant == "Siemens Bsg9" then
						t = "NO-BN-3D-SA-DRV-SPORVEKSELDRIVMASKIN-SIEMENS-BSG9-"
					elseif Variant == "Siemens ELS 710" then
						t = "NO-BN-3D-SA-DRV-SPORVEKSELDRIVMASKIN-SIEMENS-ELS710-"
					else
						return "NO-BN-3D-FE-DIV-UKJENT",_error, _info("Unrecognized variant ["..Variant.."].")
					end
					if ((dir == "up" and RightSided) or (dir == "down" and LeftSided)) then 
						return t.."VSIDE"
					elseif ((dir == "up" and LeftSided) or (dir == "down" and RightSided)) then 
						return t.."VSIDE"
					else
						return "Cannot determine side of track for point machine.",_error
					end
				end
			</Formula>
		</LuaFunction>
		
		<InsertPointObject VariantName="Uspesifisert" DisplayBlockName="NO-BN-2D-JBTSA_DRV-SPORVEKSELDRIVMASKIN-{{SymbolMode}}" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="1.75" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
		</InsertPointObject>

		<InsertPointObject VariantName="Alstom MET" DisplayBlockName="NO-BN-2D-JBTSA_DRV-SPORVEKSELDRIVMASKIN-{{SymbolMode}}" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="1.75" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
		</InsertPointObject>

		<InsertPointObject VariantName="Siemens Bsg9" DisplayBlockName="NO-BN-2D-JBTSA_DRV-SPORVEKSELDRIVMASKIN-{{SymbolMode}}" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="1.75" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
		</InsertPointObject>

		<InsertPointObject VariantName="Siemens ELS 710" DisplayBlockName="NO-BN-2D-JBTSA_DRV-SPORVEKSELDRIVMASKIN-{{SymbolMode}}" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="1.75" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
		</InsertPointObject>

		<SymbolDefinition DefaultBlockName="NO-BN-2D-JBTSA_DRV-SPORVEKSELDRIVMASKIN-{{SymbolMode}}" AllowSymbolMove="true" >
			<Rotation Add180DegreesIfDirIsDown="true" />
		</SymbolDefinition>

		<Model3DDefinition>
			<Attribute Tag="T01" >
				<Value>{{code}}</Value>
			</Attribute>
		</Model3DDefinition>

		<SymbolDefinition DefaultBlockName="NO-BN-2D-JBTRC_INNSETTINGSPUNKT-Schematic" />

	</ObjectType>



<!--========================================================================================================
    SIGNAL
	DERAILER MACHINE
=========================================================================================================-->
	<ObjectType DataType="tOrientedElement" Class="RailwayPlacedObject" Name="JBTSA_SPD Sporsperredrivmaskin"
				Layer="JBTSA_SPD" Color="ByLayer"
				Group="Signal/Drivmaskiner"
				AttMirrorY="{% if RightSided %}true{% else %}false{% endif %}"
				>
				
		<RelationSpace>sporsperredrivmaskin</RelationSpace>

		<!-- <xpp:expand select="NOBN_xxx_DEPRECATED_MACRO___TO_BE_REMOVED" /> -->
		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___ANGULAROFFSET_VAR" />
		<xpp:expand select="NOBN_com_STD_TEXATTRIBUTES___VERTICAL_AND_FAR___SIG" />
		<xpp:expand select="NOBN_com_DISCIPLINE___SIG" />
		<xpp:expand select="NOBN_com_CHK_NUMBER_OF_OCP_AREAS" />
		<xpp:expand select="RC_com_SET_OCP_STATION_REFERENCE" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___TRACKBOUND_OBJECT" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___EARTHED_TO_RAIL" />

		
		
		<xpp:expand select="NOBN_com_PSET_TITTELFELT" />
		<xpp:expand select="NOBN_com_PSET_FDV_BANEDATA" />
		<xpp:expand select="NOBN_com_PSET_FDV_BANEDATA_SA_SPD" />
		<xpp:expand select="NOBN_com_PSET_HOV_ID" />
		<LuaExpression Name="IsyPostnotat"><Formula>name</Formula></LuaExpression> 


		<LuaExpression Name="DistanceToAlignment" >		   
			<Formula>NOBN_trk_getDistanceToAlignmentFromCantAndTrackPlaneDistance(RightSided and 1.75 or -1.75)</Formula>
		</LuaExpression>

		<LuaExpression Name="code" ><Formula>_JBTSA_SPD_code()</Formula></LuaExpression>	
		<LuaFunction Name="_JBTSA_SPD_code()" ReturnType="String"
				Description="Obtains the code for a derailer machine, derived from the derailer it is related to with 'Driver sporsperre'." >
			<Constructor>String _JBTSA_SPD_code()</Constructor>
			<Formula>
				function _JBTSA_SPD_code()
					s = "Driver sporsperre"
					r,n = RC__getCollectionOfRelatedObjects(s)
					if n == 0 then
						return "UNFINISHED - Missing relation '"..s.."' to derailer object.",_warning
					else
						return r[0].code
					end
				end
			</Formula>
		</LuaFunction>
		
		<LuaExpression Name="name" ><Formula>return "Spd."..code</Formula></LuaExpression>	

		<!-- Bela machine is symmetrical (a little to one side, but same config for both sides mounting). -->
		<SetValue Key="dir" Value="both" />

		<Variants DefaultValue="BELA" >
			<Variant Name="BELA" >
				<SetValue Key="Model3DName" Value="NO-BN-3D-SA-SPD-SPORSPERREDRIVMASKIN-BELA" /> 
			</Variant>
		</Variants>

		<InsertPointObject VariantName="BELA" DisplayBlockName="NO-BN-2D-JBTSA_SPD-SPORSPERREDRIVMASKIN-{{SymbolMode}}" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="1.75" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
		</InsertPointObject>

		<SymbolDefinition DefaultBlockName="NO-BN-2D-JBTSA_SPD-SPORSPERREDRIVMASKIN-{{SymbolMode}}" AllowSymbolMove="true" >
			<Rotation Add180DegreesIfDirIsDown="true" />
		</SymbolDefinition>

		<Model3DDefinition>
			<Attribute Tag="T01" >
				<Value>{{code}}</Value>
			</Attribute>
		</Model3DDefinition>

		<SymbolDefinition DefaultBlockName="NO-BN-2D-JBTRC_INNSETTINGSPUNKT-Schematic" />

	</ObjectType>



<!--========================================================================================================
    SIGNALING
	LEVEL CROSSING BARRIER MACHINE
=========================================================================================================-->
	
	

<!--========================================================================================================
    SIGNALING
	LOCAL CONTROL PANEL
	Push-button device for single or coupled turnout / turnout-turnout / derailer / turnout-derailer
=========================================================================================================-->
	<ObjectType DataType="tOrientedElement" Class="RailwayPlacedObject" Name="JBTSA_LOK Lokalstiller"
				Layer="JBTSA_LOK" Color="ByLayer"
				Group="Signal/Lokalstillere"
				AttMirrorY="{% if RightSided %}true{% else %}false{% endif %}"
				>
				
		<RelationSpace>lokalstiller</RelationSpace>

		<AttachmentCategory Name="lokalstiller" />
		<AttachTo Category="stolpe_med_fot" />

		<!-- <xpp:expand select="NOBN_xxx_DEPRECATED_MACRO___TO_BE_REMOVED" /> -->
		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___ANGULAROFFSET_VAR" />
		<xpp:expand select="NOBN_com_STD_TEXATTRIBUTES___VERTICAL_AND_FAR___SIG" />
		<xpp:expand select="NOBN_com_DISCIPLINE___SIG" />
		<xpp:expand select="NOBN_com_CHK_NUMBER_OF_OCP_AREAS" />
		<xpp:expand select="RC_com_SET_OCP_STATION_REFERENCE" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___WAYSIDE_GENERAL_OBJECT" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___EARTHED_TO_RAIL" />
		
		
		
		<xpp:expand select="NOBN_com_PSET_TITTELFELT" />
		<xpp:expand select="NOBN_com_PSET_FDV_BANEDATA" />
		<xpp:expand select="NOBN_com_PSET_FDV_BANEDATA_SA_LOK" />
		<xpp:expand select="NOBN_com_PSET_HOV_ID" />

		<LuaExpression Name="IsyPostnotat"><Formula>name</Formula></LuaExpression> 


		<LuaExpression Name="Offset3D.Z" ><Formula>Variant:match("vegg") and 1.25 or 0</Formula></LuaExpression>
		<LuaExpression Name="PoleRouting3D" ><Formula>Variant:match("vegg") and "None" or "Vertical"</Formula></LuaExpression>
	
		<Variants DefaultValue="Lokalstiller, 1 knapp/enkel veksel, på stolpe" >
			<Variant Name="Lokalstiller, 1 knapp/enkel veksel, på stolpe" >
				<SetValue Key="Model3DName" Value="NO-BN-3D-SA-LOK-LOKALSTILLER-1-KNAPP-ENKEL-VEKSEL-MED-STOLPE" />
			</Variant>
			<Variant Name="Lokalstiller, 1 knapp/enkel veksel, på vegg" >
				<SetValue Key="Model3DName" Value="NO-BN-3D-SA-LOK-LOKALSTILLER-1-KNAPP-ENKEL-VEKSEL" />
			</Variant>
			<Variant Name="Lokalstiller, 1 knapp/koblet veksel, på stolpe" >
				<SetValue Key="Model3DName" Value="NO-BN-3D-SA-LOK-LOKALSTILLER-1-KNAPP-KOBLET-VEKSEL-MED-STOLPE" />
			</Variant>
			<Variant Name="Lokalstiller, 1 knapp/koblet veksel, på vegg" >
				<SetValue Key="Model3DName" Value="NO-BN-3D-SA-LOK-LOKALSTILLER-1-KNAPP-KOBLET-VEKSEL" />
			</Variant>
			<Variant Name="Lokalstiller, 2 knapper/enkel veksel, på stolpe" >
				<SetValue Key="Model3DName" Value="NO-BN-3D-SA-LOK-LOKALSTILLER-2-KNAPPER-ENKEL-VEKSEL-MED-STOLPE" />
			</Variant>
			<Variant Name="Lokalstiller, 2 knapper/enkel veksel, på vegg" >
				<SetValue Key="Model3DName" Value="NO-BN-3D-SA-LOK-LOKALSTILLER-2-KNAPPER-ENKEL-VEKSEL" />
			</Variant>
			<Variant Name="Lokalstiller, 2 knapper/koblet veksel, på stolpe" >
				<SetValue Key="Model3DName" Value="NO-BN-3D-SA-LOK-LOKALSTILLER-2-KNAPPER-KOBLET-VEKSEL-MED-STOLPE" />
			</Variant>
			<Variant Name="Lokalstiller, 2 knapper/koblet veksel, på vegg" >
				<SetValue Key="Model3DName" Value="NO-BN-3D-SA-LOK-LOKALSTILLER-2-KNAPPER-KOBLET-VEKSEL" />
			</Variant>
		</Variants>

		<LuaExpression Name="code" ><Formula>_JBTSA_SPD_code()</Formula></LuaExpression>	
		<LuaFunction Name="_JBTSA_SPD_code()" ReturnType="String"
				Description="Obtains the code for a local control panel, derived from the switch or derailer it is related to with 'Omstiller sporveksel' or 'Omstiller sporsperre'." >
			<Constructor>String _JBTSA_SPD_code()</Constructor>
			<Formula>
				function _JBTSA_SPD_code()
					local s = "Omstiller sporveksel/sporsperre"
					local r,n = RC__getCollectionOfRelatedObjects(s)
					if n == 0 then
						return "UNFINISHED - Missing relation '"..s.."' to switch object or derailer object.",_warning,
						_info("A local control panel derives its code property from the switch or derailer which it is related to.")
					elseif n == 1 then
						if r[0].RcType == "JBTKO_SPV Sporveksel" then 
							local coupledSwitch,ncsw = RC__getCollectionOfRelatedObjects("Er koblet med sporveksel",r[0])
							if ncsw == 0 then
								return r[0].code
							else
								return coupledSwitch[0].code.."/"..r[0].code
							end
						elseif r[0].RcType == "JBTSA_SSP Sporsperre" then
							return r[0].code
						else
							return "ERROR - Bad RcType ["..r[0].RcType.."] for object related to Local control panel.",_error
						end
					else
						return "ERROR - More than 1 ["..n.."] object related to Local control panel.",_error
					end
				end
			</Formula>
		</LuaFunction>

		<LuaExpression Name="name" ><Formula>"Lok."..code</Formula></LuaExpression>

		<LuaExpression Name="dir" ><Formula>_JBTSA_LOK_dir()</Formula></LuaExpression>	
		<LuaFunction Name="_JBTSA_LOK_dir()" ReturnType="String"
				Description="Obtains the dir (direction) for a local control panel, derived from the switch or derailer it is related to with 'Omstiller sporveksel/sporsperre'." >
			<Constructor>String _JBTSA_LOK_dir()</Constructor>
			<Formula>
				function _JBTSA_SPD_code()
					s = "Omstiller sporveksel/sporsperre"
					r,n = RC__getCollectionOfRelatedObjects(s)
					if n == 0 then
						return "unknown"
					else
						if r[0].RcType == "JBTSA_LOK Lokalstiller" then 
							return "both" 
						else 
							return r[0].dir
						end
					end
				end
			</Formula>
		</LuaFunction>

		
		<!-- 2D symbol is circular symmetric, so no need to specify any rotation during insertion jig -->
		<InsertPointObject VariantName="Lokalstiller, 1 knapp/enkel veksel, på stolpe"
				DisplayBlockName="NO-BN-2D-JBTSA_LOK-LOKALSTILLER-{{SymbolMode}}" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="2.4" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<SetValue Key="dir" Value="both" />
		</InsertPointObject>
		<InsertPointObject VariantName="Lokalstiller, 1 knapp/enkel veksel, på vegg"
				DisplayBlockName="NO-BN-2D-JBTSA_LOK-LOKALSTILLER-{{SymbolMode}}" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="4.0" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<SetValue Key="dir" Value="both" />
		</InsertPointObject>
		<InsertPointObject VariantName="Lokalstiller, 1 knapp/koblet veksel, på stolpe"
				DisplayBlockName="NO-BN-2D-JBTSA_LOK-LOKALSTILLER-{{SymbolMode}}" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="2.4" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<SetValue Key="dir" Value="both" />
		</InsertPointObject>
		<InsertPointObject VariantName="Lokalstiller, 1 knapp/koblet veksel, på vegg"
				DisplayBlockName="NO-BN-2D-JBTSA_LOK-LOKALSTILLER-{{SymbolMode}}" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="4.0" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<SetValue Key="dir" Value="both" />
		</InsertPointObject>
		<InsertPointObject VariantName="Lokalstiller, 2 knapper/enkel veksel, på stolpe"
				DisplayBlockName="NO-BN-2D-JBTSA_LOK-LOKALSTILLER-{{SymbolMode}}" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="2.4" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<SetValue Key="dir" Value="both" />
		</InsertPointObject>
		<InsertPointObject VariantName="Lokalstiller, 2 knapper/enkel veksel, på vegg"
				DisplayBlockName="NO-BN-2D-JBTSA_LOK-LOKALSTILLER-{{SymbolMode}}" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="4.0" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<SetValue Key="dir" Value="both" />
		</InsertPointObject>
		<InsertPointObject VariantName="Lokalstiller, 2 knapper/koblet veksel, på stolpe"
				DisplayBlockName="NO-BN-2D-JBTSA_LOK-LOKALSTILLER-{{SymbolMode}}" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="2.4" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<SetValue Key="dir" Value="both" />
		</InsertPointObject>
		<InsertPointObject VariantName="Lokalstiller, 2 knapper/koblet veksel, på vegg"
				DisplayBlockName="NO-BN-2D-JBTSA_LOK-LOKALSTILLER-{{SymbolMode}}" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="4.0" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<SetValue Key="dir" Value="both" />
		</InsertPointObject>

		<SymbolDefinition DefaultBlockName="NO-BN-2D-JBTSA_LOK-LOKALSTILLER-{{SymbolMode}}" AllowSymbolMove="true" >
			<Rotation Add180DegreesIfDirIsDown="false" AddAngle="{% if dir == 'up' %}{{270.0|plus:AngularOffset}}
														{% elsif dir == 'down' %}{{90.0|plus:AngularOffset}}
														{% elsif dir == 'both' and RightSided %}{{180.0|plus:AngularOffset}}
														{% elsif dir == 'both' and LeftSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and RightSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and LeftSided %}{{180.0|plus:AngularOffset}}
														{% else %}45.0
														{% endif %}" />	
		</SymbolDefinition>

		<Model3DDefinition>
			<Attribute Tag="T01" >
				<Value>{{code}}</Value>
			</Attribute>
		</Model3DDefinition>

		<SymbolDefinition DefaultBlockName="NO-BN-2D-JBTRC_INNSETTINGSPUNKT-Schematic" />

		<DockPointDefinitions>
			<SnapPoints>
				<!-- Stolpe for montasje -->
				<SnapPoint X="0" Y="0" TargetSpace="stolpe_med_fot" />
			</SnapPoints>
		</DockPointDefinitions>

		<DisplayPointDefinitions>
			<SnapPoints>
				<!-- Visuell Lok relativt til dock point (0, +/-2.5) i sporveksel, skal vises litt før SS (og spv har fire kvadranter) -->
				<SnapPoint X="-1.75" Y="0.75" />
				<SnapPoint X="-1.75" Y="-0.75" />
				<SnapPoint X="1.75" Y="0.75" />
				<SnapPoint X="1.75" Y="-0.75" />
			</SnapPoints>
		</DisplayPointDefinitions>
	</ObjectType>



<!--=======================================================================================================
	SIGNAL
	FORRIGLING
	Default options for eksport av forriglingstabeller
========================================================================================================-->
	<DefaultInterlockingExportOptions>
		<TrainRoutesStartPointFilter>if (RcType == "JBTSA_SIG Signal" and Hovedsignal == 'Hs2' or Hovedsignal == 'Hs3') then
	return NOBN_sig_getSignalShortName()
elseif RcType == "JBTSA_ERT ERTMS-signal" then
	return NOBN_sig_getSignalShortName()
end</TrainRoutesStartPointFilter>
		<TrainRoutesEndPointFilter>if ((RcType == "JBTSA_SIG Signal" and (Hovedsignal == 'Hs1'or Hovedsignal == 'Hs2' or Hovedsignal == 'Hs3'))
	or (RcType == "JBTSA_FIK Fiktivt punkt" and Variant == "Fiktivt sluttpunkt for togvei")
	or (RcType == "JBTSA_SIG Togvei slutt"))
then
	return NOBN_sig_getSignalShortName()
elseif RcType == "JBTSA_ERT ERTMS-signal" then
	return NOBN_sig_getSignalShortName()
end</TrainRoutesEndPointFilter>
		<ShuntingRoutesStartPointFilter>if (RcType == "JBTSA_SIG Signal" and Dvergsignal == "Ja") then return NOBN_sig_getSignalNumber() end</ShuntingRoutesStartPointFilter>
		<ShuntingRoutesEndPointFilter>if (RcType == "JBTSA_SIG Signal" and Dvergsignal == "Ja") then 
	return NOBN_sig_getSignalNumber()
elseif ((RcType == "JBTSA_FIK Fiktivt punkt" and Variant == "Fiktivt sluttpunkt for togvei") or (RcType == "JBTSA_SIG Togvei slutt")) then

	return code
end</ShuntingRoutesEndPointFilter>
		<ViaPointFilter>if (RcType == "JBTSA_FIK Fiktivt punkt" and Variant == "Viapunkt for betjeningsanlegg") then
    return "(v"..code..")"
end</ViaPointFilter>
		<ExtendedTrainRoutesExcludedStartPointFilter>Function == "blocking"</ExtendedTrainRoutesExcludedStartPointFilter>
		<ExtendedRoutePartFormatScript>base = StartName .. "-" .. EndName
if ViaPoints.Count > 0 then
    via = ViaPoints[0].Value
    for i=1, ViaPoints.Count-1 do
      via = via .. "-" .. ViaPoints[i].Value
    end
    return base .. " via " .. via
else
    return base
end</ExtendedRoutePartFormatScript>
		<SwitchNameScript>dir = (position == "left") and "V" or "H"
return switchObj.code .. dir</SwitchNameScript>
	</DefaultInterlockingExportOptions>
	
	
	
<!--========================================================================================================
    End of file 
=========================================================================================================-->
</xpp:bloc>

<!--========================================================================================================

    NO-BN-CivilWorks.xml
	
	Include in DNA file using XPPq XML preprocessor directive <xpp:expand href="fileName.xml"/>.

	Copyright (c) 2015-2024 Railcomplete AS, Norway, NO916118503
	
=========================================================================================================-->
<xpp:bloc>



<!--========================================================================================================
	sub - Substructure / civil works functions accessible globally
=========================================================================================================-->
	<LuaFunction Name="NOBN_sub_getFoundationCode()" ReturnType="String" 
		Description="Returns the code for a foundation / bolt group / deduced from its associated object (based on RcType and close proximity).">
		<Signature>String NOBN_sub_getFoundationCode([ObjRef obj])</Signature>
		<Formula>
			function NOBN_sub_getFoundationCode(obj)
				local tol = 0.50 --[m] Look for a matching object close to 'obj'
				local function fn(obj,objectTypes,errMsg)
						--Check for matching objects in prioritized order.
					local ot,n,o
					ot = getCollectionFromTable(objectTypes)
					n = ot.Count
					for i=0,n-1 do
						o = getNearbyPointObjects2D(tol,ot[i],obj)
						if getCollectionLength(o) &gt; 0 then return o[0].code end
					end
					return errMsg 
				end
			
				if obj == nil then obj = this end
				if RcType:match("JBTEH_FUN KL%-fundament") then 
					return fn(obj,{	rctype_OcsPole,
									rctype_OcsDropArmUnderPortal,
									rctype_OcsDropArmForBridgeOrTunnel,
									rctype_GuywireFootplate,
									rctype_SpannerFootplate,
									rctype_TunnelWallFixing
								},
								"UNFINISHED - no visible OCS pole or guywire / spanner fastener found at foundation.")
				elseif RcType:match(rctype_SignalFoundation) then 
					return fn(obj,{rctype_Signal},"UNFINISHED - no visible signal found at foundation.")
				elseif RcType:match(rctype_CabinetFoundation) then 
					return fn(obj,{rctype_SignallingCabinet},"UNFINISHED - no visible signal cabinet found at foundation.")
				elseif RcType:match(rctype_TelecomFoundation) then 
					return fn(obj,{"TODO: Define telecom objects here :ODOT"},"UNFINISHED - no visible matching telecom object found at foundation.")
				end
			end
		</Formula>
	</LuaFunction> 
		


<!--========================================================================================================
	CIVIL WORKS
	CABLE DUCTS
	Cable ducts are made from concrete or plastic, where cables may enter or exit at any time through the use of a 
	duct connection element. 
 =========================================================================================================-->
	<!-- NB! 2021-11-22 CLFEY: We have introduced automatic layer setting to JBTFF_TTT_XXxx-YYyy (phase). -->
	<!-- NB! Bane NOR kode er KU-KFØ. Vi har skilt denne i KFK=kanal, KFR=rørpakke, KFP=pressrør, KFT=trekkerør. -->
	<!-- Ved eksport til Banedata skal disse mappes til KU-KFØ. -->
	<ObjectType DataType="tElementWithAlignment" Class="RailwayAlignment" LuaName="rctype_CableTrough" Name="JBTKU_KFK Kabelkanal"
				Layer="JBTKU_KFK" Color="ByLayer" 
				Group="Underbygning/Føringsveier/Kabelkanal"
				>

		<RelationSpace>kabelføring</RelationSpace>

		<xpp:expand select="NOBN_com_DEROGATION"/>
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___SYMBOLFRAME"/>
		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___VAR"/>
		<xpp:expand select="NOBN_com_DISCIPLINE___SUB"/>
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___ALIGNMENT_WITHOUT_CANT"/>

		<xpp:expand select="NOBN_com_PSET_ISY_STK"/>
		<xpp:expand select="NOBN_com_PSET_BANE_NOR"/>
		<xpp:expand select="NOBN_com_PSET_TITTELFELT"/>
		<xpp:expand select="NOBN_com_PSET_FDV_BANEDATA"/>
		<xpp:expand select="NOBN_com_PSET_FDV_BANEDATA_KU_KFØ"/>

		<!-- Use alignment system to figure out how the closest rail will be concerned in track curves with cant. -->
		<!-- Bane NOR uses LiftWithCant="true" because the sleepers are rotated with asin(cant/CantGauge) around centre track, then lifted by cant/2. -->
		<!-- Attribute AlignmentGauge has no specific usage here. -->
		<AlignmentSystems DefaultSystemName="Kabelføring, løftet med overhøyde">
			<AlignmentSystem Name="Kabelføring, løftet med overhøyde"
				CantGauge="1.500"
				AlignmentGauge="0.000"
				LiftWithCant="true"
			 />
		</AlignmentSystems>

		<Variants DefaultValue="Kabelkanal, betong, 1-løps, 30 cm">
			<Variant Name="Kabelkanal, betong, 1-løps, 30 cm"/>
			<Variant Name="Kabelkanal, betong, 1-løps, 40 cm"/>
			<Variant Name="Kabelkanal, betong, 2-løps, 60 cm"/>
			<Variant Name="Kabelkanal, betong, 3-løps, 60 cm"/>
		</Variants>

		<CustomProperty DataType="Enumeration" Name="AddElevationIfCant" DisplayName="Heving hvis overhøhyde" DefaultValue="NONE" 
			Description="The 'Heving hvis overhøyde' (AddElevationIfCant) property controls how the cable duct shall behave if its alignment contains cant data. The cant data will normally be inherited from the closest track. If the duct is placed on the right side of this track, then select 'Venstrekurve' (CCW): the right rail's superelevation will be added to the cable duct's elevation (Z coordinate). If the duct is placed on the left side of this track, then select 'Høyrekurve' (CW): the left rail's superelevation will be added to the cable duct's elevation. If you need to elevate the duct to a specific height independent of left/right curvature, e.g. to attach it to a tunnel wall or to a bridge's fence, then select 'Alltid' (ALWAYS). To ignore possible cant data, select 'NONE'."
		>
			<Values>
				<Value Description="Cable duct's cant data will be ignored, duct is placed according to vertical profile data only." DisplayName="Ingen">NONE</Value>
				<Value Description="Cable duct's elevation is augmented by its cant profile value when in a CCW (left) curve." DisplayName="Venstrekurve">CCW</Value>
				<Value Description="Cable duct's elevation is augmented by its cant profile value when in a CW (right) curve." DisplayName="Høyrekurve">CW</Value>
				<Value Description="Cable duct's elevation is augmented by its cant profile everywhere" DisplayName="Alltid">ALWAYS</Value>
			</Values>
		</CustomProperty>

		<LuaExpression Name="Linetype"><Formula>_JBTKU_KFK_Linetype()</Formula></LuaExpression>
		<LuaFunction Name="_JBTKU_KFK_Linetype()" 
				ReturnType="String"
				HideFromUser="false"
				Description="Returns the CAD system 2D presentation line type for the cable duct, based on its Variant.">
			<Signature>String _JBTKU_KFK_Linetype()</Signature>
			<Formula>
				function _JBTKU_KFK_Linetype()
					if Variant:lower():match("1%-løps") then return "RC-DASHED-01"
					elseif Variant:lower():match("2%-løps") then return "RC-DASHED-02"
					elseif Variant:lower():match("3%-løps") then return "RC-DASHED-03"
					else return "Continuous", _info("Variant ["..Variant.."] has not been anticipated yet.")
					end
				end
			</Formula>
		</LuaFunction>

		<LuaExpression Name="GlobalWidth"><Formula>_JBTKU_KFK_GlobalWidth()</Formula></LuaExpression>
		<LuaFunction Name="_JBTKU_KFK_GlobalWidth()" 
				ReturnType="Double"
				HideFromUser="false"
				Description="Returns the global width of the cable duct's 2D representation as a wide polyline.">
			<Signature>Double _JBTKU_KFK_GlobalWidth()</Signature>
			<Formula>
				function _JBTKU_KFK_GlobalWidth()
					if Variant:lower():match("1%-løps, 30 cm") then return 0.30
					elseif Variant:lower():match("1%-løps, 40 cm") then return 0.40
					elseif Variant:lower():match("2%-løps, 60 cm") then return 0.62
					elseif Variant:lower():match("3%-løps, 60 cm") then return 0.62
					else return 0, _info("Variant ["..Variant.."] has not been anticipated yet.")
					end
				end
			</Formula>
		</LuaFunction>

		<!-- 3D geometries: -->
		<!-- '_position' is an intrinsic variable available to sampled Lua functions. -->
		<LuaExpression Name="SweptGeometry3D_0.Name"><Formula>_JBTKU_KFK_Geometry3DName(true,true)</Formula></LuaExpression>
		<LuaExpression Name="SweptGeometry3D_0.Offset.Z"><Formula>_JBTKU_KFK_Geometry3DOffsetZ(_position)</Formula></LuaExpression>

		<LuaExpression Name="IteratedGeometry3D_1.Name"><Formula>_JBTKU_KFK_Geometry3DName(true,false)</Formula></LuaExpression>
		<LuaExpression Name="IteratedGeometry3D_1.Offset.X"><Formula>_JBTKU_KFK_Geometry3DOffsetX(_position)</Formula></LuaExpression>
		<LuaExpression Name="IteratedGeometry3D_1.Offset.Z"><Formula>_JBTKU_KFK_Geometry3DOffsetZ(_position)</Formula></LuaExpression>
		<LuaExpression Name="IteratedGeometry3D_1.Separation"><Formula>_JBTKU_KFK_IteratedGeometry3DSeparation(_position)</Formula></LuaExpression>

		<LuaFunction Name="_JBTKU_KFK_Geometry3DName()" 
				ReturnType="String"
				HideFromUser="false"
				Description="Returns the cable duct's default 3D geometry name, covered or uncovered. Set second argument to 'true' if a sweep profile is needed.">
			<Signature>String _JBTKU_KFK_Geometry3DName([boolean Covered,)</Signature>
			<Formula>
				function _JBTKU_KFK_Geometry3DName(Covered,Swept)

					if Covered == nil or Covered == false then Covered = false
					elseif Covered == true then --do nothing
					else return "Argument 'Covered' must be nil, true or false.",_error
					end

					if Swept == nil or Swept == false then Swept = false
					elseif Swept == true then --do nothing
					else return "Argument 'Swept' must be nil, true or false.",_error
					end

					local t = "NO-BN-"..(Swept and "2D" or "3D").."-KU-KFØ-KABELKANAL-"
					if     Variant == "Kabelkanal, betong, 1-løps, 30 cm" then return t.."300x1000-1-LØPS"..(Covered and "-MED-50-50-LOKK" or "")
					elseif Variant == "Kabelkanal, betong, 1-løps, 40 cm" then return t.."400x1000-1-LØPS"..(Covered and "-MED-50-50-LOKK" or "")
					elseif Variant == "Kabelkanal, betong, 2-løps, 60 cm" then return t.."620x2400-2-LØPS"..(Covered and "-MED-70-70-LOKK" or "")
					elseif Variant == "Kabelkanal, betong, 3-løps, 60 cm" then return t.."620x2400-3-LØPS"..(Covered and "-MED-70-70-LOKK" or "")
					else 
						return "", _info("Variant ["..Variant.."] has not been anticipated yet.")
					end
				end
			</Formula>
		</LuaFunction>

		<LuaFunction Name="_JBTKU_KFK_getStartEndAndJump()"
				ReturnType="AlignmentInfo,AlignmentInfo,Double"
				HideFromUser="false"
				Description="Sampled formula. Returns 'AlignmentInfo' data structures for one duct element's start and end, plus the jump length from start to end along the duct's alignment. Must be called with '_position' as input argument (_position.Ref = alignment GUID, _position.Pos = distAlong).">
			<Signature>alignmentInfo,alignmentInfo,Double _JBTKU_KFK_getStartEndAndJump(_position)</Signature>
			<Formula>
				function _JBTKU_KFK_getStartEndAndJump(_position)
					--Interpret 'Cant' stored in duct's alignment as extra offset (usually the lift of the closest rail) [mm]:
					local id,pos,len2d,offset,s,e,a,b
					id = _position.Ref.id
					pos = _position.Pos
					len2d = getObjectFromId(id).RcAlignment.HorizontalGeometry.Length
					offset = 0.499 * _JBTKU_KFK_IteratedGeometry3DSeparation(_position) --pick samples at +/- offset from object's insertion point (but avoid 0.5000 sharp).
					if pos &lt; offset then
						a = 0
						b = pos + offset
					elseif pos &gt; len2d - offset then 
						a = pos - offset
						b = len2d
					else 
						a = pos - offset
						b = pos + offset
					end
					s = getAlignmentInfo(getAlignmentPos(id,a))
					e = getAlignmentInfo(getAlignmentPos(id,b))
					return s,e,b-a
				end
			</Formula>
		</LuaFunction>

		<LuaFunction Name="_JBTKU_KFK_Geometry3DOffsetX()"
				ReturnType="Double"
				HideFromUser="false"
				Description="Sampled formula. Returns sideways offset for cable duct element (midway between end points on alignment). Must be called with '_position' as input argument (_position.ref = alignment GUID, _position.pos = distAlong).">
			<Signature>Double _JBTKU_KFK_Geometry3DOffsetX(_position)</Signature>
			<Formula>
				function _JBTKU_KFK_Geometry3DOffsetX(_position)
					local s,e = _JBTKU_KFK_getStartEndAndJump(_position)
					local ai = getAlignmentInfo(_position.ref.id,(s.Point.X + e.Point.X)/2,(s.Point.Y + e.Point.Y)/2)
					return ai.DistanceToAlignment
				end	
			</Formula>
		</LuaFunction>

		<LuaFunction Name="_JBTKU_KFK_Geometry3DOffsetZ()"
				ReturnType="Double"
				HideFromUser="false"
				Description="Sampled formula. Returns an extra elevation for the cable duct element in none/CCW/CW/always curve situations according to the current setting of the 'AddElevationIfCant' property. Copy cant data from closest track's cant using the RC-AssistOffsetProfile command, or RC-AlignmentManager/Alignment/Cant. This function must be called with '_position' as input argument (_position.Ref = alignment GUID, _position.Pos = distAlong).">
			<Signature>Double _JBTKU_KFK_Geometry3DOffsetZ(_position)</Signature>
			<Formula>
				function _JBTKU_KFK_Geometry3DOffsetZ(where)
					local _Geometry3DOffsetZstartAi,endAi,jumpDist = _JBTKU_KFK_getStartEndAndJump(where)
					local mid = getAlignmentInfo(where)
					local startElevation = startAi.Elevation
					local endElevation = endAi.Elevation
					local startCant = RC__isNan(startAi.Cant) and 0 or startAi.Cant
					local endCant = RC__isNan(endAi.Cant) and 0 or endAi.Cant
					if AddElevationIfCant == "ALWAYS" then
						return (startElevation + endElevation)/2 + (startCant/1000 + endCant/1000)/2 - mid.Point.Z
					elseif AddElevationIfCant == mid.CantRotation then
						return (startElevation + endElevation)/2 + (startCant/1000 + endCant/1000)/2 - mid.Point.Z
					else 
						--If 'AddElevationIfCant' is "NONE" or "CW" or "CCW" but we are not currently in a curve:
						return (startElevation + endElevation)/2 - mid.Point.Z
					end
				end
			</Formula>
		</LuaFunction>

		<LuaFunction Name="_JBTKU_KFK_Rotation3DX()" 
				ReturnType="Double"
				HideFromUser="false"
				Description="Sampled formula. Returns pitch (gradient) for the cable duct element. Copy the duct's vertical profile (gradient) data from the relevant tracks' vertical profile using the RC-AssistOffsetProfile command. This function must be called with '_position' as input argument (_position.Ref = alignment GUID, _position.Pos = distAlong).">
			<Signature>Double _JBTKU_KFK_Rotation3DX(_position)</Signature>
			<Formula>
				function _JBTKU_KFK_Rotation3DX(where)
					local startAi,endAi,jumpDist = _JBTKU_KFK_getStartEndAndJump(where)
					local startElevation = startAi.Elevation
					local endElevation = endAi.Elevation
					local midCantRotation = getAlignmentInfo(where).CantRotation
					local startCant = RC__isNan(startAi.Cant) and 0 or startAi.Cant
					local endCant = RC__isNan(endAi.Cant) and 0 or endAi.Cant
					local deltaZ
					if AddElevationIfCant == "ALWAYS" or AddElevationIfCant == midCantRotation then
						deltaZ = (endElevation + endCant/1000) - (startElevation + startCant/1000)
					else
						--If 'AddElevationIfCant' is "NONE" or "CW" or "CCW" but we are not currently in a curve:
						deltaZ = endElevation - startElevation
					end
					return math.deg(math.atan(deltaZ,jumpDist))
				end
			</Formula>
		</LuaFunction>

		<LuaFunction Name="_JBTKU_KFK_IteratedGeometry3DSeparation()" 
				ReturnType="Double"
				HideFromUser="false"
				Description="Returns the default separation between consecutive concrete cable duct elements. 5 mm margin is added in tangent segments. In sharp curves, the elements have to be cut at an angle, so the separation decreases with decreasing curvature. This function must be called with '_position' as input argument (_position.Ref = alignment GUID, _position.Pos = distAlong).">
			<Signature>Double _JBTKU_KFK_IteratedGeometry3DSeparation(_position)</Signature>
			<Formula>
				function _JBTKU_KFK_IteratedGeometry3DSeparation(where)
					-- TODO: A more elaborate function would rely on the actual size for each inserted 3D Model, which may vary as a sampled function along the alignment.
					-- This simple formula assumes that the 3D geometry is constant along the alignment, decided by the Variant (which applies to the whole alignment's length)
					local f, b
					if Variant == "Kabelkanal, betong, 1-løps, 30 cm" then 
						f = 2400/1000
						b = 0.3
					elseif Variant == "Kabelkanal, betong, 1-løps, 40 cm" then 
						f = 2400/1000
						b = 0.4
					elseif Variant == "Kabelkanal, betong, 2-løps, 60 cm" then 
						f = 1
						b = 0.6
					elseif Variant == "Kabelkanal, betong, 3-løps, 60 cm" then 
						f = 1
						b = 0.6
					else 
						return 3.1416, _info("Variant ["..Variant.."] has not been anticipated yet - so we assume 3.1416m 3D geometry separation...")
					end
					local r = getAlignmentInfo(where).CurveRadius
					-- Empirical formula, to allow a small separation between concrete elements in the "outer curve", but assuming that it will be cut in the "inner curve".
					if r == nil or r &gt; 100 then 
						return 2.4 / f + .005
					elseif r &lt; (0.8 / b) then 
						return (2.4 - b) / f
					else 
						return (2.4 - 0.8/r) / f + .005
					end
				end
			</Formula>
		</LuaFunction>

		<PropertyPrompt Key="code" DefaultValue="Kabelkanal" AcceptEmptyValue="false"/>

		<InsertAlignment Name="Kabelkanal, betong, 1-løps, 30 cm" DisplayBlockName="NO-BN-2D-JBTRC_THUMBNAIL-KABELFOERING-KABELKANAL-1-LOEPS-300-Schematic" DefaultToTangentContinuity="false">
			<IncludeSegmentType>Tangent</IncludeSegmentType>
			<IncludeSegmentType>Curve</IncludeSegmentType>
		</InsertAlignment>

		<InsertAlignment Name="Kabelkanal, betong, 1-løps, 40 cm" DisplayBlockName="NO-BN-2D-JBTRC_THUMBNAIL-KABELFOERING-KABELKANAL-1-LOEPS-400-Schematic" DefaultToTangentContinuity="false">
			<IncludeSegmentType>Tangent</IncludeSegmentType>
			<IncludeSegmentType>Curve</IncludeSegmentType>
		</InsertAlignment>

		<InsertAlignment Name="Kabelkanal, betong, 2-løps, 60 cm" DisplayBlockName="NO-BN-2D-JBTRC_THUMBNAIL-KABELFOERING-KABELKANAL-2-LOEPS-620-Schematic" DefaultToTangentContinuity="false">
			<IncludeSegmentType>Tangent</IncludeSegmentType>
			<IncludeSegmentType>Curve</IncludeSegmentType>
		</InsertAlignment>

		<InsertAlignment Name="Kabelkanal, betong, 3-løps, 60 cm" DisplayBlockName="NO-BN-2D-JBTRC_THUMBNAIL-KABELFOERING-KABELKANAL-3-LOEPS-620-Schematic" DefaultToTangentContinuity="false">
			<IncludeSegmentType>Tangent</IncludeSegmentType>
			<IncludeSegmentType>Curve</IncludeSegmentType>
		</InsertAlignment>

	</ObjectType>
			


<!--========================================================================================================
	CIVIL WORKS
	CABLE DUCT - CONCRETE ENCASED
	Tube packages made from plastic or steel, most often with concrete encasing, where cables may NOT 
	enter or exit except at the ends. 
 =========================================================================================================-->
	<ObjectType DataType="tElementWithAlignment" Class="RailwayAlignment" LuaName="rctype_UnderTrackCrossingConcrete" Name="JBTKU_KFR Rørpakke"
				Layer="JBTKU_KFR" Color="ByLayer" 
				Group="Underbygning/Føringsveier/Omstøpte trekkerør"
				>

		<RelationSpace>rørpakke</RelationSpace>

		<xpp:expand select="NOBN_com_DEROGATION"/>
		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___VAR"/>
		<xpp:expand select="NOBN_com_STD_TEXTATTRIBUTES___HORIZONTAL_AND_CLOSE___SUB"/>
		<xpp:expand select="NOBN_com_DISCIPLINE___SUB"/>
		<xpp:expand select="NOBN_com_PSET_BANE_NOR"/>
		<xpp:expand select="NOBN_com_PSET_FDV_BANEDATA"/>
		<xpp:expand select="NOBN_com_PSET_ISY_STK"/>
		<xpp:expand select="NOBN_com_PSET_TITTELFELT"/>
		<xpp:expand select="NOBN_com_PSET_FDV_BANEDATA_KU_KFØ"/>

		<!-- TODO Fjerne AlignmentSystem? -->
		<AlignmentSystems DefaultSystemName="Kabelføring">
			<AlignmentSystem Name="Kabelføring"
				CantGauge="0.000"
				AlignmentGauge="0.000"
				LiftWithCant="false"
			 />
		</AlignmentSystems>

		<!-- AxBxC means 'A layers (layer 1 = bottom), B tubes per layer (1 = leftmost), diameter C mm -->
		<!-- If the composition of tubes is not identical between layers, then layer 1 is mentioned first etc. -->
		<!-- Enclose each layer in parenthesis. Colors R=red G=green Y=yellow B=blue may be assigned. -->

		<Variants DefaultValue="Rørpakke, omstøpt, 1x4xØ110">

			<Variant Name="Rørpakke, omstøpt, 1x1xØ110"/>
			<Variant Name="Rørpakke, omstøpt, 2x1xØ110"/>
			<Variant Name="Rørpakke, omstøpt, 3x1xØ110"/>
			<Variant Name="Rørpakke, omstøpt, 4x1xØ110"/>
			<Variant Name="Rørpakke, omstøpt, 5x1xØ110"/>
			<Variant Name="Rørpakke, omstøpt, 6x1xØ110"/>
			<Variant Name="Rørpakke, omstøpt, 7x1xØ110"/>
			
			<Variant Name="Rørpakke, omstøpt, 1x2xØ110"/>
			<Variant Name="Rørpakke, omstøpt, 2x2xØ110"/>
			<Variant Name="Rørpakke, omstøpt, 3x2xØ110"/>
			<Variant Name="Rørpakke, omstøpt, 4x2xØ110"/>
			<Variant Name="Rørpakke, omstøpt, 5x2xØ110"/>
			<Variant Name="Rørpakke, omstøpt, 6x2xØ110"/>
			<Variant Name="Rørpakke, omstøpt, 7x2xØ110"/>

			<Variant Name="Rørpakke, omstøpt, 1x3xØ110"/>
			<Variant Name="Rørpakke, omstøpt, 2x3xØ110"/>
			<Variant Name="Rørpakke, omstøpt, 3x3xØ110"/>
			<Variant Name="Rørpakke, omstøpt, 4x3xØ110"/>
			<Variant Name="Rørpakke, omstøpt, 5x3xØ110"/>
			<Variant Name="Rørpakke, omstøpt, 6x3xØ110"/>
			<Variant Name="Rørpakke, omstøpt, 7x3xØ110"/>

			<Variant Name="Rørpakke, omstøpt, 3x(3xØ110-Ø160),(3xØ110)"/>

			<Variant Name="Rørpakke, omstøpt, 1x4xØ110"/>
			<Variant Name="Rørpakke, omstøpt, 2x4xØ110"/>
			<Variant Name="Rørpakke, omstøpt, 3x4xØ110"/>
			<Variant Name="Rørpakke, omstøpt, 4x4xØ110"/>
			<Variant Name="Rørpakke, omstøpt, 5x4xØ110"/>
			<Variant Name="Rørpakke, omstøpt, 6x4xØ110"/>
			<Variant Name="Rørpakke, omstøpt, 7x4xØ110"/>

			<Variant Name="Rørpakke, omstøpt, 1x5xØ110"/>
			<Variant Name="Rørpakke, omstøpt, 2x5xØ110"/>
			<Variant Name="Rørpakke, omstøpt, 3x5xØ110"/>
			<Variant Name="Rørpakke, omstøpt, 4x5xØ110"/>
			<Variant Name="Rørpakke, omstøpt, 5x5xØ110"/>
			<Variant Name="Rørpakke, omstøpt, 6x5xØ110"/>
			<Variant Name="Rørpakke, omstøpt, 7x5xØ110"/>

			<Variant Name="Rørpakke, omstøpt, 1x6xØ110"/>
			<Variant Name="Rørpakke, omstøpt, 2x6xØ110"/>
			<Variant Name="Rørpakke, omstøpt, 3x6xØ110"/>
			<Variant Name="Rørpakke, omstøpt, 4x6xØ110"/>
			<Variant Name="Rørpakke, omstøpt, 5x6xØ110"/>
			<Variant Name="Rørpakke, omstøpt, 6x6xØ110"/>
			<Variant Name="Rørpakke, omstøpt, 7x6xØ110"/>
		
		</Variants>

		<DynamicProperty Type="Representation3D" Subtype="SweptGeometry3D">
			<SetValue Key="Frozen" Value="False"/>
			<SetValue Key="CustomTransformation" Value="True"/>
		</DynamicProperty>

		<CustomProperty DataType="Boolean" Name="UnderTrackCrossing" DisplayName="Krysser under spor" DefaultValue="true"
				Description="If true, then the pipes are meant to cross under one or more tracks, connecting two cable pits (manholes).
				\nIf false, the pipes are meant to connect cable pits without crossing under any track."/>

		<CustomProperty DataType="Double" Name="StartPointVerticalOffset" DisplayName="Vertical offset at start" DefaultValue="-0.900"
			Description="The vertical offset at the start of the concrete encased tubes [m], relative to its manhole (or the nearest track, if no manhole was found)."/>

		<CustomProperty DataType="Double" Name="EndPointVerticalOffset" DisplayName="Vertical offset at start" DefaultValue="-0.900"
			Description="The vertical offset at the end of the concrete encased tubes [m], relative to its manhole (or the nearest track, if no manhole was found)."/>

		<CustomProperty DataType="String" ReadOnly="true" Category="Model check" 
			Name="mc_Slope" 
			DisplayName="Slope [o/oo] from start to end" 
			Description="
			Below -4 o/oo : OK - Slope magnitude is larger than the recommended value.\n
			-4 to -3 o/oo : WARNING - Slope magnitude is close to the limit, increase slope magnitude.\n
			-3 to +3 o/oo : ERROR - Slope magnitude is not sufficient, increase slope magnitude.\n
			+3 to +4 o/oo : WARNING - Slope magnitude is close to the limit, increase slope magnitude.\n
			Above +4 o/oo : OK - Slope magnitude is larger than the recommended value.\n"
		/>

		<LuaExpression Name="mc_Slope" IsModelCheck ="true"><Formula>_JBTKU_KFR_chkSlope()</Formula></LuaExpression>
		<LuaFunction Name="_JBTKU_KFR_chkSlope()" ReturnType="String"
		Description="Checks the slope from start to end of the concrete-encased tubes. Error if its magnitude is less than 3 o/oo, warning at 4 o/oo.">
			<Signature>String _JBTKU_KFR_chkSlope()</Signature>
			<Formula>
				function _JBTKU_KFR_chkSlope()
					local errorBelowSlope = 3 --[o/oo]
					local warnBelowSlope = 4 --[o/oo]
					local p1 = RcAlignment.StartPoint
					local p2 = RcAlignment.EndPoint
					local t1 = getNearbyAlignments(getPoint3D(p1.X,p1.Y))[0]
					local t2 = getNearbyAlignments(getPoint3D(p2.X,p2.Y))[0]
					local m1 = getNearbyPointObjects2D(p1, 2.5, rctype_CablePit)
					local m2 = getNearbyPointObjects2D(p2, 2.5, rctype_CablePit)
					local n1 = getCollectionLength(m1)
					local n2 = getCollectionLength(m2) 
					
					local z1, z2, t
				
					if n1 + n2 == 0 then
						--Manhole not found at start nor at end:
						z1 = getAlignmentInfo(t1.id,p1.X,p1.Y).Elevation + StartPointVerticalOffset
						z2 = getAlignmentInfo(t2.id,p2.X,p2.Y).Elevation + EndPointVerticalOffset
						t = "track "..RC__identify(t1).." / track "..RC__identify(t2)
					elseif n2 == 0 then
						--Manhole found at start, none found at end:
						z1 = m1[0].geoCoord.Z + StartPointVerticalOffset
						z2 = getAlignmentInfo(t2.id,p2.X,p2.Y).Elevation + EndPointVerticalOffset
						t = "manhole "..RC__identify(m1).." / track "..RC__identify(t2)
					elseif n1 == 0 then
						--Manhole found at end, none found at start:
						z1 = getAlignmentInfo(t1.id,p1.X,p1.Y).Elevation + StartPointVerticalOffset
						z2 = m2[0].geoCoord.Z + EndPointVerticalOffset
						t = "track "..RC__identify(t1).." / manhole "..RC__identify(m2)
					else
						--Manhole found at start and at end:
						z1 = m1[0].geoCoord.Z + StartPointVerticalOffset
						z2 = m2[0].geoCoord.Z + EndPointVerticalOffset
						t = "manhole "..RC__identify(m1).." / manhole "..RC__identify(m2)
					end
				
					local dZ = z2 - z1
					local dL = RcAlignment.HorizontalGeometry.Length
					local slope = (dZ/dL) * 1000 --[o/oo]

					if math.abs(slope) &lt;= errorBelowSlope then 
						return _error,string.format("%.01f: ERROR - %s slope from elevation %.03f to %.03f is not within tolerance %.01f o/oo. Ref. %s.",
							slope, (slope &gt;= 0.0 and "upwards" or "downwards"), z1,z2,errorBelowSlope,t)
					elseif math.abs(slope) &lt;= warnBelowSlope then 
						return _warning,string.format("%.01f: WARNING - %s slope from elevation %.03f to %.03f is close to but still within tolerance %.01f o/oo. Ref. %s.",
							slope, (slope &gt;= 0.0 and "upwards" or "downwards"), z1,z2,errorBelowSlope,t)
					else
						return _ok,string.format("%.01f: OK - %s slope from elevation %.03f to %.03f is greater than %.01f o/oo. Ref. %s.",
							slope, (slope &gt;= 0.0 and "upwards" or "downwards"), z1,z2,warnBelowSlope,t)
					end
				end
			</Formula>
		</LuaFunction>

		<LuaExpression Name="name"><Formula>code.." ("..Variant..")"</Formula></LuaExpression>

		<LuaExpression Name="Linetype"><Formula>_JBTKU_KFR_Linetype()</Formula></LuaExpression>
		<LuaFunction Name="_JBTKU_KFR_Linetype()"
				ReturnType="String"
				HideFromUser="false"
				Description="Returns the CAD system 2D presentation line type for the cable tube package, based on its Variant.">
			<Signature>String _JBTKU_KFR_Linetype()</Signature>
			<Formula>
				function _JBTKU_KFR_Linetype()
					return "RC-SOLID"
				end
			</Formula>
		</LuaFunction>

		<LuaExpression Name="GlobalWidth"><Formula>_JBTKU_KFR_GlobalWidth()</Formula></LuaExpression>
		<LuaFunction Name="_JBTKU_KFR_GlobalWidth()" 
				ReturnType="Double"
				HideFromUser="false"
				Description="Returns the global width of the cable tube package's 2D representation as a wide polyline.">
			<Signature>Double _JBTKU_KFR_GlobalWidth()</Signature>
			<Formula>
				function _JBTKU_KFR_GlobalWidth()
						if Variant == "Rørpakke, omstøpt, 1x1xØ110" and not UnderTrackCrossing then return 0.170
					elseif Variant == "Rørpakke, omstøpt, 2x1xØ110" and not UnderTrackCrossing then return 0.170
					elseif Variant == "Rørpakke, omstøpt, 3x1xØ110" and not UnderTrackCrossing then return 0.170
					elseif Variant == "Rørpakke, omstøpt, 4x1xØ110" and not UnderTrackCrossing then return 0.170
					elseif Variant == "Rørpakke, omstøpt, 5x1xØ110" and not UnderTrackCrossing then return 0.170
					elseif Variant == "Rørpakke, omstøpt, 6x1xØ110" and not UnderTrackCrossing then return 0.170
					elseif Variant == "Rørpakke, omstøpt, 7x1xØ110" and not UnderTrackCrossing then return 0.170
					elseif Variant == "Rørpakke, omstøpt, 1x2xØ110" and not UnderTrackCrossing then return 0.310
					elseif Variant == "Rørpakke, omstøpt, 2x2xØ110" and not UnderTrackCrossing then return 0.310
					elseif Variant == "Rørpakke, omstøpt, 3x2xØ110" and not UnderTrackCrossing then return 0.310
					elseif Variant == "Rørpakke, omstøpt, 4x2xØ110" and not UnderTrackCrossing then return 0.310
					elseif Variant == "Rørpakke, omstøpt, 5x2xØ110" and not UnderTrackCrossing then return 0.310
					elseif Variant == "Rørpakke, omstøpt, 6x2xØ110" and not UnderTrackCrossing then return 0.310
					elseif Variant == "Rørpakke, omstøpt, 7x2xØ110" and not UnderTrackCrossing then return 0.310
					elseif Variant == "Rørpakke, omstøpt, 1x3xØ110" and not UnderTrackCrossing then return 0.450
					elseif Variant == "Rørpakke, omstøpt, 2x3xØ110" and not UnderTrackCrossing then return 0.450
					elseif Variant == "Rørpakke, omstøpt, 3x3xØ110" and not UnderTrackCrossing then return 0.450
					elseif Variant == "Rørpakke, omstøpt, 4x3xØ110" and not UnderTrackCrossing then return 0.450
					elseif Variant == "Rørpakke, omstøpt, 5x3xØ110" and not UnderTrackCrossing then return 0.450
					elseif Variant == "Rørpakke, omstøpt, 6x3xØ110" and not UnderTrackCrossing then return 0.450
					elseif Variant == "Rørpakke, omstøpt, 7x3xØ110" and not UnderTrackCrossing then return 0.450
					elseif Variant == "Rørpakke, omstøpt, 1x4xØ110" and not UnderTrackCrossing then return 0.590
					elseif Variant == "Rørpakke, omstøpt, 2x4xØ110" and not UnderTrackCrossing then return 0.590
					elseif Variant == "Rørpakke, omstøpt, 3x4xØ110" and not UnderTrackCrossing then return 0.590
					elseif Variant == "Rørpakke, omstøpt, 4x4xØ110" and not UnderTrackCrossing then return 0.590
					elseif Variant == "Rørpakke, omstøpt, 5x4xØ110" and not UnderTrackCrossing then return 0.590
					elseif Variant == "Rørpakke, omstøpt, 6x4xØ110" and not UnderTrackCrossing then return 0.590
					elseif Variant == "Rørpakke, omstøpt, 7x4xØ110" and not UnderTrackCrossing then return 0.590
					elseif Variant == "Rørpakke, omstøpt, 1x5xØ110" and not UnderTrackCrossing then return 0.730
					elseif Variant == "Rørpakke, omstøpt, 2x5xØ110" and not UnderTrackCrossing then return 0.730
					elseif Variant == "Rørpakke, omstøpt, 3x5xØ110" and not UnderTrackCrossing then return 0.730
					elseif Variant == "Rørpakke, omstøpt, 4x5xØ110" and not UnderTrackCrossing then return 0.730
					elseif Variant == "Rørpakke, omstøpt, 5x5xØ110" and not UnderTrackCrossing then return 0.730
					elseif Variant == "Rørpakke, omstøpt, 6x5xØ110" and not UnderTrackCrossing then return 0.730
					elseif Variant == "Rørpakke, omstøpt, 7x5xØ110" and not UnderTrackCrossing then return 0.730
					elseif Variant == "Rørpakke, omstøpt, 1x6xØ110" and not UnderTrackCrossing then return 0.870
					elseif Variant == "Rørpakke, omstøpt, 2x6xØ110" and not UnderTrackCrossing then return 0.870
                    elseif Variant == "Rørpakke, omstøpt, 3x6xØ110" and not UnderTrackCrossing then return 0.870
                    elseif Variant == "Rørpakke, omstøpt, 4x6xØ110" and not UnderTrackCrossing then return 0.870
                    elseif Variant == "Rørpakke, omstøpt, 5x6xØ110" and not UnderTrackCrossing then return 0.870
                    elseif Variant == "Rørpakke, omstøpt, 6x6xØ110" and not UnderTrackCrossing then return 0.870
                    elseif Variant == "Rørpakke, omstøpt, 7x6xØ110" and not UnderTrackCrossing then return 0.870
					elseif Variant == "Rørpakke, omstøpt, 1x7xØ110" and not UnderTrackCrossing then return 1.010
					elseif Variant == "Rørpakke, omstøpt, 2x7xØ110" and not UnderTrackCrossing then return 1.010
					elseif Variant == "Rørpakke, omstøpt, 3x7xØ110" and not UnderTrackCrossing then return 1.010
					elseif Variant == "Rørpakke, omstøpt, 4x7xØ110" and not UnderTrackCrossing then return 1.010
					elseif Variant == "Rørpakke, omstøpt, 5x7xØ110" and not UnderTrackCrossing then return 1.010
					elseif Variant == "Rørpakke, omstøpt, 6x7xØ110" and not UnderTrackCrossing then return 1.010
					elseif Variant == "Rørpakke, omstøpt, 7x7xØ110" and not UnderTrackCrossing then return 1.010

					elseif Variant == "Rørpakke, omstøpt, 3x(3xØ110-Ø160),(3xØ110)" then return 0.640

					elseif Variant == "Rørpakke, omstøpt, 1x1xØ110" and UnderTrackCrossing then return 0.310
					elseif Variant == "Rørpakke, omstøpt, 2x1xØ110" and UnderTrackCrossing then return 0.310
					elseif Variant == "Rørpakke, omstøpt, 3x1xØ110" and UnderTrackCrossing then return 0.310
					elseif Variant == "Rørpakke, omstøpt, 4x1xØ110" and UnderTrackCrossing then return 0.310
					elseif Variant == "Rørpakke, omstøpt, 5x1xØ110" and UnderTrackCrossing then return 0.310
					elseif Variant == "Rørpakke, omstøpt, 6x1xØ110" and UnderTrackCrossing then return 0.310
					elseif Variant == "Rørpakke, omstøpt, 7x1xØ110" and UnderTrackCrossing then return 0.310
					elseif Variant == "Rørpakke, omstøpt, 1x2xØ110" and UnderTrackCrossing then return 0.450
					elseif Variant == "Rørpakke, omstøpt, 2x2xØ110" and UnderTrackCrossing then return 0.450
					elseif Variant == "Rørpakke, omstøpt, 3x2xØ110" and UnderTrackCrossing then return 0.450
					elseif Variant == "Rørpakke, omstøpt, 4x2xØ110" and UnderTrackCrossing then return 0.450
					elseif Variant == "Rørpakke, omstøpt, 5x2xØ110" and UnderTrackCrossing then return 0.450
					elseif Variant == "Rørpakke, omstøpt, 6x2xØ110" and UnderTrackCrossing then return 0.450
					elseif Variant == "Rørpakke, omstøpt, 7x2xØ110" and UnderTrackCrossing then return 0.450
					elseif Variant == "Rørpakke, omstøpt, 1x3xØ110" and UnderTrackCrossing then return 0.590
					elseif Variant == "Rørpakke, omstøpt, 2x3xØ110" and UnderTrackCrossing then return 0.590
					elseif Variant == "Rørpakke, omstøpt, 3x3xØ110" and UnderTrackCrossing then return 0.590
					elseif Variant == "Rørpakke, omstøpt, 4x3xØ110" and UnderTrackCrossing then return 0.590
					elseif Variant == "Rørpakke, omstøpt, 5x3xØ110" and UnderTrackCrossing then return 0.590
					elseif Variant == "Rørpakke, omstøpt, 6x3xØ110" and UnderTrackCrossing then return 0.590
					elseif Variant == "Rørpakke, omstøpt, 7x3xØ110" and UnderTrackCrossing then return 0.590
					elseif Variant == "Rørpakke, omstøpt, 1x4xØ110" and UnderTrackCrossing then return 0.730
					elseif Variant == "Rørpakke, omstøpt, 2x4xØ110" and UnderTrackCrossing then return 0.730
					elseif Variant == "Rørpakke, omstøpt, 3x4xØ110" and UnderTrackCrossing then return 0.730
					elseif Variant == "Rørpakke, omstøpt, 4x4xØ110" and UnderTrackCrossing then return 0.730
					elseif Variant == "Rørpakke, omstøpt, 5x4xØ110" and UnderTrackCrossing then return 0.730
					elseif Variant == "Rørpakke, omstøpt, 6x4xØ110" and UnderTrackCrossing then return 0.730
					elseif Variant == "Rørpakke, omstøpt, 7x4xØ110" and UnderTrackCrossing then return 0.730
					elseif Variant == "Rørpakke, omstøpt, 1x5xØ110" and UnderTrackCrossing then return 0.870
					elseif Variant == "Rørpakke, omstøpt, 2x5xØ110" and UnderTrackCrossing then return 0.870
					elseif Variant == "Rørpakke, omstøpt, 3x5xØ110" and UnderTrackCrossing then return 0.870
					elseif Variant == "Rørpakke, omstøpt, 4x5xØ110" and UnderTrackCrossing then return 0.870
					elseif Variant == "Rørpakke, omstøpt, 5x5xØ110" and UnderTrackCrossing then return 0.870
					elseif Variant == "Rørpakke, omstøpt, 6x5xØ110" and UnderTrackCrossing then return 0.870
					elseif Variant == "Rørpakke, omstøpt, 7x5xØ110" and UnderTrackCrossing then return 0.870
					elseif Variant == "Rørpakke, omstøpt, 1x6xØ110" and UnderTrackCrossing then return 1.010
					elseif Variant == "Rørpakke, omstøpt, 2x6xØ110" and UnderTrackCrossing then return 1.010
					elseif Variant == "Rørpakke, omstøpt, 3x6xØ110" and UnderTrackCrossing then return 1.010
					elseif Variant == "Rørpakke, omstøpt, 4x6xØ110" and UnderTrackCrossing then return 1.010
					elseif Variant == "Rørpakke, omstøpt, 5x6xØ110" and UnderTrackCrossing then return 1.010
					elseif Variant == "Rørpakke, omstøpt, 6x6xØ110" and UnderTrackCrossing then return 1.010
					elseif Variant == "Rørpakke, omstøpt, 7x6xØ110" and UnderTrackCrossing then return 1.010
					elseif Variant == "Rørpakke, omstøpt, 1x7xØ110" and UnderTrackCrossing then return 1.150
					elseif Variant == "Rørpakke, omstøpt, 2x7xØ110" and UnderTrackCrossing then return 1.150
					elseif Variant == "Rørpakke, omstøpt, 3x7xØ110" and UnderTrackCrossing then return 1.150
					elseif Variant == "Rørpakke, omstøpt, 4x7xØ110" and UnderTrackCrossing then return 1.150
					elseif Variant == "Rørpakke, omstøpt, 5x7xØ110" and UnderTrackCrossing then return 1.150
					elseif Variant == "Rørpakke, omstøpt, 6x7xØ110" and UnderTrackCrossing then return 1.150
					elseif Variant == "Rørpakke, omstøpt, 7x7xØ110" and UnderTrackCrossing then return 1.150		
					else 
						return 0,"Unrecognized variant ["..Variant.."]."
					end
				end
			</Formula>
		</LuaFunction>

		<LuaExpression Name="SweptGeometry3D_0.Name"><Formula>_JBTKU_KFR_Geometry3DName()</Formula></LuaExpression>
		<LuaFunction Name="_JBTKU_KFR_Geometry3DName()" 
				ReturnType="String"
				HideFromUser="false"
				Description="Returns the tube package default 3D object model name.">
			<Signature>Double _JBTKU_KFR_Geometry3DName()</Signature>
			<Formula>
				function _JBTKU_KFR_Geometry3DName()
						if Variant == "Rørpakke, omstøpt, 1x1xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.2x0.17)-(1x1-110)"
					elseif Variant == "Rørpakke, omstøpt, 2x1xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.34x0.17)-(2x1-110)"
					elseif Variant == "Rørpakke, omstøpt, 3x1xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.48x0.17)-(3x1-110)"
					elseif Variant == "Rørpakke, omstøpt, 4x1xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.62x0.17)-(4x1-110)"
					elseif Variant == "Rørpakke, omstøpt, 5x1xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.76x0.17)-(5x1-110)"
					elseif Variant == "Rørpakke, omstøpt, 6x1xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.9x0.17)-(6x1-110)"
					elseif Variant == "Rørpakke, omstøpt, 7x1xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(1.04x0.17)-(7x1-110)"
					elseif Variant == "Rørpakke, omstøpt, 1x2xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.2x0.31)-(1x2-110)"
					elseif Variant == "Rørpakke, omstøpt, 2x2xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.34x0.31)-(2x2-110)"
					elseif Variant == "Rørpakke, omstøpt, 3x2xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.48x0.31)-(3x2-110)"
					elseif Variant == "Rørpakke, omstøpt, 4x2xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.62x0.31)-(4x2-110)"
					elseif Variant == "Rørpakke, omstøpt, 5x2xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.76x0.31)-(5x2-110)"
					elseif Variant == "Rørpakke, omstøpt, 6x2xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.9x0.31)-(6x2-110)"
					elseif Variant == "Rørpakke, omstøpt, 7x2xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(1.04x0.31)-(7x2-110)"
					elseif Variant == "Rørpakke, omstøpt, 1x3xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.2x0.45)-(1x3-110)"
					elseif Variant == "Rørpakke, omstøpt, 2x3xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.34x0.45)-(2x3-110)"
					elseif Variant == "Rørpakke, omstøpt, 3x3xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.48x0.45)-(3x3-110)"
					elseif Variant == "Rørpakke, omstøpt, 4x3xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.62x0.45)-(4x3-110)"
					elseif Variant == "Rørpakke, omstøpt, 5x3xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.76x0.45)-(5x3-110)"
					elseif Variant == "Rørpakke, omstøpt, 6x3xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.9x0.45)-(6x3-110)"
					elseif Variant == "Rørpakke, omstøpt, 7x3xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(1.04x0.45)-(7x3-110)"
					elseif Variant == "Rørpakke, omstøpt, 1x4xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.2x0.59)-(1x4-110)"
					elseif Variant == "Rørpakke, omstøpt, 2x4xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.34x0.59)-(2x4-110)"
					elseif Variant == "Rørpakke, omstøpt, 3x4xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.48x0.59)-(3x4-110)"
					elseif Variant == "Rørpakke, omstøpt, 4x4xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.62x0.59)-(4x4-110)"
					elseif Variant == "Rørpakke, omstøpt, 5x4xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.76x0.59)-(5x4-110)"
					elseif Variant == "Rørpakke, omstøpt, 6x4xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.9x0.59)-(6x4-110)"
					elseif Variant == "Rørpakke, omstøpt, 7x4xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(1.04x0.59)-(7x4-110)"
					elseif Variant == "Rørpakke, omstøpt, 1x5xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.2x0.73)-(1x5-110)"
					elseif Variant == "Rørpakke, omstøpt, 2x5xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.34x0.73)-(2x5-110)"
					elseif Variant == "Rørpakke, omstøpt, 3x5xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.48x0.73)-(3x5-110)"
					elseif Variant == "Rørpakke, omstøpt, 4x5xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.62x0.73)-(4x5-110)"
					elseif Variant == "Rørpakke, omstøpt, 5x5xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.76x0.73)-(5x5-110)"
					elseif Variant == "Rørpakke, omstøpt, 6x5xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.9x0.73)-(6x5-110)"
					elseif Variant == "Rørpakke, omstøpt, 7x5xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(1.04x0.73)-(7x5-110)"
					elseif Variant == "Rørpakke, omstøpt, 1x6xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.2x0.87)-(1x6-110)"
					elseif Variant == "Rørpakke, omstøpt, 2x6xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.34x0.87)-(2x6-110)"
                    elseif Variant == "Rørpakke, omstøpt, 3x6xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.48x0.87)-(3x6-110)"
                    elseif Variant == "Rørpakke, omstøpt, 4x6xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.62x0.87)-(4x6-110)"
                    elseif Variant == "Rørpakke, omstøpt, 5x6xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.76x0.87)-(5x6-110)"
                    elseif Variant == "Rørpakke, omstøpt, 6x6xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.9x0.87)-(6x6-110)"
                    elseif Variant == "Rørpakke, omstøpt, 7x6xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(1.04x0.87)-(7x6-110)"
					elseif Variant == "Rørpakke, omstøpt, 1x7xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.2x1.01)-(1x1-110)"
					elseif Variant == "Rørpakke, omstøpt, 2x7xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.34x1.01)-(2x1-110)"
					elseif Variant == "Rørpakke, omstøpt, 3x7xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.48x1.01)-(3x1-110)"
					elseif Variant == "Rørpakke, omstøpt, 4x7xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.62x1.01)-(4x1-110)"
					elseif Variant == "Rørpakke, omstøpt, 5x7xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.76x1.01)-(5x1-110)"
					elseif Variant == "Rørpakke, omstøpt, 6x7xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.9x1.01)-(6x1-110)"
					elseif Variant == "Rørpakke, omstøpt, 7x7xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(1.04x1.01)-(7x1-110)"
					
					elseif Variant == "Rørpakke, omstøpt, under spor, 1x1xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.31x0.31)-(1x1-110)"
					
					elseif Variant == "Rørpakke, omstøpt, 3x(3xØ110-Ø160),(3xØ110)" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.62x0.64)-(4x3-110)-(3x1-160)"
					elseif Variant == "Rørpakke, omstøpt, under spor, 2x1xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.45x0.31)-(2x1-110)"
					elseif Variant == "Rørpakke, omstøpt, under spor, 3x1xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.59x0.31)-(3x1-110)"
					elseif Variant == "Rørpakke, omstøpt, under spor, 4x1xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.73x0.31)-(4x1-110)"
					elseif Variant == "Rørpakke, omstøpt, under spor, 5x1xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.87x0.31)-(5x1-110)"
					elseif Variant == "Rørpakke, omstøpt, under spor, 6x1xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(1.01x0.31)-(6x1-110)"
					elseif Variant == "Rørpakke, omstøpt, under spor, 7x1xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(1.15x0.31)-(7x1-110)"
					elseif Variant == "Rørpakke, omstøpt, under spor, 1x2xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.31x0.45)-(1x2-110)"
					elseif Variant == "Rørpakke, omstøpt, under spor, 2x2xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.45x0.45)-(2x2-110)"
					elseif Variant == "Rørpakke, omstøpt, under spor, 3x2xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.59x0.45)-(3x2-110)"
					elseif Variant == "Rørpakke, omstøpt, under spor, 4x2xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.73x0.45)-(4x2-110)"
					elseif Variant == "Rørpakke, omstøpt, under spor, 5x2xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.87x0.45)-(5x2-110)"
					elseif Variant == "Rørpakke, omstøpt, under spor, 6x2xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(1.01x0.45)-(6x2-110)"
					elseif Variant == "Rørpakke, omstøpt, under spor, 7x2xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(1.15x0.45)-(7x2-110)"
					elseif Variant == "Rørpakke, omstøpt, under spor, 1x3xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.31x0.59)-(1x3-110)"
					elseif Variant == "Rørpakke, omstøpt, under spor, 2x3xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.45x0.59)-(2x3-110)"
					elseif Variant == "Rørpakke, omstøpt, under spor, 3x3xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.59x0.59)-(3x3-110)"
					elseif Variant == "Rørpakke, omstøpt, under spor, 4x3xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.73x0.59)-(4x3-110)"
					elseif Variant == "Rørpakke, omstøpt, under spor, 5x3xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.87x0.59)-(5x3-110)"
					elseif Variant == "Rørpakke, omstøpt, under spor, 6x3xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(1.01x0.59)-(6x3-110)"
					elseif Variant == "Rørpakke, omstøpt, under spor, 7x3xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(1.15x0.59)-(7x3-110)"
					elseif Variant == "Rørpakke, omstøpt, under spor, 1x4xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.31x0.73)-(1x4-110)"
					elseif Variant == "Rørpakke, omstøpt, under spor, 2x4xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.45x0.73)-(2x4-110)"
					elseif Variant == "Rørpakke, omstøpt, under spor, 3x4xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.59x0.73)-(3x4-110)"
					elseif Variant == "Rørpakke, omstøpt, under spor, 4x4xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.73x0.73)-(4x4-110)"
					elseif Variant == "Rørpakke, omstøpt, under spor, 5x4xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.87x0.73)-(5x4-110)"
					elseif Variant == "Rørpakke, omstøpt, under spor, 6x4xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(1.01x0.73)-(6x4-110)"
					elseif Variant == "Rørpakke, omstøpt, under spor, 7x4xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(1.15x0.73)-(7x4-110)"
					elseif Variant == "Rørpakke, omstøpt, under spor, 1x5xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.31x0.87)-(1x5-110)"
					elseif Variant == "Rørpakke, omstøpt, under spor, 2x5xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.45x0.87)-(2x5-110)"
					elseif Variant == "Rørpakke, omstøpt, under spor, 3x5xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.59x0.87)-(3x5-110)"
					elseif Variant == "Rørpakke, omstøpt, under spor, 4x5xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.73x0.87)-(4x5-110)"
					elseif Variant == "Rørpakke, omstøpt, under spor, 5x5xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.87x0.87)-(5x5-110)"
					elseif Variant == "Rørpakke, omstøpt, under spor, 6x5xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(1.01x0.87)-(6x5-110)"
					elseif Variant == "Rørpakke, omstøpt, under spor, 7x5xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(1.15x0.87)-(7x5-110)"
					elseif Variant == "Rørpakke, omstøpt, under spor, 1x6xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.31x1.01)-(1x6-110)"
					elseif Variant == "Rørpakke, omstøpt, under spor, 2x6xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.45x1.01)-(2x6-110)"
					elseif Variant == "Rørpakke, omstøpt, under spor, 3x6xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.59x1.01)-(3x6-110)"
					elseif Variant == "Rørpakke, omstøpt, under spor, 4x6xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.73x1.01)-(4x6-110)"
					elseif Variant == "Rørpakke, omstøpt, under spor, 5x6xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.87x1.01)-(5x6-110)"
					elseif Variant == "Rørpakke, omstøpt, under spor, 6x6xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(1.01x1.01)-(6x6-110)"
					elseif Variant == "Rørpakke, omstøpt, under spor, 7x6xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(1.15x1.01)-(7x6-110)"
					elseif Variant == "Rørpakke, omstøpt, under spor, 1x7xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.31x1.15)-(1x7-110)"
					elseif Variant == "Rørpakke, omstøpt, under spor, 2x7xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.45x1.15)-(2x7-110)"
					elseif Variant == "Rørpakke, omstøpt, under spor, 3x7xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.59x1.15)-(3x7-110)"
					elseif Variant == "Rørpakke, omstøpt, under spor, 4x7xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.73x1.15)-(4x7-110)"
					elseif Variant == "Rørpakke, omstøpt, under spor, 5x7xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(0.87x1.15)-(5x7-110)"
					elseif Variant == "Rørpakke, omstøpt, under spor, 6x7xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(1.01x1.15)-(6x7-110)"
					elseif Variant == "Rørpakke, omstøpt, under spor, 7x7xØ110" then return "NO-BN-2D-KU-KFØ-OMTSTØPT-RØRPAKKE-(1.15x1.15)-(7x7-110)"		
					else 
						return "???","Unrecognized variant ["..Variant.."]."
					end
				end
			</Formula>
		</LuaFunction>

		<!-- '_position' is an intrinsic variable available to sampled Lua functions. -->
		<LuaExpression Name="SweptGeometry3D_0.Offset.Z"><Formula>_JBTKU_KFR_Offset3DZ(_position)</Formula></LuaExpression>
		<LuaFunction Name="_JBTKU_KFR_Offset3DZ()" ReturnType="String" HideFromUser="false"
				Description="Returns the tube package default elevation, interpolated linearly from the nearest manhole (or track) close to each end. Must be called with '_position' as input argument (_position.ref = alignment GUID, _position.pos = distAlong).">
			<Signature>Double _JBTKU_KFR_Offset3DZ(_position)</Signature>
			<Formula>
				function _JBTKU_KFR_Offset3DZ(cursor)
					--Draw concrete encased tubes in a straight line from one end to the other
				
					local p1 = RcAlignment.StartPoint
					local p2 = RcAlignment.EndPoint
					local t1 = getNearbyAlignments(getPoint3D(p1.X,p1.Y))[0]
					local t2 = getNearbyAlignments(getPoint3D(p2.X,p2.Y))[0]
					local m1 = getNearbyPointObjects2D(p1, 2.5, rctype_CablePit)
					local m2 = getNearbyPointObjects2D(p2, 2.5, rctype_CablePit)
					local n1 = getCollectionLength(m1)
					local n2 = getCollectionLength(m2)
					local z1, z2
				
					if n1 + n2 == 0 then
						--Manhole not found at start nor at end:
						z1 = getAlignmentInfo(t1.id,p1.X,p1.Y).Elevation + StartPointVerticalOffset
						z2 = getAlignmentInfo(t2.id,p2.X,p2.Y).Elevation + EndPointVerticalOffset
					elseif n2 == 0 then
						--Manhole found at start, none found at end:
						z1 = m1[0].geoCoord.Z + StartPointVerticalOffset
						z2 = getAlignmentInfo(t2.id,p2.X,p2.Y).Elevation + EndPointVerticalOffset
					elseif n1 == 0 then
						--Manhole found at end, none found at start:
						z1 = getAlignmentInfo(t1.id,p1.X,p1.Y).Elevation + StartPointVerticalOffset
						z2 = m2[0].geoCoord.Z + EndPointVerticalOffset
					else
						--Manhole found at start and at end:
						z1 = m1[0].geoCoord.Z + StartPointVerticalOffset
						z2 = m2[0].geoCoord.Z + EndPointVerticalOffset
					end
					--if true then return z1,z2,StartPointVerticalOffset,EndPointVerticalOffset end --DEBUG
				
					local dZ = z2 - z1
					local dL = RcAlignment.HorizontalGeometry.Length
					local slope = dZ/dL
				
					local distAlong = cursor.pos
					local Z = z1 + slope*distAlong
					return  Z
				end
			</Formula>
		</LuaFunction>

		<PropertyPrompt Key="code" DefaultValue="Omstøpt rørpakke" AcceptEmptyValue="false"/>

		<InsertAlignment Name="Rørpakke, omstøpt, 1x2xØ110" DisplayBlockName="NO-BN-2D-JBTRC_THUMBNAIL-KABELFOERING-OMSTOEPTE-TREKKEROER-Schematic" DefaultToTangentContinuity="true">
			<IncludeSegmentType>Tangent</IncludeSegmentType>
			<IncludeSegmentType>Curve</IncludeSegmentType>
		</InsertAlignment>
		<InsertAlignment Name="Rørpakke, omstøpt, 2x2xØ110" DisplayBlockName="NO-BN-2D-JBTRC_THUMBNAIL-KABELFOERING-OMSTOEPTE-TREKKEROER-Schematic" DefaultToTangentContinuity="true">
			<IncludeSegmentType>Tangent</IncludeSegmentType>
			<IncludeSegmentType>Curve</IncludeSegmentType>
		</InsertAlignment>
		<InsertAlignment Name="Rørpakke, omstøpt, 3x2xØ110" DisplayBlockName="NO-BN-2D-JBTRC_THUMBNAIL-KABELFOERING-OMSTOEPTE-TREKKEROER-Schematic" DefaultToTangentContinuity="true">
			<IncludeSegmentType>Tangent</IncludeSegmentType>
			<IncludeSegmentType>Curve</IncludeSegmentType>
		</InsertAlignment>
		<InsertAlignment Name="Rørpakke, omstøpt, 4x2xØ110" DisplayBlockName="NO-BN-2D-JBTRC_THUMBNAIL-KABELFOERING-OMSTOEPTE-TREKKEROER-Schematic" DefaultToTangentContinuity="true">
			<IncludeSegmentType>Tangent</IncludeSegmentType>
			<IncludeSegmentType>Curve</IncludeSegmentType>
		</InsertAlignment>
		<InsertAlignment Name="Rørpakke, omstøpt, 1x3xØ110" DisplayBlockName="NO-BN-2D-JBTRC_THUMBNAIL-KABELFOERING-OMSTOEPTE-TREKKEROER-Schematic" DefaultToTangentContinuity="true">
			<IncludeSegmentType>Tangent</IncludeSegmentType>
			<IncludeSegmentType>Curve</IncludeSegmentType>
		</InsertAlignment>
		<InsertAlignment Name="Rørpakke, omstøpt, 2x3xØ110" DisplayBlockName="NO-BN-2D-JBTRC_THUMBNAIL-KABELFOERING-OMSTOEPTE-TREKKEROER-Schematic" DefaultToTangentContinuity="true">
			<IncludeSegmentType>Tangent</IncludeSegmentType>
			<IncludeSegmentType>Curve</IncludeSegmentType>
		</InsertAlignment>
		<InsertAlignment Name="Rørpakke, omstøpt, 3x3xØ110" DisplayBlockName="NO-BN-2D-JBTRC_THUMBNAIL-KABELFOERING-OMSTOEPTE-TREKKEROER-Schematic" DefaultToTangentContinuity="true">
			<IncludeSegmentType>Tangent</IncludeSegmentType>
			<IncludeSegmentType>Curve</IncludeSegmentType>
		</InsertAlignment>
		<InsertAlignment Name="Rørpakke, omstøpt, 4x3xØ110" DisplayBlockName="NO-BN-2D-JBTRC_THUMBNAIL-KABELFOERING-OMSTOEPTE-TREKKEROER-Schematic" DefaultToTangentContinuity="true">
			<IncludeSegmentType>Tangent</IncludeSegmentType>
			<IncludeSegmentType>Curve</IncludeSegmentType>
		</InsertAlignment>
		<InsertAlignment Name="Rørpakke, omstøpt, 1x4xØ110" DisplayBlockName="NO-BN-2D-JBTRC_THUMBNAIL-KABELFOERING-OMSTOEPTE-TREKKEROER-Schematic" DefaultToTangentContinuity="true">
			<IncludeSegmentType>Tangent</IncludeSegmentType>
			<IncludeSegmentType>Curve</IncludeSegmentType>
		</InsertAlignment>
		<InsertAlignment Name="Rørpakke, omstøpt, 2x4xØ110" DisplayBlockName="NO-BN-2D-JBTRC_THUMBNAIL-KABELFOERING-OMSTOEPTE-TREKKEROER-Schematic" DefaultToTangentContinuity="true">
			<IncludeSegmentType>Tangent</IncludeSegmentType>
			<IncludeSegmentType>Curve</IncludeSegmentType>
		</InsertAlignment>
		<InsertAlignment Name="Rørpakke, omstøpt, 3x4xØ110" DisplayBlockName="NO-BN-2D-JBTRC_THUMBNAIL-KABELFOERING-OMSTOEPTE-TREKKEROER-Schematic" DefaultToTangentContinuity="true">
			<IncludeSegmentType>Tangent</IncludeSegmentType>
			<IncludeSegmentType>Curve</IncludeSegmentType>
		</InsertAlignment>
		<InsertAlignment Name="Rørpakke, omstøpt, 4x4xØ110" DisplayBlockName="NO-BN-2D-JBTRC_THUMBNAIL-KABELFOERING-OMSTOEPTE-TREKKEROER-Schematic" DefaultToTangentContinuity="true">
			<IncludeSegmentType>Tangent</IncludeSegmentType>
			<IncludeSegmentType>Curve</IncludeSegmentType>
		</InsertAlignment>
		<InsertAlignment Name="Rørpakke, omstøpt, 3x(3xØ110-Ø160),(3xØ110)" DisplayBlockName="NO-BN-2D-JBTRC_THUMBNAIL-KABELFOERING-OMSTOEPTE-TREKKEROER-Schematic" DefaultToTangentContinuity="true">
			<IncludeSegmentType>Tangent</IncludeSegmentType>
			<IncludeSegmentType>Curve</IncludeSegmentType>
		</InsertAlignment>
	</ObjectType>
			


<!--========================================================================================================
	CIVIL WORKS
	CABLE DUCTS
	JBTKU_KFP Pressrør
	Tube packages made from hard polymere or steel, where cables may NOT enter or exit except at the ends. 
	TODO: Avklare med Bane NOR om OBJEKTID-koden kan benyttes,
 =========================================================================================================-->
	<ObjectType DataType="tElementWithAlignment" Class="RailwayAlignment" LuaName="rctype_UnderTrackCrossingSteel" Name="JBTKU_KFP Pressrør"
				Layer="JBTKU_KFP" Color="ByLayer" 
				Group="Underbygning/Føringsveier/Pressrør"
				>

		<RelationSpace>pressrør</RelationSpace>

		<xpp:expand select="NOBN_com_DEROGATION"/>
		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___VAR"/>
		<xpp:expand select="NOBN_com_DISCIPLINE___SUB"/>
		<xpp:expand select="NOBN_com_PSET_BANE_NOR"/>
		<xpp:expand select="NOBN_com_PSET_FDV_BANEDATA"/>
		<xpp:expand select="NOBN_com_PSET_ISY_STK"/>
		<xpp:expand select="NOBN_com_PSET_TITTELFELT"/>
		<xpp:expand select="NOBN_com_PSET_FDV_BANEDATA_KU_KFØ"/>

		<!-- TODO Fjerne AlignmentSystem? -->
		<AlignmentSystems DefaultSystemName="Kabelføring">
			<AlignmentSystem Name="Kabelføring"
				CantGauge="0.000"
				AlignmentGauge="0.000"
				LiftWithCant="false"
			 />
		</AlignmentSystems>

		<Variants DefaultValue="Pressrør Ø160 uten subrør">
			<Variant Name="Pressrør Ø160 uten subrør"/>
			<Variant Name="Pressrør Ø400 uten subrør"/>
		</Variants>

		<DynamicProperty Type="Representation3D" Subtype="IteratedAnnotion3D">
			<SetValue Key="Frozen" Value="False"/>
			<SetValue Key="CustomTransformation" Value="False"/>
		</DynamicProperty>

		<LuaExpression Name="name"><Formula>code.." ("..Variant..")"</Formula></LuaExpression>

		<LuaExpression Name="Linetype"><Formula>_JBTKU_KFP_Linetype()</Formula></LuaExpression>
		<LuaFunction Name="_JBTKU_KFP_Linetype()" 
				ReturnType="String"
				HideFromUser="false"
				Description="Returns the CAD system 2D presentation line type for the stiff tube package, based on its Variant.">
			<Signature>String _JBTKU_KFP_Linetype()</Signature>
			<Formula>
				function _JBTKU_KFP_Linetype()
					return "Continuous" --(same enum for alle language packs)
				end
			</Formula>
		</LuaFunction>

		<LuaExpression Name="GlobalWidth"><Formula>_JBTKU_KFOE__JBTKU_KFP_GlobalWidth()</Formula></LuaExpression>
		<LuaFunction Name="_JBTKU_KFOE__JBTKU_KFP_GlobalWidth()" 
				ReturnType="Double"
				HideFromUser="false"
				Description="Returns the global width of the stiff  tube package's 2D representation as a wide polyline.">
			<Signature>Double _JBTKU_KFOE__JBTKU_KFP_GlobalWidth()</Signature>
			<Formula>
				function _JBTKU_KFOE__JBTKU_KFP_GlobalWidth()
					if Variant:match("Pressrør Ø160") then return 0.160
					elseif Variant:match("Pressrør Ø400") then return 0.400
					else
						return 1.0, _info("Variant ["..Variant.."] has not been anticipated yet.")
					end
				end
			</Formula>
		</LuaFunction>

		<LuaExpression Name="SweptGeometry3D_0.Name"><Formula>_JBTKU_KFP_Geometry3DName()</Formula></LuaExpression>
		<LuaFunction Name="_JBTKU_KFP_Geometry3DName()" 
				ReturnType="String"
				HideFromUser="false"
				Description="Returns the tube package default 3D object model name.">
			<Signature>Double _JBTKU_KFP_Geometry3DName()</Signature>
			<Formula>
				function _JBTKU_KFP_Geometry3DName()
					local t = "NO-BN-2D-KU-KFØ-PRESSRØR-DIAMETER-"
					if Variant:match("Pressrør Ø160") then return t.."144-160-TOMT"
					elseif Variant:match("Pressrør Ø400") then return t.."360-400-TOMT"
					else 
						return "", _info("Variant ["..Variant.."] has not been anticipated yet.")
					end
				end
			</Formula>
		</LuaFunction>

		<PropertyPrompt Key="code" DefaultValue="Pressrør" AcceptEmptyValue="false"/>

		<!-- Only straight segments (tangents) allowed - steel tubes don't bend... -->
		<InsertAlignment Name="Pressrør Ø160 uten subrør" DisplayBlockName="NO-BN-2D-JBTRC_THUMBNAIL-KABELFOERING-PRESSROER-Schematic" DefaultToTangentContinuity="true">
			<IncludeSegmentType>Tangent</IncludeSegmentType>
		</InsertAlignment>

		<InsertAlignment Name="Pressrør Ø400 uten subrør" DisplayBlockName="NO-BN-2D-JBTRC_THUMBNAIL-KABELFOERING-PRESSROER-Schematic" DefaultToTangentContinuity="true">
			<IncludeSegmentType>Tangent</IncludeSegmentType>
		</InsertAlignment>

	</ObjectType>

			

<!--========================================================================================================
	CIVIL WORKS
	CABLE DUCTS
	KU-KFØ Trekkerør
	Flexible tube made from plastic, rubber, corrugated steel or combinations thereof, where cables may 
	NOT enter or exit except at the ends. Usually only one cable fits per tube. Usually, tubes are not 
	protected by concrete ducts, but rather connect the well-protected concrete ducts with objects in
	the track or nearby a railway track.
	TODO: Avklare med Bane NOR om OBJEKTID-koden kan benyttes,
 =========================================================================================================-->
	<ObjectType DataType="tElementWithAlignment" Class="RailwayAlignment" LuaName="rctype_FlexibleTube" Name="JBTKU_KFT Trekkerør"
				Layer="JBTKU_KFT" Color="ByLayer" 
				Group="Underbygning/Føringsveier/Trekkerør"
				>

		<RelationSpace>trekkerør</RelationSpace>

		<xpp:expand select="NOBN_com_DEROGATION"/>
		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___VAR"/>
		<xpp:expand select="NOBN_com_STD_TEXTATTRIBUTES___HORIZONTAL_AND_CLOSE___SUB"/>
		<xpp:expand select="NOBN_com_DISCIPLINE___SUB"/>
		<xpp:expand select="NOBN_com_PSET_BANE_NOR"/>
		<xpp:expand select="NOBN_com_PSET_FDV_BANEDATA"/>
		<xpp:expand select="NOBN_com_PSET_ISY_STK"/>
		<xpp:expand select="NOBN_com_PSET_TITTELFELT"/>
		<xpp:expand select="NOBN_com_PSET_FDV_BANEDATA_KU_KFØ"/>

		<!-- TODO Fjerne AlignmentSystem? -->
		<AlignmentSystems DefaultSystemName="Kabelføring">
			<AlignmentSystem Name="Kabelføring"
				CantGauge="0.000"
				AlignmentGauge="0.000"
				LiftWithCant="false"
			 />
		</AlignmentSystems>

		<LuaExpression Name="name"><Formula>code.." ("..Variant..")"</Formula></LuaExpression>

		<DynamicProperty Type="Representation3D" Subtype="SweptGeometry3D">
			<!-- Use custom transformation, we need formulas to set the Z coordinate relative to the start/end of the tube where it picks up a cable duct Z. -->
			<SetValue Key="CustomTransformation" Value="True"/>
		</DynamicProperty>

		<LuaExpression Name="Linetype"><Formula>_JBTKU_KFT_Linetype()</Formula></LuaExpression>
		<LuaFunction Name="_JBTKU_KFT_Linetype()"
				ReturnType="String"
				HideFromUser="false"
				Description="Returns the CAD system 2D presentation line type for the flexible tube, based on its Variant.">
			<Signature>String _JBTKU_KFT_Linetype()</Signature>
			<!-- TODO 2021-05-16 CLFEY Implement ZIGZAG line for flexible tubes -->
			<Formula>
				function _JBTKU_KFT_Linetype()
					return "Continuous" --(same enum for alle language packs)
				end
			</Formula>
		</LuaFunction>

		<LuaExpression Name="GlobalWidth"><Formula>_JBTKU_KFT_GlobalWidth()</Formula></LuaExpression>
		<LuaFunction Name="_JBTKU_KFT_GlobalWidth()" ReturnType="Double"
				HideFromUser="false"
				Description="Returns the global width of the flexible tube's 2D representation as a wide polyline.">
			<Signature>Double _JBTKU_KFT_GlobalWidth()</Signature>
			<Formula>
				function _JBTKU_KFT_GlobalWidth()
					if Variant:match("Ø50") then return 0.050
					elseif Variant:match("Ø75") then return 0.075
					elseif Variant:match("Ø110") then return 0.110
					elseif Variant:match("Ø125") then return 0.125
					elseif Variant:match("Ø160") then return 0.160
					else 
						return 0, _info("Variant ["..Variant.."] has not been anticipated yet.")
					end
				end
			</Formula>
		</LuaFunction>

		<LuaExpression Name="SweptGeometry3D_0.Name"><Formula>_JBTKU_KFT_Geometry3DName()</Formula></LuaExpression>
		<LuaFunction Name="_JBTKU_KFT_Geometry3DName()" 
				ReturnType="String"
				HideFromUser="false"
				Description="Returns the flexible tube default 3D object model name.">
			<Signature>String _JBTKU_KFT_Geometry3DName()</Signature>
			<Formula>
				function _JBTKU_KFT_Geometry3DName()
					local t = "NO-BN-2D-KU-KFØ-TREKKERØR-RØD-DIAMETER-"
					if Variant:match("Ø50") then return t.."042-050"
					elseif Variant:match("Ø75") then return t.."063-075"
					elseif Variant:match("Ø110") then return t.."094-110"
					elseif Variant:match("Ø125") then return t.."108-125"
					elseif Variant:match("Ø160") then return t.."138-160"
					else
						return "", _info("Variant ["..Variant.."] has not been anticipated yet.")
					end
				end
			</Formula>
		</LuaFunction>


		<!-- '_position' is an intrinsic variable available to sampled Lua functions. -->
		<LuaExpression Name="SweptGeometry3D_0.Offset.Z"><Formula>_JBTKU_KFT_Offset3DZ(_position)</Formula></LuaExpression>
		<LuaFunction Name="_JBTKU_KFT_Offset3DZ()" 
				ReturnType="Double"
				HideFromUser="false"
				Description="Returns the flexible tube Z offset along the geometry, relative to the duct bottom located at the start of the tube's alignment geometry. Must be called with '_position' as input argument (_position.ref = alignment GUID, _position.pos = distAlong).">
			<Signature>Double _JBTKU_KFT_Offset3DZ(SampledPosition _position)</Signature>
			<Formula>
				function _JBTKU_KFT_Offset3DZ(cursor)
					local P1 = RcAlignment.StartPoint
					local ducts = getNearbyAlignments(getPoint3D(P1.X,P1.Y), rctype_CableTrough)
					if getCollectionLength(ducts) == 0 then
						return 0, _info("UNFINISHED - No cable duct found at flexible tube's geometry start point.")
					end
					local Zref = getAlignmentInfo(ducts[0].id,P1.X,P1.Y).Point.Z
					
					local ini = 0.2		--Length of initial level part
					local c = 0.8		--Length of cosine part
					local h1 = 0.1		--Start at bottom duct level +h1, make a cosine bend down to bottom duct -h1 
					local r = 0.5		--After horizontal movement, bend up from Zref-h1 as a quarter-circle with radius r 
					local h2 = 0.4		--Finally, rise another h2, close to the tube's end (at the object to feed)
					local d = 0.1		--Horizontal length of the last steep ascent
					
					local L = RcAlignment.HorizontalGeometry.Length --2D length of the tube's geometry
					local L1 = ini		--Start cosine bend
					local L2 = L1+c		--End of cosine, start horizontal part
					local L3 = L-d-r	--Start of arc
					local L4 = L-d		--End of arc, start of steep ascent
					if L &lt; ini+c+r+d then 
						return 0, _info("UNFINISHED - Tube geometry is too short to generate Z offset.")
					end
					
					local p = cursor.pos	--Our 'cursor' running along the geometry from 0 to L
					
					if p &lt; L1 then --horizontal
						return Zref + h1
					
					elseif p &lt; L2 then --cosine
						return Zref + h1*math.cos(math.pi*((p-L1)/c))
					
					elseif p &lt; L3 then --horizontal
						return Zref - h1
					
					elseif p &lt; L4 then --circular arc
						return Zref - h1 + r*(1 - math.sqrt(1 -((p-L3)/r)^2))
					
					else 
						return Zref - h1 + r + h2*(p-L4)/d
					end
				end
			</Formula>
		</LuaFunction>

		<Variants DefaultValue="Trekkerør, Ø50">
			<Variant Name="Trekkerør, Ø50"/>
			<Variant Name="Trekkerør, Ø75"/>
			<Variant Name="Trekkerør, Ø110"/>
			<Variant Name="Trekkerør, Ø125"/>
			<Variant Name="Trekkerør, Ø160"/>
		</Variants>

		<PropertyPrompt Key="code" DefaultValue="Trekkerør" AcceptEmptyValue="false"/>

		<InsertAlignment Name="Trekkerør, Ø50" DisplayBlockName="NO-BN-2D-JBTRC_THUMBNAIL-KABELFOERING-TREKKEROER-Schematic" DefaultToTangentContinuity="true">
			<IncludeSegmentType>Tangent</IncludeSegmentType>
			<IncludeSegmentType>Curve</IncludeSegmentType>
		</InsertAlignment>
		<InsertAlignment Name="Trekkerør, Ø75" DisplayBlockName="NO-BN-2D-JBTRC_THUMBNAIL-KABELFOERING-TREKKEROER-Schematic" DefaultToTangentContinuity="true">
			<IncludeSegmentType>Tangent</IncludeSegmentType>
			<IncludeSegmentType>Curve</IncludeSegmentType>
		</InsertAlignment>
		<InsertAlignment Name="Trekkerør, Ø110" DisplayBlockName="NO-BN-2D-JBTRC_THUMBNAIL-KABELFOERING-TREKKEROER-Schematic" DefaultToTangentContinuity="true">
			<IncludeSegmentType>Tangent</IncludeSegmentType>
			<IncludeSegmentType>Curve</IncludeSegmentType>
		</InsertAlignment>
		<InsertAlignment Name="Trekkerør, Ø125" DisplayBlockName="NO-BN-2D-JBTRC_THUMBNAIL-KABELFOERING-TREKKEROER-Schematic" DefaultToTangentContinuity="true">
			<IncludeSegmentType>Tangent</IncludeSegmentType>
			<IncludeSegmentType>Curve</IncludeSegmentType>
		</InsertAlignment>
		<InsertAlignment Name="Trekkerør, Ø160" DisplayBlockName="NO-BN-2D-JBTRC_THUMBNAIL-KABELFOERING-TREKKEROER-Schematic" DefaultToTangentContinuity="true">
			<IncludeSegmentType>Tangent</IncludeSegmentType>
			<IncludeSegmentType>Curve</IncludeSegmentType>
		</InsertAlignment>

	</ObjectType>
			


<!--========================================================================================================
	CIVIL WORKS
	CABLE DUCTS
	JBTKU_KFØ Trekkekum
	Cable pit / manhole - generally made out of concrete, may otherwise be made out of hard polymere or steel.

	TODO: 
	Redefine cable pits (manholes) as a connection object for cable ducts. Modify distance(), getUpObject() etc to work
	with cable ducts as a network, isolated from the track network.
	
 =========================================================================================================-->
	<ObjectType DataType="tOrientedElement" Class="RailwayPlacedObject" LuaName="rctype_CablePit" Name="JBTKU_KFØ Trekkekum"
				Layer="JBTKU_KFØ_TREKKEKUM" Color="ByLayer" 
				Group="Underbygning/Føringsveier"
				AttMirrorY="{% if RightSided %}true{% else %}false{% endif %}"
				>

		<RelationSpace>trekkekum</RelationSpace>

		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___SYMBOLFRAME"/>
		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___VAR"/>
		<xpp:expand select="NOBN_com_STD_TEXATTRIBUTES___VERTICAL_AND_FAR___SUB"/>
		<xpp:expand select="NOBN_com_DISCIPLINE___SUB"/>
		<xpp:expand select="NOBN_com_CHK_NUMBER_OF_OCP_AREAS"/>
		<xpp:expand select="NOBN_com_SET_OCP_STATION_REFERENCE"/>
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___WAYSIDE_GENERAL_OBJECT"/>
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___EARTHED_TO_NONE"/>
		<xpp:expand select="NOBN_com_PSET_BANE_NOR"/>
		<xpp:expand select="NOBN_com_PSET_FDV_BANEDATA"/>
		<xpp:expand select="NOBN_com_PSET_ISY_STK"/>
		<xpp:expand select="NOBN_com_PSET_TITTELFELT"/>
		<xpp:expand select="NOBN_com_PSET_FDV_BANEDATA_KU_KFØ"/>
		
		<Variants DefaultValue="Trekkekum Ø=1400 H=1350">
			<Variant Name="Trekkekum Ø=1400 H=1350">
				<SetValue Key="ManholeDiameter" Value="1400"/>
				<SetValue Key="ManholeLength" Value="0"/>
				<SetValue Key="ManholeDepth" Value="0"/>
				<SetValue Key="ManholeHeight" Value="1350"/>
			</Variant>
			<Variant Name="Trekkekum L=1600 D=900 H=900">
				<SetValue Key="ManholeDiameter" Value="0"/>
				<SetValue Key="ManholeLength" Value="1600"/>
				<SetValue Key="ManholeDepth" Value="900"/>
				<SetValue Key="ManholeHeight" Value="900"/>
			</Variant>
			<Variant Name="Trekkekum L=1400 D=1400 H=1600">
				<SetValue Key="ManholeDiameter" Value="0"/>
				<SetValue Key="ManholeLength" Value="1400"/>
				<SetValue Key="ManholeDepth" Value="1400"/>
				<SetValue Key="ManholeHeight" Value="1600"/>
			</Variant>
			<Variant Name="Trekkekum L=2300 D=2300 H=2400, 3-veis">
				<SetValue Key="ManholeDiameter" Value="0"/>
				<SetValue Key="ManholeLength" Value="2300"/>
				<SetValue Key="ManholeDepth" Value="2300"/>
				<SetValue Key="ManholeHeight" Value="2400"/>
			</Variant>
			<Variant Name="Trekkekum L=2300 D=2300 H=2400, 4-veis">
				<SetValue Key="ManholeDiameter" Value="0"/>
				<SetValue Key="ManholeLength" Value="2300"/>
				<SetValue Key="ManholeDepth" Value="2300"/>
				<SetValue Key="ManholeHeight" Value="2400"/>
			</Variant>
			<Variant Name="Trekkekum, brukerdefinert, rund">
				<SetValue Key="ManholeDiameter" Value="1000"/>
				<SetValue Key="ManholeLength" Value="0"/>
				<SetValue Key="ManholeDepth" Value="0"/>
				<SetValue Key="ManholeHeight" Value="1000"/>
			</Variant>
			<Variant Name="Trekkekum, brukerdefinert, rektangulær">
				<SetValue Key="ManholeDiameter" Value="0"/>
				<SetValue Key="ManholeLength" Value="1000"/>
				<SetValue Key="ManholeDepth" Value="1000"/>
				<SetValue Key="ManholeHeight" Value="1000"/>
			</Variant>
		</Variants>

		<CustomProperty DataType="UInt32" Name="ManholeDiameter" DisplayName="Trekkekum diameter" DefaultValue="0"
			Description="The manhole diameter (exterior dimension) [mm]."/>

		<CustomProperty DataType="UInt32" Name="ManholeLength" DisplayName="Trekkekum lengde" DefaultValue="0"
			Description="The manhole length (exterior dimension measured along its own alignment) [mm]."/>

		<CustomProperty DataType="UInt32" Name="ManholeDepth" DisplayName="Trekkekum dybde" DefaultValue="0"
			Description="The manhole depth (exterior dimension measured perpendicularly to its own alignment) [mm]."/>

		<CustomProperty DataType="UInt32" Name="ManholeHeight" DisplayName="Trekkekum høyde" DefaultValue="0"
			Description="The manhole height (exterior dimension) [mm].">
		</CustomProperty>

		<CustomProperty DataType="Enumeration" Name="ManholeDisplayMode" DisplayName="Trekkekum visningsmodus" DefaultValue="Closed"
			Description="The manhole shown as closed (Lukket) with its top plate, or open (Åpen) without its top plate.">
			<Values>
				<Value DisplayName="Lukket">Closed</Value>
				<Value DisplayName="Åpen">Open</Value>
			</Values>
		</CustomProperty>

		<LuaExpression Name="code"><Formula>_JBTKU_KFOE_manhole_code()</Formula></LuaExpression>
		<LuaFunction Name="_JBTKU_KFOE_manhole_code()" ReturnType="String"
			Description="Obtains the code for the manhole, as a concatenation of the manhole's reference mileage km-value and the current 'Seq' local variable.">
			<Signature>String _JBTKU_KFOE_manhole_code()</Signature>
			<Formula>
				function _JBTKU_KFOE_manhole_code()
					local entireKm = math.floor(ReferenceMileage/1000)
					return string.format("TK-%d-%02d",entireKm,Seq), _info("Manhole's code is inherited from reference mileage ("..ReferenceMileage..") and the local variable Seq ("..Seq..").")
				end
			</Formula>
		</LuaFunction>

		<LuaExpression Name="name"><Formula>code.." ("..Variant..")"</Formula></LuaExpression>

		<LuaExpression Name="LateralOffset"><Formula>_JBTKU_KFOE_manhole_LateralOffset()</Formula></LuaExpression>
		<LuaFunction Name="_JBTKU_KFOE_manhole_LateralOffset()" 
				ReturnType="Double"
				Description="Returns manhole's default distance to its alignment.">
			<Signature>Double _JBTKU_KFOE_manhole_LateralOffset()</Signature>
			<Formula>
				function _JBTKU_KFOE_manhole_LateralOffset() 
					local MinFreeProfile = 2.52 --Bane NOR TRV value
					local d
					if ManholeDiameter &gt; 0 then
						--Should "touch" MinFreeProfile, insertion point = center manhole at Top-of-rail
						d = MinFreeProfile + ManholeDiameter/2000.0
					elseif ManHoleLength &gt; 0 and ManHoleDepth &gt; 0 then
						--Should "touch" MinFreeProfile, insertion point = midpoint long side towards track at Top-of-rail
						if dir == "both" then d = MinFreeProfile + 0.0
						elseif dir == "none" then d = MinFreeProfile + ManholeDepth/1000.0
						elseif dir == "up" then d = MinFreeProfile + ManholeLength/2000.0
						elseif dir == "down" then d = MinFreeProfile + ManholeLength/2000.0
						else return 1e-3, _info("UNFINISHED - Unknown direction") 
						end
					else
						return 1e-3, _info("Variant ["..Variant.."] has not been anticipated yet.")
					end
					return RightSided and d or -d, _info("Distance to alignment deduced from direction and from manhole dimensions.")
				end
			</Formula>
		</LuaFunction>

		<LuaExpression Name="Geometry3D_0.Name"><Formula>_JBTKU_KFOE_manhole_Geometry3DName()</Formula></LuaExpression>
		<LuaFunction Name="_JBTKU_KFOE_manhole_Geometry3DName()" 
				ReturnType="String"
				Description="Returns manhole's default 3D object model name.">
			<Signature>String _JBTKU_KFOE_manhole_Geometry3DName()</Signature>
			<Formula>
				function _JBTKU_KFOE_manhole_Geometry3DName()
					if ManholeDiameter == 0 and (ManholeLength == 0 and ManholeDepth == 0) then --AND: all are zero...
						return "NO-BN-3D-FE-DIV-UKJENT",
							_info("Dimensions are missing, set either Diameter or Length/Depth to their intended values.")
					elseif ManholeDiameter == 0 and (ManholeLength == 0 or ManholeDepth == 0) then --OR: still missing something...
						return "NO-BN-3D-FE-DIV-UKJENT",
							_info("Both of Length and Depth must be non-zero when Diameter is zero.")
					elseif ManholeDiameter &gt; 0 and (ManholeLength &gt; 0 or ManholeDepth &gt; 0) then
						return "NO-BN-3D-FE-DIV-UKJENT",
							_info("Length/Depth must be set to zero when Diameter is non-zero.")
					elseif ManholeHeight == 0 then
						return "NO-BN-3D-FE-DIV-UKJENT",
							_info("Manhole Height must be non-zero [mm].")
					end
					local tOpenOrClosed = (ManholeDisplayMode == "CLOSED") and "-MED-LOKK" or ""
					if ManholeDiameter &gt; 0 then
						--Cylindrical manhole:
						return "NO-BN-3D-KU-KFØ-TREKKEKUM-Ø"..ManholeDiameter.."-H"..ManholeHeight..tOpenOrClosed
					else
						--Cubic manhole:
						local numberOfOrifices = Variant:lower():match("(%d+)%-veis")
						if numberOfOrifices == nil then
							return "NO-BN-3D-KU-KFØ-TREKKEKUM-L"..ManholeLength.."-D"..ManholeDepth.."-H"..ManholeHeight..tOpenOrClosed
						else
							return "NO-BN-3D-KU-KFØ-TREKKEKUM-L"..ManholeLength.."-D"..ManholeDepth.."-H"..ManholeHeight.."-"..numberOfOrifices.."-VEIS"..tOpenOrClosed
						end
					end
				end
			</Formula>
		</LuaFunction>

		<!-- TODO: Lage 2D-symbol for trekkekum variantene -->
		<!-- Note: Snap distance is set quite low to ensure snapping to the intended track. Formulas adjust distance afterwards. -->
		<InsertPointObject Name="Trekkekum Ø=1400 H=1350" DisplayBlockName="NO-BN-2D-JBTKU_KFØ-TREKKEKUM-RUND-1400-{{SymbolMode}}" 
				DefaultSnapMode="Alignment" SnapToAlignment="true" SnapDistance="1.5">
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="true" RotateIfRightSideOfAlignment="true"/>
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<SetValue Key="dir" Value="both"/>
		</InsertPointObject>

		<InsertPointObject Name="Trekkekum L=1600 D=900 H=900" DisplayBlockName="NO-BN-2D-JBTKU_KFØ-TREKKEKUM-L1600-D900-{{SymbolMode}}" 
				DefaultSnapMode="Alignment" SnapToAlignment="true" SnapDistance="1.5">
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="true" RotateIfRightSideOfAlignment="true"/>
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<SetValue Key="dir" Value="both"/>
		</InsertPointObject>

		<InsertPointObject Name="Trekkekum L=1400 D=1400 H=1600" DisplayBlockName="NO-BN-2D-JBTKU_KFØ-TREKKEKUM-L1400-D1400-{{SymbolMode}}" 
				DefaultSnapMode="Alignment" SnapToAlignment="true" SnapDistance="1.5">
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="true" RotateIfRightSideOfAlignment="true"/>
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<SetValue Key="dir" Value="both"/>
		</InsertPointObject>

		<InsertPointObject Name="Trekkekum L=2300 D=2300 H=2400, 3-veis" DisplayBlockName="NO-BN-2D-JBTKU_KFØ-TREKKEKUM-L2300-D2300-{{SymbolMode}}" 
				DefaultSnapMode="Alignment" SnapToAlignment="true" SnapDistance="1.5">
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="true" RotateIfRightSideOfAlignment="true"/>
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<SetValue Key="dir" Value="both"/>
		</InsertPointObject>

		<InsertPointObject Name="Trekkekum L=2300 D=2300 H=2400, 4-veis" DisplayBlockName="NO-BN-2D-JBTKU_KFØ-TREKKEKUM-L2300-D2300-{{SymbolMode}}" 
				DefaultSnapMode="Alignment" SnapToAlignment="true" SnapDistance="1.5">
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="true" RotateIfRightSideOfAlignment="true"/>
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<SetValue Key="dir" Value="both"/>
		</InsertPointObject>

		<InsertPointObject Name="Trekkekum, brukerdefinert, rund" DisplayBlockName="NO-BN-2D-JBTRC_THUMBNAIL-TREKKEKUM-RUND-{{SymbolMode}}" 
				DefaultSnapMode="Alignment" SnapToAlignment="true" SnapDistance="1.5">
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="true" RotateIfRightSideOfAlignment="true"/>
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<SetValue Key="dir" Value="both"/>
		</InsertPointObject>

		<InsertPointObject Name="Trekkekum, brukerdefinert, rektangulær" DisplayBlockName="NO-BN-2D-JBTRC_THUMBNAIL-TREKKEKUM-REKTANGULAER-{{SymbolMode}}" 
				DefaultSnapMode="Alignment" SnapToAlignment="true" SnapDistance="1.5">
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="true" RotateIfRightSideOfAlignment="true"/>
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<SetValue Key="dir" Value="both"/>
		</InsertPointObject>

		<SymbolDefinition DefaultBlockName="NO-BN-2D-JBTRC_THUMBNAIL_USPESIFISERT" AllowSymbolMove="true">
			<Rotation Add180DegreesIfDirIsDown="false" AddAngle="{% if dir == 'up' %}{{270.0|plus:AngularOffset}}
														{% elsif dir == 'down' %}{{90.0|plus:AngularOffset}}
														{% elsif dir == 'both' and RightSided %}{{180.0|plus:AngularOffset}}
														{% elsif dir == 'both' and LeftSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and RightSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and LeftSided %}{{180.0|plus:AngularOffset}}
														{% else %}45.0
														{% endif %}"/>	
			<BlockNameFormat JoinBy="-">
				{%    if Variant == 'Trekkekum Ø=1400 H=1350' %}NO-BN-2D-JBTKU_KFØ-TREKKEKUM-RUND-1400
				{% elsif Variant == 'Trekkekum L=1600 D=900 H=900' %}NO-BN-2D-JBTKU_KFØ-TREKKEKUM-L1600-D900
				{% elsif Variant == 'Trekkekum L=1400 D=1400 H=1600' %}NO-BN-2D-JBTKU_KFØ-TREKKEKUM-L1400-D1400
				{% elsif Variant == 'Trekkekum L=2300 D=2300 H=2400, 3-veis' %}NO-BN-2D-JBTKU_KFØ-TREKKEKUM-L2300-D2300
				{% elsif Variant == 'Trekkekum L=2300 D=2300 H=2400, 4-veis' %}NO-BN-2D-JBTKU_KFØ-TREKKEKUM-L2300-D2300
				{% elsif Variant == 'Trekkekum, brukerdefinert, rund' %}NO-BN-2D-JBTRC_THUMBNAIL-TREKKEKUM-RUND
				{% elsif Variant == 'Trekkekum, brukerdefinert, rektangulær' %}NO-BN-2D-JBTRC_THUMBNAIL-TREKKEKUM-REKTANGULAER
				{% else %}BAD_Variant_{{Variant}}
				{% endif %}
				{{SymbolMode}}
			</BlockNameFormat>
		</SymbolDefinition>

		<SymbolDefinition DefaultBlockName="NO-BN-2D-JBTRC_INNSETTINGSPUNKT-Schematic" DoNotIncludeInSymbolFrame="true"/>

		<Annotation3DTagDefinition><Attribute Tag="T01"><Value>{{code}}</Value></Attribute></Annotation3DTagDefinition>
		
		<DockPointDefinitions>
			<SnapPoints>
				<SnapPoint X="0.0" Y="0.0" TargetSpace="jordskinne"/>
			</SnapPoints>
		</DockPointDefinitions>

	</ObjectType>
			


<!--========================================================================================================
	CIVIL WORKS
	ROADS
	TODO: Avklare med Bane NOR om OBJEKTID-koden kan benyttes.
=========================================================================================================-->
	<ObjectType DataType="tElementWithAlignment" Class="RailwayAlignment" LuaName="rctype_Road" Name="JBTKU_VEI Vei"
				Layer="JBTKU_VEI" Color="ByLayer"
				Group="Underbygning/Veier"
				>

		<RelationSpace>vei</RelationSpace>
		
		<xpp:expand select="NOBN_com_DEROGATION"/>
		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___VAR"/>
		<xpp:expand select="NOBN_com_STD_TEXTATTRIBUTES___HORIZONTAL_AND_CLOSE___SUB"/>
		<xpp:expand select="NOBN_com_DISCIPLINE___SUB"/>
		<xpp:expand select="NOBN_com_PSET_BANE_NOR"/>
		<xpp:expand select="NOBN_com_PSET_FDV_BANEDATA"/>
		<xpp:expand select="NOBN_com_PSET_ISY_STK"/>
		<xpp:expand select="NOBN_com_PSET_TITTELFELT"/>

		<AlignmentSystems DefaultSystemName="Vei">
			<AlignmentSystem Name="Vei"
				CantGauge="0.000"
				AlignmentGauge="0.000"
				LiftWithCant="false"
		 />
		</AlignmentSystems>

		<Variants DefaultValue="Bilvei">
			<Variant Name="Bilvei">
				<LuaExpression Name="name"><Formula>code.." (bilvei)"</Formula></LuaExpression>
				<SetValue Key="RoadNumberOfLanes" Value="2"/>
				<SetValue Key="RoadExteriorWidth" Value="6000"/>
			</Variant>
			<Variant Name="Gangvei">
				<LuaExpression Name="name"><Formula>code.." (gangvei)"</Formula></LuaExpression>
				<SetValue Key="RoadNumberOfLanes" Value="1"/>
				<SetValue Key="RoadExteriorWidth" Value="2000"/>
			</Variant>
			<Variant Name="Sykkelsti">
				<LuaExpression Name="name"><Formula>code.." (sykkelsti)"</Formula></LuaExpression>
				<SetValue Key="RoadNumberOfLanes" Value="1"/>
				<SetValue Key="RoadExteriorWidth" Value="1400"/>
			</Variant>
			<Variant Name="Rømningsvei">
				<LuaExpression Name="name"><Formula>code.." (rømningsvei)"</Formula></LuaExpression>
				<SetValue Key="RoadNumberOfLanes" Value="1"/>
				<SetValue Key="RoadExteriorWidth" Value="1200"/>
			</Variant>
		</Variants>
		
		<DynamicProperty Type="Representation3D" Subtype="IteratedGeometry3D">
			<SetValue Key="RotationBeforeOffset" Value="True"/>
			<SetValue Key="CustomTransformation" Value="False"/>
		</DynamicProperty>

		<CustomProperty DataType="Enumeration" Name="RoadNumberOfLanes" DisplayName="Felt"
			Description="The road's number of lanes.">
			<Values Variant="Bilvei">
				<Value>6</Value>
				<Value>4</Value>
				<Value>3</Value>
				<Value>2</Value>
				<Value>1</Value>
			</Values>
			<Values Variant="Gangvei">
				<Value>1</Value>
			</Values>
			<Values Variant="Sykkelsti">
				<Value>2</Value>
				<Value>1</Value>
			</Values>
			<Values Variant="Rømningsvei">
				<Value>1</Value>
			</Values>
		</CustomProperty>

		<CustomProperty DataType="Enumeration" Name="RoadExteriorWidth" DisplayName="Bredde"
			Description="The road's exterior width [mm].">
			<Values Variant="Bilvei">
				<Value>12000</Value>
				<Value>11000</Value>
				<Value>10000</Value>
				<Value>9000</Value>
				<Value>8000</Value>
				<Value>7000</Value>
				<Value>6000</Value>
				<Value>5500</Value>
				<Value>5000</Value>
				<Value>4500</Value>
				<Value>4000</Value>
			</Values>
			<Values Variant="Gangvei">
				<Value>2000</Value>
				<Value>1600</Value>
				<Value>1200</Value>
			</Values>
			<Values Variant="Sykkelsti">
				<Value>2800</Value>
				<Value>1400</Value>
			</Values>
			<Values Variant="Rømningsvei">
				<Value>1400</Value>
				<Value>1200</Value>
				<Value>1000</Value>
				<Value>800</Value>
			</Values>
		</CustomProperty>
	
	<LuaExpression Name="IteratedGeometry3D_0.Name"><Formula>_JBTKU_VEI_Geometry3DName()</Formula></LuaExpression>
		<LuaFunction Name="_JBTKU_VEI_Geometry3DName()" 
				ReturnType="String"
				HideFromUser="false"
				Description="Returns the road's default 3D object model name.">
			<Signature>String _JBTKU_VEI_Geometry3DName()</Signature>
			<Formula>
				function _JBTKU_VEI_Geometry3DName()
					--TODO: Add more roads in 3D
					--TODO: Allow for varying segment lengths (all are 1000 mm now)
					local t = Sweep3D and "NO-BN-2D-KU-VEI-" or "NO-BN-3D-KU-VEI-"
					if Variant == "Bilvei" then 
						return t.."VEIBANE-"..RoadNumberOfLanes.."-FELT-L1000-D100-B"..RoadExteriorWidth
					elseif Variant == "Gangvei" then
						return t.."GANGBANE-"..RoadNumberOfLanes.."-FELT-L1000-D100-B"..RoadExteriorWidth
					elseif Variant == "Sykkelsti" then 
						return t.."SYKKELBANE-"..RoadNumberOfLanes.."-FELT-L1000-D100-B"..RoadExteriorWidth
					elseif Variant == "Rømningsvei" then
						return t.."RØMNINGSVEI-"..RoadNumberOfLanes.."-FELT-L1000-D100-B"..RoadExteriorWidth.."-H2250"
					else 
						return "", _info("Variant ["..Variant.."] has not been anticipated yet.")
					end
				end
			</Formula>
		</LuaFunction>

		<!-- '_position' is an intrinsic variable available to sampled Lua functions. -->
		<LuaExpression Name="IteratedGeometry3D_0.IterationStepSize"><Formula>_JBTKU_VEI_IteratedGeometryIterationStepSize(_position)</Formula></LuaExpression>
		<LuaFunction Name="_JBTKU_VEI_IteratedGeometryIterationStepSize()" 
				ReturnType="Double"
				HideFromUser="false"
				Description="Returns the distance to the next 3D model insertion point along the alignment axis during 3D Preview or 3D Export. Must be called with '_position' as input argument (_position.ref = alignment GUID, _position.pos = distAlong).">
			<Signature>Double _JBTKU_VEI_IteratedGeometryIterationStepSize(Double _position)</Signature>
			<Formula>
				function _JBTKU_VEI_IteratedGeometryIterationStepSize(pos)
					-- TODO: A more elaborate function would rely on the actual size for each inserted 3D Model, which may vary as a sampled function along the alignment.
					-- This simple formula assumes that the 3D geometry is constant along the alignment, decided by the Variant (which applies to the whole alignment's length)
					-- TODO: Implement 'SweepMode3D' which interprets the given 3D Model Name as a 2D section to be sweeped (or twisted, if Cant info is provided).

					-- length	= Assumed length of each 3D element along the alignment [m]
					-- width 	= Assumed width of each 3D element perpendicularly the alignment [m]
					-- spacing	= Recommended minimum spacing between any two adjacent elements
					local length, width, spacing
				
					if Variant == "Bilvei" then 
						length	= 1.000
						width	= 6.000
						spacing	= 0.000
					elseif Variant == "Gangvei" then 
						length	= 2.400
						width	= 0.400
						spacing	= 0.000
					elseif Variant == "Sykkelsti" then 
						length	= 1.000
						width	= 0.600
						spacing	= 0.000
					elseif Variant == "Rømningsvei" then 
						length 	= 1.000
						width 	= 0.600
						spacing	= 0.000
					else 
						return 3.142, _info("Variant ["..Variant.."] has not been anticipated yet - so we assume 3.142 m 3D Model Separation...")
					end
					--Find step size along constant-curve alignment such that the outer corner of one element touches the outer corner of the adjacent element:
					local r = getAlignmentInfo(pos).CurveRadius
					local ksi = (length/2) / (r + (width/2))
					if ksi &lt; 1e-3 then 
						return length + spacing --Almost no anglular change between elements
					else
						return (2*r * math.atan(ksi)) + spacing
					end
				end
			</Formula>
		</LuaFunction>

		<!-- Half of 3D model spearation value at pos=0: -->
		<LuaExpression Name="IteratedGeometry3D_0.InitialLinearOffset"><Formula>IteratedGeometry3D_0.Separation/2</Formula></LuaExpression>

		<PropertyPrompt Key="code" DefaultValue="Vei" AcceptEmptyValue="false"/>

		<InsertAlignment Name="Bilvei" DisplayBlockName="NO-BN-2D-JBTRC_THUMBNAIL-BILVEI-Schematic" DefaultToTangentContinuity="true">
			<IncludeSegmentType>Tangent</IncludeSegmentType>
			<IncludeSegmentType>Curve</IncludeSegmentType>
			<IncludeSegmentType>Spiral</IncludeSegmentType>
			<SetValue Key="AlignmentSystem" Value="Vei"/>
			<LuaExpression Name="HorizontalGeometryPointObjectTypeRef"><Formula>rctype_HorizontalGeometryVertex</Formula></LuaExpression>
			<LuaExpression Name="VerticalGeometryPointObjectTypeRef"><Formula>rctype_VerticalProfileVertex</Formula></LuaExpression>
			<LuaExpression Name="HorizontalGeometrySectionObjectTypeRef"><Formula>rctype_HorizontalGeometrySegment</Formula></LuaExpression>
			<LuaExpression Name="VerticalGeometrySectionObjectTypeRef"><Formula>rctype_VerticalProfileSegment</Formula></LuaExpression>
		</InsertAlignment>
		
		<InsertAlignment Name="Sykkelsti" DisplayBlockName="NO-BN-2D-JBTRC_THUMBNAIL-SYKKELSTI-Schematic" DefaultToTangentContinuity="true">
			<IncludeSegmentType>Tangent</IncludeSegmentType>
			<IncludeSegmentType>Curve</IncludeSegmentType>
			<IncludeSegmentType>Spiral</IncludeSegmentType>
			<SetValue Key="AlignmentSystem" Value="Vei"/>
			<LuaExpression Name="HorizontalGeometryPointObjectTypeRef"><Formula>rctype_HorizontalGeometryVertex</Formula></LuaExpression>
			<LuaExpression Name="VerticalGeometryPointObjectTypeRef"><Formula>rctype_VerticalProfileVertex</Formula></LuaExpression>
			<LuaExpression Name="HorizontalGeometrySectionObjectTypeRef"><Formula>rctype_HorizontalGeometrySegment</Formula></LuaExpression>
			<LuaExpression Name="VerticalGeometrySectionObjectTypeRef"><Formula>rctype_VerticalProfileSegment</Formula></LuaExpression>
		</InsertAlignment>

		<InsertAlignment Name="Gangvei" DisplayBlockName="NO-BN-2D-JBTRC_THUMBNAIL-GANGVEI-Schematic" DefaultToTangentContinuity="true">
			<IncludeSegmentType>Tangent</IncludeSegmentType>
			<IncludeSegmentType>Curve</IncludeSegmentType>
			<IncludeSegmentType>Spiral</IncludeSegmentType>
			<SetValue Key="AlignmentSystem" Value="Vei"/>
			<LuaExpression Name="HorizontalGeometryPointObjectTypeRef"><Formula>rctype_HorizontalGeometryVertex</Formula></LuaExpression>
			<LuaExpression Name="VerticalGeometryPointObjectTypeRef"><Formula>rctype_VerticalProfileVertex</Formula></LuaExpression>
			<LuaExpression Name="HorizontalGeometrySectionObjectTypeRef"><Formula>rctype_HorizontalGeometrySegment</Formula></LuaExpression>
			<LuaExpression Name="VerticalGeometrySectionObjectTypeRef"><Formula>rctype_VerticalProfileSegment</Formula></LuaExpression>
		</InsertAlignment>

		<InsertAlignment Name="Rømningsvei" DisplayBlockName="NO-BN-2D-JBTRC_THUMBNAIL-ROEMNINGSVEI-Schematic" DefaultToTangentContinuity="true">
			<IncludeSegmentType>Tangent</IncludeSegmentType>
			<IncludeSegmentType>Curve</IncludeSegmentType>
			<IncludeSegmentType>Spiral</IncludeSegmentType>
			<SetValue Key="AlignmentSystem" Value="Vei"/>
			<LuaExpression Name="HorizontalGeometryPointObjectTypeRef"><Formula>rctype_HorizontalGeometryVertex</Formula></LuaExpression>
			<LuaExpression Name="VerticalGeometryPointObjectTypeRef"><Formula>rctype_VerticalProfileVertex</Formula></LuaExpression>
			<LuaExpression Name="HorizontalGeometrySectionObjectTypeRef"><Formula>rctype_HorizontalGeometrySegment</Formula></LuaExpression>
			<LuaExpression Name="VerticalGeometrySectionObjectTypeRef"><Formula>rctype_VerticalProfileSegment</Formula></LuaExpression>
		</InsertAlignment>

	</ObjectType>
			


<!--========================================================================================================
	CIVIL WORKS
	FOUNDATIONS
	JBTKU_FUN Apparatskapfundament
=========================================================================================================-->
	<ObjectType DataType="tOrientedElement" Class="RailwayPlacedObject" LuaName="rctype_CabinetFoundation" Name="JBTKU_FUN Apparatskapfundament"
				Layer="JBTKU_FUN" Color="ByLayer"
				Group="Underbygning/Fundamenter/Apparatskap"
				AttMirrorY="{% if RightSided %}true{% else %}false{% endif %}"
				>
				
		<RelationSpace>apparatskapfundament</RelationSpace>
		<AttachmentCategory Name="apparatskapfundament"/>
		
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___SYMBOLFRAME"/>
		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___VAR"/>
		<xpp:expand select="NOBN_com_STD_TEXATTRIBUTES___VERTICAL_AND_FAR___SUB"/>
		<xpp:expand select="NOBN_com_DISCIPLINE___SUB"/>
		<xpp:expand select="NOBN_com_CHK_NUMBER_OF_OCP_AREAS"/>
		<xpp:expand select="NOBN_com_SET_OCP_STATION_REFERENCE"/>
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___WAYSIDE_GENERAL_OBJECT"/>
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___EARTHED_TO_NONE"/>
		<xpp:expand select="NOBN_com_PSET_BANE_NOR"/>
		<xpp:expand select="NOBN_com_PSET_FDV_BANEDATA"/>
		<xpp:expand select="NOBN_com_PSET_ISY_STK"/>
		<xpp:expand select="NOBN_com_PSET_TITTELFELT"/>

		<Variants>
			<Variant Name="Betong apparatskap fundament, hull på langsiden">
				<SetValue Key="name" Value="Betong AS fund. langside"/>
				<SetValue Key="Geometry3D_0.Name" Value="NO-BN-3D-KU-FUN-APPARATSKAP-STORT-1400x820x540-LANGSIDEHULL"/>
			</Variant>
			<Variant Name="Betong apparatskap fundament, hull på kortsiden">
				<SetValue Key="name" Value="Betong AS fund. kortside"/>
				<SetValue Key="Geometry3D_0.Name" Value="NO-BN-3D-KU-FUN-APPARATSKAP-STORT-1400x820x540-KORTSIDEHULL"/>
			</Variant>
		</Variants>

        <LuaExpression Name="dir"><Formula>"both"</Formula></LuaExpression>
        <LuaExpression Name="code"><Formula>NOBN_sub_getFoundationCode()</Formula></LuaExpression>
        <LuaExpression Name="name"><Formula>tostring(code):upper():match("UNFINISHED") and "" or code</Formula></LuaExpression>

		<InsertPointObject Name="Betong apparatskap fundament, hull på langsiden" DisplayBlockName="NO-BN-2D-JBTKU_FUN-SKAPFUNDAMENT-BETONG-APPARATSKAP-LANGSIDE-{{SymbolMode}}" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="3.5">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="false" RotateIfRightSideOfAlignment="true"/>
		</InsertPointObject>
		
		<InsertPointObject Name="Betong apparatskap fundament, hull på kortsiden" DisplayBlockName="NO-BN-2D-JBTKU_FUN-SKAPFUNDAMENT-BETONG-APPARATSKAP-KORTSIDE-{{SymbolMode}}"
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="3.5">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="false" RotateIfRightSideOfAlignment="true"/>
		</InsertPointObject>

		<SymbolDefinition DefaultBlockName="NO-BN-2D-JBTKU_FUN-SKAPFUNDAMENT-BETONG-APPARATSKAP-LANGSIDE-{{SymbolMode}}" AllowSymbolMove="true">
			<Rotation Add180DegreesIfDirIsDown="false" AddAngle="{% if dir == 'up' %}{{270.0|plus:AngularOffset}}
														{% elsif dir == 'down' %}{{90.0|plus:AngularOffset}}
														{% elsif dir == 'both' and RightSided %}{{180.0|plus:AngularOffset}}
														{% elsif dir == 'both' and LeftSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and RightSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and LeftSided %}{{180.0|plus:AngularOffset}}
														{% else %}45.0
														{% endif %}"/>	
			<BlockNameFormat JoinBy="-">
				NO-BN-2D-JBTKU_FUN-SKAPFUNDAMENT
				{% if Variant == 'Betong apparatskap fundament, hull på langsiden' %}BETONG-APPARATSKAP-LANGSIDE
				{% elsif Variant == 'Betong apparatskap fundament, hull på kortsiden' %}BETONG-APPARATSKAP-KORTSIDE
				{% else %}BAD_Variant_{{Variant}}
				{% endif %}
				{{SymbolMode}}
			</BlockNameFormat>
		</SymbolDefinition>

		<SymbolDefinition DefaultBlockName="NO-BN-2D-JBTRC_INNSETTINGSPUNKT-Schematic" DoNotIncludeInSymbolFrame="true"/>

		<DockPointDefinitions>
			<SnapPoints Variant="Betong apparatskap fundament, hull på langsiden">
				<SnapPoint X="0.0" Y="0.0" TargetSpace="apparatskap"/>
			</SnapPoints>
			<SnapPoints Variant="Betong apparatskap fundament, hull på kortsiden">
				<SnapPoint X="0.0" Y="0.0" TargetSpace="apparatskap"/>
			</SnapPoints>
		</DockPointDefinitions>

	</ObjectType>



<!--========================================================================================================
	CIVIL WORKS
	FOUNDATIONS
	CATENARY

	Store konstruksjoner i betong, eller boret i metall, med boltegruppe for KL-master, barduner og strevere.
	For OCS poles, guywires and spanners.
	
	Naming convention for 2D OCS foundation symbols: 

		JBTEH_FUN-KL-FUNDAMENT-BETONG-<type>-<baseX>x<baseY>-<baseOffsetY>-<boltX>x<boltY>x<boltsize>

	where:	
		baseX, baseY: bottom plate Y along track and Y across track, or outer diameter 'Ø355' etc without a base offset.
		baseOffsetY: millimeters offset of center base plate in Y direction, from origo
		shaft: from top of bottom plate to top of foundation (reference level Z)
		type: B3, BJELKEMAST, H3, BORET-Ø355, BORET-Ø555
		boltX, boltY: Placing of bolt in the first quadrant. Ø355 has 8 bolts with angle 27DD from East / North instead of x,y coordinates.
		boltsize: M24 or M36
		Insertion point: Center of bolt group

	Examples:
		NO-BN-2D-JBTEH_FUN-KL-FUNDAMENT-BETONG-BJELKEMAST-1600x1800-000-191x374xM36
		NO-BN-2D-JBTEH_FUN-KL-FUNDAMENT-BETONG-BORET-Ø355-191x374xM36


	Naming convention for 3D OCS foundation objects: 

		NO-BN-3D-EH-FUN-<type[-subtype]>-<baseX>x<baseY>x<baseZ>-<baseOffsetY>-<shaftX>x<shaftY>x<shaftZ>-<boltX>x<boltY>x<boltsize>
		
	where:	
		baseZ: Height of base plate
		shaftX, shaftY, shaftZ: shaft dimensions
	
	Examples: 
		NO-BN-3D-EH-FUN-BJELKEMAST-1600x1600x1000-000-700x700x1700-191x374xM36
		NO-BN-3D-EH-FUN-GITTERMAST-B3-2300x2300x350-000-500x1100x1800-240x800xM36	(Where is this one from? Norconsult? )
		NO-BN-3D-EH-FUN-GITTERMAST-B3-1600x1800x500-100-600x1200x2200-240x800xM36
		NO-BN-3D-EH-FUN-GITTERMAST-H3-1600x1800x500-100-1000x1000x2200-700x700xM36
		NO-BN-3D-EH-FUN-BJELKEMAST-BORET-Ø555-191x374xM36-4500
		NO-BN-3D-EH-FUN-GITTERMAST-BORET-Ø355-Ø232x27DDxM36-4500
		
=========================================================================================================-->
	<ObjectType DataType="tOrientedElement" Class="RailwayPlacedObject" LuaName="rctype_OcsPoleFoundation" Name="JBTEH_FUN KL-fundament"
				Layer="JBTEH_FUN" Color="ByLayer"
				Group="Underbygning/Fundamenter/Kontaktledning"
				AttMirrorY="{% if RightSided %}true{% else %}false{% endif %}"
				>
				
		<RelationSpace>kl-fundament</RelationSpace>
		
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___SYMBOLFRAME"/>
		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___VAR"/>
		<xpp:expand select="NOBN_com_STD_TEXATTRIBUTES___VERTICAL_AND_FAR___SUB"/>
		<xpp:expand select="NOBN_com_DISCIPLINE___SUB"/>
		<xpp:expand select="NOBN_com_CHK_NUMBER_OF_OCP_AREAS"/>
		<xpp:expand select="NOBN_com_SET_OCP_STATION_REFERENCE"/>
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___WAYSIDE_GENERAL_OBJECT"/>
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___EARTHED_TO_NONE"/>
		<xpp:expand select="NOBN_com_PSET_BANE_NOR"/>
		<xpp:expand select="NOBN_com_PSET_FDV_BANEDATA"/>
		<xpp:expand select="NOBN_com_PSET_ISY_STK"/>
		<xpp:expand select="NOBN_com_PSET_TITTELFELT"/>
		<xpp:expand select="NOBN_com_PSET_FDV_BANEDATA_EH_FUN"/>

		<Variants>
			<Variant Name="Betong KL-fundament, bjelkemast">
				<SetValue Key="OcsFoundationBaseWidth" Value="1800"/>
				<SetValue Key="OcsFoundationBaseOffset" Value="000"/>
				<SetValue Key="OcsFoundationShaftHeight" Value="2700"/>
			</Variant>
			<Variant Name="Boret KL-fundament, Ø355-Ø232xDD27xM36">
				<SetValue Key="OcsFoundationShaftHeight" Value="5000"/>
			</Variant>
			<Variant Name="Boret KL-fundament, Ø555-191x374xM36">
				<SetValue Key="OcsFoundationShaftHeight" Value="4500"/>
			</Variant>
			<Variant Name="Fjellbolter for KL-mast i tunnel">
			</Variant>
			<Variant Name="Fjellbolter for KL-mast på veggkonsoll">
			</Variant>
			<Variant Name="Veggkonsoll for KL-mast">
			</Variant>
			<Variant Name="Spesial KL-fundament">
			</Variant>
			<Variant Name="Betong KL-fundament, lav B3 og B6, 240x800xM36, 6000-9500">
				<SetValue Key="OcsFoundationBaseWidth" Value="1800"/>
				<SetValue Key="OcsFoundationBaseOffset" Value="000"/>
				<SetValue Key="OcsFoundationShaftHeight" Value="3200"/>
			</Variant>
			<Variant Name="Betong KL-fundament, høy B6, 260x940xM36, 10000-13000">
				<SetValue Key="OcsFoundationBaseWidth" Value="1800"/>
				<SetValue Key="OcsFoundationBaseOffset" Value="000"/>
				<SetValue Key="OcsFoundationShaftHeight" Value="3200"/>
			</Variant>
			<Variant Name="Betong KL-fundament, H3, 700x700xM36, 6000-9500">
				<SetValue Key="OcsFoundationBaseWidth" Value="1800"/>
				<SetValue Key="OcsFoundationBaseOffset" Value="000"/>
				<SetValue Key="OcsFoundationShaftHeight" Value="2700"/>
			</Variant>
			<Variant Name="Betong KL-fundament, H3, 790x790xM36, 10000-12000">
				<SetValue Key="OcsFoundationBaseWidth" Value="1800"/>
				<SetValue Key="OcsFoundationBaseOffset" Value="000"/>
				<SetValue Key="OcsFoundationShaftHeight" Value="2700"/>
			</Variant>
			<Variant Name="Betong KL-fundament, H3, 830x830xM36, 12500-13000">
				<SetValue Key="OcsFoundationBaseWidth" Value="1800"/>
				<SetValue Key="OcsFoundationBaseOffset" Value="000"/>
				<SetValue Key="OcsFoundationShaftHeight" Value="2700"/>
			</Variant>
		</Variants>

		<CustomProperty DataType="Enumeration" Name="OcsFoundationBaseWidth" DisplayName="Fundament bunnplate bredde"
			Description="The overhead catenary system (OCS) foundation base plate width (transversal to track). Not applicable to bored foundations." 
		>
			<Values Variant="Betong KL-fundament, bjelkemast">
				<Value>2200</Value>
				<Value>2100</Value>
				<Value>2000</Value>
				<Value>1900</Value>
				<Value>1800</Value>
				<Value>1700</Value>
				<Value>1600</Value>
			</Values>
			<Values Variant="Betong KL-fundament, lav B3 og B6, 240x800xM36, 6000-9500">
				<Value>1800</Value>
			</Values>
			<Values Variant="Betong KL-fundament, høy B6, 260x940xM36, 10000-13000">
				<Value>1800</Value>
			</Values>
			<Values Variant="Betong KL-fundament, H3, 700x700xM36, 6000-9500">
				<Value>1800</Value>
			</Values>
			<Values Variant="Betong KL-fundament, H3, 790x790xM36, 10000-12000">
				<Value>1800</Value>
			</Values>
			<Values Variant="Betong KL-fundament, H3, 830x830xM36, 12500-13000">
				<Value>1800</Value>
			</Values>
		</CustomProperty>
		
		<!-- NB Not all combinations of OcsFoundationBaseWidth and OcsFoundationBaseOffset are meaningful. -->
		<CustomProperty DataType="Enumeration" Name="OcsFoundationBaseOffset" DisplayName="Fundament bunnplate offset"
			Description="The overhead catenary system (OCS) foundation base plate offset. Not applicable to bored foundations.">
			<Values Variant="Betong KL-fundament, bjelkemast">
				<Value>300</Value>
				<Value>200</Value>
				<Value>100</Value>
				<Value>000</Value>
			</Values>
			<Values Variant="Betong KL-fundament, lav B3 og B6, 240x800xM36, 6000-9500">
				<Value>000</Value>
			</Values>
			<Values Variant="Betong KL-fundament, høy B6, 260x940xM36, 10000-13000">
				<Value>000</Value>
			</Values>
			<Values Variant="Betong KL-fundament, H3, 700x700xM36, 6000-9500">
				<Value>000</Value>
			</Values>
			<Values Variant="Betong KL-fundament, H3, 790x790xM36, 10000-12000">
				<Value>000</Value>
			</Values>
			<Values Variant="Betong KL-fundament, H3, 830x830xM36, 12500-13000">
				<Value>000</Value>
			</Values>
		</CustomProperty>
		
		<CustomProperty DataType="Enumeration" Name="OcsFoundationShaftHeight" DisplayName="Fundament søylehøyde"
			Description="The overhead catenary system (OCS) foundation shaft height resp. total bored height.">
			<Values Variant="Betong KL-fundament, bjelkemast">
				<Value>2700</Value>
				<Value>2200</Value>
				<Value>1700</Value>
				<Value>1200</Value>
			</Values>
			<Values Variant="Boret KL-fundament, Ø555-191x374xM36">
				<Value>7500</Value>
				<Value>7000</Value>
				<Value>6500</Value>
				<Value>6000</Value>
				<Value>5500</Value>
				<Value>5000</Value>
				<Value>4500</Value>
				<Value>4000</Value>
				<Value>3500</Value>
				<Value>3000</Value>
				<Value>2500</Value>
			</Values>
			<Values Variant="Boret KL-fundament, Ø355-Ø232xDD27xM36">
				<Value>7500</Value>
				<Value>7000</Value>
				<Value>6500</Value>
				<Value>6000</Value>
				<Value>5500</Value>
				<Value>5000</Value>
				<Value>4500</Value>
				<Value>4000</Value>
				<Value>3500</Value>
				<Value>3000</Value>
				<Value>2500</Value>
			</Values>
			<Values Variant="Betong KL-fundament, lav B3 og B6, 240x800xM36, 6000-9500">
				<!-- Shaft heights 2400..3700 lead to base plate 1600x1800x500 -->
				<Value>3700</Value>
				<Value>3200</Value>
				<Value>3100</Value>
				<Value>2400</Value>
				<!-- shaft height = 1800 leads to 2300x2300x350 base plate in 3D, a Lysaker-Asker / Norconsult construction -->
				<Value>1800</Value>
			</Values>
			<Values Variant="Betong KL-fundament, høy B6, 260x940xM36, 10000-13000">
				<!-- Shaft heights 2400..3700 lead to base plate 1600x1800x500 -->
				<Value>3700</Value>
				<Value>3200</Value>
				<Value>3100</Value>
				<Value>2400</Value>
				<!-- shaft height = 1800 leads to 2300x2300x350 base plate in 3D, a Lysaker-Asker / Norconsult construction -->
				<Value>1800</Value>
			</Values>
			<Values Variant="Betong KL-fundament, H3, 700x700xM36, 6000-9500">
				<Value>3700</Value>
				<Value>2900</Value>
				<Value>2700</Value>
				<Value>2600</Value>
				<Value>2200</Value>
			</Values>
			<Values Variant="Betong KL-fundament, H3, 790x790xM36, 10000-12000">
				<Value>3700</Value>
				<Value>2900</Value>
				<Value>2700</Value>
				<Value>2600</Value>
				<Value>2200</Value>
			</Values>
			<Values Variant="Betong KL-fundament, H3, 830x830xM36, 12500-13000">
				<Value>3700</Value>
				<Value>2900</Value>
				<Value>2700</Value>
				<Value>2600</Value>
				<Value>2200</Value>
			</Values>
		</CustomProperty>

		 <!-- Used by several disciplines: -->
		<SetValue Key="dir" Value="both"/>
		<LuaExpression Name="code"><Formula>NOBN_sub_getFoundationCode()</Formula></LuaExpression>

		<LuaExpression Name="name"><Formula>tostring(code):upper():match("UNFINISHED") and code or ""</Formula></LuaExpression>
		<LuaExpression Name="Mileage"><Formula>RC__getMileageFromRelatedObject(rel_OcsFoundation_AppliesTo_OcsPoleOrAnchoringFootplate)</Formula></LuaExpression>
		<LuaExpression Name="LateralOffset"><Formula>RC__getLateralOffsetFromRelatedObject(rel_OcsFoundation_AppliesTo_OcsPoleOrAnchoringFootplate)</Formula></LuaExpression>
		<LuaExpression Name="VerticalOffset"><Formula>RC__getVerticalOffsetFromRelatedObject(rel_OcsFoundation_AppliesTo_OcsPoleOrAnchoringFootplate)</Formula></LuaExpression>
		<LuaExpression Name="dir"><Formula>RC__getDirFromRelatedObject(rel_OcsFoundation_AppliesTo_OcsPoleOrAnchoringFootplate)</Formula></LuaExpression>
		<LuaExpression Name="AngularOffset"><Formula>RC__getAngularOffsetFromRelatedObject(rel_OcsFoundation_AppliesTo_OcsPoleOrAnchoringFootplate)</Formula></LuaExpression>

		<LuaExpression Name="Geometry3D_0.Name"><Formula>_JBTEH_FUN_OcsFoundation_Geometry3DName()</Formula></LuaExpression>
		<LuaFunction Name="_JBTEH_FUN_OcsFoundation_Geometry3DName()" 
				ReturnType="String"
				HideFromUser="false"
				Description="Returns the 3D geometry name for an OCS foundation.">
			<Signature>String _JBTEH_FUN_OcsFoundation_Geometry3DName()</Signature>
			<Formula>
				function _JBTEH_FUN_OcsFoundation_Geometry3DName()
					local bw = OcsFoundationBaseWidth
					local bo = OcsFoundationBaseOffset == 0 and "000" or tostring(OcsFoundationBaseOffset)
					local sh = OcsFoundationShaftHeight

					if Variant == "Betong KL-fundament, bjelkemast" then
						return "NO-BN-3D-EH-FUN-BJELKEMAST-1600x"..bw.."x1000-"..bo.."-700x700-191x374xM36-"..sh
					
					elseif Variant == "Boret KL-fundament, Ø355-Ø232xDD27xM36" then
						return "NO-BN-3D-EH-FUN-GITTERMAST-BORET-Ø355-Ø232x27DDxM36-"..sh
					
					elseif Variant == "Boret KL-fundament, Ø555-191x374xM36" then
						return "NO-BN-3D-EH-FUN-BJELKEMAST-BORET-Ø555-191x374xM36-"..sh
					
					elseif Variant == "Fjellbolter for KL-mast i tunnel" then
						return "NO-BN-3D-EH-FUN-HENGEMAST-FJELLBOLTER-350x350xM24"
					
					elseif Variant == "Fjellbolter for KL-mast på veggkonsoll" then
						return "NO-BN-3D-EH-FUN-KONSOLL-VEGGFESTE-FJELLBOLTER-600x700xM32"

					elseif Variant == "Veggkonsoll for KL-mast" then
						return "NO-BN-3D-EH-FUN-KONSOLL-VEGGFESTE-191x374xM36"
					
					elseif Variant == "Spesial KL-fundament" then
						return "NO-BN-3D-FE-DIV-UKJENT", _info("To be replaced by customized special foundation adapted to the situation's needs.")
										
					elseif Variant == "Betong KL-fundament, lav B3 og B6, 240x800xM36, 6000-9500" then
						if sh == 1800 then 
							return "NO-BN-3D-EH-FUN-GITTERMAST-B3-B6-2300x2300x350-000-500x1100-240x800xM36-"..sh
						else 
							return "NO-BN-3D-EH-FUN-GITTERMAST-B3-B6-1600x1800x500-100-600x1200-240x800xM36-"..sh
						end

					elseif Variant == "Betong KL-fundament, høy B6, 260x940xM36, 10000-13000" then
						if sh == 1800 then 
							return "NO-BN-3D-EH-FUN-GITTERMAST-B6-2300x2300x350-000-500x1100-260x940xM36-"..sh
						else 
							return "NO-BN-3D-EH-FUN-GITTERMAST-B6-1600x1800x500-100-600x1200-260x940xM36-"..sh
						end

					elseif Variant == "Betong KL-fundament, H3, 700x700xM36, 6000-9500" then
						return "NO-BN-3D-EH-FUN-GITTERMAST-H3-1600x"..bw.."x500-"..bo.."-1000x1000-700x700xM36-"..sh
					
					elseif Variant == "Betong KL-fundament, H3, 790x790xM36, 10000-12000" then
						return "NO-BN-3D-EH-FUN-GITTERMAST-H3-1600x"..bw.."x500-"..bo.."-1100x1100-790x790xM36-"..sh
					
					elseif Variant == "Betong KL-fundament, H3, 830x830xM36, 12500-13000" then
						return "NO-BN-3D-EH-FUN-GITTERMAST-H3-1600x"..bw.."x500-"..bo.."-1100x1100-830x830xM36-"..sh
					
					else
						return _error, "Unrecognized variant ["..Variant.."]."
					end
				end
			</Formula>
		</LuaFunction>

		<InsertPointObject Name="Betong KL-fundament, bjelkemast"
				DisplayBlockName="NO-BN-2D-JBTEH_FUN-KL-FUNDAMENT-BETONG-BJELKEMAST-1600x1800-000-191x374xM36-{{SymbolMode}}"
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="4.0">   
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="false" RotateIfRightSideOfAlignment="true"/>
		</InsertPointObject>

		<InsertPointObject Name="Boret KL-fundament, Ø355-Ø232xDD27xM36"
				DisplayBlockName="NO-BN-2D-JBTEH_FUN-KL-FUNDAMENT-BETONG-BORET-Ø355-Ø232xDD27xM36-{{SymbolMode}}" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="4.0">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="false" RotateIfRightSideOfAlignment="true"/>
		</InsertPointObject>

		<InsertPointObject Name="Boret KL-fundament, Ø555-191x374xM36"
				DisplayBlockName="NO-BN-2D-JBTEH_FUN-KL-FUNDAMENT-BETONG-BORET-Ø555-191x374xM36-{{SymbolMode}}" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="4.0">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="false" RotateIfRightSideOfAlignment="true"/>
		</InsertPointObject>

		<InsertPointObject Name="Fjellbolter for KL-mast i tunnel"
				DisplayBlockName="NO-BN-2D-JBTEH_FUN-KL-FUNDAMENT-FJELLBOLTER-FOR-BRU-OG-TUNNEL-350x350xM24-{{SymbolMode}}" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="4.0">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="false" RotateIfRightSideOfAlignment="true"/>
		</InsertPointObject>
		
		<InsertPointObject Name="Fjellbolter for KL-mast på veggkonsoll"
				DisplayBlockName="NO-BN-2D-JBTEH_FUN-KL-FUNDAMENT-FJELLBOLTER-FOR-VEGGKONSOLL-600x700xM24-{{SymbolMode}}" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="4.0">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="false" RotateIfRightSideOfAlignment="true"/>
		</InsertPointObject>

		<InsertPointObject Name="Veggkonsoll for KL-mast" 
				DisplayBlockName="NO-BN-2D-JBTEH_FUN-KL-FUNDAMENT-VEGGKONSOLL-191x374xM36-{{SymbolMode}}" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="4.0">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="false" RotateIfRightSideOfAlignment="true"/>
		</InsertPointObject>
		
		<InsertPointObject Name="Spesial KL-fundament" 
				DisplayBlockName="NO-BN-2D-JBTEH_FUN-KL-FUNDAMENT-SPESIAL-191x374xM36-{{SymbolMode}}" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="4.0">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="false" RotateIfRightSideOfAlignment="true"/>
		</InsertPointObject>
										 
		<InsertPointObject Name="Betong KL-fundament, lav B3 og B6, 240x800xM36, 6000-9500" 
				DisplayBlockName="NO-BN-2D-JBTEH_FUN-KL-FUNDAMENT-BETONG-B3-B6-LAV-1600x1800-000-240x800xM36-{{SymbolMode}}" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="4.0">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="false" RotateIfRightSideOfAlignment="true"/>
		</InsertPointObject>
		
		<InsertPointObject Name="Betong KL-fundament, høy B6, 260x940xM36, 10000-13000" 
				DisplayBlockName="NO-BN-2D-JBTEH_FUN-KL-FUNDAMENT-BETONG-B6-HOEY-1600x1800-000-260x940xM36-{{SymbolMode}}" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="4.0">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="false" RotateIfRightSideOfAlignment="true"/>
		</InsertPointObject>
		
		<InsertPointObject Name="Betong KL-fundament, H3, 700x700xM36, 6000-9500" 
				DisplayBlockName="NO-BN-2D-JBTEH_FUN-KL-FUNDAMENT-BETONG-H3-1600x1800-000-700x700xM36-6000-9500-{{SymbolMode}}"
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="4.0">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="false" RotateIfRightSideOfAlignment="true"/>
		</InsertPointObject>
		
		<InsertPointObject Name="Betong KL-fundament, H3, 790x790xM36, 10000-12000" 
				DisplayBlockName="NO-BN-2D-JBTEH_FUN-KL-FUNDAMENT-BETONG-H3-1600x1800-000-790x790xM36-10000-12000-{{SymbolMode}}"
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="4.0">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="false" RotateIfRightSideOfAlignment="true"/>
		</InsertPointObject>
		
		<InsertPointObject Name="Betong KL-fundament, H3, 830x830xM36, 12500-13000" 
				DisplayBlockName="NO-BN-2D-JBTEH_FUN-KL-FUNDAMENT-BETONG-H3-1600x1800-000-830x830xM36-12500-13000-{{SymbolMode}}"
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="4.0">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="false" RotateIfRightSideOfAlignment="true"/>
		</InsertPointObject>
		
		<SymbolDefinition DefaultBlockName="NO-BN-2D-JBTEH_FUN-KL-FUNDAMENT-BETONG-BJELKEMAST-1600x1800-000-191x374xM36-{{SymbolMode}}" AllowSymbolMove="true">
			<Rotation Add180DegreesIfDirIsDown="false" AddAngle="{% if dir == 'up' %}{{270.0|plus:AngularOffset}}
														{% elsif dir == 'down' %}{{90.0|plus:AngularOffset}}
														{% elsif dir == 'both' and RightSided %}{{180.0|plus:AngularOffset}}
														{% elsif dir == 'both' and LeftSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and RightSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and LeftSided %}{{180.0|plus:AngularOffset}}
														{% else %}45.0
														{% endif %}"/>	
			<!-- 2020-11-08 CLFEY Dropped using DotLiquid pipe '| downcase' since all are numbers now: -->
			<BlockNameFormat JoinBy="-">
				NO-BN-2D-JBTEH_FUN-KL-FUNDAMENT
				{% if    Variant == 'Betong KL-fundament, bjelkemast' %}BETONG-BJELKEMAST-1600x{{OcsFoundationBaseWidth}}-{{OcsFoundationBaseOffset}}-191x374xM36
				{% elsif Variant == 'Boret KL-fundament, Ø555-191x374xM36' %}BETONG-BORET-Ø555-191x374xM36
				{% elsif Variant == 'Boret KL-fundament, Ø355-Ø232xDD27xM36' %}BETONG-BORET-Ø355-Ø232xDD27xM36
				{% elsif Variant == 'Fjellbolter for KL-mast i tunnel' %}FJELLBOLTER-FOR-BRU-OG-TUNNEL-350x350xM24
				{% elsif Variant == 'Fjellbolter for KL-mast på veggkonsoll' %}FJELLBOLTER-FOR-VEGGKONSOLL-600x700xM24
				{% elsif Variant == 'Veggkonsoll for KL-mast' %}VEGGKONSOLL-191x374xM36
				{% elsif Variant == 'Spesial KL-fundament' %}SPESIAL-191x374xM36
				{% elsif Variant == 'Betong KL-fundament, lav B3 og B6, 240x800xM36, 6000-9500' %}BETONG-B3-B6-LAV-1600x1800-000-240x800xM36
				{% elsif Variant == 'Betong KL-fundament, høy B6, 260x940xM36, 10000-13000' %}BETONG-B6-HOEY-1600x1800-{{OcsFoundationBaseOffset}}-260x940xM36
				{% elsif Variant == 'Betong KL-fundament, H3, 700x700xM36, 6000-9500' %}BETONG-H3-1600x{{OcsFoundationBaseWidth}}-{{OcsFoundationBaseOffset}}-700x700xM36-6000-9500
				{% elsif Variant == 'Betong KL-fundament, H3, 790x790xM36, 10000-12000' %}BETONG-H3-1600x{{OcsFoundationBaseWidth}}-{{OcsFoundationBaseOffset}}-790x790xM36-10000-12000
				{% elsif Variant == 'Betong KL-fundament, H3, 830x830xM36, 12500-13000' %}BETONG-H3-1600x{{OcsFoundationBaseWidth}}-{{OcsFoundationBaseOffset}}-830x830xM36-12500-13000
				{% else %}BAD_Variant_{{Variant}}
				{% endif %}
				{{SymbolMode}}
			</BlockNameFormat>
		</SymbolDefinition>

		<SymbolDefinition DefaultBlockName="NO-BN-2D-JBTRC_INNSETTINGSPUNKT-Schematic" DoNotIncludeInSymbolFrame="true"/>

		<!-- Vi lar alle sammen få lov til også å benyttes som ankerpunkt for barduner og strevere -->
		<DockPointDefinitions>
			<SnapPoints>
				<SnapPoint X="0.0" Y="0.0" TargetSpace="kl-mast"/>
				<SnapPoint X="0.0" Y="0.0" TargetSpace="bardun_fotplate"/>
				<SnapPoint X="0.0" Y="0.0" TargetSpace="strever_fotplate"/>
				<SnapPoint X="0.0" Y="0.0" TargetSpace="tunnelfeste"/>
			</SnapPoints>
		</DockPointDefinitions>

	</ObjectType><!-- JBTEH_FUN KL-fundament -->


<!--========================================================================================================
	CIVIL WORKS
	FOUNDATIONS
	SIGNALLING
	Store konstruksjoner i betong, eller boret i metall, med boltegruppe
=========================================================================================================-->
	<ObjectType DataType="tOrientedElement" Class="RailwayPlacedObject" LuaName="rctype_SignalFoundation" Name="JBTKU_FUN Signalfundament"
				Layer="JBTKU_FUN" Color="ByLayer"
				Group="Underbygning/Fundamenter/Signal"
				AttMirrorY="{% if RightSided %}true{% else %}false{% endif %}"
				>
				
		<RelationSpace>signalfundament</RelationSpace>
		
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___SYMBOLFRAME"/>
		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___VAR"/>
		<xpp:expand select="NOBN_com_STD_TEXATTRIBUTES___VERTICAL_AND_FAR___SUB"/>
		<xpp:expand select="NOBN_com_DISCIPLINE___SUB"/>
		<xpp:expand select="NOBN_com_CHK_NUMBER_OF_OCP_AREAS"/>
		<xpp:expand select="NOBN_com_SET_OCP_STATION_REFERENCE"/>
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___WAYSIDE_GENERAL_OBJECT"/>
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___EARTHED_TO_NONE"/>
		<xpp:expand select="NOBN_com_PSET_BANE_NOR"/>
		<xpp:expand select="NOBN_com_PSET_FDV_BANEDATA"/>
		<xpp:expand select="NOBN_com_PSET_ISY_STK"/>
		<xpp:expand select="NOBN_com_PSET_TITTELFELT"/>

		<Variants>
			<Variant Name="Betong Hs fundament på fri linje">
				<SetValue Key="name" Value="Hs-fund. på fri linje"/>
				<SetValue Key="SignalFoundationShaftHeight" Value="1700"/>
			</Variant>
			<Variant Name="Betong Hs fundament på plattform">
				<SetValue Key="name" Value="Hs-fund. på plattform"/>
				<SetValue Key="VerticalOffset" Value="0.76"/>
				<SetValue Key="SignalFoundationShaftHeight" Value="1000"/>
			</Variant>
			<Variant Name="Betong Hs fundament, Ø300/Ø680">
				<SetValue Key="name" Value="Rundt Hs-fund, Ø680"/>
				<SetValue Key="SignalFoundationShaftHeight" Value="1800"/>
			</Variant>
			<Variant Name="Betong Ds fundament, Ø76, konisk">
				<SetValue Key="name" Value="Ds-fund."/>
			</Variant>
			<Variant Name="Betong Ds fundament, Ø76, rettsidet">
				<SetValue Key="name" Value="Ds-fund."/>
			</Variant>
			<Variant Name="Betong Ds fundament, ERTMS">
				<SetValue Key="name" Value="Ds-fund."/>
			</Variant>
			<Variant Name="Boret Hs fundament, Ø555">
				<SetValue Key="name" Value="Boret Hs-fund."/>
				<SetValue Key="SignalFoundationShaftHeight" Value="4500"/>
			</Variant>
			<Variant Name="Betong veibomdrivmaskin fundament, Ø210/Ø680">
				<SetValue Key="name" Value="Rundt Veibommaskin-fund, Ø680"/>
				<SetValue Key="SignalFoundationShaftHeight" Value="1600"/>
			</Variant>
		</Variants>

		<CustomProperty DataType="Enumeration" Name="SignalFoundationShaftHeight" DisplayName="Fundament søylehøyde"
			Description="The signal foundation shaft height resp. total bored height.">
			<Values Variant="Betong Hs fundament på fri linje">
				<Value>1700</Value>
			</Values>
			<Values Variant="Betong Hs fundament på plattform">
				<Value>1000</Value>
			</Values>
			<Values Variant="Betong Hs fundament, Ø300/Ø680">
				<Value>1800</Value>
				<Value>1600</Value>
			</Values>
			<Values Variant="Betong Ds fundament, Ø76, konisk">
				<!-- Well, it doesn't really have a shaft - it is conical... -->
				<Value>400</Value>
			</Values>
			<Values Variant="Betong Ds fundament, Ø76, rettsidet">
				<Value>400</Value>
			</Values>
			<Values Variant="Betong Ds fundament, ERTMS">
				<!-- TODO: Check value 400, it's only a guess. -->
				<Value>400</Value>
			</Values>
			<Values Variant="Boret Hs fundament, Ø555">
				<Value>7500</Value>
				<Value>7000</Value>
				<Value>6500</Value>
				<Value>6000</Value>
				<Value>5500</Value>
				<Value>5000</Value>
				<Value>4500</Value>
				<Value>4000</Value>
				<Value>3500</Value>
				<Value>3000</Value>
				<Value>2500</Value>
			</Values>
			<Values Variant="Betong veibomdrivmaskin fundament, Ø210/Ø680">
				<Value>1600</Value>
			</Values>
		</CustomProperty>

		<LuaExpression Name="Geometry3D_0.Name"><Formula>_JBTKU_FUN_Signalfundament_Geometry3DName()</Formula></LuaExpression>
		<LuaFunction Name="_JBTKU_FUN_Signalfundament_Geometry3DName()" ReturnType="Double"
				HideFromUser="false"
				Description="Sampled formula. Returns sideways offset for cable duct element (midway betwen end points on alignment). Must be called with '_position' as input argument (_position.ref = alignment GUID, _position.pos = distAlong).">
			<Signature>_JBTKU_FUN_Signalfundament_Geometry3DName()</Signature>
			<Formula>
				function _JBTKU_FUN_Signalfundament_Geometry3DName()
					if (Variant == "Betong Hs fundament på fri linje") then
						return "NO-BN-3D-KU-FUN-HOVEDSIGNAL-FRI-LINJE-2000x2000x300-650x650-300x300xM24-1700"
					elseif(Variant == "Betong Hs fundament på plattform") then
						return "NO-BN-3D-KU-FUN-HOVEDSIGNAL-PLATTFORM-1750x1750x300-650x650-300x300xM24-1000"
					elseif(Variant == "Betong Hs fundament, Ø300/Ø680") then
						return "NO-BN-3D-KU-FUN-HOVEDSIGNAL-Ø300xØ680-300x300xM24-"..SignalFoundationShaftHeight
					elseif(Variant == "Betong Ds fundament, Ø76, konisk") then
						return "NO-BN-3D-KU-FUN-DVERGSIGNAL-Ø76-KONISK"
					elseif(Variant == "Betong Ds fundament, Ø76, rettsidet") then
						return "NO-BN-3D-KU-FUN-DVERGSIGNAL-Ø76-RETTSIDET"
					elseif(Variant == "Betong Ds fundament, ERTMS") then
						return "NO-BN-3D-KU-FUN-DVERGSIGNAL-ERTMS" -- TODO: Make 3D model for this.
					elseif(Variant == "Boret Hs fundament, Ø555") then
						return "NO-BN-3D-KU-FUN-HOVEDSIGNAL-BORET-Ø555-164x164xM32-"..SignalFoundationShaftHeight
					elseif(Variant == "Betong veibomdrivmaskin fundament, Ø210/Ø680") then
						return "NO-BN-3D-KU-FUN-VEIBOMDRIVMASKIN-Ø210xØ680-210x210xM20-1600"
					end
				end	
			</Formula>
		</LuaFunction>

		<InsertPointObject Name="Betong Hs fundament på fri linje"
				DisplayBlockName="NO-BN-2D-JBTKU_FUN-SIGNALFUNDAMENT-BETONG-HS-PAA-FRI-LINJE-300x300xM24-{{SymbolMode}}" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="3.5">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="-90" EnableDirectionSetting="true"/>
		</InsertPointObject>
		
		<InsertPointObject Name="Betong Hs fundament på plattform"
				DisplayBlockName="NO-BN-2D-JBTKU_FUN-SIGNALFUNDAMENT-BETONG-HS-PAA-PLATTFORM-300x300xM24-{{SymbolMode}}" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="3.5">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="-90" EnableDirectionSetting="true"/>
		</InsertPointObject>
		
		<InsertPointObject Name="Betong Hs fundament, Ø300/Ø680"
				DisplayBlockName="NO-BN-2D-JBTKU_FUN-SIGNALFUNDAMENT-BETONG-HS-Ø300-Ø680-300x300xM24-H1800-{{SymbolMode}}" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="3.5">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="-90" EnableDirectionSetting="true"/>
		</InsertPointObject>
		
		<InsertPointObject Name="Betong Ds fundament, Ø76, konisk"
				DisplayBlockName="NO-BN-2D-JBTKU_FUN-SIGNALFUNDAMENT-BETONG-DS-KONISK-Ø76-{{SymbolMode}}"
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="3.5">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="-90" EnableDirectionSetting="true"/>
		</InsertPointObject>
		
		<InsertPointObject Name="Betong Ds fundament, Ø76, rettsidet"
				DisplayBlockName="NO-BN-2D-JBTKU_FUN-SIGNALFUNDAMENT-BETONG-DS-RETTVEGGET-Ø76-{{SymbolMode}}"
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="3.5">
			<JigSymbolAppearance AddAngle="-90" EnableDirectionSetting="true"/>
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
		</InsertPointObject>
		
		<!-- TODO: Make 2D symbol. Get drawing from Siemens. -->
		<InsertPointObject Name="Betong Ds fundament, ERTMS"
				DisplayBlockName="NO-BN-2D-JBTKU_FUN-SIGNALFUNDAMENT-BETONG-DS-ERTMS-{{SymbolMode}}" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="3.5">
			<JigSymbolAppearance AddAngle="-90" EnableDirectionSetting="true"/>
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
		</InsertPointObject>

		<InsertPointObject Name="Boret Hs fundament, Ø555"
				DisplayBlockName="NO-BN-2D-JBTKU_FUN-SIGNALFUNDAMENT-BETONG-BORET-Ø555-164x164xM32-{{SymbolMode}}"
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="3.5">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="false" RotateIfRightSideOfAlignment="true"/>
			<SetValue Key="dir" Value="both"/>
		</InsertPointObject>
		
		<!-- NB: Veibomdrivmaskin plasseres inntil linjetype 'vei': -->
		<InsertPointObject Name="Betong veibomdrivmaskin fundament, Ø210/Ø680"
				DisplayBlockName="NO-BN-2D-JBTKU_FUN-SIGNALFUNDAMENT-BETONG-VEIBOMDRIVMASKIN-Ø210-Ø680-210x210xM20-H1600-{{SymbolMode}}" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="3.5">
			<OwnAlignmentTargetSpace>vei</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="false" RotateIfRightSideOfAlignment="true"/>
			<SetValue Key="dir" Value="both"/>
		</InsertPointObject>
		
		<SymbolDefinition DefaultBlockName="" AllowSymbolMove="true">
			<Rotation Add180DegreesIfDirIsDown="false" AddAngle="{% if dir == 'up' %}{{270.0|plus:AngularOffset}}
														{% elsif dir == 'down' %}{{90.0|plus:AngularOffset}}
														{% elsif dir == 'both' and RightSided %}{{180.0|plus:AngularOffset}}
														{% elsif dir == 'both' and LeftSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and RightSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and LeftSided %}{{180.0|plus:AngularOffset}}
														{% else %}45.0
														{% endif %}"/>	
			<BlockNameFormat JoinBy="-">
				NO-BN-2D-JBTKU_FUN-SIGNALFUNDAMENT-BETONG
				{% if Variant == 'Betong Hs fundament på fri linje' %}HS-PAA-FRI-LINJE-300x300xM24
				{% elsif Variant == 'Betong Hs fundament på plattform' %}HS-PAA-PLATTFORM-300x300xM24
				{% elsif Variant == 'Betong Hs fundament, Ø300/Ø680' %}HS-Ø300-Ø680-300x300xM24-H1800
				{% elsif Variant == 'Betong Ds fundament, Ø76, konisk' %}DS-KONISK-Ø76
				{% elsif Variant == 'Betong Ds fundament, Ø76, rettsidet' %}DS-RETTVEGGET-Ø76
				{% elsif Variant == 'Betong Ds fundament, ERTMS' %}DS-ERTMS
				{% elsif Variant == 'Boret Hs fundament, Ø555' %}BORET-Ø555-164x164xM32
				{% elsif Variant == 'Betong veibomdrivmaskin fundament, Ø210/Ø680' %}VEIBOMDRIVMASKIN-Ø210-Ø680-210x210xM20-H1600
				{% else %}BAD_Variant_{{Variant}}
				{% endif %}
				{{SymbolMode}}
			</BlockNameFormat>
		</SymbolDefinition>

		<SymbolDefinition DefaultBlockName="NO-BN-2D-JBTRC_INNSETTINGSPUNKT-Schematic" DoNotIncludeInSymbolFrame="true"/>

		<DockPointDefinitions>
			<SnapPoints Variant="Betong Hs fundament på fri linje">
				<SnapPoint X="0.0" Y="0.0" TargetSpace="signal"/>
			</SnapPoints>
			<SnapPoints Variant="Betong Hs fundament på plattform">
				<SnapPoint X="0.0" Y="0.0" TargetSpace="signal"/>
			</SnapPoints>
			<SnapPoints Variant="Betong Hs fundament, Ø300/Ø680">
				<SnapPoint X="0.0" Y="0.0" TargetSpace="signal"/>
			</SnapPoints>
			<SnapPoints Variant="Betong Ds fundament, Ø76, konisk">
				<SnapPoint X="0.0" Y="0.0" TargetSpace="signal"/>
			</SnapPoints>
			<SnapPoints Variant="Betong Ds fundament, Ø76, rettsidet">
				<SnapPoint X="0.0" Y="0.0" TargetSpace="signal"/>
			</SnapPoints>
			<SnapPoints Variant="Betong Ds fundament, ERTMS">
				<SnapPoint X="0.0" Y="0.0" TargetSpace="ertms_shunting_signal"/>
			</SnapPoints>
			<SnapPoints Variant="Boret Hs fundament, Ø555">
				<SnapPoint X="0.0" Y="0.0" TargetSpace="signal"/>
			</SnapPoints>
		</DockPointDefinitions>

	</ObjectType>



<!--========================================================================================================
	CIVIL WORKS
	FOUNDATIONS
	TELECOM
=========================================================================================================-->
	<ObjectType DataType="tOrientedElement" Class="RailwayPlacedObject" LuaName="rctype_TelecomFoundation" Name="JBTKU_FUN Telefundament"
				Layer="JBTKU_FUN" Color="ByLayer"
				Group="Underbygning/Fundamenter/Tele"
				AttMirrorY="{% if RightSided %}true{% else %}false{% endif %}"
				>
				
		<RelationSpace>telefundament</RelationSpace>
		
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___SYMBOLFRAME"/>
		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___VAR"/>
		<xpp:expand select="NOBN_com_STD_TEXATTRIBUTES___VERTICAL_AND_FAR___SUB"/>
		<xpp:expand select="NOBN_com_DISCIPLINE___SUB"/>
		<xpp:expand select="NOBN_com_CHK_NUMBER_OF_OCP_AREAS"/>
		<xpp:expand select="NOBN_com_SET_OCP_STATION_REFERENCE"/>
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___WAYSIDE_GENERAL_OBJECT"/>
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___EARTHED_TO_NONE"/>
		<xpp:expand select="NOBN_com_PSET_BANE_NOR"/>
		<xpp:expand select="NOBN_com_PSET_FDV_BANEDATA"/>
		<xpp:expand select="NOBN_com_PSET_ISY_STK"/>
		<xpp:expand select="NOBN_com_PSET_TITTELFELT"/>

		<Variants>
			<Variant Name="Betongfundament, anvisersøyle">
				<SetValue Key="name" Value="Anvisersøyle fund."/>
				<SetValue Key="Geometry3D_0.Name" Value="NO-BN-3D-KU-FUN-TELE-ANVISERSYØYLE-1500x1500x1000-Ø600"/>
			</Variant>
			<Variant Name="Betongfundament, monitor">
				<SetValue Key="name" Value="Monitor fund."/>
				<SetValue Key="Geometry3D_0.Name" Value="NO-BN-3D-KU-FUN-TELE-MONITOR-1000x1000x1000-Ø600"/>
			</Variant>
			<Variant Name="Betongfundament, validator">
				<SetValue Key="name" Value="NSB validator fund."/>
				<SetValue Key="Geometry3D_0.Name" Value="NO-BN-3D-KU-FUN-TELE-BILLETT-VALIDATOR-360x300x500"/>
			</Variant>
			<Variant Name="Betongfundament, tele- og fordelingsskap">
				<SetValue Key="name" Value="Tele- og fordelingsskap fund."/>
				<SetValue Key="Geometry3D_0.Name" Value="NO-BN-3D-KU-FUN-TELE-FORDELINGSSKAP-900x800x910"/>
			</Variant>
		</Variants>

        <LuaExpression Name="dir"><Formula>"both"</Formula></LuaExpression>
        <LuaExpression Name="code"><Formula>NOBN_sub_getFoundationCode()</Formula></LuaExpression>
        <LuaExpression Name="name"><Formula>tostring(code):upper():match("UNFINISHED") and "" or code</Formula></LuaExpression>

		<InsertPointObject Name="Betongfundament, anvisersøyle" DisplayBlockName="NO-BN-2D-JBTKU_FUN-TELEFUNDAMENT-BETONG-ANVISERSOEYLE-{{SymbolMode}}" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="3.5">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="true" RotateIfRightSideOfAlignment="true"/>
			<SetValue Key="dir" Value="both"/>
		</InsertPointObject>
		
		<InsertPointObject Name="Betongfundament, monitor" DisplayBlockName="NO-BN-2D-JBTKU_FUN-TELEFUNDAMENT-BETONG-MONITOR-{{SymbolMode}}" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="3.5">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="true" RotateIfRightSideOfAlignment="true"/>
			<SetValue Key="dir" Value="both"/>
		</InsertPointObject>
		
		<InsertPointObject Name="Betongfundament, validator" DisplayBlockName="NO-BN-2D-JBTKU_FUN-TELEFUNDAMENT-BETONG-VALIDATOR-{{SymbolMode}}" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="3.5">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="true" RotateIfRightSideOfAlignment="true"/>
			<SetValue Key="dir" Value="both"/>
		</InsertPointObject>
		
		<InsertPointObject Name="Betongfundament, tele- og fordelingsskap" DisplayBlockName="NO-BN-2D-JBTKU_FUN-TELEFUNDAMENT-BETONG-TELESKAP-OG-FORDELINGSSKAP-{{SymbolMode}}" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="3.5">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="true" RotateIfRightSideOfAlignment="true"/>
			<SetValue Key="dir" Value="both"/>
		</InsertPointObject>

		<SymbolDefinition DefaultBlockName="" AllowSymbolMove="true">
			<Rotation Add180DegreesIfDirIsDown="false" AddAngle="{% if dir == 'up' %}{{270.0|plus:AngularOffset}}
														{% elsif dir == 'down' %}{{90.0|plus:AngularOffset}}
														{% elsif dir == 'both' and RightSided %}{{180.0|plus:AngularOffset}}
														{% elsif dir == 'both' and LeftSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and RightSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and LeftSided %}{{180.0|plus:AngularOffset}}
														{% else %}45.0
														{% endif %}"/>	
			<BlockNameFormat JoinBy="-">
				NO-BN-2D-JBTKU_FUN-TELEFUNDAMENT
				{% if Variant == 'Betongfundament, anvisersøyle' %}BETONG-ANVISERSOEYLE
				{% elsif Variant == 'Betongfundament, monitor' %}BETONG-MONITOR
				{% elsif Variant == 'Betongfundament, validator' %}BETONG-VALIDATOR
				{% elsif Variant == 'Betongfundament, tele- og fordelingsskap' %}BETONG-TELESKAP-OG-FORDELINGSSKAP
				{% else %}BAD_Variant_{{Variant}}
				{% endif %}
				{{SymbolMode}}
			</BlockNameFormat>
		</SymbolDefinition>

		<SymbolDefinition DefaultBlockName="NO-BN-2D-JBTRC_INNSETTINGSPUNKT-Schematic" DoNotIncludeInSymbolFrame="true"/>

		<DockPointDefinitions>
			<SnapPoints Variant="Betongfundament, anvisersøyle">
				<SnapPoint X="0.0" Y="0.0" TargetSpace="anvisersøyle"/>
			</SnapPoints>
			<SnapPoints Variant="Betongfundament, monitor">
				<SnapPoint X="0.0" Y="0.0" TargetSpace="monitor"/>
			</SnapPoints>
			<SnapPoints Variant="Betongfundament, validator">
				<SnapPoint X="0.0" Y="0.0" TargetSpace="validator"/>
			</SnapPoints>
			<SnapPoints Variant="Betongfundament, tele- og fordelingsskap">
				<SnapPoint X="0.0" Y="0.0" TargetSpace="fordelingsskap"/>
			</SnapPoints>
		</DockPointDefinitions>

	</ObjectType>



<!--========================================================================================================
	CIVIL WORKS
	FIXATIONS FOR BOARDS
	Små skiltfester som ikke skal monteres på noe annet (ved relations).
	NB: 'KU-SKF' er p.t. ikke en gyldig Banedata kode, men en vi 'fant på selv', omfatter
	dingser som vanligvis ikke fortjener å bli registrert i Banedata.
=========================================================================================================-->
	<ObjectType DataType="tOrientedElement" Class="RailwayPlacedObject" LuaName="rctype_MinorPoleFixing" Name="JBTKU_SKF Skiltfeste"
				Layer="JBTKU_SKF" Color="ByLayer"
				Group="Underbygning/Skiltfester"
				AttMirrorY="{% if RightSided %}true{% else %}false{% endif %}"
				>
				
		<RelationSpace>skiltfeste</RelationSpace>
		<AttachmentCategory Name="skiltfeste"/>
		
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___SYMBOLFRAME"/>
		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___VAR"/>
		<xpp:expand select="NOBN_com_STD_TEXATTRIBUTES___VERTICAL_AND_FAR___SUB"/>
		<xpp:expand select="NOBN_com_DISCIPLINE___SUB"/>
		<xpp:expand select="NOBN_com_CHK_NUMBER_OF_OCP_AREAS"/>
		<xpp:expand select="NOBN_com_SET_OCP_STATION_REFERENCE"/>
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___WAYSIDE_GENERAL_OBJECT"/>
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___EARTHED_TO_NONE"/>
		<xpp:expand select="NOBN_com_PSET_BANE_NOR"/>
		<xpp:expand select="NOBN_com_PSET_FDV_BANEDATA"/>
		<xpp:expand select="NOBN_com_PSET_ISY_STK"/>
		<xpp:expand select="NOBN_com_PSET_TITTELFELT"/>

		<Variants>
			<Variant Name="Betongfundament (h=500mm)">
				<SetValue Key="name" Value="Ø60/b225/h500"/>
				<SetValue Key="Geometry3D_0.Name" Value="NO-BN-3D-KU-SKF-SKILTFESTE-BETONGFOT-Ø60-145..215x500"/>
			</Variant>
			<Variant Name="Betongfundament (h=700mm)">
				<SetValue Key="name" Value="Ø60/b225/h700"/>
				<SetValue Key="Geometry3D_0.Name" Value="NO-BN-3D-KU-SKF-SKILTFESTE-BETONGFOT-Ø60-145..215x700"/>
			</Variant>
			<Variant Name="Betongfundament (h=1200mm)">
				<SetValue Key="name" Value="Ø60/Ø200/h1200"/>
				<SetValue Key="Geometry3D_0.Name" Value="NO-BN-3D-KU-SKF-SKILTFESTE-BETONGFOT-Ø60-Ø200x1200"/>
			</Variant>
			<Variant Name="Jordfundament">
				<SetValue Key="name" Value="Ø60/jordfund."/>
				<SetValue Key="Geometry3D_0.Name" Value="NO-BN-3D-KU-SKF-SKILTFESTE-JORDFUNDAMENT-Ø60-700"/>
			</Variant>
			<Variant Name="Jordspyd (60cm dypt)">
				<SetValue Key="name" Value="Ø60/jordspyd"/>
				<SetValue Key="Geometry3D_0.Name" Value="NO-BN-3D-KU-SKF-SKILTFESTE-JORDSPYD-Ø60"/>
			</Variant>
			<Variant Name="Tilbakefylt grop">
				<SetValue Key="name" Value="Tilbakefylt grop"/>
				<SetValue Key="Geometry3D_0.Name" Value="NO-BN-3D-KU-SKF-SKILTFESTE-TILBAKEFYLT-BALLASTGROP"/>
			</Variant>
			<Variant Name="Strips eller patentbånd">
				<SetValue Key="name" Value="Strips m.m."/>
				<SetValue Key="Geometry3D_0.Name" Value="NO-BN-3D-KU-SKF-SKILTFESTE-PATENTBÅND"/>
			</Variant>
			<Variant Name="Brakett mot gulv">
				<SetValue Key="name" Value="Ø60/gulv"/>
				<SetValue Key="Geometry3D_0.Name" Value="NO-BN-3D-KU-SKF-SKILTFESTE-BRAKETT-MOT-GULV-Ø60-200x200x308"/>
			</Variant>
			<Variant Name="Brakett mot vegg">
				<SetValue Key="name" Value="Ø60/vegg"/>
				<SetValue Key="VerticalOffset" Value="2.5"/>
				<SetValue Key="Geometry3D_0.Name" Value="NO-BN-3D-KU-SKF-SKILTFESTE-BRAKETT-MOT-VEGG-Ø60-150x120x119"/>
			</Variant>
			<Variant Name="Brakett på annen mast">
				<SetValue Key="name" Value="Brakett på annen mast"/>
				<SetValue Key="Geometry3D_0.Name" Value="NO-BN-3D-KU-SKF-SKILTFESTE-BRAKETT-MOT-MAST"/>
			</Variant>
		</Variants>
		
		<LuaExpression Name="dir"><Formula>"both"</Formula></LuaExpression>
		<LuaExpression Name="VerticalOffset"><Formula>if Variant:find("Brakett mot vegg") then return 2.5 else return 0 end</Formula></LuaExpression>

		<InsertPointObject Name="Betongfundament (h=500mm)" DisplayBlockName="NO-BN-2D-JBTKU_SKF-SKILTFESTE-BETONGFOT-60-225-500-{{SymbolMode}}" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="3.5">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance RotateIfRightSideOfAlignment="true" EnableDirectionSetting="true" AddAngle="0"/>
		</InsertPointObject>
		
		<InsertPointObject Name="Betongfundament (h=700mm)" DisplayBlockName="NO-BN-2D-JBTKU_SKF-SKILTFESTE-BETONGFOT-60-225-700-{{SymbolMode}}" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="3.5">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance RotateIfRightSideOfAlignment="true" EnableDirectionSetting="true" AddAngle="0"/>
		</InsertPointObject>
		
		<InsertPointObject Name="Betongfundament (h=1200mm)" DisplayBlockName="NO-BN-2D-JBTKU_SKF-SKILTFESTE-BETONGFOT-60-200-1200-{{SymbolMode}}"
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="3.5">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance RotateIfRightSideOfAlignment="true" EnableDirectionSetting="true" AddAngle="0"/>
		</InsertPointObject>
		
		<InsertPointObject Name="Jordfundament" DisplayBlockName="NO-BN-2D-JBTKU_SKF-SKILTFESTE-JORDFUNDAMENT-60-700-{{SymbolMode}}"
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="3.5">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance RotateIfRightSideOfAlignment="true" EnableDirectionSetting="true" AddAngle="0"/>
		</InsertPointObject>
		
		<InsertPointObject Name="Jordspyd (60cm dypt)" DisplayBlockName="NO-BN-2D-JBTKU_SKF-SKILTFESTE-JORDSPYD-60-{{SymbolMode}}" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="3.5">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance RotateIfRightSideOfAlignment="true" EnableDirectionSetting="true" AddAngle="0"/>
		</InsertPointObject>
		
		<InsertPointObject Name="Tilbakefylt grop" DisplayBlockName="NO-BN-2D-JBTKU_SKF-SKILTFESTE-TILBAKEFYLT-GROP-{{SymbolMode}}"
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="3.5">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance RotateIfRightSideOfAlignment="true" EnableDirectionSetting="true" AddAngle="0"/>
		</InsertPointObject>
		
		<InsertPointObject Name="Strips eller patentbånd" DisplayBlockName="NO-BN-2D-JBTKU_SKF-SKILTFESTE-STRIPS-ELLER-PATENTBÅND-{{SymbolMode}}"
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="3.5">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance RotateIfRightSideOfAlignment="true" EnableDirectionSetting="true" AddAngle="0"/>
		</InsertPointObject>

		<InsertPointObject Name="Brakett på annen mast" DisplayBlockName="NO-BN-2D-JBTKU_SKF-SKILTFESTE-BRAKETT-PÅ-ANNEN-MAST-{{SymbolMode}}" 
                  SnapToAlignment="true" SnapDistance="3.5">
			<JigSymbolAppearance EnableDirectionSetting="true" AddAngle="-90"/>
			<SetValue Key="dir" Value="both"/>
			<SetValue Key="Geometry3D_0.Name" Value="NO-BN-3D-KU-SKF-SKILTFESTE-BRAKETT-MOT-MAST"/>
		</InsertPointObject>

		<InsertPointObject Name="Brakett mot vegg" DisplayBlockName="NO-BN-2D-JBTKU_SKF-SKILTFESTE-BRAKETT-MOT-VEGG-60-110-{{SymbolMode}}"
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="3.5">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance RotateIfRightSideOfAlignment="true" EnableDirectionSetting="true" AddAngle="0"/>
			<SetValue Key="VerticalOffset" Value="2.5"/>
		</InsertPointObject>
		
		<InsertPointObject Name="Brakett mot gulv" DisplayBlockName="NO-BN-2D-JBTKU_SKF-SKILTFESTE-BRAKETT-MOT-GULV-60-308-{{SymbolMode}}"
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="3.5">
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance RotateIfRightSideOfAlignment="true" EnableDirectionSetting="true" AddAngle="0"/>
		</InsertPointObject>
		
		<SymbolDefinition DefaultBlockName="NO-BN-2D-JBTKU_SKF-SKILTFESTE-BETONGFOT-60-225-700-{{SymbolMode}}" AllowSymbolMove="true">
			<Rotation Add180DegreesIfDirIsDown="false" AddAngle="{% if dir == 'up' %}{{270.0|plus:AngularOffset}}
														{% elsif dir == 'down' %}{{90.0|plus:AngularOffset}}
														{% elsif dir == 'both' and RightSided %}{{180.0|plus:AngularOffset}}
														{% elsif dir == 'both' and LeftSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and RightSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and LeftSided %}{{180.0|plus:AngularOffset}}
														{% else %}45.0
														{% endif %}"/>	
			<BlockNameFormat JoinBy="-">
				NO-BN-2D-JBTKU_SKF-SKILTFESTE
				{% if Variant == 'Betongfundament (h=500mm)' %}BETONGFOT-60-225-500
				{% elsif Variant == 'Betongfundament (h=700mm)' %}BETONGFOT-60-225-700
				{% elsif Variant == 'Betongfundament (h=1200mm)' %}BETONGFOT-60-200-1200
				{% elsif Variant == 'Jordfundament' %}JORDFUNDAMENT-60-700
				{% elsif Variant == 'Jordspyd (60cm dypt)' %}JORDSPYD-60
				{% elsif Variant == 'Brakett mot gulv' %}BRAKETT-MOT-GULV-60-308
				{% elsif Variant == 'Brakett på annen mast' %}BRAKETT-PÅ-ANNEN-MAST
				{% elsif Variant == 'Brakett mot vegg' %}BRAKETT-MOT-VEGG-60-110
				{% elsif Variant == 'Tilbakefylt grop' %}TILBAKEFYLT-GROP
				{% elsif Variant == 'Strips eller patentbånd' %}STRIPS-ELLER-PATENTBÅND
				{% else %}BAD_Variant_{{Variant}}
				{% endif %}
				{{SymbolMode}}
			</BlockNameFormat>
		</SymbolDefinition>

		<SymbolDefinition DefaultBlockName="NO-BN-2D-JBTRC_INNSETTINGSPUNKT-Schematic" DoNotIncludeInSymbolFrame="true"/>

		<DockPointDefinitions>
			<SnapPoints>
				<SnapPoint X="0.0" Y="0.0" TargetSpace="skilt"/>
				<SnapPoint X="0.0" Y="0.0" TargetSpace="stolpe"/>
				<SnapPoint X="0.0" Y="0.0" TargetSpace="skilt_mot_vei"/>
			</SnapPoints>
		</DockPointDefinitions>

	</ObjectType>



<!--========================================================================================================
    End of file 
=========================================================================================================-->
</xpp:bloc>

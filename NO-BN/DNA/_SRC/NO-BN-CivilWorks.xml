<!--========================================================================================================

    NO-BN-CivilWorks.xml
	
	Include in DNA file using XPPq XML preprocessor directive <xpp:expand href="fileName.xml" />.

	(c) Railcomplete AS, Norway, 2015-2021. All rights reserved.
	
=========================================================================================================-->
<xpp:bloc>



<!--========================================================================================================
	UNDERBYGNING
	KABELFØRINGER
	JBTKU_KFØ Kabelkanal
	Cable ducts are made from concrete or plastic, where cables may enter or exit at any time through the use of a 
	duct connection element. 
	TODO: Avklare med Bane NOR om TAG-koden kan benyttes,
	TODO: Add duct connection elements.
	TODO: Automatic routing of cables in cable ducts. Modelchecking of duct fill percentage.
 =========================================================================================================-->
	<ObjectType DataType="tElementWithAlignment" Class="RailwayAlignment" Name="JBTKU_KFØ Kabelkanal"
				Layer="JBTKU_KFØ_KABELKANAL" Color="ByLayer" 
				Group="Underbygning/Føringsveier"
				>

		<RelationSpace>kabelføring</RelationSpace>

		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___TAG_OBJECTINFO_METADATA_VAR" />
		<xpp:expand select="NOBN_com_STD_TEXTATTRIBUTES___HORIZONTAL_AND_CLOSE___JBTUB" />
		<xpp:expand select="NOBN_com_DISCIPLINE_JBTUB" />

		<!-- TODO Fjerne AlignmentSystem? -->
		<AlignmentSystems DefaultSystemName="Kabelføring" >
			<AlignmentSystem Name="Kabelføring"
				CantGauge="0.000"
				AlignmentGauge="0.000"
				QuickMode3DLiftWithCant="false"
			 />
		</AlignmentSystems>

		<Variants DefaultValue="Kabelkanal, betong, 1-løps, 30 cm" >
			<Variant Name="Kabelkanal, betong, 1-løps, 30 cm" />
			<Variant Name="Kabelkanal, betong, 1-løps, 40 cm" />
			<Variant Name="Kabelkanal, betong, 2-løps, 60 cm" />
			<Variant Name="Kabelkanal, betong, 3-løps, 60 cm" />
		</Variants>

		<LuaExpression Name="name" ><Formula>code.." ("..Variant..")"</Formula></LuaExpression>

		<SetValue Key="Sweep3D" Value="True" />
		<SetValue Key="QuickMode3D" Value="True" />

		<LuaFunction Name="_JBTKU_KFOE_Duct_getStartEndAndJump" 
				ReturnType="AlignmentInfo,AlignmentInfo,Double"
				HideFromUser="false"
				Description="Sampled formula. Returns alignmentInfo structs for one duct element's start and end, plus the jump length from start to end along the duct's alignment. Must be called with '_position' as input argument (_position.ref = alignment GUID, _position.pos = distAlong)." >
			<Constructor>AlignmentInfo,AlignmentInfo,Double _JBTKU_KFOE_Duct_getStartEndAndJump(_position)</Constructor>
			<Formula>
				function _JBTKU_KFOE_Duct_getStartEndAndJump(_position)
					--Interpret 'Cant' stored in duct's alignment as extra offset (usually the lift of the closest rail) [mm]:
					local id,pos,len2d,offset,s,e,a,b
					id = _position.ref.id
					pos = _position.pos
					len2d = getObjectFromId(id).RcAlignment.HorizontalProfile.Length
					offset = 0.499 * Model3DSeparation --pick samples at +/- offset from object's insertion point
					if pos &lt; offset then
						a = 0
						b = pos + offset
					elseif pos &gt; len2d - offset then 
						a = pos - offset
						b = len2d
					else 
						a = pos - offset
						b = pos + offset
					end
					s = getAlignmentInfo(getAlignmentPos(id,a))
					e = getAlignmentInfo(getAlignmentPos(id,b))
					return s,e,b-a
				end
			</Formula>
		</LuaFunction>

		<!-- Trick: If QuickMode3D is False, then use possible Cant in the duct alignment as the height to add in 3D: -->
		<!-- '_position' is an intrinsic variable available to sampled Lua functions. -->
		<LuaExpression Name="Offset3D.X" ><Formula>sweep3D and 0 or _JBTKU_KFOE_Duct_Offset3dX(_position)</Formula></LuaExpression>
		<LuaFunction Name="_JBTKU_KFOE_Duct_Offset3dX" ReturnType="Double"
				HideFromUser="false"
				Description="Sampled formula. Returns sideways offset for cable duct element (midway betwen end points on alignment). Must be called with '_position' as input argument (_position.ref = alignment GUID, _position.pos = distAlong)." >
			<Constructor>Double _JBTKU_KFOE_Duct_Offset3dX(_position)</Constructor>
			<Formula>
				function _JBTKU_KFOE_Duct_Offset3dX(_position)
					local s,e,m
					s,e = _JBTKU_KFOE_Duct_getStartEndAndJump(_position)
					m = getAlignmentInfo(_position.ref.id,(s.Point.X + e.Point.X)/2,(s.Point.Y + e.Point.Y)/2)
					return m.DistanceToAlignment
				end	
			</Formula>
		</LuaFunction>

		<!-- '_position' is an intrinsic variable available to sampled Lua functions. -->
		<LuaExpression Name="Offset3D.Z" ><Formula>_JBTKU_KFOE_Duct_Offset3dZ(_position)</Formula></LuaExpression>
		<LuaFunction Name="_JBTKU_KFOE_Duct_Offset3dZ" 
				ReturnType="Double"
				HideFromUser="false"
				Description="Sampled formula. Returns an extra elevation for the cable duct element, as stored in millimeter as Cant data. Copy cant data from closest track's relevant cant using Alignment Manager datagrid/Cant. Must be called with '_position' as input argument (_position.ref = alignment GUID, _position.pos = distAlong)." >
			<Constructor>Double _JBTKU_KFOE_Duct_Offset3dZ(_position)</Constructor>
			<Formula>
				function _TFGC_CCC_Offset3dZ(_position)
					startAi,endAi,jumpDist = _TFGC_CCC_getStartEndAndJump(_position)
					mid = getAlignmentInfo(_position)
					startElevation = startAi.Elevation
					endElevation = endAi.Elevation
					startCant = RC__isNan(startAi.Cant) and 0 or startAi.Cant
					endCant = RC__isNan(endAi.Cant) and 0 or endAi.Cant
					if true then return {mid.Point.X, mid.Point.Y,mid.Point.Z}, startAi.Elevation, endElevation, startCant,endCant end
					return (startElevation + endElevation)/2 + (startCant/1000 + endCant/1000)/2 - mid.Point.Z
				end
			</Formula>
		</LuaFunction>
		
		<!-- Cant gradient is stored as per mille - using possible Cant information in the alignment (measured in millimeter, just copy from neighbor track's Cant) -->
		<!-- '_position' is an intrinsic variable available to sampled Lua functions. -->
		<LuaExpression Name="Rotation3D.X" ><Formula>_JBTKU_KFOE_Duct_Rotation3dX(_position)</Formula></LuaExpression>
		<LuaFunction Name="_JBTKU_KFOE_Duct_Rotation3dX" 
				ReturnType="Double"
				HideFromUser="false"
				Description="Sampled formula. Returns the pitch [Decimal Degrees] for the cable duct element, adding the effects of general vertical profile and the additional duct elevation stored as alignment 'cant'. Must be called with '_position' as input argument (_position.ref = alignment GUID, _position.pos = distAlong)." >
			<Constructor>Double _JBTKU_KFOE_Duct_Rotation3dX(_position)</Constructor>
			<Formula>
				function _JBTKU_KFOE_Duct_Rotation3dX(_position)
					local s,e,m
					local jump
					s,e,jump = _JBTKU_KFOE_Duct_getStartEndAndJump(_position)
					sc = RC__isNan(s.Cant) and 0 or s.Cant
					ec = RC__isNan(e.Cant) and 0 or e.Cant
					return math.deg( math.atan((e.Elevation-s.Elevation) + (ec/1000-sc/1000), jump) )
				end	
			</Formula>
		</LuaFunction>
		
		<!-- '_position' is an intrinsic variable available to sampled Lua functions. -->
		<LuaExpression Name="Rotation3D.Z" ><Formula>_JBTKU_KFOE_Duct_Rotation3dZ(_position)</Formula></LuaExpression>
		<LuaFunction Name="_JBTKU_KFOE_Duct_Rotation3dZ" 
				ReturnType="Double"
				HideFromUser="false"
				Description="Sampled formula. Returns the yaw [Decimal Degrees] for the cable duct element. Must be called with '_position' as input argument (_position.ref = alignment GUID, _position.pos = distAlong)." >
			<Constructor>Double _JBTKU_KFOE_Duct_Rotation3dZ(_position)</Constructor>
			<Formula>
				function _JBTKU_KFOE_Duct_Rotation3dZ(_position)
					local s,e,m
					s,e = _JBTKU_KFOE_Duct_getStartEndAndJump(_position)
					m = getAlignmentInfo(_position)
					return math.deg( (math.atan(e.Point.Y-s.Point.Y,e.Point.X-s.Point.X) - math.atan(m.Tangent.Y,m.Tangent.X)) )
				end	
			</Formula>
		</LuaFunction>
		
		<LuaExpression Name="Linetype" ><Formula>_JBTKU_KFOE_Duct_Linetype()</Formula></LuaExpression>
		<LuaFunction Name="_JBTKU_KFOE_Duct_Linetype" 
				ReturnType="String"
				HideFromUser="false"
				Description="Returns the CAD system 2D presentation line type for the cable duct, based on its Variant." >
			<Constructor>String _JBTKU_KFOE_Duct_Linetype()</Constructor>
			<Formula>
				function _JBTKU_KFOE_Duct_Linetype()
					if Variant:lower():match("1%-løps") then return "RC-DASHED-01"
					elseif Variant:lower():match("2%-løps") then return "RC-DASHED-02"
					elseif Variant:lower():match("3%-løps") then return "RC-DASHED-03"
					else return "Continuous",_info("Variant ["..Variant.."] has not been anticipated yet.")
					end
				end
			</Formula>
		</LuaFunction>

		<LuaExpression Name="GlobalWidth" ><Formula>_JBTKU_KFOE_Duct_GlobalWidth()</Formula></LuaExpression>
		<LuaFunction Name="_JBTKU_KFOE_Duct_GlobalWidth" 
				ReturnType="Double"
				HideFromUser="false"
				Description="Returns the global width of the cable duct's 2D representation as a wide polyline." >
			<Constructor>Double _JBTKU_KFOE_Duct_GlobalWidth()</Constructor>
			<Formula>
				function _JBTKU_KFOE_Duct_GlobalWidth()
					if Variant:lower():match("1%-løps, 30 cm") then return 0.30
					elseif Variant:lower():match("1%-løps, 40 cm") then return 0.40
					elseif Variant:lower():match("2%-løps, 60 cm") then return 0.62
					elseif Variant:lower():match("3%-løps, 60 cm") then return 0.62
					else return 0,_info("Variant ["..Variant.."] has not been anticipated yet.")
					end
				end
			</Formula>
		</LuaFunction>

		<LuaExpression Name="Model3DName" ><Formula>_JBTKU_KFOE_Duct_Model3DName()</Formula></LuaExpression>
		<LuaFunction Name="_JBTKU_KFOE_Duct_Model3DName()" 
				ReturnType="String"
				HideFromUser="false"
				Description="Returns the cable duct default 3D object model name." >
			<Constructor>String _JBTKU_KFOE_Duct_Model3DName()</Constructor>
			<Formula>
				function _JBTKU_KFOE_Duct_Model3DName()
					t = Sweep3D and "NO-BN-SWEEP-KU-KFØ-KABELKANAL-" or "NO-BN-3D-KU-KFØ-KABELKANAL-"
					if Variant == "Kabelkanal, betong, 1-løps, 30 cm" then return t.."300x1000-1-LØPS-MED-50-50-LOKK"
					elseif Variant == "Kabelkanal, betong, 1-løps, 40 cm" then return t.."400x1000-1-LØPS-MED-50-50-LOKK"
					elseif Variant == "Kabelkanal, betong, 2-løps, 60 cm" then return t.."620x2400-2-LØPS-MED-70-70-LOKK"
					elseif Variant == "Kabelkanal, betong, 3-løps, 60 cm" then return t.."620x2400-3-LØPS-MED-70-70-LOKK"
					else 
						return "",_info("Variant ["..Variant.."] has not been anticipated yet.")
					end
				end
			</Formula>
		</LuaFunction>

		<!-- '_position' is an intrinsic variable available to sampled Lua functions. -->
		<LuaExpression Name="Model3DSeparation" ><Formula>Sweep3D and RC__getNearest3DStep(1.0) or _JBTKU_KFOE_duct_Model3DSeparation(_position)</Formula></LuaExpression>
		<LuaFunction Name="_JBTKU_KFOE_duct_Model3DSeparation()" 
				ReturnType="Double"
				HideFromUser="false"
				Description="Returns the distance to the next 3D model insertion point along the alignment axis during 3D Preview or 3D Export. Must be called with '_position' as input argument (_position.ref = alignment GUID, _position.pos = distAlong)." >
			<Constructor>Double _JBTKU_KFOE_duct_Model3DSeparation(Double _position)</Constructor>
			<Formula>
				function _JBTKU_KFOE_duct_Model3DSeparation(pos)
					-- TODO: A more elaborate function would rely on the actual size for each inserted 3D Model, which may vary as a sampled function along the alignment.
					-- This simple formula assumes that the Model3D is constant along the alignment, decided by the Variant (which applies to the whole alignment's length)
					-- TODO: Implement 'SweepMode3D' which interprets the given 3D Model Name as a 2D section to be sweeped (or twisted, if Cant info is provided).
					if Variant == "Kabelkanal, betong, 1-løps, 30 cm" then 
						f = 2400/1000
						b = 0.3
					elseif Variant == "Kabelkanal, betong, 1-løps, 40 cm" then 
						f = 2400/1000
						b = 0.4
					elseif Variant == "Kabelkanal, betong, 2-løps, 60 cm" then 
						f = 1
						b = 0.6
					elseif Variant == "Kabelkanal, betong, 3-løps, 60 cm" then 
						f = 1
						b = 0.6
					else 
						return 3.1416,_info("Variant ["..Variant.."] has not been anticipated yet - so we assume 3.1416m 3D Model Separation...")
					end
					r = getAlignmentInfo(pos).CurveRadius
					-- Empirical formula, to allow a small separation between concrete elements in the "outer curve", but assuming that it will be cut in the "inner curve".
					if r == nil or r &gt; 100 then 
						return 2.4 / f + .005
					elseif r &lt; (0.8 / b) then 
						return (2.4 - b) / f
					else 
						return (2.4 - 0.8/r) / f + .005
					end
				end
			</Formula>
		</LuaFunction>

		<LuaExpression Name="Model3DOffset" ><Formula>Sweep3D and 0 or RC__round(_JBTKU_KFOE_duct_Model3DSeparation()/2, 1)</Formula></LuaExpression>

		<PropertyPrompt Key="code" DefaultValue="Kabelkanal" AcceptEmptyValue="false" />

		<InsertAlignment VariantName="Kabelkanal, betong, 1-løps, 30 cm" SubGroup="Kabelkanaler" DisplayBlockName="NO-BN-2D-##RC_THUMBNAIL-KABELFOERING-KABELKANAL-1-LOEPS-300-Schematic" DefaultToTangentContinuity="false" >
			<IncludeSegmentType>Tangent</IncludeSegmentType>
			<IncludeSegmentType>Curve</IncludeSegmentType>
		</InsertAlignment>
		<InsertAlignment VariantName="Kabelkanal, betong, 1-løps, 40 cm" SubGroup="Kabelkanaler" DisplayBlockName="NO-BN-2D-##RC_THUMBNAIL-KABELFOERING-KABELKANAL-1-LOEPS-400-Schematic" DefaultToTangentContinuity="false" >
			<IncludeSegmentType>Tangent</IncludeSegmentType>
			<IncludeSegmentType>Curve</IncludeSegmentType>
		</InsertAlignment>
		<InsertAlignment VariantName="Kabelkanal, betong, 2-løps, 60 cm" SubGroup="Kabelkanaler" DisplayBlockName="NO-BN-2D-##RC_THUMBNAIL-KABELFOERING-KABELKANAL-2-LOEPS-620-Schematic" DefaultToTangentContinuity="false" >
			<IncludeSegmentType>Tangent</IncludeSegmentType>
			<IncludeSegmentType>Curve</IncludeSegmentType>
		</InsertAlignment>
		<InsertAlignment VariantName="Kabelkanal, betong, 3-løps, 60 cm" SubGroup="Kabelkanaler" DisplayBlockName="NO-BN-2D-##RC_THUMBNAIL-KABELFOERING-KABELKANAL-3-LOEPS-620-Schematic" DefaultToTangentContinuity="false" >
			<IncludeSegmentType>Tangent</IncludeSegmentType>
			<IncludeSegmentType>Curve</IncludeSegmentType>
		</InsertAlignment>

	</ObjectType>
			


<!--========================================================================================================
	CIVIL WORKS
	CABLE DUCT - CONCRETE ENCASED
	Tube packages made from plastic or steel, most often with concrete encasing, where cables may NOT 
	enter or exit except at the ends. 
 =========================================================================================================-->
	<ObjectType DataType="tElementWithAlignment" Class="RailwayAlignment" Name="JBTKU_KFØ Rørpakke"
				Layer="JBTKU_KFØ_RØRPAKKE" Color="ByLayer" 
				Group="Underbygning/Føringsveier"
				>

		<RelationSpace>rørpakke</RelationSpace>

		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___TAG_OBJECTINFO_METADATA_VAR" />
		<xpp:expand select="NOBN_com_STD_TEXTATTRIBUTES___HORIZONTAL_AND_CLOSE___JBTUB" />
		<xpp:expand select="NOBN_com_DISCIPLINE_JBTUB" />

		<!-- TODO Fjerne AlignmentSystem? -->
		<AlignmentSystems DefaultSystemName="Kabelføring" >
			<AlignmentSystem Name="Kabelføring"
				CantGauge="0.000"
				AlignmentGauge="0.000"
				QuickMode3DLiftWithCant="false"
			 />
		</AlignmentSystems>

		<!-- AxBxC means 'A layers (layer 1 = bottom), B tubes per layer (1 = leftmost), diameter C mm -->
		<!-- If the composition of tubes is not identical between layers, then layer 1 is mentioned first etc. -->
		<!-- Enclose each layer in parenthesis. Colors R=red G=green Y=yellow B=blue may be assigned. -->

		<Variants DefaultValue="Rørpakke, omstøpt, 1x4xØ110" >
			<Variant Name="Rørpakke, omstøpt, 1x2xØ110" />
			<Variant Name="Rørpakke, omstøpt, 2x2xØ110" />
			<Variant Name="Rørpakke, omstøpt, 3x2xØ110" />
			<Variant Name="Rørpakke, omstøpt, 4x2xØ110" />

			<Variant Name="Rørpakke, omstøpt, 1x3xØ110" />
			<Variant Name="Rørpakke, omstøpt, 2x3xØ110" />
			<Variant Name="Rørpakke, omstøpt, 3x3xØ110" />
			<Variant Name="Rørpakke, omstøpt, 4x3xØ110" />

			<Variant Name="Rørpakke, omstøpt, 1x4xØ110" />
			<Variant Name="Rørpakke, omstøpt, 2x4xØ110" />
			<Variant Name="Rørpakke, omstøpt, 3x4xØ110" />
			<Variant Name="Rørpakke, omstøpt, 4x4xØ110" />

			<Variant Name="Rørpakke, omstøpt, 3x(3xØ110-Ø160),(3xØ110)" />
		</Variants>

		<SetValue Key="Sweep3D" Value="True" />
		<SetValue Key="QuickMode3D" Value="True" />

		<LuaExpression Name="name" ><Formula>code.." ("..Variant..")"</Formula></LuaExpression>

		<LuaExpression Name="Linetype" ><Formula>_JBTKU_KFOE_Package_Linetype()</Formula></LuaExpression>
		<LuaFunction Name="_JBTKU_KFOE_Package_Linetype" 
				ReturnType="String"
				HideFromUser="false"
				Description="Returns the CAD system 2D presentation line type for the cable tube package, based on its Variant." >
			<Constructor>String _JBTKU_KFOE_Package_Linetype()</Constructor>
			<Formula>
				function _JBTKU_KFOE_Package_Linetype()
					return "Continuous"
				end
			</Formula>
		</LuaFunction>

		<LuaExpression Name="GlobalWidth" ><Formula>_JBTKU_KFOE_Package_GlobalWidth()</Formula></LuaExpression>
		<LuaFunction Name="_JBTKU_KFOE_Package_GlobalWidth" 
				ReturnType="Double"
				HideFromUser="false"
				Description="Returns the global width of the cable tube package's 2D representation as a wide polyline." >
			<Constructor>Double _JBTKU_KFOE_Package_GlobalWidth()</Constructor>
			<Formula>
				function _JBTKU_KFOE_Package_GlobalWidth()
					    if Variant == "Rørpakke, omstøpt, 1x2xØ110" then return 0.310
					elseif Variant == "Rørpakke, omstøpt, 2x2xØ110" then return 0.310
					elseif Variant == "Rørpakke, omstøpt, 3x2xØ110" then return 0.310
					elseif Variant == "Rørpakke, omstøpt, 4x2xØ110" then return 0.310
					elseif Variant == "Rørpakke, omstøpt, 1x3xØ110" then return 0.450
					elseif Variant == "Rørpakke, omstøpt, 2x3xØ110" then return 0.450
					elseif Variant == "Rørpakke, omstøpt, 3x3xØ110" then return 0.450
					elseif Variant == "Rørpakke, omstøpt, 4x3xØ110" then return 0.450
					elseif Variant == "Rørpakke, omstøpt, 1x4xØ110" then return 0.590
					elseif Variant == "Rørpakke, omstøpt, 2x4xØ110" then return 0.590
					elseif Variant == "Rørpakke, omstøpt, 3x4xØ110" then return 0.590
					elseif Variant == "Rørpakke, omstøpt, 4x4xØ110" then return 0.590
					elseif Variant == "Rørpakke, omstøpt, 3x(3xØ110-Ø160),(3xØ110)" then return 0.640
					else 
						return 0,"Unrecognized variant ["..Variant.."]."
					end
				end
			</Formula>
		</LuaFunction>

		<LuaExpression Name="Model3DName" ><Formula>_JBTKU_KFOE_Package_Model3DName()</Formula></LuaExpression>
		<LuaFunction Name="_JBTKU_KFOE_Package_Model3DName()" 
				ReturnType="String"
				HideFromUser="false"
				Description="Returns the tube package default 3D object model name." >
			<Constructor>Double _JBTKU_KFOE_Package_Model3DName()</Constructor>
			<Formula>
				function _JBTKU_KFOE_Package_Model3DName()
					    if Variant == "Rørpakke, omstøpt, 1x2xØ110" then return "NO-BN-SWEEP-KU-KFØ-OMSTØPT-RØRPAKKE-(1x(G110-G110))"
					elseif Variant == "Rørpakke, omstøpt, 2x2xØ110" then return "NO-BN-SWEEP-KU-KFØ-OMSTØPT-RØRPAKKE-(2x(G110-G110))"
					elseif Variant == "Rørpakke, omstøpt, 3x2xØ110" then return "NO-BN-SWEEP-KU-KFØ-OMSTØPT-RØRPAKKE-(3x(G110-G110))"
					elseif Variant == "Rørpakke, omstøpt, 4x2xØ110" then return "NO-BN-SWEEP-KU-KFØ-OMSTØPT-RØRPAKKE-(4x(G110-G110))"
					elseif Variant == "Rørpakke, omstøpt, 1x3xØ110" then return "NO-BN-SWEEP-KU-KFØ-OMSTØPT-RØRPAKKE-(1x(B110-G110-R110))"
					elseif Variant == "Rørpakke, omstøpt, 2x3xØ110" then return "NO-BN-SWEEP-KU-KFØ-OMSTØPT-RØRPAKKE-(2x(B110-G110-R110))"
					elseif Variant == "Rørpakke, omstøpt, 3x3xØ110" then return "NO-BN-SWEEP-KU-KFØ-OMSTØPT-RØRPAKKE-(3x(B110-G110-R110))"
					elseif Variant == "Rørpakke, omstøpt, 4x3xØ110" then return "NO-BN-SWEEP-KU-KFØ-OMSTØPT-RØRPAKKE-(4x(B110-G110-R110))"
					elseif Variant == "Rørpakke, omstøpt, 1x4xØ110" then return "NO-BN-SWEEP-KU-KFØ-OMSTØPT-RØRPAKKE-(1x(Y110- B110-G110-R110))"
					elseif Variant == "Rørpakke, omstøpt, 2x4xØ110" then return "NO-BN-SWEEP-KU-KFØ-OMSTØPT-RØRPAKKE-(2x(Y110- B110-G110-R110))"
					elseif Variant == "Rørpakke, omstøpt, 3x4xØ110" then return "NO-BN-SWEEP-KU-KFØ-OMSTØPT-RØRPAKKE-(3x(Y110- B110-G110-R110))"
					elseif Variant == "Rørpakke, omstøpt, 4x4xØ110" then return "NO-BN-SWEEP-KU-KFØ-OMSTØPT-RØRPAKKE-(4x(Y110- B110-G110-R110))"
					elseif Variant == "Rørpakke, omstøpt, 3x(3xØ110-Ø160),(3xØ110)" then 
						return "NO-BN-SWEEP-KU-KFØ-OMSTØPT-RØRPAKKE-(3x(B110-Y110-R110-G160)-(B110-Y110-R110))"
					else 
						return "???","Unrecognized variant ["..Variant.."]."
					end
				end
			</Formula>
		</LuaFunction>

		<!-- 0.25 step => Allow for quite sharp cable bends without getting a 'jagged' tubing: -->
		<LuaExpression Name="Model3DSeparation" ><Formula>RC__getNearest3DStep(0.25)</Formula></LuaExpression>
		<LuaExpression Name="Model3DOffset" ><Formula>0</Formula></LuaExpression>
		<!-- '_position' is an intrinsic variable available to sampled Lua functions. -->
		<LuaExpression Name="Offset3D.Z" ><Formula>_JBTKU_KFOE_Package_Offset3dZ(_position)</Formula></LuaExpression>
		<LuaFunction Name="_JBTKU_KFOE_Package_Offset3dZ()" ReturnType="String" HideFromUser="false"
				Description="Returns the tube package default elevation, interpolated linearly from the nearest manhole (or track) close to each end. Must be called with '_position' as input argument (_position.ref = alignment GUID, _position.pos = distAlong)." >
			<Constructor>Double _JBTKU_KFOE_Package_Offset3dZ(_position)</Constructor>
			<Formula>
				function _JBTKU_KFOE_Package_Offset3dZ(_position)
					--Draw concrete encased tubes in a straight line from one end to the other
					zOffsetFromManhole = 0.900 --[m]
					p1 = RcAlignment.StartPoint
					p2 = RcAlignment.EndPoint
					m1 = getNearbyPointObjects2D(p1, 2.5, "JBTKU_KFØ Trekkekum")
					m2 = getNearbyPointObjects2D(p2, 2.5, "JBTKU_KFØ Trekkekum")
					n1 = getCollectionLength(m1)
					n2 = getCollectionLength(m2) 
					if n1 + n2 == 0 then
						return 0,_info("No nearby manholes found [&lt;= 2.5m] - cannot deduce a reasonable depth for encased tubes")
					elseif n1 == 0 then
						z2 = m2[0].geoCoord.Z
						z1 = z2
					elseif n2 == 0 then
						z1 = m1[0].geoCoord.Z
						z2 = z1	
					else
						z1 = m1[0].geoCoord.Z
						z2 = m2[0].geoCoord.Z
					end
					p = _position.pos
					L = RcAlignment.HorizontalProfile.Length
					Z = ((z2-z1)/L)*p + z1 - zOffsetFromManhole
					return  Z
				end
			</Formula>
		</LuaFunction>

		<PropertyPrompt Key="code" DefaultValue="Omstøpt rørpakke" AcceptEmptyValue="false" />

		<InsertAlignment VariantName="Rørpakke, omstøpt, 1x2xØ110" DisplayBlockName="NO-BN-2D-##RC_THUMBNAIL-KABELFOERING-OMSTOEPTE-TREKKEROER-Schematic" DefaultToTangentContinuity="true" >
			<IncludeSegmentType>Tangent</IncludeSegmentType>
			<IncludeSegmentType>Curve</IncludeSegmentType>
		</InsertAlignment>
		<InsertAlignment VariantName="Rørpakke, omstøpt, 2x2xØ110" DisplayBlockName="NO-BN-2D-##RC_THUMBNAIL-KABELFOERING-OMSTOEPTE-TREKKEROER-Schematic" DefaultToTangentContinuity="true" >
			<IncludeSegmentType>Tangent</IncludeSegmentType>
			<IncludeSegmentType>Curve</IncludeSegmentType>
		</InsertAlignment>
		<InsertAlignment VariantName="Rørpakke, omstøpt, 3x2xØ110" DisplayBlockName="NO-BN-2D-##RC_THUMBNAIL-KABELFOERING-OMSTOEPTE-TREKKEROER-Schematic" DefaultToTangentContinuity="true" >
			<IncludeSegmentType>Tangent</IncludeSegmentType>
			<IncludeSegmentType>Curve</IncludeSegmentType>
		</InsertAlignment>
		<InsertAlignment VariantName="Rørpakke, omstøpt, 4x2xØ110" DisplayBlockName="NO-BN-2D-##RC_THUMBNAIL-KABELFOERING-OMSTOEPTE-TREKKEROER-Schematic" DefaultToTangentContinuity="true" >
			<IncludeSegmentType>Tangent</IncludeSegmentType>
			<IncludeSegmentType>Curve</IncludeSegmentType>
		</InsertAlignment>
		<InsertAlignment VariantName="Rørpakke, omstøpt, 1x3xØ110" DisplayBlockName="NO-BN-2D-##RC_THUMBNAIL-KABELFOERING-OMSTOEPTE-TREKKEROER-Schematic" DefaultToTangentContinuity="true" >
			<IncludeSegmentType>Tangent</IncludeSegmentType>
			<IncludeSegmentType>Curve</IncludeSegmentType>
		</InsertAlignment>
		<InsertAlignment VariantName="Rørpakke, omstøpt, 2x3xØ110" DisplayBlockName="NO-BN-2D-##RC_THUMBNAIL-KABELFOERING-OMSTOEPTE-TREKKEROER-Schematic" DefaultToTangentContinuity="true" >
			<IncludeSegmentType>Tangent</IncludeSegmentType>
			<IncludeSegmentType>Curve</IncludeSegmentType>
		</InsertAlignment>
		<InsertAlignment VariantName="Rørpakke, omstøpt, 3x3xØ110" DisplayBlockName="NO-BN-2D-##RC_THUMBNAIL-KABELFOERING-OMSTOEPTE-TREKKEROER-Schematic" DefaultToTangentContinuity="true" >
			<IncludeSegmentType>Tangent</IncludeSegmentType>
			<IncludeSegmentType>Curve</IncludeSegmentType>
		</InsertAlignment>
		<InsertAlignment VariantName="Rørpakke, omstøpt, 4x3xØ110" DisplayBlockName="NO-BN-2D-##RC_THUMBNAIL-KABELFOERING-OMSTOEPTE-TREKKEROER-Schematic" DefaultToTangentContinuity="true" >
			<IncludeSegmentType>Tangent</IncludeSegmentType>
			<IncludeSegmentType>Curve</IncludeSegmentType>
		</InsertAlignment>
		<InsertAlignment VariantName="Rørpakke, omstøpt, 1x4xØ110" DisplayBlockName="NO-BN-2D-##RC_THUMBNAIL-KABELFOERING-OMSTOEPTE-TREKKEROER-Schematic" DefaultToTangentContinuity="true" >
			<IncludeSegmentType>Tangent</IncludeSegmentType>
			<IncludeSegmentType>Curve</IncludeSegmentType>
		</InsertAlignment>
		<InsertAlignment VariantName="Rørpakke, omstøpt, 2x4xØ110" DisplayBlockName="NO-BN-2D-##RC_THUMBNAIL-KABELFOERING-OMSTOEPTE-TREKKEROER-Schematic" DefaultToTangentContinuity="true" >
			<IncludeSegmentType>Tangent</IncludeSegmentType>
			<IncludeSegmentType>Curve</IncludeSegmentType>
		</InsertAlignment>
		<InsertAlignment VariantName="Rørpakke, omstøpt, 3x4xØ110" DisplayBlockName="NO-BN-2D-##RC_THUMBNAIL-KABELFOERING-OMSTOEPTE-TREKKEROER-Schematic" DefaultToTangentContinuity="true" >
			<IncludeSegmentType>Tangent</IncludeSegmentType>
			<IncludeSegmentType>Curve</IncludeSegmentType>
		</InsertAlignment>
		<InsertAlignment VariantName="Rørpakke, omstøpt, 4x4xØ110" DisplayBlockName="NO-BN-2D-##RC_THUMBNAIL-KABELFOERING-OMSTOEPTE-TREKKEROER-Schematic" DefaultToTangentContinuity="true" >
			<IncludeSegmentType>Tangent</IncludeSegmentType>
			<IncludeSegmentType>Curve</IncludeSegmentType>
		</InsertAlignment>
		<InsertAlignment VariantName="Rørpakke, omstøpt, 3x(3xØ110-Ø160),(3xØ110)" DisplayBlockName="NO-BN-2D-##RC_THUMBNAIL-KABELFOERING-OMSTOEPTE-TREKKEROER-Schematic" DefaultToTangentContinuity="true" >
			<IncludeSegmentType>Tangent</IncludeSegmentType>
			<IncludeSegmentType>Curve</IncludeSegmentType>
		</InsertAlignment>

	</ObjectType>
			


<!--========================================================================================================
	UNDERBYGNING
	KABELFØRINGER
	JBTKU_KFØ Pressrør
	Tube packages made from hard polymere or steel, where cables may NOT enter or exit except at the ends. 
	TODO: Avklare med Bane NOR om TAG-koden kan benyttes,
 =========================================================================================================-->
	<ObjectType DataType="tElementWithAlignment" Class="RailwayAlignment" Name="JBTKU_KFØ Pressrør"
				Layer="JBTKU_KFØ_PRESSRØR" Color="ByLayer" 
				Group="Underbygning/Føringsveier"
				>

		<RelationSpace>pressrør</RelationSpace>

		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___TAG_OBJECTINFO_METADATA_VAR" />
		<xpp:expand select="NOBN_com_STD_TEXTATTRIBUTES___HORIZONTAL_AND_CLOSE___JBTUB" />
		<xpp:expand select="NOBN_com_DISCIPLINE_JBTUB" />

		<!-- TODO Fjerne AlignmentSystem? -->
		<AlignmentSystems DefaultSystemName="Kabelføring" >
			<AlignmentSystem Name="Kabelføring"
				CantGauge="0.000"
				AlignmentGauge="0.000"
				QuickMode3DLiftWithCant="false"
			 />
		</AlignmentSystems>

		<Variants DefaultValue="Pressrør Ø160 uten subrør" >
			<Variant Name="Pressrør Ø160 uten subrør" />
			<Variant Name="Pressrør Ø400 uten subrør" />
		</Variants>

		<LuaExpression Name="name" ><Formula>code.." ("..Variant..")"</Formula></LuaExpression>

		<SetValue Key="Sweep3D" Value="True" />
		<SetValue Key="QuickMode3D" Value="True" />

		<LuaExpression Name="Linetype" ><Formula>_JBTKU_KFOE_StiffTube_Linetype()</Formula></LuaExpression>
		<LuaFunction Name="_JBTKU_KFOE_StiffTube_Linetype" 
				ReturnType="String"
				HideFromUser="false"
				Description="Returns the CAD system 2D presentation line type for the stiff tube package, based on its Variant." >
			<Constructor>String _JBTKU_KFOE_StiffTube_Linetype()</Constructor>
			<Formula>
				function _JBTKU_KFOE_StiffTube_Linetype()
					return "Continuous" --(same enum for alle language packs)
				end
			</Formula>
		</LuaFunction>

		<LuaExpression Name="GlobalWidth" ><Formula>_JBTKU_KFOE__JBTKU_KFOE_StiffTube_GlobalWidth()</Formula></LuaExpression>
		<LuaFunction Name="_JBTKU_KFOE__JBTKU_KFOE_StiffTube_GlobalWidth" 
				ReturnType="Double"
				HideFromUser="false"
				Description="Returns the global width of the stiff  tube package's 2D representation as a wide polyline." >
			<Constructor>Double _JBTKU_KFOE__JBTKU_KFOE_StiffTube_GlobalWidth()</Constructor>
			<Formula>
				function _JBTKU_KFOE__JBTKU_KFOE_StiffTube_GlobalWidth()
					if Variant:match("Pressrør Ø160") then return 0.160
					elseif Variant:match("Pressrør Ø400") then return 0.400
					else
						return 1.0,_info("Variant ["..Variant.."] has not been anticipated yet.")
					end
				end
			</Formula>
		</LuaFunction>

		<LuaExpression Name="Model3DName" ><Formula>_JBTKU_KFOE_StiffTube_Model3DName()</Formula></LuaExpression>
		<LuaFunction Name="_JBTKU_KFOE_StiffTube_Model3DName()" 
				ReturnType="String"
				HideFromUser="false"
				Description="Returns the tube package default 3D object model name." >
			<Constructor>Double _JBTKU_KFOE_StiffTube_Model3DName()</Constructor>
			<Formula>
				function _JBTKU_KFOE_StiffTube_Model3DName()
					t = "NO-BN-SWEEP-KU-KFØ-PRESSRØR-DIAMETER-"
					if Variant:match("Pressrør Ø160") then return t.."144-160-TOMT"
					elseif Variant:match("Pressrør Ø400") then return t.."360-400-TOMT"
					else 
						return "",_info("Variant ["..Variant.."] has not been anticipated yet.")
					end
				end
			</Formula>
		</LuaFunction>

		<LuaExpression Name="Model3DSeparation" ><Formula>RC__getNearest3DStep(2.0)</Formula></LuaExpression>
		<LuaExpression Name="Model3DOffset" ><Formula>0</Formula></LuaExpression>

		<PropertyPrompt Key="code" DefaultValue="Pressrør" AcceptEmptyValue="false" />

		<!-- Only straight segments (tangents) allowed - steel tubes don't bend... -->
		<InsertAlignment VariantName="Pressrør Ø160 uten subrør" SubGroup="Pressrør" DisplayBlockName="NO-BN-2D-##RC_THUMBNAIL-KABELFOERING-PRESSROER-Schematic" DefaultToTangentContinuity="true" >
			<IncludeSegmentType>Tangent</IncludeSegmentType>
		</InsertAlignment>

		<InsertAlignment VariantName="Pressrør Ø400 uten subrør" SubGroup="Pressrør" DisplayBlockName="NO-BN-2D-##RC_THUMBNAIL-KABELFOERING-PRESSROER-Schematic" DefaultToTangentContinuity="true" >
			<IncludeSegmentType>Tangent</IncludeSegmentType>
		</InsertAlignment>

	</ObjectType>

			

<!--========================================================================================================
	UNDERBYGNING
	KABELFØRINGER
	KU-KFØ Trekkeør
	Flexible tube made from plastic, rubber, corrugated steel or combinations thereof, where cables may 
	NOT enter or exit except at the ends. Usually only one cable fits per tube. Usually, tubes are not 
	protected by concrete ducts, but rather connect the well-protected concrete ducts with objects in
	the track or nearby a railway track.
	TODO: Avklare med Bane NOR om TAG-koden kan benyttes,
 =========================================================================================================-->
	<ObjectType DataType="tElementWithAlignment" Class="RailwayAlignment" Name="JBTKU_KFØ Trekkerør"
				Layer="JBTKU_KFØ_TREKKERØR" Color="ByLayer" 
				Group="Underbygning/Føringsveier"
				>

		<RelationSpace>trekkerør</RelationSpace>

		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___TAG_OBJECTINFO_METADATA_VAR" />
		<xpp:expand select="NOBN_com_STD_TEXTATTRIBUTES___HORIZONTAL_AND_CLOSE___JBTUB" />
		<xpp:expand select="NOBN_com_DISCIPLINE_JBTUB" />

		<!-- TODO Fjerne AlignmentSystem? -->
		<AlignmentSystems DefaultSystemName="Kabelføring" >
			<AlignmentSystem Name="Kabelføring"
				CantGauge="0.000"
				AlignmentGauge="0.000"
				QuickMode3DLiftWithCant="false"
			 />
		</AlignmentSystems>

		<LuaExpression Name="name" ><Formula>code.." ("..Variant..")"</Formula></LuaExpression>

		<!-- Do not use quick mode, we need formulas to set the Z coordinate relative to the start/end of the tube where it picks up a cable duct Z. -->
		<SetValue Key="Sweep3D" Value="True" />
		<SetValue Key="QuickMode3D" Value="False" />

		<LuaExpression Name="Linetype" ><Formula>_JBTKU_KFOE_tube_Linetype()</Formula></LuaExpression>
		<LuaFunction Name="_JBTKU_KFOE_tube_Linetype" 
				ReturnType="String"
				HideFromUser="false"
				Description="Returns the CAD system 2D presentation line type for the flexible tube, based on its Variant." >
			<Constructor>String _JBTKU_KFOE_tube_Linetype()</Constructor>
			<!-- TODO 2021-05-16 CLFEY Implement ZIGZAG line for flexible tubes -->
			<Formula>
				function _JBTKU_KFOE_tube_Linetype()
					return "Continuous" --(same enum for alle language packs)
				end
			</Formula>
		</LuaFunction>

		<LuaExpression Name="GlobalWidth" ><Formula>_JBTKU_KFOE_tube_GlobalWidth()</Formula></LuaExpression>
		<LuaFunction Name="_JBTKU_KFOE_tube_GlobalWidth" ReturnType="Double"
				HideFromUser="false"
				Description="Returns the global width of the flexible tube's 2D representation as a wide polyline." >
			<Constructor>Double _JBTKU_KFOE_tube_GlobalWidth()</Constructor>
			<Formula>
				function _JBTKU_KFOE_tube_GlobalWidth()
					if Variant:match("Ø50") then return 0.050
					elseif Variant:match("Ø75") then return 0.075
					elseif Variant:match("Ø110") then return 0.110
					elseif Variant:match("Ø125") then return 0.125
					elseif Variant:match("Ø160") then return 0.160
					else 
						return 0,_info("Variant ["..Variant.."] has not been anticipated yet.")
					end
				end
			</Formula>
		</LuaFunction>

		<LuaExpression Name="Model3DName" ><Formula>_JBTKU_KFOE_tube_Model3DName()</Formula></LuaExpression>
		<LuaFunction Name="_JBTKU_KFOE_tube_Model3DName()" 
				ReturnType="String"
				HideFromUser="false"
				Description="Returns the flexible tube default 3D object model name." >
			<Constructor>String _JBTKU_KFOE_tube_Model3DName()</Constructor>
			<Formula>
				function _JBTKU_KFOE_tube_Model3DName()
					local t = "NO-BN-SWEEP-KU-KFØ-TREKKERØR-RØD-DIAMETER-"
					if Variant:match("Ø50") then return t.."042-050"
					elseif Variant:match("Ø75") then return t.."063-075"
					elseif Variant:match("Ø110") then return t.."094-110"
					elseif Variant:match("Ø125") then return t.."108-125"
					elseif Variant:match("Ø160") then return t.."138-160"
					else
						return "",_info("Variant ["..Variant.."] has not been anticipated yet.")
					end
				end
			</Formula>
		</LuaFunction>


		<!-- '_position' is an intrinsic variable available to sampled Lua functions. -->
		<LuaExpression Name="Offset3D.Z" ><Formula>_JBTKU_KFOE_tube_Offset3dZ(_position)</Formula></LuaExpression>
		<LuaFunction Name="_JBTKU_KFOE_tube_Offset3dZ()" 
				ReturnType="Double"
				HideFromUser="false"
				Description="Returns the flexible tube Z offset along the geometry, relative to the duct bottom located at the start of the tube's alignment geometry. Must be called with '_position' as input argument (_position.ref = alignment GUID, _position.pos = distAlong)." >
			<Constructor>Double _JBTKU_KFOE_tube_Offset3dZ(SampledPosition _position)</Constructor>
			<Formula>
				function _JBTKU_KFOE_tube_Offset3dZ(cursor)
					local P1 = RcAlignment.StartPoint
					local ducts = getClosestAlignments("JBTKU_KFØ Kabelkanal",P1.X,P1.Y)
					if getCollectionLength(ducts) == 0 then
						return 0,_info("UNFINISHED - No cable duct found at flexible tube's geometry start point.")
					end
					local Zref = getAlignmentInfo(ducts[0].id,P1.X,P1.Y).Point.Z
					
					local ini = 0.2		--Length of initial level part
					local c = 0.8		--Length of cosine part
					local h1 = 0.1		--Start at bottom duct level +h1, make a cosine bend down to bottom duct -h1 
					local r = 0.5		--After horizontal movement, bend up from Zref-h1 as a quarter-circle with radius r 
					local h2 = 0.4		--Finally, rise another h2, close to the tube's end (at the object to feed)
					local d = 0.1		--Horizontal length of the last steep ascent
					
					local L = RcAlignment.HorizontalProfile.Length --2D length of the tube's geometry
					local L1 = ini		--Start cosine bend
					local L2 = L1+c		--End of cosine, start horizontal part
					local L3 = L-d-r	--Start of arc
					local L4 = L-d		--End of arc, start of steep ascent
					if L &lt; ini+c+r+d then 
						return 0,_info("UNFINISHED - Tube geometry is too short to generate Z offset.")
					end
					
					local p = cursor.pos	--Our 'cursor' running along the geometry from 0 to L
					
					if p &lt; L1 then --horizontal
						return Zref + h1
					
					elseif p &lt; L2 then --cosine
						return Zref + h1*math.cos(math.pi*((p-L1)/c))
					
					elseif p &lt; L3 then --horizontal
						return Zref - h1
					
					elseif p &lt; L4 then --circular arc
						return Zref - h1 + r*(1 - math.sqrt(1 -((p-L3)/r)^2))
					
					else 
						return Zref - h1 + r + h2*(p-L4)/d
					end
				end
			</Formula>
		</LuaFunction>

		<Variants DefaultValue="Trekkerør, Ø50" >
			<Variant Name="Trekkerør, Ø50" />
			<Variant Name="Trekkerør, Ø75" />
			<Variant Name="Trekkerør, Ø110" />
			<Variant Name="Trekkerør, Ø125" />
			<Variant Name="Trekkerør, Ø160" />
		</Variants>

		<LuaExpression Name="Model3DSeparation" ><Formula>RC__getNearest3DStep(0.10)</Formula></LuaExpression>
		<LuaExpression Name="Model3DOffset" ><Formula>0</Formula></LuaExpression>

		<PropertyPrompt Key="code" DefaultValue="Trekkerør" AcceptEmptyValue="false" />

		<InsertAlignment VariantName="Trekkerør, Ø50" SubGroup="Trekkerør" DisplayBlockName="NO-BN-2D-##RC_THUMBNAIL-KABELFOERING-TREKKEROER-Schematic" DefaultToTangentContinuity="true" >
			<IncludeSegmentType>Tangent</IncludeSegmentType>
			<IncludeSegmentType>Curve</IncludeSegmentType>
		</InsertAlignment>
		<InsertAlignment VariantName="Trekkerør, Ø75" SubGroup="Trekkerør" DisplayBlockName="NO-BN-2D-##RC_THUMBNAIL-KABELFOERING-TREKKEROER-Schematic" DefaultToTangentContinuity="true" >
			<IncludeSegmentType>Tangent</IncludeSegmentType>
			<IncludeSegmentType>Curve</IncludeSegmentType>
		</InsertAlignment>
		<InsertAlignment VariantName="Trekkerør, Ø110" SubGroup="Trekkerør" DisplayBlockName="NO-BN-2D-##RC_THUMBNAIL-KABELFOERING-TREKKEROER-Schematic" DefaultToTangentContinuity="true" >
			<IncludeSegmentType>Tangent</IncludeSegmentType>
			<IncludeSegmentType>Curve</IncludeSegmentType>
		</InsertAlignment>
		<InsertAlignment VariantName="Trekkerør, Ø125" SubGroup="Trekkerør" DisplayBlockName="NO-BN-2D-##RC_THUMBNAIL-KABELFOERING-TREKKEROER-Schematic" DefaultToTangentContinuity="true" >
			<IncludeSegmentType>Tangent</IncludeSegmentType>
			<IncludeSegmentType>Curve</IncludeSegmentType>
		</InsertAlignment>
		<InsertAlignment VariantName="Trekkerør, Ø160" SubGroup="Trekkerør" DisplayBlockName="NO-BN-2D-##RC_THUMBNAIL-KABELFOERING-TREKKEROER-Schematic" DefaultToTangentContinuity="true" >
			<IncludeSegmentType>Tangent</IncludeSegmentType>
			<IncludeSegmentType>Curve</IncludeSegmentType>
		</InsertAlignment>

	</ObjectType>
			


<!--========================================================================================================
	UNDERBYGNING
	KABELFØRINGER
	JBTKU_KFØ Trekkekum
	Manhole - generally made out of concrete, may be made out of hard polynmere or steel.
 =========================================================================================================-->
	<ObjectType DataType="tOrientedElement" Class="RailwayPlacedObject" Name="JBTKU_KFØ Trekkekum"
				Layer="JBTKU_KFØ_TREKKEKUM" Color="ByLayer" 
				Group="Underbygning/Føringsveier"
				AttMirrorY="{% if RightSided %}true{% else %}false{% endif %}"
				>

		<RelationSpace>trekkekum</RelationSpace>

		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___ANGULAROFFSET_TAG_OBJECTINFO_METADATA_VAR" />
		<xpp:expand select="NOBN_com_STD_TEXATTRIBUTES___VERTICAL_AND_FAR___JBTUB" />
		<xpp:expand select="NOBN_com_DISCIPLINE_JBTUB" />
		<xpp:expand select="NOBN_com_CHK_NUMBER_OF_OCP_AREAS" />
		<xpp:expand select="RC_com_SET_OCP_STATION_REFERENCE" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___WAYSIDE_GENERAL_OBJECT" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___EARTHED_TO_NONE" />
		
		<Variants DefaultValue="Trekkekum Ø1400" >
			<Variant Name="Trekkekum Ø1400" >
				<SetValue Key="ManholeHeight" Value="1350" />
			</Variant>
			<Variant Name="Trekkekum 1600x900" >
				<SetValue Key="ManholeHeight" Value="900" />
			</Variant>
			<Variant Name="Trekkekum 1400x1400" >
				<SetValue Key="ManholeHeight" Value="1600" />
			</Variant>
			<Variant Name="Trekkekum 2300x2300, 3-veis" >
				<SetValue Key="ManholeHeight" Value="2400" />
			</Variant>
			<Variant Name="Trekkekum 2300x2300, 4-veis" >
				<SetValue Key="ManholeHeight" Value="2400" />
			</Variant>
		</Variants>
		
		<CustomAttribute DataType="Enumeration" Name="ManholeHeight" DisplayName="Trekkekum høyde" DefaultValue="900"
			Description="The manhole height (exterior dimension) [mm] [200 | 250 | 600 | ... | 3500]." >
			<Values>
				<Value>3500</Value>
				<Value>3450</Value>
				<Value>3400</Value>
				<Value>3350</Value>
				<Value>3300</Value>
				<Value>3450</Value>
				<Value>3400</Value>
				<Value>3150</Value>
				<Value>3100</Value>
				<Value>3050</Value>
				<Value>3000</Value>
				<Value>2950</Value>
				<Value>2900</Value>
				<Value>2850</Value>
				<Value>2800</Value>
				<Value>2750</Value>
				<Value>2700</Value>
				<Value>2650</Value>
				<Value>2600</Value>
				<Value>2550</Value>
				<Value>2500</Value>
				<Value>2450</Value>
				<Value>2400</Value>
				<Value>2350</Value>
				<Value>2300</Value>
				<Value>2450</Value>
				<Value>2400</Value>
				<Value>2150</Value>
				<Value>2100</Value>
				<Value>2050</Value>
				<Value>2000</Value>
				<Value>1950</Value>
				<Value>1900</Value>
				<Value>1850</Value>
				<Value>1800</Value>
				<Value>1750</Value>
				<Value>1700</Value>
				<Value>1650</Value>
				<Value>1600</Value>
				<Value>1550</Value>
				<Value>1500</Value>
				<Value>1450</Value>
				<Value>1400</Value>
				<Value>1350</Value>
				<Value>1300</Value>
				<Value>1250</Value>
				<Value>1200</Value>
				<Value>1150</Value>
				<Value>1100</Value>
				<Value>1050</Value>
				<Value>1000</Value>
				<Value>950</Value>
				<Value>900</Value>
				<Value>850</Value>
				<Value>800</Value>
				<Value>750</Value>
				<Value>700</Value>
				<Value>650</Value>
				<Value>600</Value>
				<Value>550</Value>
				<Value>500</Value>
				<Value>450</Value>
				<Value>400</Value>
				<Value>350</Value>
				<Value>300</Value>
				<Value>250</Value>
				<Value>200</Value>
			</Values>
		</CustomAttribute>

		<LuaExpression Name="code" ><Formula>_JBTKU_KFOE_manhole_code()</Formula></LuaExpression>
		<LuaFunction Name="_JBTKU_KFOE_manhole_code()" ReturnType="String"
			Description="Obtains the code for the manhole, as a concatenation of the manhole's reference mileage km-value and the current 'seq' local variable." >
			<Constructor>String _JBTKU_KFOE_manhole_code()</Constructor>
			<Formula>
				function _JBTKU_KFOE_manhole_code()
					entireKm = math.floor(ReferenceMileage/1000)
					return string.format("TK-%d-%02d",entireKm,seq),_info("Manhole's code is inherited from reference mileage ("..ReferenceMileage..") and the local variable seq ("..seq..").")
				end
			</Formula>
		</LuaFunction>

		<LuaExpression Name="name" ><Formula>code.." ("..Variant..")"</Formula></LuaExpression>

		<LuaExpression Name="DistanceToAlignment" ><Formula>_JBTKU_KFOE_manhole_DistanceToAlignment()</Formula></LuaExpression>
		<LuaFunction Name="_JBTKU_KFOE_manhole_DistanceToAlignment()" 
				ReturnType="Double"
				Description="Returns manhole's default 3D object model name." >
			<Constructor>Double _JBTKU_KFOE_manhole_DistanceToAlignment()</Constructor>
			<Formula>
				function _JBTKU_KFOE_manhole_DistanceToAlignment() 
					local diameter = Variant:match("Ø(%d+)")
					local length = Variant:match("(%d+)X%d+")
					local depth = Variant:match("%d+X(%d+)")
					local MinFreeProfile = 2.30 --Bane NOR TRV value
					local StdFreeProfile = 2.52 --Bane NOR TRV value
					local d
					a = getClosestAlignments("JBTKU_KFØ Kabelkanal")
					if diameter then
						--Should "touch" MinFreeProfile, insertion point = center manhole at Top-of-rail
						d = MinFreeProfile + diameter/2000
					elseif length and depth then
						--Should "touch" MinFreeProfile, insertion point = midpoint long side towards track at Top-of-rail
						if dir == "both" then d = MinFreeProfile + 0
						elseif dir == "none" then d = MinFreeProfile + depth/1000
						elseif dir == "up" then d = MinFreeProfile + length/2000
						elseif dir == "down" then d = MinFreeProfile + length/2000
						else return 4e-4,_info("UNFINISHED - Unknown direction") 
						end
					else
						return 4e-4,_info("Variant ["..Variant.."] has not been anticipated yet.")
					end
					return RightSided and d or -d,_info("Distance to alignment deduced from direction and from manhole dimensions.")
				end
			</Formula>
		</LuaFunction>

		<LuaExpression Name="Model3DName" ><Formula>_JBTKU_KFOE_manhole_Model3DName()</Formula></LuaExpression>
		<LuaFunction Name="_JBTKU_KFOE_manhole_Model3DName()" 
				ReturnType="String"
				Description="Returns manhole's default 3D object model name." >
			<Constructor>String _JBTKU_KFOE_manhole_Model3DName()</Constructor>
			<Formula>
				function _JBTKU_KFOE_manhole_Model3DName()
					local diameter = Variant:match("Ø(%d+)")
					local length = Variant:match("(%d+)X%d+")
					local depth = Variant:match("%d+X(%d+)")
					local numberOfOrifices = Variant:lower():match("(%d+)%-veis")
					if Variant:match("Ø%d+") then
						return "NO-BN-3D-KU-KFØ-TREKKEKUM-Ø"..diameter.."-H"..ManholeHeight.."-MED-LOKK"
					elseif Variant:upper():match("%d+X%d+") then
						if numberOfOrifices == nil then
							return "NO-BN-3D-KU-KFØ-TREKKEKUM-L"..length.."-D"..depth.."-H"..ManholeHeight.."-MED-LOKK"
						else
							return "NO-BN-3D-KU-KFØ-TREKKEKUM-L"..length.."-D"..depth.."-H"..ManholeHeight.."-"..numberOfOrifices.."-VEIS-MED-LOKK"
						end
					else
						return "NO-BN-3D-FE-DIV-UKJENT",_info("Variant ["..Variant.."] has not been anticipated yet.")
					end
				end
			</Formula>
		</LuaFunction>

		<LuaExpression Name="EarthingMethod" ><Formula>"None"</Formula></LuaExpression>

		<!-- TODO: Lage 2D-symbol for trekkekum variantene -->
		<!-- Note: Snap distance is set quite low to ensure snapping to the intended track. Formulas adjust distance afterwards. -->
		<InsertPointObject VariantName="Trekkekum Ø1400" DisplayBlockName="NO-BN-2D-JBTKU_KFØ-TREKKEKUM-RUND-1400-{{SymbolMode}}" 
				DefaultSnapMode="Alignment" SnapToAlignment="true" SnapDistance="1.5" >
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="true" RotateIfRightSideOfAlignment="true" />
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<SetValue Key="dir" Value="both" />
		</InsertPointObject>

		<InsertPointObject VariantName="Trekkekum 1600x900" DisplayBlockName="NO-BN-2D-JBTKU_KFØ-TREKKEKUM-L1600-D900-{{SymbolMode}}" 
				DefaultSnapMode="Alignment" SnapToAlignment="true" SnapDistance="1.5" >
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="true" RotateIfRightSideOfAlignment="true" />
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<SetValue Key="dir" Value="both" />
		</InsertPointObject>

		<InsertPointObject VariantName="Trekkekum 1400x1400" DisplayBlockName="NO-BN-2D-JBTKU_KFØ-TREKKEKUM-L1400-D1400-{{SymbolMode}}" 
				DefaultSnapMode="Alignment" SnapToAlignment="true" SnapDistance="1.5" >
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="true" RotateIfRightSideOfAlignment="true" />
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<SetValue Key="dir" Value="both" />
		</InsertPointObject>

		<InsertPointObject VariantName="Trekkekum 2300x2300, 3-veis" DisplayBlockName="NO-BN-2D-JBTKU_KFØ-TREKKEKUM-L2300-D2300-{{SymbolMode}}" 
				DefaultSnapMode="Alignment" SnapToAlignment="true" SnapDistance="1.5" >
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="true" RotateIfRightSideOfAlignment="true" />
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<SetValue Key="dir" Value="both" />
		</InsertPointObject>

		<InsertPointObject VariantName="Trekkekum 2300x2300, 4-veis" DisplayBlockName="NO-BN-2D-JBTKU_KFØ-TREKKEKUM-L2300-D2300-{{SymbolMode}}" 
				DefaultSnapMode="Alignment" SnapToAlignment="true" SnapDistance="1.5" >
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="true" RotateIfRightSideOfAlignment="true" />
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<SetValue Key="dir" Value="both" />
		</InsertPointObject>

		<SymbolDefinition DefaultBlockName="NO-BN-2D-JBTKU_KFØ-TREKKEKUM-RUND-1400-{{SymbolMode}}" AllowSymbolMove="true" >
			<Rotation Add180DegreesIfDirIsDown="false" AddAngle="{% if dir == 'up' %}{{270.0|plus:AngularOffset}}
														{% elsif dir == 'down' %}{{90.0|plus:AngularOffset}}
														{% elsif dir == 'both' and RightSided %}{{180.0|plus:AngularOffset}}
														{% elsif dir == 'both' and LeftSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and RightSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and LeftSided %}{{180.0|plus:AngularOffset}}
														{% else %}45.0
														{% endif %}" />	
			<BlockNameFormat JoinBy="-" >
				{% if Variant == 'Trekkekum Ø1400' %}NO-BN-2D-JBTKU_KFØ-TREKKEKUM-RUND-1400
				{% elsif Variant == 'Trekkekum 1600x900' %}NO-BN-2D-JBTKU_KFØ-TREKKEKUM-L1600-D900
				{% elsif Variant == 'Trekkekum 1400x1400' %}NO-BN-2D-JBTKU_KFØ-TREKKEKUM-L1400-D1400
				{% elsif Variant == 'Trekkekum 2300x2300, 3-veis' %}NO-BN-2D-JBTKU_KFØ-TREKKEKUM-L2300-D2300
				{% elsif Variant == 'Trekkekum 2300x2300, 4-veis' %}NO-BN-2D-JBTKU_KFØ-TREKKEKUM-L2300-D2300
				{% else %}BAD_Variant
				{% endif %}
				{{SymbolMode}}
			</BlockNameFormat>
		</SymbolDefinition>

		<SymbolDefinition DefaultBlockName="NO-BN-2D-##RC_INNSETTINGSPUNKT-Schematic" />

		<Model3DDefinition><Attribute Tag="T01" ><Value>{{code}}</Value></Attribute></Model3DDefinition>
		
		<DockPointDefinitions>
			<SnapPoints>
				<SnapPoint X="0.0" Y="0.0" TargetSpace="jordingsskinne" />
			</SnapPoints>
		</DockPointDefinitions>

	</ObjectType>
			


<!--========================================================================================================
	CIVIL WORKS
	ROADS
	TODO: Avklare med Bane NOR om TAG-koden kan benyttes.
=========================================================================================================-->
	<ObjectType DataType="tElementWithAlignment" Class="RailwayAlignment" Name="JBTKU_VEI Vei"
				Layer="JBTKU_VEI" Color="ByLayer"
				Group="Underbygning/Veier"
				>

		<RelationSpace>vei</RelationSpace>
		
		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___TAG_OBJECTINFO_VAR" />
		<xpp:expand select="NOBN_com_STD_TEXTATTRIBUTES___HORIZONTAL_AND_CLOSE___JBTUB" />
		<xpp:expand select="NOBN_com_DISCIPLINE_JBTUB" />

		<AlignmentSystems DefaultSystemName="Vei" >
			<AlignmentSystem Name="Vei"
				CantGauge="0.000"
				AlignmentGauge="0.000"
				QuickMode3DLiftWithCant="false"
		 />
		</AlignmentSystems>

		<Variants DefaultValue="Bilvei" >
			<Variant Name="Bilvei" >
				<LuaExpression Name="name" ><Formula>code.." (bilvei)"</Formula></LuaExpression>
				<SetValue Key="RoadNumberOfLanes" Value="2" />
				<SetValue Key="RoadExteriorWidth" Value="6000" />
			</Variant>
			<Variant Name="Gangvei" >
				<LuaExpression Name="name" ><Formula>code.." (gangvei)"</Formula></LuaExpression>
				<SetValue Key="RoadNumberOfLanes" Value="1" />
				<SetValue Key="RoadExteriorWidth" Value="2000" />
			</Variant>
			<Variant Name="Sykkelvei" >
				<LuaExpression Name="name" ><Formula>code.." (sykkelvei)"</Formula></LuaExpression>
				<SetValue Key="RoadNumberOfLanes" Value="1" />
				<SetValue Key="RoadExteriorWidth" Value="1400" />
			</Variant>
			<Variant Name="Rømningsvei" >
				<LuaExpression Name="name" ><Formula>code.." (rømningsvei)"</Formula></LuaExpression>
				<SetValue Key="RoadNumberOfLanes" Value="1" />
				<SetValue Key="RoadExteriorWidth" Value="1200" />
			</Variant>
		</Variants>
		
		<CustomAttribute DataType="Enumeration" Name="RoadNumberOfLanes" DisplayName="Felt"
			Description="The road's number of lanes." >
			<Values Variant="Bilvei" >
				<Value>6</Value>
				<Value>4</Value>
				<Value>3</Value>
				<Value>2</Value>
				<Value>1</Value>
			</Values>
			<Values Variant="Gangvei" >
				<Value>1</Value>
			</Values>
			<Values Variant="Sykkelvei" >
				<Value>2</Value>
				<Value>1</Value>
			</Values>
			<Values Variant="Rømningsvei" >
				<Value>1</Value>
			</Values>
		</CustomAttribute>

		<CustomAttribute DataType="Enumeration" Name="RoadExteriorWidth" DisplayName="Bredde"
			Description="The road's exterior width [mm]." >
			<Values Variant="Bilvei" >
				<Value>12000</Value>
				<Value>11000</Value>
				<Value>10000</Value>
				<Value>9000</Value>
				<Value>8000</Value>
				<Value>7000</Value>
				<Value>6000</Value>
				<Value>5500</Value>
				<Value>5000</Value>
				<Value>4500</Value>
				<Value>4000</Value>
			</Values>
			<Values Variant="Gangvei" >
				<Value>2000</Value>
				<Value>1600</Value>
				<Value>1200</Value>
			</Values>
			<Values Variant="Sykkelvei" >
				<Value>2800</Value>
				<Value>1400</Value>
			</Values>
			<Values Variant="Rømningsvei" >
				<Value>1400</Value>
				<Value>1200</Value>
				<Value>1000</Value>
				<Value>800</Value>
			</Values>
		</CustomAttribute>
	
	<LuaExpression Name="Model3DName" ><Formula>_JBTKU_VEI__Model3DName()</Formula></LuaExpression>
		<LuaFunction Name="_JBTKU_VEI__Model3DName()" 
				ReturnType="String"
				HideFromUser="false"
				Description="Returns the road's default 3D object model name." >
			<Constructor>String _JBTKU_VEI__Model3DName()</Constructor>
			<Formula>
				function _JBTKU_VEI__Model3DName()
					--TODO: Add more roads in 3D
					--TODO: Allow for varying segment lengths (all are 1000 mm now)
					t = Sweep3D and "NO-BN-SWEEP-KU-VEI-" or "NO-BN-3D-KU-VEI-"
					if Variant == "Bilvei" then 
						return t.."VEIBANE-"..RoadNumberOfLanes.."-FELT-L1000-D100-B"..RoadExteriorWidth
					elseif Variant == "Gangvei" then
						return t.."GANGBANE-"..RoadNumberOfLanes.."-FELT-L1000-D100-B-"..RoadExteriorWidth
					elseif Variant == "Sykkelvei" then 
						return t.."SYKKELBANE-"..RoadNumberOfLanes.."-FELT-L1000-D100-B-"..RoadExteriorWidth
					elseif Variant == "Rømningsvei" then
						return t.."RØMNINGSBANE-"..RoadNumberOfLanes.."-FELT-L1000-D100-B-"..RoadExteriorWidth
					else 
						return "",_info("Variant ["..Variant.."] has not been anticipated yet.")
					end
				end
			</Formula>
		</LuaFunction>

		<!-- '_position' is an intrinsic variable available to sampled Lua functions. -->
		<LuaExpression Name="Model3DSeparation" ><Formula>Sweep3D and RC__getNearest3DStep(1.0) or _JBTKU_VEI_Model3DSeparation(_position)</Formula></LuaExpression>
		<LuaFunction Name="_JBTKU_VEI_Model3DSeparation()" 
				ReturnType="Double"
				HideFromUser="false"
				Description="Returns the distance to the next 3D model insertion point along the alignment axis during 3D Preview or 3D Export. Must be called with '_position' as input argument (_position.ref = alignment GUID, _position.pos = distAlong)." >
			<Constructor>Double _JBTKU_VEI_Model3DSeparation(Double _position)</Constructor>
			<Formula>
				function _JBTKU_VEI_Model3DSeparation(pos)
					-- TODO: A more elaborate function would rely on the actual size for each inserted 3D Model, which may vary as a sampled function along the alignment.
					-- This simple formula assumes that the Model3D is constant along the alignment, decided by the Variant (which applies to the whole alignment's length)
					-- TODO: Implement 'SweepMode3D' which interprets the given 3D Model Name as a 2D section to be sweeped (or twisted, if Cant info is provided).
					if Variant == "Bilvei" then 
						f = 1000/1000
						b = 6000
					elseif Variant == "Gangvei" then 
						f = 2400/1000
						b = 0.4
					elseif Variant == "Sykkelvei" then 
						f = 1
						b = 0.6
					elseif Variant == "Rømningsvei" then 
						f = 1
						b = 0.6
					else 
						return 3.1416,_info("Variant ["..Variant.."] has not been anticipated yet - so we assume 3.1416m 3D Model Separation...")
					end
					r = getAlignmentInfo(pos).CurveRadius
					-- Empirical formula, to allow a small separation between concrete elements in the "outer curve", but assuming that it will be cut in the "inner curve".
					if r == nil or r &gt; 100 then 
						return 2.4 / f + .005
					elseif r &lt; (0.8 / b) then 
						return (2.4 - b) / f
					else 
						return (2.4 - 0.8/r) / f + .005
					end
				end
			</Formula>
		</LuaFunction>

		<LuaExpression Name="Model3DOffset" ><Formula>Sweep3D and 0 or RC__round(_JBTKU_VEI_Model3DSeparation()/2, 1)</Formula></LuaExpression>

		<PropertyPrompt Key="code" DefaultValue="Vei" AcceptEmptyValue="false" />

		<InsertAlignment VariantName="Bilvei" DisplayBlockName="NO-BN-2D-JBTKU-THUMBNAIL-ROAD-Schematic" DefaultToTangentContinuity="true" >
			<IncludeSegmentType>Tangent</IncludeSegmentType>
			<IncludeSegmentType>Curve</IncludeSegmentType>
			<IncludeSegmentType>Spiral</IncludeSegmentType>
			<SetValue Key="AlignmentSystem" Value="Vei" />
		</InsertAlignment>
		
		<InsertAlignment VariantName="Sykkelvei" DisplayBlockName="NO-BN-2D-JBTKU-THUMBNAIL-BICYCLE-LANE-Schematic" DefaultToTangentContinuity="true" >
			<IncludeSegmentType>Tangent</IncludeSegmentType>
			<IncludeSegmentType>Curve</IncludeSegmentType>
			<IncludeSegmentType>Spiral</IncludeSegmentType>
			<SetValue Key="AlignmentSystem" Value="Vei" />
		</InsertAlignment>

		<InsertAlignment VariantName="Gangvei" DisplayBlockName="NO-BN-2D-JBTKU-THUMBNAIL-PEDESTRIAN-LANE-Schematic" DefaultToTangentContinuity="true" >
			<IncludeSegmentType>Tangent</IncludeSegmentType>
			<IncludeSegmentType>Curve</IncludeSegmentType>
			<IncludeSegmentType>Spiral</IncludeSegmentType>
			<SetValue Key="AlignmentSystem" Value="Vei" />
		</InsertAlignment>

		<InsertAlignment VariantName="Rømningsvei" DisplayBlockName="NO-BN-2D-JBTKU-THUMBNAIL-ESCAPE-ROUTE-Schematic" DefaultToTangentContinuity="true" >
			<IncludeSegmentType>Tangent</IncludeSegmentType>
			<IncludeSegmentType>Curve</IncludeSegmentType>
			<IncludeSegmentType>Spiral</IncludeSegmentType>
			<SetValue Key="AlignmentSystem" Value="Vei" />
		</InsertAlignment>

	</ObjectType>
			


<!--========================================================================================================
	UNDERBYGNING
	FUNDAMENTER
	JBTKU_FUN Apparatskapfundament
=========================================================================================================-->
	<ObjectType DataType="tOrientedElement" Class="RailwayPlacedObject" Name="JBTKU_FUN Apparatskapfundament"
				Layer="JBTKU_FUN" Color="ByLayer"
				Group="Underbygning/Fundamenter/Apparatskap"
				AttMirrorY="{% if RightSided %}true{% else %}false{% endif %}"
				>
				
		<RelationSpace>apparatskapfundament</RelationSpace>
		<AttachmentCategory Name="apparatskapfundament" />
		
		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___ANGULAROFFSET_TAG_OBJECTINFO_METADATA_VAR" />
		<xpp:expand select="NOBN_com_STD_TEXATTRIBUTES___VERTICAL_AND_FAR___JBTUB" />
		<xpp:expand select="NOBN_com_DISCIPLINE_JBTUB" />
		<xpp:expand select="NOBN_com_CHK_NUMBER_OF_OCP_AREAS" />
		<xpp:expand select="RC_com_SET_OCP_STATION_REFERENCE" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___WAYSIDE_GENERAL_OBJECT" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___EARTHED_TO_NONE" />

		<Variants>
			<Variant Name="Betong apparatskap fundament, hull på langsiden" >
				<SetValue Key="name" Value="Betong AS fund. langside" />
				<SetValue Key="Model3DName" Value="NO-BN-3D-KU-FUN-APPARATSKAP-STORT-1400x820x540-LANGSIDEHULL" />
			</Variant>
			<Variant Name="Betong apparatskap fundament, hull på kortsiden" >
				<SetValue Key="name" Value="Betong AS fund. kortside" />
				<SetValue Key="Model3DName" Value="NO-BN-3D-KU-FUN-APPARATSKAP-STORT-1400x820x540-KORTSIDEHULL" />
			</Variant>
		</Variants>

        <LuaExpression Name="dir" ><Formula>"both"</Formula></LuaExpression>
        <LuaExpression Name="code" ><Formula>NOBN_sub_getFoundationCode()</Formula></LuaExpression>
		<LuaExpression Name="EarthingMethod" ><Formula>"None"</Formula></LuaExpression>
        <LuaExpression Name="name" ><Formula>tostring(code):upper():match("UNFINISHED") and "" or code</Formula></LuaExpression>

		<InsertPointObject VariantName="Betong apparatskap fundament, hull på langsiden" DisplayBlockName="NO-BN-2D-JBTKU_FUN-SKAPFUNDAMENT-BETONG-APPARATSKAP-LANGSIDE-{{SymbolMode}}" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="3.5" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="false" RotateIfRightSideOfAlignment="true" />
		</InsertPointObject>
		
		<InsertPointObject VariantName="Betong apparatskap fundament, hull på kortsiden" DisplayBlockName="NO-BN-2D-JBTKU_FUN-SKAPFUNDAMENT-BETONG-APPARATSKAP-KORTSIDE-{{SymbolMode}}"
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="3.5" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="false" RotateIfRightSideOfAlignment="true" />
		</InsertPointObject>

		<SymbolDefinition DefaultBlockName="NO-BN-2D-JBTKU_FUN-SKAPFUNDAMENT-BETONG-APPARATSKAP-LANGSIDE-{{SymbolMode}}" AllowSymbolMove="true" >
			<Rotation Add180DegreesIfDirIsDown="false" AddAngle="{% if dir == 'up' %}{{270.0|plus:AngularOffset}}
														{% elsif dir == 'down' %}{{90.0|plus:AngularOffset}}
														{% elsif dir == 'both' and RightSided %}{{180.0|plus:AngularOffset}}
														{% elsif dir == 'both' and LeftSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and RightSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and LeftSided %}{{180.0|plus:AngularOffset}}
														{% else %}45.0
														{% endif %}" />	
			<BlockNameFormat JoinBy="-" >
				NO-BN-2D-JBTKU_FUN-SKAPFUNDAMENT
				{% if Variant == 'Betong apparatskap fundament, hull på langsiden' %}BETONG-APPARATSKAP-LANGSIDE
				{% elsif Variant == 'Betong apparatskap fundament, hull på kortsiden' %}BETONG-APPARATSKAP-KORTSIDE
				{% else %}BAD_Variant
				{% endif %}
				{{SymbolMode}}
			</BlockNameFormat>
		</SymbolDefinition>

		<SymbolDefinition DefaultBlockName="NO-BN-2D-##RC_INNSETTINGSPUNKT-Schematic" />

		<DockPointDefinitions>
			<SnapPoints Variant="Betong apparatskap fundament, hull på langsiden" >
				<SnapPoint X="0.0" Y="0.0" TargetSpace="apparatskap" />
			</SnapPoints>
			<SnapPoints Variant="Betong apparatskap fundament, hull på kortsiden" >
				<SnapPoint X="0.0" Y="0.0" TargetSpace="apparatskap" />
			</SnapPoints>
		</DockPointDefinitions>

	</ObjectType>



<!--========================================================================================================
	UNDERBYGNING
	FUNDAMENTER

	Store konstruksjoner i betong, eller boret i metall, med boltegruppe for KL-master, barduner og strevere.
	For OCS masts, spanners and stretchers.
	
	Naming convention for 2D OCS foundation symbols: 

		JBTEH_FUN-FUNDAMENT-BETONG-<type>-<baseX>x<baseY>-<baseOffsetY>-<boltX>x<boltY>x<boltsize>

	where:	
		baseX, baseY: bottom plate Y along track and Y across track, or outer diameter 'Ø355' etc without a base offset.
		baseOffsetY: millimeters offset of center base plate in Y direction, from origo
		shaft: from top of bottom plate to top of foundation (reference level Z)
		type: B3, BJELKEMAST, H3, BORET-Ø355, BORET-Ø555
		boltX, boltY: Placing of bolt in the first quadrant. Ø355 has 8 bolts with angle 27DD from East / North instead of x,y coordinates.
		boltsize: M24 or M36
		Insertion point: Center of bolt group

	Examples:
		NO-BN-2D-JBTEH_FUN-FUNDAMENT-BETONG-BJELKEMAST-1600x1800-000-191x374xM36
		NO-BN-2D-JBTEH_FUN-FUNDAMENT-BETONG-BORET-Ø355-191x374xM36


	Naming convention for 3D OCS foundation objects: 

		NO-BN-3D-EH-FUN-<type[-subtype]>-<baseX>x<baseY>x<baseZ>-<baseOffsetY>-<shaftX>x<shaftY>x<shaftZ>-<boltX>x<boltY>x<boltsize>
		
	where:	
		baseZ: Height of base plate
		shaftX, shaftY, shaftZ: shaft dimensions
	
	Examples: 
		NO-BN-3D-EH-FUN-BJELKEMAST-1600x1600x1000-000-700x700x1700-191x374xM36
		NO-BN-3D-EH-FUN-GITTERMAST-B3-2300x2300x350-000-500x1100x1800-240x800xM36	(Where is this one from? Norconsult? )
		NO-BN-3D-EH-FUN-GITTERMAST-B3-1600x1800x500-100-600x1200x2200-240x800xM36
		NO-BN-3D-EH-FUN-GITTERMAST-H3-1600x1800x500-100-1000x1000x2200-700x700xM36
		NO-BN-3D-EH-FUN-BJELKEMAST-BORET-Ø555-191x374xM36-4500
		NO-BN-3D-EH-FUN-GITTERMAST-BORET-Ø355-Ø232x27DDxM36-4500
		
=========================================================================================================-->
	<ObjectType DataType="tOrientedElement" Class="RailwayPlacedObject" Name="JBTEH_FUN KL-fundament"
				Layer="JBTKU_EH_FUN" Color="ByLayer"
				Group="Underbygning/Fundamenter/Kontaktledning"
				AttMirrorY="{% if RightSided %}true{% else %}false{% endif %}"
				>
				
		<RelationSpace>kl-fundament</RelationSpace>
		
		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___ANGULAROFFSET_TAG_OBJECTINFO_METADATA_VAR" />
		<xpp:expand select="NOBN_com_STD_TEXATTRIBUTES___VERTICAL_AND_FAR___JBTUB" />
		<xpp:expand select="NOBN_com_DISCIPLINE_JBTUB" />
		<xpp:expand select="NOBN_com_CHK_NUMBER_OF_OCP_AREAS" />
		<xpp:expand select="RC_com_SET_OCP_STATION_REFERENCE" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___WAYSIDE_GENERAL_OBJECT" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___EARTHED_TO_NONE" />

		<Variants>
			<Variant Name="Betong KL-fundament, bjelkemast" >
			</Variant>
			<Variant Name="Boret KL-fundament, Ø355-Ø232xDD27xM36" >
			</Variant>
			<Variant Name="Boret KL-fundament, Ø555-191x374xM36" >
			</Variant>
			<Variant Name="Fjellbolter for KL-mast i tunnel" >
			</Variant>
			<Variant Name="Fjellbolter for KL-mast på veggkonsoll" >
			</Variant>
			<Variant Name="Veggkonsoll for KL-mast" >
			</Variant>
			<Variant Name="Spesial KL-fundament" >
			</Variant>
			<Variant Name="Betong KL-fundament, lav B3 og B6, 240x800xM36, 6000-9500" >
			</Variant>
			<Variant Name="Betong KL-fundament, høy B6, 260x940xM36, 10000-13000" >
			</Variant>
			<Variant Name="Betong KL-fundament, H3, 700x700xM36, 6000-9500" >
			</Variant>
			<Variant Name="Betong KL-fundament, H3, 790x790xM36, 10000-12000" >
			</Variant>
			<Variant Name="Betong KL-fundament, H3, 830x830xM36, 12500-13000" >
			</Variant>
		</Variants>
		
		<CustomAttribute DataType="Enumeration" Name="OcsFoundationBaseWidth" DisplayName="Fundament bunnplate bredde"
			Description="The overhead catenary system (OCS) foundation base plate width (transversal to track). Not applicable to bored foundations." >
			<Values Variant="Betong KL-fundament, bjelkemast" >
				<Value>2200</Value>
				<Value>2100</Value>
				<Value>2000</Value>
				<Value>1900</Value>
				<Value>1800</Value>
				<Value>1700</Value>
				<Value>1600</Value>
			</Values>
			<Values Variant="Betong KL-fundament, lav B3 og B6, 240x800xM36, 6000-9500" >
				<Value>1800</Value>
			</Values>
			<Values Variant="Betong KL-fundament, høy B6, 260x940xM36, 10000-13000" >
				<Value>1800</Value>
			</Values>
			<Values Variant="Betong KL-fundament, H3, 700x700xM36, 6000-9500" >
				<Value>1800</Value>
			</Values>
			<Values Variant="Betong KL-fundament, H3, 790x790xM36, 10000-12000" >
				<Value>1800</Value>
			</Values>
			<Values Variant="Betong KL-fundament, H3, 830x830xM36, 12500-13000" >
				<Value>1800</Value>
			</Values>
		</CustomAttribute>
		
		<!-- NB Not all combinations of OcsFoundationBaseWidth and OcsFoundationBaseOffset are meaningful. -->
		<CustomAttribute DataType="Enumeration" Name="OcsFoundationBaseOffset" DisplayName="Fundament bunnplate offset"
			Description="The overhead catenary system (OCS) foundation base plate offset. Not applicable to bored foundations." >
			<Values Variant="Betong KL-fundament, bjelkemast" >
				<Value>300</Value>
				<Value>200</Value>
				<Value>100</Value>
				<Value>000</Value>
			</Values>
			<Values Variant="Betong KL-fundament, lav B3 og B6, 240x800xM36, 6000-9500" >
				<Value>000</Value>
			</Values>
			<Values Variant="Betong KL-fundament, høy B6, 260x940xM36, 10000-13000" >
				<Value>000</Value>
			</Values>
			<Values Variant="Betong KL-fundament, H3, 700x700xM36, 6000-9500" >
				<Value>000</Value>
			</Values>
			<Values Variant="Betong KL-fundament, H3, 790x790xM36, 10000-12000" >
				<Value>000</Value>
			</Values>
			<Values Variant="Betong KL-fundament, H3, 830x830xM36, 12500-13000" >
				<Value>000</Value>
			</Values>
		</CustomAttribute>
		
		<CustomAttribute DataType="Enumeration" Name="OcsFoundationShaftHeight" DisplayName="Fundament søylehøyde"
			Description="The overhead catenary system (OCS) foundation shaft height resp. total bored height." >
			<Values Variant="Betong KL-fundament, bjelkemast" >
				<Value>2700</Value>
				<Value>2200</Value>
				<Value>1700</Value>
				<Value>1200</Value>
			</Values>
			<Values Variant="Boret KL-fundament, Ø555-191x374xM36" >
				<Value>7500</Value>
				<Value>7000</Value>
				<Value>6500</Value>
				<Value>6000</Value>
				<Value>5500</Value>
				<Value>5000</Value>
				<Value>4500</Value>
				<Value>4000</Value>
				<Value>3500</Value>
				<Value>3000</Value>
				<Value>2500</Value>
			</Values>
			<Values Variant="Boret KL-fundament, Ø355-Ø232xDD27xM36" >
				<Value>7500</Value>
				<Value>7000</Value>
				<Value>6500</Value>
				<Value>6000</Value>
				<Value>5500</Value>
				<Value>5000</Value>
				<Value>4500</Value>
				<Value>4000</Value>
				<Value>3500</Value>
				<Value>3000</Value>
				<Value>2500</Value>
			</Values>
			<Values Variant="Betong KL-fundament, lav B3 og B6, 240x800xM36, 6000-9500" >
				<!-- Shaft heights 2400..3700 lead to base plate 1600x1800x500 -->
				<Value>3700</Value>
				<Value>3200</Value>
				<Value>3100</Value>
				<Value>2400</Value>
				<!-- shaft height = 1800 leads to 2300x2300x350 base plate in 3D, a Lysaker-Asker / Norconsult construction -->
				<Value>1800</Value>
			</Values>
			<Values Variant="Betong KL-fundament, høy B6, 260x940xM36, 10000-13000" >
				<!-- Shaft heights 2400..3700 lead to base plate 1600x1800x500 -->
				<Value>3700</Value>
				<Value>3200</Value>
				<Value>3100</Value>
				<Value>2400</Value>
				<!-- shaft height = 1800 leads to 2300x2300x350 base plate in 3D, a Lysaker-Asker / Norconsult construction -->
				<Value>1800</Value>
			</Values>
			<Values Variant="Betong KL-fundament, H3, 700x700xM36, 6000-9500" >
				<Value>3700</Value>
				<Value>2900</Value>
				<Value>2700</Value>
				<Value>2600</Value>
				<Value>2200</Value>
			</Values>
			<Values Variant="Betong KL-fundament, H3, 790x790xM36, 10000-12000" >
				<Value>3700</Value>
				<Value>2900</Value>
				<Value>2700</Value>
				<Value>2600</Value>
				<Value>2200</Value>
			</Values>
			<Values Variant="Betong KL-fundament, H3, 830x830xM36, 12500-13000" >
				<Value>3700</Value>
				<Value>2900</Value>
				<Value>2700</Value>
				<Value>2600</Value>
				<Value>2200</Value>
			</Values>
		</CustomAttribute>

		 <!-- Used by several disciplines: -->
		<LuaExpression Name="code" ><Formula>NOBN_sub_getFoundationCode()</Formula></LuaExpression>

        <LuaExpression Name="name" ><Formula>tostring(code):upper():match("UNFINISHED") and code or ""</Formula></LuaExpression>
        <LuaExpression Name="Mileage" ><Formula>RC__getMileageFromRelatedObject("Er kl-fundament for kl-mast/kraftavlasting")</Formula></LuaExpression>
        <LuaExpression Name="DistanceToAlignment" ><Formula>RC__getDistanceToAlignmentFromRelatedObject("Er kl-fundament for kl-mast/kraftavlasting")</Formula></LuaExpression>
        <LuaExpression Name="RelativeElevation" ><Formula>RC__getRelativeElevationFromRelatedObject("Er kl-fundament for kl-mast/kraftavlasting")</Formula></LuaExpression>
        <LuaExpression Name="dir" ><Formula>RC__getDirFromRelatedObject("Er kl-fundament for kl-mast/kraftavlasting")</Formula></LuaExpression>
        <LuaExpression Name="AngularOffset" ><Formula>RC__getAngularOffsetFromRelatedObject("Er kl-fundament for kl-mast/kraftavlasting")</Formula></LuaExpression>
		<LuaExpression Name="EarthingMethod" ><Formula>"None"</Formula></LuaExpression>

		<LuaExpression Name="Model3DName" ><Formula>_EH_FUN_OcsFoundation_Model3DName()</Formula></LuaExpression>
		<LuaFunction Name="_EH_FUN_OcsFoundation_Model3DName" 
				ReturnType="String"
				HideFromUser="false"
				Description="Returns the 3D model name for an OCS foundation." >
			<Constructor>String _EH_FUN_OcsFoundation_Model3DName()</Constructor>
			<Formula>
				function _EH_FUN_OcsFoundation_Model3DName()
					local bw = OcsFoundationBaseWidth
					local bo = OcsFoundationBaseOffset == 0 and "000" or tostring(OcsFoundationBaseOffset)
					local sh = OcsFoundationShaftHeight
					if Variant:lower():match("bjelkemast") then
						return "NO-BN-3D-EH-FUN-BJELKEMAST-1600x"..bw.."x1000-"..bo.."-700x700-191x374xM36-"..sh
					
					elseif Variant:match("Ø555") then
						return "NO-BN-3D-EH-FUN-BJELKEMAST-BORET-Ø555-191x374xM36-"..sh
					
					elseif Variant:match("Ø355") then
						return "NO-BN-3D-EH-FUN-GITTERMAST-BORET-Ø355-Ø232x27DDxM36-"..sh
					
					elseif Variant:match("Fjellbolter for KL%-mast i tunnel") then
						return "NO-BN-3D-EH-FUN-HENGEMAST-FJELLBOLTER-350x350xM24"
					
					elseif Variant:match("Fjellbolter for KL%-mast på veggkonsoll") then
						return "NO-BN-3D-EH-FUN-KONSOLL-VEGGFESTE-FJELLBOLTER-600x700xM32"

					elseif Variant:match("Veggkonsoll for KL%-mast") then
						return "NO-BN-3D-EH-FUN-KONSOLL-VEGGFESTE-191x374xM36"
					
					elseif Variant:lower():match("spesial") then
						return "NO-BN-3D-FE-DIV-UKJENT",_info("To be replaced by customized special foundation adapted to the situation's needs.")
					
					elseif Variant:match("lav B3 og B6, 240x800xM36, 6000%-9500") then
						if sh == 1800 then 
							return "NO-BN-3D-EH-FUN-GITTERMAST-B3-B6-2300x2300x350-000-500x1100-240x800xM36-"..sh
						else 
							return "NO-BN-3D-EH-FUN-GITTERMAST-B3-B6-1600x1800x500-100-600x1200-240x800xM36-"..sh
						end

					elseif Variant:match("høy B6, 260x940xM36") then
						if sh == 1800 then 
							return "NO-BN-3D-EH-FUN-GITTERMAST-B6-2300x2300x350-000-500x1100-260x940xM36-"..sh
						else 
							return "NO-BN-3D-EH-FUN-GITTERMAST-B6-1600x1800x500-100-600x1200-260x940xM36-"..sh
						end

					elseif Variant:match("H3, 700x700xM36, 6000%-9500") then
						return "NO-BN-3D-EH-FUN-GITTERMAST-H3-1600x"..bw.."x500-"..bo.."-1000x1000-700x700xM36-"..sh
					
					elseif Variant:match("H3, 790x790xM36, 10000%-12000") then
						return "NO-BN-3D-EH-FUN-GITTERMAST-H3-1600x"..bw.."x500-"..bo.."-1100x1100-790x790xM36-"..sh
					
					elseif Variant:match("H3, 830x830xM36, 12500%-13000") then
						return "NO-BN-3D-EH-FUN-GITTERMAST-H3-1600x"..bw.."x500-"..bo.."-1100x1100-830x830xM36-"..sh
					
					else
						return _error,"Unrecognized variant ["..Variant.."]."
					end
				end
			</Formula>
		</LuaFunction>

		<InsertPointObject VariantName="Betong KL-fundament, bjelkemast"
				DisplayBlockName="NO-BN-2D-JBTEH_FUN-FUNDAMENT-BETONG-BJELKEMAST-1600x1800-000-191x374xM36-{{SymbolMode}}"
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="4.0" >   
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="false" RotateIfRightSideOfAlignment="true" />
			<SetValue Key="dir" Value="both" />
			<SetValue Key="OcsFoundationBaseWidth" Value="1800" />
			<SetValue Key="OcsFoundationBaseOffset" Value="000" />
			<SetValue Key="OcsFoundationShaftHeight" Value="2700" />
		</InsertPointObject>

		<InsertPointObject VariantName="Boret KL-fundament, Ø355-Ø232xDD27xM36"
				DisplayBlockName="NO-BN-2D-JBTEH_FUN-FUNDAMENT-BETONG-BORET-Ø355-Ø232xDD27xM36-{{SymbolMode}}" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="4.0" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="false" RotateIfRightSideOfAlignment="true" />
			<SetValue Key="dir" Value="both" />
			<SetValue Key="OcsFoundationShaftHeight" Value="5000" />
		</InsertPointObject>

		<InsertPointObject VariantName="Boret KL-fundament, Ø555-191x374xM36"
				DisplayBlockName="NO-BN-2D-JBTEH_FUN-FUNDAMENT-BETONG-BORET-Ø555-191x374xM36-{{SymbolMode}}" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="4.0" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="false" RotateIfRightSideOfAlignment="true" />
			<SetValue Key="dir" Value="both" />
			<SetValue Key="OcsFoundationShaftHeight" Value="4500" />
		</InsertPointObject>

		<InsertPointObject VariantName="Fjellbolter for KL-mast i tunnel"
				DisplayBlockName="NO-BN-2D-JBTEH_FUN-FUNDAMENT-FJELLBOLTER-FOR-BRU-OG-TUNNEL-350x350xM24-{{SymbolMode}}" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="4.0" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="false" RotateIfRightSideOfAlignment="true" />
			<SetValue Key="dir" Value="both" />
		</InsertPointObject>

		
		<InsertPointObject VariantName="Fjellbolter for KL-mast på veggkonsoll"
				DisplayBlockName="NO-BN-2D-JBTEH_FUN-FUNDAMENT-FJELLBOLTER-FOR-VEGGKONSOLL-600x700xM24-{{SymbolMode}}" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="4.0" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="false" RotateIfRightSideOfAlignment="true" />
			<SetValue Key="dir" Value="both" />
		</InsertPointObject>

		<InsertPointObject VariantName="Veggkonsoll for KL-mast" 
				DisplayBlockName="NO-BN-2D-JBTEH_FUN-FUNDAMENT-KONSOLL-VEGGFESTE-191x374xM36-{{SymbolMode}}" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="4.0" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="false" RotateIfRightSideOfAlignment="true" />
			<SetValue Key="dir" Value="both" />
		</InsertPointObject>
		
		<InsertPointObject VariantName="Spesial KL-fundament" 
				DisplayBlockName="NO-BN-2D-JBTEH_FUN-FUNDAMENT-SPESIAL-191x374xM36-{{SymbolMode}}" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="4.0" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="false" RotateIfRightSideOfAlignment="true" />
			<SetValue Key="dir" Value="both" />
		</InsertPointObject>

		<InsertPointObject VariantName="Betong KL-fundament, lav B3 og B6, 240x800xM36, 6000-9500" 
				DisplayBlockName="NO-BN-2D-JBTEH_FUN-FUNDAMENT-BETONG-B3-OG-B6-1600x1800-000-240x800xM36-{{SymbolMode}}" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="4.0" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="false" RotateIfRightSideOfAlignment="true" />
			<SetValue Key="dir" Value="both" />
			<SetValue Key="OcsFoundationBaseWidth" Value="1800" />
			<SetValue Key="OcsFoundationBaseOffset" Value="000" />
			<SetValue Key="OcsFoundationShaftHeight" Value="3200" />
		</InsertPointObject>
		
		<InsertPointObject VariantName="Betong KL-fundament, høy B6, 260x940xM36, 10000-13000" 
				DisplayBlockName="NO-BN-2D-JBTEH_FUN-FUNDAMENT-BETONG-B6-1600x1800-000-260x940xM36-{{SymbolMode}}" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="4.0" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="false" RotateIfRightSideOfAlignment="true" />
			<SetValue Key="dir" Value="both" />
			<SetValue Key="OcsFoundationBaseWidth" Value="1800" />
			<SetValue Key="OcsFoundationBaseOffset" Value="000" />
			<SetValue Key="OcsFoundationShaftHeight" Value="3200" />
		</InsertPointObject>
		
		<InsertPointObject VariantName="Betong KL-fundament, H3, 700x700xM36, 6000-9500" 
				DisplayBlockName="NO-BN-2D-JBTEH_FUN-FUNDAMENT-BETONG-H3-1600x1800-000-700x700xM36-6000-9500-{{SymbolMode}}"
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="4.0" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="false" RotateIfRightSideOfAlignment="true" />
			<SetValue Key="dir" Value="both" />
			<SetValue Key="OcsFoundationBaseWidth" Value="1800" />
			<SetValue Key="OcsFoundationBaseOffset" Value="000" />
			<SetValue Key="OcsFoundationShaftHeight" Value="2700" />
		</InsertPointObject>
		
		<InsertPointObject VariantName="Betong KL-fundament, H3, 790x790xM36, 10000-12000" 
				DisplayBlockName="NO-BN-2D-JBTEH_FUN-FUNDAMENT-BETONG-H3-1600x1800-000-790x790xM36-10000-12000-{{SymbolMode}}"
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="4.0" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="false" RotateIfRightSideOfAlignment="true" />
			<SetValue Key="dir" Value="both" />
			<SetValue Key="OcsFoundationBaseWidth" Value="1800" />
			<SetValue Key="OcsFoundationBaseOffset" Value="000" />
			<SetValue Key="OcsFoundationShaftHeight" Value="2700" />
		</InsertPointObject>
		
		<InsertPointObject VariantName="Betong KL-fundament, H3, 830x830xM36, 12500-13000" 
				DisplayBlockName="NO-BN-2D-JBTEH_FUN-FUNDAMENT-BETONG-H3-1600x1800-000-830x830xM36-12500-13000-{{SymbolMode}}"
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="4.0" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="false" RotateIfRightSideOfAlignment="true" />
			<SetValue Key="OcsFoundationBaseWidth" Value="1800" />
			<SetValue Key="OcsFoundationBaseOffset" Value="000" />
			<SetValue Key="OcsFoundationShaftHeight" Value="2700" />
			<SetValue Key="dir" Value="both" />
		</InsertPointObject>
		
		<SymbolDefinition DefaultBlockName="NO-BN-2D-JBTEH_FUN-FUNDAMENT-BETONG-BJELKEMAST-1600x1800-000-191x374xM36-{{SymbolMode}}" AllowSymbolMove="true" >
			<Rotation Add180DegreesIfDirIsDown="false" AddAngle="{% if dir == 'up' %}{{270.0|plus:AngularOffset}}
														{% elsif dir == 'down' %}{{90.0|plus:AngularOffset}}
														{% elsif dir == 'both' and RightSided %}{{180.0|plus:AngularOffset}}
														{% elsif dir == 'both' and LeftSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and RightSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and LeftSided %}{{180.0|plus:AngularOffset}}
														{% else %}45.0
														{% endif %}" />	
			<!-- 2020-11-08 CLFEY Dropped using DotLiquid pipe '| downcase' since all are numbers now: -->
			<BlockNameFormat JoinBy="-" >
				NO-BN-2D-JBTEH_FUN-FUNDAMENT
				{% if    Variant == 'Betong KL-fundament, bjelkemast' %}BETONG-BJELKEMAST-1600x{{OcsFoundationBaseWidth}}-{{OcsFoundationBaseOffset}}-191x374xM36
				{% elsif Variant == 'Boret KL-fundament, Ø555-191x374xM36' %}BETONG-BORET-Ø555-191x374xM36
				{% elsif Variant == 'Boret KL-fundament, Ø355-Ø232xDD27xM36' %}BETONG-BORET-Ø355-Ø232xDD27xM36
				{% elsif Variant == 'Fjellbolter for KL-mast i tunnel' %}FJELLBOLTER-FOR-BRU-OG-TUNNEL-350x350xM24
				{% elsif Variant == 'Fjellbolter for KL-mast på veggkonsoll' %}FJELLBOLTER-FOR-VEGGKONSOLL-600x700xM24
				{% elsif Variant == 'Veggkonsoll for KL-mast' %}KONSOLL-VEGGFESTE-191x374xM36
				{% elsif Variant == 'Spesial KL-fundament' %}SPESIAL-191x374xM36
				{% elsif Variant == 'Betong KL-fundament, lav B3 og B6, 240x800xM36, 6000-9500' %}BETONG-B3-B6-LAV-1600x1800-{{OcsFoundationBaseOffset}}-240x800xM36
				{% elsif Variant == 'Betong KL-fundament, høy B6, 260x940xM36, 10000-13000' %}BETONG-B6-HOEY-1600x1800-{{OcsFoundationBaseOffset}}-260x940xM36
				{% elsif Variant == 'Betong KL-fundament, H3, 700x700xM36, 6000-9500' %}BETONG-H3-1600x{{OcsFoundationBaseWidth}}-{{OcsFoundationBaseOffset}}-700x700xM36-6000-9500
				{% elsif Variant == 'Betong KL-fundament, H3, 790x790xM36, 10000-12000' %}BETONG-H3-1600x{{OcsFoundationBaseWidth}}-{{OcsFoundationBaseOffset}}-790x790xM36-10000-12000
				{% elsif Variant == 'Betong KL-fundament, H3, 830x830xM36, 12500-13000' %}BETONG-H3-1600x{{OcsFoundationBaseWidth}}-{{OcsFoundationBaseOffset}}-830x830xM36-12500-13000
				{% else %}BAD_Variant
				{% endif %}
				{{SymbolMode}}
			</BlockNameFormat>
		</SymbolDefinition>

		<SymbolDefinition DefaultBlockName="NO-BN-2D-##RC_INNSETTINGSPUNKT-Schematic" />

		<!-- Vi lar alle sammen få lov til også å benyttes som ankerpunkt for barduner og strevere -->
		<DockPointDefinitions>
			<SnapPoints>
				<SnapPoint X="0.0" Y="0.0" TargetSpace="kl-mast" />
				<SnapPoint X="0.0" Y="0.0" TargetSpace="kraftavlasting" />
			</SnapPoints>
		</DockPointDefinitions>

	</ObjectType><!-- JBTEH_FUN KL-fundament -->


<!--========================================================================================================
	UNDERBYGNING
	FUNDAMENTER
	Store konstruksjoner i betong, eller boret i metall, med boltegruppe
=========================================================================================================-->
	<ObjectType DataType="tOrientedElement" Class="RailwayPlacedObject" Name="JBTKU_FUN Signalfundament"
				Layer="JBTKU_FUN" Color="ByLayer"
				Group="Underbygning/Fundamenter/Signal"
				AttMirrorY="{% if RightSided %}true{% else %}false{% endif %}"
				>
				
		<RelationSpace>signalfundament</RelationSpace>
		
		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___ANGULAROFFSET_TAG_OBJECTINFO_METADATA_VAR" />
		<xpp:expand select="NOBN_com_STD_TEXATTRIBUTES___VERTICAL_AND_FAR___JBTUB" />
		<xpp:expand select="NOBN_com_DISCIPLINE_JBTUB" />
		<xpp:expand select="NOBN_com_CHK_NUMBER_OF_OCP_AREAS" />
		<xpp:expand select="RC_com_SET_OCP_STATION_REFERENCE" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___WAYSIDE_GENERAL_OBJECT" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___EARTHED_TO_NONE" />

		<Variants>
			<Variant Name="Betong Hs fundament på fri linje" >
				<SetValue Key="name" Value="Hs-fund. på fri linje" />
				<SetValue Key="SignalFoundationShaftHeight" Value="1700" />
			</Variant>
			<Variant Name="Betong Hs fundament på plattform" >
				<SetValue Key="name" Value="Hs-fund. på plattform" />
				<SetValue Key="RelativeElevation" Value="0.76" />
				<SetValue Key="SignalFoundationShaftHeight" Value="1000" />
			</Variant>
			<Variant Name="Betong Hs fundament, Ø680" >
				<SetValue Key="name" Value="Rundt Hs-fund, Ø680" />
				<SetValue Key="SignalFoundationShaftHeight" Value="1600" />
			</Variant>
			<Variant Name="Betong Ds fundament, Ø76, konisk" >
				<SetValue Key="name" Value="Ds-fund." />
			</Variant>
			<Variant Name="Betong Ds fundament, Ø76, rettsidet" >
				<SetValue Key="name" Value="Ds-fund." />
			</Variant>
			<Variant Name="Boret Hs fundament, Ø555" >
				<SetValue Key="name" Value="Boret Hs-fund." />
			</Variant>
			<Variant Name="Betong veibomdrivmaskin fundament, Ø680" >
				<SetValue Key="name" Value="Rundt Hs-fund, Ø680" />
			</Variant>
		</Variants>

		<CustomAttribute DataType="Enumeration" Name="SignalFoundationShaftHeight" DisplayName="Fundament søylehøyde"
			Description="The signal foundation shaft height resp. total bored height." >
			<Values Variant="Betong Hs fundament på fri linje" >
				<Value>1700</Value>
			</Values>
			<Values Variant="Betong Hs fundament på plattform" >
				<Value>1000</Value>
			</Values>
			<Values Variant="Betong Hs fundament, Ø680" >
				<Value>1800</Value>
				<Value>1600</Value>
			</Values>
			<Values Variant="Betong Ds fundament, Ø76, konisk" >
				<!-- Well, it doesn't really have a shaft - it is conical... -->
				<Value>400</Value>
			</Values>
			<Values Variant="Betong Ds fundament, Ø76, rettsidet" >
				<Value>400</Value>
			</Values>
		</CustomAttribute>

		<InsertPointObject VariantName="Betong Hs fundament på fri linje"
				DisplayBlockName="NO-BN-2D-JBTKU_FUN-SIGNALFUNDAMENT-BETONG-HS-FRI-LINJE-300x300xM24-{{SymbolMode}}" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="3.5" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="-90" EnableDirectionSetting="true" />
		</InsertPointObject>
		
		<InsertPointObject VariantName="Betong Hs fundament på plattform"
				DisplayBlockName="NO-BN-2D-JBTKU_FUN-SIGNALFUNDAMENT-BETONG-HS-PLATTFORM-300x300xM24-{{SymbolMode}}" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="3.5" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="-90" EnableDirectionSetting="true" />
		</InsertPointObject>
		
		<InsertPointObject VariantName="Betong Hs fundament, Ø680"
				DisplayBlockName="NO-BN-2D-JBTKU_FUN-SIGNALFUNDAMENT-BETONG-HS-Ø680-300x300xM24-{{SymbolMode}}" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="3.5" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="-90" EnableDirectionSetting="true" />
		</InsertPointObject>
		
		<InsertPointObject VariantName="Betong Ds fundament, Ø76, konisk"
				DisplayBlockName="NO-BN-2D-JBTKU_FUN-SIGNALFUNDAMENT-BETONG-DS-Ø76-KONISK-{{SymbolMode}}"
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="3.5" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="-90" EnableDirectionSetting="true" />
		</InsertPointObject>
		
		<InsertPointObject VariantName="Betong Ds fundament, Ø76, rettsidet"
				DisplayBlockName="NO-BN-2D-JBTKU_FUN-SIGNALFUNDAMENT-BETONG-DS-Ø76-RETTSIDET-{{SymbolMode}}"
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="3.5" >
			<JigSymbolAppearance AddAngle="-90" EnableDirectionSetting="true" />
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
		</InsertPointObject>

		<InsertPointObject VariantName="Boret Hs fundament, Ø555"
				DisplayBlockName="NO-BN-2D-JBTKU_FUN-SIGNALFUNDAMENT-BETONG-BORET-Ø555-164x164xM32-{{SymbolMode}}"
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="3.5" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="false" RotateIfRightSideOfAlignment="true" />
			<SetValue Key="dir" Value="both" />
		</InsertPointObject>
		
		<!-- NB: Veibomdrivmaskin plasseres inntil linjetype 'vei': -->
		<InsertPointObject VariantName="Betong veibomdrivmaskin fundament, Ø680"
				DisplayBlockName="NO-BN-2D-JBTKU_FUN-SIGNALFUNDAMENT-BETONG-VEIBOMDRIVMASKIN-Ø680-210x210xM20-1600-{{SymbolMode}}" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="3.5" >
			<OwnAlignmentTargetSpace>vei</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="false" RotateIfRightSideOfAlignment="true" />
			<SetValue Key="dir" Value="both" />
		</InsertPointObject>
		
		<SymbolDefinition DefaultBlockName="NO-BN-2D-JBTKU_FUN-SIGNALFUNDAMENT-BETONG-HS-FRI-LINJE-300x300xM24-{{SymbolMode}}" AllowSymbolMove="true" >
			<Rotation Add180DegreesIfDirIsDown="false" AddAngle="{% if dir == 'up' %}{{270.0|plus:AngularOffset}}
														{% elsif dir == 'down' %}{{90.0|plus:AngularOffset}}
														{% elsif dir == 'both' and RightSided %}{{180.0|plus:AngularOffset}}
														{% elsif dir == 'both' and LeftSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and RightSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and LeftSided %}{{180.0|plus:AngularOffset}}
														{% else %}45.0
														{% endif %}" />	
			<BlockNameFormat JoinBy="-" >
				NO-BN-2D-JBTKU_FUN-SIGNALFUNDAMENT
				{% if Variant == 'Betong Hs fundament på fri linje' %}BETONG-HS-FRI-LINJE-300x300xM24
				{% elsif Variant == 'Betong Hs fundament på plattform' %}BETONG-HS-PLATTFORM-300x300xM24
				{% elsif Variant == 'Betong Hs fundament, Ø680' %}BETONG-HS-Ø680-300x300xM24-{{SignalFoundationShaftHeight}}
				{% elsif Variant == 'Betong Ds fundament, Ø76, konisk' %}BETONG-DS-Ø76-KONISK
				{% elsif Variant == 'Betong Ds fundament, Ø76, rettsidet' %}BETONG-DS-Ø76-RETTSIDET
				{% elsif Variant == 'Boret Hs fundament, Ø555' %}BETONG-BORET-Ø555-164x164xM32
				{% elsif Variant == 'Betong veibomdrivmaskin fundament, Ø680' %}BETONG-VEIBOMDRIVMASKIN-Ø680-210x210xM20-{{SignalFoundationShaftHeight}}
				{% else %}BAD_Variant
				{% endif %}
				{{SymbolMode}}
			</BlockNameFormat>
		</SymbolDefinition>

		<SymbolDefinition DefaultBlockName="NO-BN-2D-##RC_INNSETTINGSPUNKT-Schematic" />

		<DockPointDefinitions>
			<SnapPoints Variant="Betong Hs fundament på fri linje" >
				<SnapPoint X="0.0" Y="0.0" TargetSpace="signal" />
			</SnapPoints>
			<SnapPoints Variant="Betong Hs fundament på plattform" >
				<SnapPoint X="0.0" Y="0.0" TargetSpace="signal" />
			</SnapPoints>
			<SnapPoints Variant="Betong Hs fundament, Ø680, h=1600" >
				<SnapPoint X="0.0" Y="0.0" TargetSpace="signal" />
			</SnapPoints>
			<SnapPoints Variant="Betong Hs fundament, Ø680, h=1800" >
				<SnapPoint X="0.0" Y="0.0" TargetSpace="signal" />
			</SnapPoints>
			<SnapPoints Variant="Betong Ds fundament, Ø76, konisk" >
				<SnapPoint X="0.0" Y="0.0" TargetSpace="signal" />
			</SnapPoints>
			<SnapPoints Variant="Betong Ds fundament, Ø76, rettsidet" >
				<SnapPoint X="0.0" Y="0.0" TargetSpace="signal" />
			</SnapPoints>
			<SnapPoints Variant="Boret Hs fundament, Ø555" >
				<SnapPoint X="0.0" Y="0.0" TargetSpace="signal" />
			</SnapPoints>
		</DockPointDefinitions>

	</ObjectType>



<!--========================================================================================================
	UNDERBYGNING
	FUNDAMENTER
=========================================================================================================-->
	<ObjectType DataType="tOrientedElement" Class="RailwayPlacedObject" Name="JBTKU_FUN Telefundament"
				Layer="JBTKU_FUN" Color="ByLayer"
				Group="Underbygning/Fundamenter/Tele"
				AttMirrorY="{% if RightSided %}true{% else %}false{% endif %}"
				>
				
		<RelationSpace>telefundament</RelationSpace>
		
		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___ANGULAROFFSET_TAG_OBJECTINFO_METADATA_VAR" />
		<xpp:expand select="NOBN_com_STD_TEXATTRIBUTES___VERTICAL_AND_FAR___JBTUB" />
		<xpp:expand select="NOBN_com_DISCIPLINE_JBTUB" />
		<xpp:expand select="NOBN_com_CHK_NUMBER_OF_OCP_AREAS" />
		<xpp:expand select="RC_com_SET_OCP_STATION_REFERENCE" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___WAYSIDE_GENERAL_OBJECT" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___EARTHED_TO_NONE" />

		<Variants>
			<Variant Name="Betongfundament, anvisersøyle" >
				<SetValue Key="name" Value="Anvisersøyle fund." />
				<SetValue Key="Model3DName" Value="NO-BN-3D-KU-FUN-TELE-ANVISERSYØYLE-1500x1500x1000-Ø600" />
			</Variant>
			<Variant Name="Betongfundament, monitor" >
				<SetValue Key="name" Value="Monitor fund." />
				<SetValue Key="Model3DName" Value="NO-BN-3D-KU-FUN-TELE-MONITOR-1000x1000x1000-Ø600" />
			</Variant>
			<Variant Name="Betongfundament, validator" >
				<SetValue Key="name" Value="NSB validator fund." />
				<SetValue Key="Model3DName" Value="NO-BN-3D-KU-FUN-TELE-BILLETT-VALIDATOR-360x300x500" />
			</Variant>
			<Variant Name="Betongfundament, tele- og fordelingsskap" >
				<SetValue Key="name" Value="Tele- og fordelingsskap fund." />
				<SetValue Key="Model3DName" Value="NO-BN-3D-KU-FUN-TELE-FORDELINGSSKAP-900x800x910" />
			</Variant>
		</Variants>

        <LuaExpression Name="dir" ><Formula>"both"</Formula></LuaExpression>
        <LuaExpression Name="code" ><Formula>NOBN_sub_getFoundationCode()</Formula></LuaExpression>
		<LuaExpression Name="EarthingMethod" ><Formula>"None"</Formula></LuaExpression>
        <LuaExpression Name="name" ><Formula>tostring(code):upper():match("UNFINISHED") and "" or code</Formula></LuaExpression>

		<InsertPointObject VariantName="Betongfundament, anvisersøyle" DisplayBlockName="NO-BN-2D-JBTKU_FUN-TELEFUNDAMENT-BETONG-ANVISERSOEYLE-{{SymbolMode}}" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="3.5" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="true" RotateIfRightSideOfAlignment="true" />
			<SetValue Key="dir" Value="both" />
		</InsertPointObject>
		
		<InsertPointObject VariantName="Betongfundament, monitor" DisplayBlockName="NO-BN-2D-JBTKU_FUN-TELEFUNDAMENT-BETONG-MONITOR-{{SymbolMode}}" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="3.5" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="true" RotateIfRightSideOfAlignment="true" />
			<SetValue Key="dir" Value="both" />
		</InsertPointObject>
		
		<InsertPointObject VariantName="Betongfundament, validator" DisplayBlockName="NO-BN-2D-JBTKU_FUN-TELEFUNDAMENT-BETONG-VALIDATOR-{{SymbolMode}}" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="3.5" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="true" RotateIfRightSideOfAlignment="true" />
			<SetValue Key="dir" Value="both" />
		</InsertPointObject>
		
		<InsertPointObject VariantName="Betongfundament, tele- og fordelingsskap" DisplayBlockName="NO-BN-2D-JBTKU_FUN-TELEFUNDAMENT-BETONG-TELE-OG-FORDELINGSSKAP-{{SymbolMode}}" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="3.5" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance AddAngle="0" EnableDirectionSetting="true" RotateIfRightSideOfAlignment="true" />
			<SetValue Key="dir" Value="both" />
		</InsertPointObject>

		<SymbolDefinition DefaultBlockName="NO-BN-3D-KU-FUN-ANVISERSYØYLE-1500x1500x1000-Ø600-{{SymbolMode}}" AllowSymbolMove="true" >
			<Rotation Add180DegreesIfDirIsDown="false" AddAngle="{% if dir == 'up' %}{{270.0|plus:AngularOffset}}
														{% elsif dir == 'down' %}{{90.0|plus:AngularOffset}}
														{% elsif dir == 'both' and RightSided %}{{180.0|plus:AngularOffset}}
														{% elsif dir == 'both' and LeftSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and RightSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and LeftSided %}{{180.0|plus:AngularOffset}}
														{% else %}45.0
														{% endif %}" />	
			<BlockNameFormat JoinBy="-" >
				NO-BN-2D-JBTKU_FUN-TELEFUNDAMENT
				{% if Variant == 'Betongfundament, anvisersøyle' %}BETONG-ANVISERSOEYLE
				{% elsif Variant == 'Betongfundament, monitor' %}BETONG-MONITOR
				{% elsif Variant == 'Betongfundament, validator' %}BETONG-VALIDATOR
				{% elsif Variant == 'Betongfundament, tele- og fordelingsskap' %}BETONG-TELE-OG-FORDELINGSSKAP
				{% else %}BAD_Variant
				{% endif %}
				{{SymbolMode}}
			</BlockNameFormat>
		</SymbolDefinition>

		<SymbolDefinition DefaultBlockName="NO-BN-2D-##RC_INNSETTINGSPUNKT-Schematic" />

		<DockPointDefinitions>
			<SnapPoints Variant="Betongfundament, anvisersøyle" >
				<SnapPoint X="0.0" Y="0.0" TargetSpace="anvisersøyle" />
			</SnapPoints>
			<SnapPoints Variant="Betongfundament, monitor" >
				<SnapPoint X="0.0" Y="0.0" TargetSpace="monitor" />
			</SnapPoints>
			<SnapPoints Variant="Betongfundament, validator" >
				<SnapPoint X="0.0" Y="0.0" TargetSpace="validator" />
			</SnapPoints>
			<SnapPoints Variant="Betongfundament, tele- og fordelingsskap" >
				<SnapPoint X="0.0" Y="0.0" TargetSpace="fordelingsskap" />
			</SnapPoints>
		</DockPointDefinitions>

	</ObjectType>



<!--========================================================================================================
	UNDERBYGNING
	SKILTFESTER
	Små skiltfester som ikke skal monteres på noe annet (ved relations).
	NB: 'KU-SKF' er p.t. ikke en gyldig Banedata kode, men en vi 'fant på selv', omfatter
	dingser som vanligvis ikke fortjener å bli registrert i Banedata.
=========================================================================================================-->
	<ObjectType DataType="tOrientedElement" Class="RailwayPlacedObject" Name="JBTKU_SKF Skiltfeste"
				Layer="JBTKU_SPB" Color="ByLayer"
				Group="Underbygning/Skiltfester"
				AttMirrorY="{% if RightSided %}true{% else %}false{% endif %}"
				>
				
		<RelationSpace>skiltfeste</RelationSpace>
		<AttachmentCategory Name="skiltfeste" />
		
		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___ANGULAROFFSET_TAG_OBJECTINFO_METADATA_VAR" />
		<xpp:expand select="NOBN_com_STD_TEXATTRIBUTES___VERTICAL_AND_FAR___JBTUB" />
		<xpp:expand select="NOBN_com_DISCIPLINE_JBTUB" />
		<xpp:expand select="NOBN_com_CHK_NUMBER_OF_OCP_AREAS" />
		<xpp:expand select="RC_com_SET_OCP_STATION_REFERENCE" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___WAYSIDE_GENERAL_OBJECT" />
		<xpp:expand select="NOBN_com_STD_LUAEXPRESSIONS___EARTHED_TO_NONE" />

		<Variants>
			<Variant Name="Betongfundament (h=500mm)" >
				<SetValue Key="name" Value="Ø60/b225/h500" />
				<SetValue Key="Model3DName" Value="NO-BN-3D-KU-SKF-SKILTFESTE-BETONGFOT-Ø60-145..215x500" />
			</Variant>
			<Variant Name="Betongfundament (h=700mm)" >
				<SetValue Key="name" Value="Ø60/b225/h700" />
				<SetValue Key="Model3DName" Value="NO-BN-3D-KU-SKF-SKILTFESTE-BETONGFOT-Ø60-145..215x700" />
			</Variant>
			<Variant Name="Betongfundament (h=1200mm)" >
				<SetValue Key="name" Value="Ø60/Ø200/h1200" />
				<SetValue Key="Model3DName" Value="NO-BN-3D-KU-SKF-SKILTFESTE-BETONGFOT-Ø60-Ø200x1200" />
			</Variant>
			<Variant Name="Jordfundament" >
				<SetValue Key="name" Value="Ø60/jordfund." />
				<SetValue Key="Model3DName" Value="NO-BN-3D-KU-SKF-SKILTFESTE-JORDFUNDAMENT-Ø60-700" />
			</Variant>
			<Variant Name="Jordspyd (60cm dypt)" >
				<SetValue Key="name" Value="Ø60/jordspyd" />
				<SetValue Key="Model3DName" Value="NO-BN-3D-KU-SKF-SKILTFESTE-JORDSPYD-Ø60" />
			</Variant>
			<Variant Name="Tilbakefylt grop" >
				<SetValue Key="name" Value="Tilbakefylt grop" />
				<SetValue Key="Model3DName" Value="NO-BN-3D-KU-SKF-SKILTFESTE-TILBAKEFYLT-BALLASTGROP" />
			</Variant>
			<Variant Name="Strips eller patentbånd" >
				<SetValue Key="name" Value="Strips m.m." />
				<SetValue Key="Model3DName" Value="NO-BN-3D-KU-SKF-SKILTFESTE-PATENTBÅND" />
			</Variant>
			<Variant Name="Brakett mot gulv" >
				<SetValue Key="name" Value="Ø60/gulv" />
				<SetValue Key="Model3DName" Value="NO-BN-3D-KU-SKF-SKILTFESTE-BRAKETT-MOT-GULV-Ø60-200x200x308" />
			</Variant>
			<Variant Name="Brakett mot vegg" >
				<SetValue Key="name" Value="Ø60/vegg" />
				<SetValue Key="RelativeElevation" Value="2.5" />
				<SetValue Key="Model3DName" Value="NO-BN-3D-KU-SKF-SKILTFESTE-BRAKETT-MOT-VEGG-Ø60-150x120x119" />
			</Variant>
			<Variant Name="Brakett på annen mast" >
				<SetValue Key="name" Value="Brakett på annen mast" />
				<SetValue Key="Model3DName" Value="NO-BN-3D-KU-SKF-SKILTFESTE-BRAKETT-MOT-MAST" />
			</Variant>
		</Variants>
		
		<LuaExpression Name="dir" ><Formula>"both"</Formula></LuaExpression>
		<LuaExpression Name="RelativeElevation" ><Formula>if variant:find("Brakett mot vegg") then return 2.5 else return 0 end</Formula></LuaExpression>
		<LuaExpression Name="EarthingMethod" ><Formula>"None"</Formula></LuaExpression>

		<InsertPointObject VariantName="Betongfundament (h=500mm)" DisplayBlockName="NO-BN-2D-JBTKU_SKF-SKILTFESTE-BETONGFOT-60-225-500-{{SymbolMode}}" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="3.5" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance RotateIfRightSideOfAlignment="true" EnableDirectionSetting="true" AddAngle="0" />
		</InsertPointObject>
		
		<InsertPointObject VariantName="Betongfundament (h=700mm)" DisplayBlockName="NO-BN-2D-JBTKU_SKF-SKILTFESTE-BETONGFOT-60-225-700-{{SymbolMode}}" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="3.5" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance RotateIfRightSideOfAlignment="true" EnableDirectionSetting="true" AddAngle="0" />
		</InsertPointObject>
		
		<InsertPointObject VariantName="Betongfundament (h=1200mm)" DisplayBlockName="NO-BN-2D-JBTKU_SKF-SKILTFESTE-BETONGFOT-60-200-1200-{{SymbolMode}}"
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="3.5" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance RotateIfRightSideOfAlignment="true" EnableDirectionSetting="true" AddAngle="0" />
		</InsertPointObject>
		
		<InsertPointObject VariantName="Jordfundament" DisplayBlockName="NO-BN-2D-JBTKU_SKF-SKILTFESTE-JORDFUNDAMENT-60-700-{{SymbolMode}}"
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="3.5" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance RotateIfRightSideOfAlignment="true" EnableDirectionSetting="true" AddAngle="0" />
		</InsertPointObject>
		
		<InsertPointObject VariantName="Jordspyd (60cm dypt)" DisplayBlockName="NO-BN-2D-JBTKU_SKF-SKILTFESTE-JORDSPYD-60-{{SymbolMode}}" 
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="3.5" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance RotateIfRightSideOfAlignment="true" EnableDirectionSetting="true" AddAngle="0" />
		</InsertPointObject>
		
		<InsertPointObject VariantName="Tilbakefylt grop" DisplayBlockName="NO-BN-2D-JBTKU_SKF-SKILTFESTE-TILBAKEFYLT-GROP-{{SymbolMode}}"
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="3.5" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance RotateIfRightSideOfAlignment="true" EnableDirectionSetting="true" AddAngle="0" />
		</InsertPointObject>
		
		<InsertPointObject VariantName="Strips eller patentbånd" DisplayBlockName="NO-BN-2D-JBTKU_SKF-SKILTFESTE-STRIPS-ELLER-PATENTBÅND-{{SymbolMode}}"
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="3.5" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance RotateIfRightSideOfAlignment="true" EnableDirectionSetting="true" AddAngle="0" />
		</InsertPointObject>

		<InsertPointObject VariantName="Brakett på annen mast" DisplayBlockName="NO-BN-2D-JBTKU_SKF-SKILTFESTE-BRAKETT-PÅ-ANNEN-MAST-{{SymbolMode}}" 
                  SnapToAlignment="true" SnapDistance="3.5" >
			<JigSymbolAppearance EnableDirectionSetting="true" AddAngle="-90" />
			<SetValue Key="dir" Value="both" />
			<SetValue Key="Model3DName" Value="NO-BN-3D-KU-SKF-SKILTFESTE-BRAKETT-MOT-MAST" />
		</InsertPointObject>

		<InsertPointObject VariantName="Brakett mot vegg" DisplayBlockName="NO-BN-2D-JBTKU_SKF-SKILTFESTE-BRAKETT-MOT-VEGG-60-110-{{SymbolMode}}"
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="3.5" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance RotateIfRightSideOfAlignment="true" EnableDirectionSetting="true" AddAngle="0" />
			<SetValue Key="RelativeElevation" Value="2.5" />
		</InsertPointObject>
		
		<InsertPointObject VariantName="Brakett mot gulv" DisplayBlockName="NO-BN-2D-JBTKU_SKF-SKILTFESTE-BRAKETT-MOT-GULV-60-308-{{SymbolMode}}"
				DefaultSnapMode="Point" SnapToAlignment="true" SnapDistance="3.5" >
			<OwnAlignmentTargetSpace>spor</OwnAlignmentTargetSpace>
			<JigSymbolAppearance RotateIfRightSideOfAlignment="true" EnableDirectionSetting="true" AddAngle="0" />
		</InsertPointObject>
		
		<SymbolDefinition DefaultBlockName="NO-BN-2D-JBTKU_SKF-SKILTFESTE-BETONGFOT-60-225-700-{{SymbolMode}}" AllowSymbolMove="true" >
			<Rotation Add180DegreesIfDirIsDown="false" AddAngle="{% if dir == 'up' %}{{270.0|plus:AngularOffset}}
														{% elsif dir == 'down' %}{{90.0|plus:AngularOffset}}
														{% elsif dir == 'both' and RightSided %}{{180.0|plus:AngularOffset}}
														{% elsif dir == 'both' and LeftSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and RightSided %}{{0.0|plus:AngularOffset}}
														{% elsif dir == 'none' and LeftSided %}{{180.0|plus:AngularOffset}}
														{% else %}45.0
														{% endif %}" />	
			<BlockNameFormat JoinBy="-" >
				NO-BN-2D-JBTKU_SKF-SKILTFESTE
				{% if Variant == 'Betongfundament (h=500mm)' %}BETONGFOT-60-225-500
				{% elsif Variant == 'Betongfundament (h=700mm)' %}BETONGFOT-60-225-700
				{% elsif Variant == 'Betongfundament (h=1200mm)' %}BETONGFOT-60-200-1200
				{% elsif Variant == 'Jordfundament' %}JORDFUNDAMENT-60-700
				{% elsif Variant == 'Jordspyd (60cm dypt)' %}JORDSPYD-60
				{% elsif Variant == 'Brakett mot gulv' %}BRAKETT-MOT-GULV-60-308
				{% elsif Variant == 'Brakett på annen mast' %}BRAKETT-PÅ-ANNEN-MAST
				{% elsif Variant == 'Brakett mot vegg' %}BRAKETT-MOT-VEGG-60-110
				{% elsif Variant == 'Tilbakefylt grop' %}TILBAKEFYLT-GROP
				{% elsif Variant == 'Strips eller patentbånd' %}STRIPS-ELLER-PATENTBÅND
				{% else %}BAD_Variant
				{% endif %}
				{{SymbolMode}}
			</BlockNameFormat>
		</SymbolDefinition>

		<SymbolDefinition DefaultBlockName="NO-BN-2D-##RC_INNSETTINGSPUNKT-Schematic" />

		<DockPointDefinitions>
			<SnapPoints>
				<SnapPoint X="0.0" Y="0.0" TargetSpace="skilt" />
				<SnapPoint X="0.0" Y="0.0" TargetSpace="stolpe" />
				<SnapPoint X="0.0" Y="0.0" TargetSpace="skilt_mot_vei" />
			</SnapPoints>
		</DockPointDefinitions>

	</ObjectType>



<!--========================================================================================================
    End of file 
=========================================================================================================-->
</xpp:bloc>
<!--========================================================================================================

    NO-BN-Labels.xml
	
	Include in DNA file using XPPq XML preprocessor directive <xpp:expand href="fileName.xml"/>.

	(c) Railcomplete AS, Norway, 2019-2020 All rights reserved.
	
=========================================================================================================-->
<xpp:bloc>



<!--========================================================================================================
	Lua functions
=========================================================================================================-->
	<LuaFunction Name="NOBN_trk_getSwitchLabelItem1()" ReturnType="String"
		Description="Returns the Fouling Point and Stock Rail joint reference mileages for a related switch." >
		<Constructor>String NOBN_trk_getSwitchLabelItem1([Boolean mileageIncreasesTowardsLeft])</Constructor>
		<Formula>
function NOBN_trk_getSwitchLabelItem1(mileageIncreasesTowardsLeft)
	if mileageIncreasesTowardsLeft == nil then 
		 mileageIncreasesTowardsLeft = false
	end
	local r,v,mid,ss
	r = Relations["Er etikett for anything"]
	if getCollectionLength(r) == 0 then
		return "UNFINISHED - Relate with 'Er etikett for anything'.",_warning
	else
		v = r[0]
		if v.RcType ~= "KO-SPV Sporveksel" then
			return "Bad related object type ["..v.RcType.."], a switch was expected",_warning
		end
		ss = v.ReferenceMileage
		fp = getFoulingPoints(v)
		if getCollectionLength(fp) == 0 then	
			return "Km. "..RC__toKm(ss).." (fant ikke Mid)",_warning
		else 
			mid = fp[0].Branch1.ReferenceMileage
			if ss &lt; mid then 
				if mileageIncreasesTowardsLeft == true then
					return "Km."..RC__toKm(mid).."/"..RC__toKm(ss)
				else
					return "Km."..RC__toKm(ss).."/"..RC__toKm(mid)
				end
			else
				if mileageIncreasesTowardsLeft == true then
					return "Km."..RC__toKm(ss).."/"..RC__toKm(mid)
				else
					return "Km."..RC__toKm(mid).."/"..RC__toKm(ss)
				end
			end
		end
	end
end
		</Formula>
	</LuaFunction>

	
	
	<LuaFunction Name="NOBN_trk_getSwitchLabelItem2()" ReturnType="String"
		Description="Returns the related switch's name." >
		<Constructor>String NOBN_trk_getSwitchLabelItem2([Boolean mileageIncreasesTowardsLeft])</Constructor>
		<Formula>
function NOBN_trk_getSwitchLabelItem2(mileageIncreasesTowardsLeft)
	if mileageIncreasesTowardsLeft == nil then 
		 mileageIncreasesTowardsLeft = false
	end
	local s,r,n,v,mid,ss
	s = "Er etikett for anything"
	r,n = RC__getCollectionOfRelatedObjects(s)
	if n == 0 then
		return "UNFINISHED - Relate with '"..s.."'."
	else
		v = r[0]
		if v.RcType ~= "KO-SPV Sporveksel" then
			return "Bad related object type ["..v.RcType.."], a switch was expected",_warning
		end
		ss = v.ReferenceMileage
		fp = getFoulingPoints(v)
		if getCollectionLength(fp) == 0 then	
			return "SS "..v.code.." (fant ikke Mid)",_warning
		else
			mid = fp[0].Branch1.ReferenceMileage
			if ss &lt; mid then 
				if mileageIncreasesTowardsLeft == true then
					return "Mid/SS "..v.Code
				else
					return "SS/Mid "..v.Code
				end
			else
				if kmStigerMotVenstre == true then
					return "SS/Mid "..v.Code
				else
					return "Mid/SS "..v.Code
				end
			end
		end
	end
end
		</Formula>
	</LuaFunction>

	

	<LuaFunction Name="NOBN_trk_getSwitchLabelItem3()" ReturnType="String"
		Description="Returns the switch's reference alignment code." >
		<Constructor>String NOBN_trk_getSwitchLabelItem3()</Constructor>
		<Formula>
function NOBN_trk_getSwitchLabelItem3()
	local r,v,mid,ss
	r = Relations["Er etikett for anything"]
	if getCollectionLength(r) == 0 then
		return "UNFINISHED - Relate with 'Er etikett for anything'.",_warning
	else
		v = r[0]
		if v.RcType ~= "KO-SPV Sporveksel" then
			return "Bad related object type ["..v.RcType.."], 'KO-SPV Sporveksel' was expected",_warning
		end
		return "(Ref. "..v.ReferenceAlignment.Code..")"
	end
end
		</Formula>
	</LuaFunction>



<!--========================================================================================================
	FELLES
	ETIKETTER
	FE-DIV Etikett
	Standard etiketter
=========================================================================================================-->
	<ObjectType DataType="RailCOMPLETELabel" Class="RailwayPlacedObject" Name="FE-DIV Etikett"
				Layer="JBTFE_ETIKETTER" Color="ByLayer"
				Group="Felles/Etiketter"
				>

		<RelationSourceSpace>etikett</RelationSourceSpace>
		
		<xpp:expand select="NOBN_com_DISCIPLINE_JBTFE"/>
		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___MILEAGE_INCREASES_TOWARDS_LEFT"/> 

		<Variants DefaultValue="A-1-0-VLB-018">
			<Variant Name="A-1-0-VLB-018" />
			<Variant Name="A-1-0-VLT-018" />
			<Variant Name="A-1-0-VRB-018" />
			<Variant Name="A-1-0-VRT-018" />

			<Variant Name="B-1-0-HLB-018" />
			<Variant Name="B-1-0-HLT-018" />
			<Variant Name="B-1-0-HRB-018" />
			<Variant Name="B-1-0-HRT-018" />

			<Variant Name="C-1-0-HLB-025" />
			<Variant Name="C-1-0-HLT-025" />
			<Variant Name="C-1-0-HRB-025" />
			<Variant Name="C-1-0-HRT-025" />

			<Variant Name="C-1-1-HLB-025-018" />
			<Variant Name="C-1-1-HLT-025-018" />
			<Variant Name="C-1-1-HRB-025-018" />
			<Variant Name="C-1-1-HRT-025-018" />

			<Variant Name="C-1-2-HLB-025-018" />
			<Variant Name="C-1-2-HLT-025-018" />
			<Variant Name="C-1-2-HRB-025-018" />
			<Variant Name="C-1-2-HRT-025-018" />

			<Variant Name="D-1-1-HLB-025-018" />
			<Variant Name="D-1-1-HLT-025-018" />
			<Variant Name="D-1-1-HRB-025-018" />
			<Variant Name="D-1-1-HRT-025-018" />

			<Variant Name="D-1-2-HLB-025-018" />
			<Variant Name="D-1-2-HLT-025-018" />
			<Variant Name="D-1-2-HRB-025-018" />
			<Variant Name="D-1-2-HRT-025-018" />
		</Variants>
		
		<LuaExpression Name="DistanceToAlignment">
            <Formula>RC__snap(getPropertyValue("DistanceToAlignment"),5)</Formula>
        </LuaExpression>

		<LuaExpression Name="RelativeElevation">
            <Formula>0</Formula>
        </LuaExpression>

		<LuaExpression Name="LabelItem1">
            <Formula>RC_com_getLabelItem1()</Formula>
        </LuaExpression>

		<LuaExpression Name="LabelItem2">
			<Formula>RC_com_getLabelItem2()</Formula>
        </LuaExpression>

        <LuaExpression Name="LabelItem3">
            <Formula>RC_com_getLabelItem3()</Formula>
        </LuaExpression>

		<InsertSymbol DisplayName="Etikett A" VariantName="A-1-0-VRB-018" DisplayBlockName="NO-BN-2D-JBTFE-ETIKETT-A-1-0-VRB-018" >
			<Rotation Direction="true" />
			<SetValue Key="MileageIncreasesTowardsLeft" Value="{{alignmentRotation | minus:ucsRotation | cosisnegative}}" />
		</InsertSymbol>

		<InsertSymbol DisplayName="Etikett B" VariantName="B-1-0-HRB-018" DisplayBlockName="NO-BN-2D-JBTFE-ETIKETT-B-1-0-HRB-018" >
			<Rotation Direction="true" />
			<SetValue Key="MileageIncreasesTowardsLeft" Value="{{alignmentRotation | minus:ucsRotation | cosisnegative}}" />
		</InsertSymbol>

		<InsertSymbol DisplayName="Etikett C" VariantName="C-1-0-HRB-025" DisplayBlockName="NO-BN-2D-JBTFE-ETIKETT-C-1-0-HRB-025" >
			<Rotation Direction="true" />
			<SetValue Key="MileageIncreasesTowardsLeft" Value="{{alignmentRotation | minus:ucsRotation | cosisnegative}}" />
		</InsertSymbol>

		<InsertSymbol DisplayName="Etikett D" VariantName="D-1-1-HRB-025-018" DisplayBlockName="NO-BN-2D-JBTFE-ETIKETT-D-1-1-HRB-025-018" >
			<Rotation Direction="true" />
			<SetValue Key="MileageIncreasesTowardsLeft" Value="{{alignmentRotation | minus:ucsRotation | cosisnegative}}" />
		</InsertSymbol>

		<InsertSymbol DisplayName="Etikett D (3-linjer)" VariantName="D-1-2-HRB-025-018" DisplayBlockName="NO-BN-2D-JBTFE-ETIKETT-D-1-2-HRB-025-018"  >
			<Rotation Direction="true" />
			<SetValue Key="MileageIncreasesTowardsLeft" Value="{{alignmentRotation | minus:ucsRotation | cosisnegative}}" />
		</InsertSymbol>

		<SymbolDefinition X="0.0" Y="0.0" DefaultBlockName="NO-BN-2D-JBTFE-ETIKETT-A-1-0-VLB-018" AllowSymbolMove="true">
			<Rotation RotateDirection="true" AddAngle="{% if MileageIncreasesTowardsLeft == 'True'%}180{% else %}0{% endif %}" />
			<BlockNameFormat JoinBy="-">
				NO-BN-2D-JBTFE-ETIKETT
				{% if    Variant == 'A-1-0-VLB-018' %}A-1-0-VLB-018
				{% elsif Variant == 'A-1-0-VLT-018' %}A-1-0-VLT-018
				{% elsif Variant == 'A-1-0-VRB-018' %}A-1-0-VRB-018
				{% elsif Variant == 'A-1-0-VRT-018' %}A-1-0-VRT-018
			
				{% elsif Variant == 'B-1-0-HLB-018' %}B-1-0-HLB-018
				{% elsif Variant == 'B-1-0-HLT-018' %}B-1-0-HLT-018
				{% elsif Variant == 'B-1-0-HRB-018' %}B-1-0-HRB-018
				{% elsif Variant == 'B-1-0-HRT-018' %}B-1-0-HRT-018

				{% elsif Variant == 'C-1-0-HLB-025' %}C-1-0-HLB-025
				{% elsif Variant == 'C-1-0-HLT-025' %}C-1-0-HLT-025
				{% elsif Variant == 'C-1-0-HRB-025' %}C-1-0-HRB-025
				{% elsif Variant == 'C-1-0-HRT-025' %}C-1-0-HRT-025

				{% elsif Variant == 'C-1-1-HLB-025-018' %}C-1-1-HLB-025-018
				{% elsif Variant == 'C-1-1-HLT-025-018' %}C-1-1-HLT-025-018
				{% elsif Variant == 'C-1-1-HRB-025-018' %}C-1-1-HRB-025-018
				{% elsif Variant == 'C-1-1-HRT-025-018' %}C-1-1-HRT-025-018

				{% elsif Variant == 'C-1-2-HLB-025-018' %}C-1-2-HLB-025-018
				{% elsif Variant == 'C-1-2-HLT-025-018' %}C-1-2-HLT-025-018
				{% elsif Variant == 'C-1-2-HRB-025-018' %}C-1-2-HRB-025-018
				{% elsif Variant == 'C-1-2-HRT-025-018' %}C-1-2-HRT-025-018

				{% elsif Variant == 'D-1-1-HLB-025-018' %}D-1-1-HLB-025-018
				{% elsif Variant == 'D-1-1-HLT-025-018' %}D-1-1-HLT-025-018
				{% elsif Variant == 'D-1-1-HRB-025-018' %}D-1-1-HRB-025-018
				{% elsif Variant == 'D-1-1-HRT-025-018' %}D-1-1-HRT-025-018

				{% elsif Variant == 'D-1-2-HLB-025-018' %}D-1-2-HLB-025-018
				{% elsif Variant == 'D-1-2-HLT-025-018' %}D-1-2-HLT-025-018
				{% elsif Variant == 'D-1-2-HRB-025-018' %}D-1-2-HRB-025-018
				{% elsif Variant == 'D-1-2-HRT-025-018' %}D-1-2-HRT-025-018
				{% endif %}
			</BlockNameFormat>

			<!-- Sett inn lagrede verdier i det grafiske symbolet i modelspace: -->
			<SymbolAttribute Tag="T01">
				<Value>{{LabelItem1}}</Value>
			</SymbolAttribute>
			<SymbolAttribute Tag="T02">
				<Value>{{LabelItem2}}</Value>
			</SymbolAttribute>
			<SymbolAttribute Tag="T03">
				<Value>{{LabelItem3}}</Value>
			</SymbolAttribute>
		</SymbolDefinition>

		<SymbolDefinition X="0.0" Y="0.0" DefaultBlockName="NO-BN-2D-INSERTION-POINT">
			<Rotation RotateDirection="true" />
		</SymbolDefinition>
		
	</ObjectType>

	
	
<!--========================================================================================================
	OVERBYGNING
	ETIKETTER
	FE-DIV Etikett for sporveksel
=========================================================================================================-->
	<ObjectType DataType="RailCOMPLETELabel" Class="RailwayPlacedObject" Name="FE-DIV Etikett for sporveksel"
				Layer="JBTFE_ETIKETTER" Color="ByLayer"
				Group="Overbygning/Etiketter"
				>

		<RelationSourceSpace>etikett</RelationSourceSpace>
		
		<xpp:expand select="NOBN_com_DISCIPLINE_JBTOB"/>
		<xpp:expand select="NOBN_com_STD_CUSTOMATTRIBUTES___MILEAGE_INCREASES_TOWARDS_LEFT"/> 
		
		<Variants DefaultValue="D-1-2-HRB-025-018-SPV">
			<Variant Name="D-1-2-HLB-025-018-SPV" />
			<Variant Name="D-1-2-HRB-025-018-SPV" />
		</Variants>

		<LuaExpression Name="RelativeElevation">
            <Formula>0</Formula>
        </LuaExpression>

		<LuaExpression Name="DistanceToAlignment">
            <Formula>RC__snap(getPropertyValue("DistanceToAlignment"),5)</Formula>
        </LuaExpression>

		<LuaExpression Name="ReferenceMileage">
            <Formula>Relations["Er etikett for anything"][0].ReferenceMileage</Formula>
        </LuaExpression>

		<LuaExpression Name="LabelItem1">
            <Formula>NOBN_trk_getSwitchLabelItem1(MileageIncreasesTowardsLeft)</Formula>
        </LuaExpression>

		<LuaExpression Name="LabelItem2">
			<Formula>NOBN_trk_getSwitchLabelItem2(MileageIncreasesTowardsLeft)</Formula>
        </LuaExpression>

        <LuaExpression Name="LabelItem3">
            <Formula>NOBN_trk_getSwitchLabelItem3()</Formula>
        </LuaExpression>
							   
		<InsertSymbol DisplayName="Sporveksel SS/Mid (km-retn mot høyre)" VariantName="D-1-2-HRB-025-018-SPV" DisplayBlockName="NO-BN-2D-JBTFE-ETIKETT-D-1-2-HRB-025-018" >
			<Rotation Direction="true" />
			<SetValue Key="MileageIncreasesTowardsLeft" Value="{{alignmentRotation | minus:ucsRotation | cosisnegative}}" />
		</InsertSymbol>

		<InsertSymbol DisplayName="Sporveksel SS/Mid (km-retn mot venstre)" VariantName="D-1-2-HLB-025-018-SPV" DisplayBlockName="NO-BN-2D-JBTFE-ETIKETT-D-1-2-HLB-025-018" >
			<Rotation Direction="true" />
			<SetValue Key="MileageIncreasesTowardsLeft" Value="{{alignmentRotation | minus:ucsRotation | cosisnegative}}" />
		</InsertSymbol>

		<SymbolDefinition X="0.0" Y="0.0" DefaultBlockName="NO-BN-2D-JBTFE-ETIKETT-D-1-2-HRB-025-018" AllowSymbolMove="true">
			<Rotation RotateDirection="true" AddAngle="{% if MileageIncreasesTowardsLeft == 'True'%}180{% else %}0{% endif %}" />
			<BlockNameFormat JoinBy="-">
				NO-BN-2D-JBTFE-ETIKETT
				{% if Variant == 'D-1-2-HLB-025-018-SPV' %}D-1-2-HLB-025-018
				{% elsif Variant == 'D-1-2-HRB-025-018-SPV' %}D-1-2-HRB-025-018
				{% endif %}
			</BlockNameFormat>

			<SymbolAttribute Tag="T01">
				<Value>{{LabelItem1}}</Value>
			</SymbolAttribute>
			<SymbolAttribute Tag="T02">
				<Value>{{LabelItem2}}</Value>
			</SymbolAttribute>
			<SymbolAttribute Tag="T03">
				<Value>{{LabelItem3}}</Value>
			</SymbolAttribute>
		</SymbolDefinition>

		<SymbolDefinition X="0.0" Y="0.0" DefaultBlockName="NO-BN-2D-INSERTION-POINT">
			<Rotation RotateDirection="true" />
		</SymbolDefinition>

	</ObjectType>



<!--========================================================================================================
    End of file 
=========================================================================================================-->
</xpp:bloc>
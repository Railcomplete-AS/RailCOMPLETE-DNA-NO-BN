<!DOCTYPE html>
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RailCOMPLETE User Guide</title>

    
        <link rel="stylesheet" href="./index_files/bootstrap.css">
        <link rel="stylesheet" href="./index_files/site.css">
		<link rel="icon" type="image/png" href="./images/rc.ico">
    
</head>
<body>
    <nav class="navbar navbar-inverse navbar-fixed-top">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="index.html">Home</a>
            </div>
            <div class="navbar-collapse collapse">
                <ul class="nav navbar-nav">
                    <li><a href="welcome.html">Welcome</a></li>
                    <li><a href="getting_started.html">Getting Started</a></li>
                    <li><a href="main_features.html">Main Features</a></li>
                    <li><a href="commands.html">Commands</a></li>
                    <li><a href="export_3d.html">Export 3D</a></li>
					<li><a href="lua.html"><font color="#F4772D" size="+1">Lua</font></a></li>
                </ul>
            </div>
        </div>
    </nav>
    <div class="container body-content">
        
<div class="row">
              
                <h1 id="lua">Lua</h1>
<p>Lua is a scripting language made by PetroBras, Brazil. In RailCOMPLETE, Lua is used primarily as scripting language in formulas for RailwayObject properties. 
It is also used in the table tool for defining object filters and for specifying cell value content.</p>
<h2 id="lua-introduction">Lua Introduction</h2>
<p>Lua is based on standard C. Composite
objects are stored as hash tables (see <a href="https://www.railcomplete.com/docs/user-guide/lua/index.html#luatable">LuaTable</a>), ie, as key / value pairs. Tables can be accessed as an indexed
table (array, multi-dimensional) or as a list. You can do index operations and amount operations
on a table. Ternéperperator <em>A ? B : C</em> is approximated in LUA as <em>A and B or C</em>, which works as long as A
do not evaluate to false or null.</p>
<pre><code class="lua hljs">a = <span class="hljs-number">5</span>
b = <span class="hljs-number">4</span>

<span class="hljs-keyword">return</span> a + b == <span class="hljs-number">9</span> <span class="hljs-keyword">and</span> <span class="hljs-string">"It's true"</span> <span class="hljs-keyword">or</span> <span class="hljs-string">"No way"</span>

<span class="hljs-comment">-- Output: It's true</span>

</code></pre>

<p>Logical values ​​are false, true. All numbers are true. Empty list {}
is nil. a = null resets a to undefined. Garbage collection is always active. </p>
<p>Streaking starts commenting on the line. Matching pairs with single, double, triple etc square brackets and double
The line delimits a long comment (multiple lines):</p>
<pre><code class="lua hljs"> <span class="hljs-comment">-- This is a short comment</span>

<span class="hljs-comment">--[[ 
This is a long comment
and over multiple lines
--]]</span>

</code></pre>

<h2 id="useful-links">Useful links</h2>
<p><a href="https://www.formsbank.com/download/300662/the-lua-language-v5-1-cheat-sheet.html">Download Lua Cheat Sheet</a></p>
<p><a href="https://www.lua.org/manual/5.1/manual.html">Lua 5.1 Reference Manual</a></p>
<h2 id="expressions-tutorial">Expressions Tutorial</h2>
<p>Expressions are evaluated in order to perform calculations which may assign values to variables or pass arguments 
 to functions. Expressions are covered pretty well in section 2.5 of the Reference Manual.[1] Expressions are covered 
 here for completeness and to offer more examples. We'll use the = expression shorthand notation for this page. The 
 values can easily be assigned to a variable, e.g., </p>
<pre><code class="lua hljs">x = <span class="hljs-number">7</span>
<span class="hljs-keyword">return</span> x

<span class="hljs-comment">-- Output: 7</span>
</code></pre>

<p><strong>Arithmetic expressions</strong></p>
<p>Lua has the usual binary arithmetic operators. </p>
<pre><code class="lua hljs"><span class="hljs-number">2</span>+<span class="hljs-number">3</span>, <span class="hljs-number">5</span>-<span class="hljs-number">12</span>, <span class="hljs-number">2</span>*<span class="hljs-number">7</span>, <span class="hljs-number">7</span>/<span class="hljs-number">8</span>

<span class="hljs-comment">-- Output: Collection(4) {5, -7, 14, 0.875}</span>
</code></pre>

<pre><code class="lua hljs"><span class="hljs-number">5</span>*(<span class="hljs-number">2</span>-<span class="hljs-number">8.3</span>)/<span class="hljs-number">77.7</span>+<span class="hljs-number">99.1</span>

<span class="hljs-comment">-- Output: 98.6945945945946</span>

</code></pre>

<p><em>Unary negation:</em></p>
<pre><code class="lua hljs">-(-<span class="hljs-number">10</span>), -(<span class="hljs-number">10</span>)

<span class="hljs-comment">-- Output: Collection(2) {10, -10}</span>
</code></pre>

<p><em>Modulo (division remainder):</em> </p>
<pre><code class="lua hljs"><span class="hljs-number">15</span>%<span class="hljs-number">7</span>, -<span class="hljs-number">4</span>%<span class="hljs-number">3</span>, <span class="hljs-number">5.5</span>%<span class="hljs-number">1</span>

<span class="hljs-comment">-- Output: Collection(3) {1, 2, 0.5}</span>
</code></pre>

<p><em>Power of:</em> </p>
<pre><code class="lua hljs"><span class="hljs-number">7</span>^<span class="hljs-number">2</span>, <span class="hljs-number">107</span>^<span class="hljs-number">0</span>, <span class="hljs-number">2</span>^<span class="hljs-number">8</span>

<span class="hljs-comment">-- Output: Collection(3) {49, 1, 256}</span>

</code></pre>

<p><strong>Relational expressions</strong></p>
<p>Relational operators are supplied which return the boolean values true or false.    </p>
<ul>
<li>== equal to   </li>
<li>~= not equal to    </li>
<li>&lt; less than    </li>
<li>&gt; greater than    </li>
<li>&lt;= less than or equal to   </li>
<li>&gt;= greater than or equal to    </li>
</ul>
<p>Examples: </p>
<pre><code class="lua hljs"><span class="hljs-number">1</span> == <span class="hljs-number">1</span>, <span class="hljs-number">1</span> == <span class="hljs-number">0</span>

<span class="hljs-comment">-- Output: Collection(2) {True, False}</span>

<span class="hljs-number">1</span> ~= <span class="hljs-number">1</span>, <span class="hljs-number">1</span> ~= <span class="hljs-number">0</span>

<span class="hljs-comment">-- Output: Collection(2) {False, True}</span>


<span class="hljs-number">3</span> &lt; <span class="hljs-number">7</span>, <span class="hljs-number">7</span> &lt; <span class="hljs-number">7</span>, <span class="hljs-number">8</span> &lt; <span class="hljs-number">7</span>

<span class="hljs-comment">-- Output: Collection(3) {True, False, False}</span>


<span class="hljs-number">3</span> &gt;= <span class="hljs-number">7</span>, <span class="hljs-number">7</span> &gt;= <span class="hljs-number">7</span>, <span class="hljs-number">8</span> &gt;= <span class="hljs-number">7</span>

<span class="hljs-comment">-- Output: Collection(3) {False, True, True}</span>
</code></pre>

<p>These also work on strings and other types.</p>
<pre><code class="lua hljs"><span class="hljs-string">"abc"</span> &lt; <span class="hljs-string">"def"</span>

<span class="hljs-comment">-- Output: True</span>

<span class="hljs-string">"abc"</span> &gt; <span class="hljs-string">"def"</span>

<span class="hljs-comment">-- Output: False</span>

<span class="hljs-string">"abc"</span> == <span class="hljs-string">"abc"</span>

<span class="hljs-comment">-- Output: True</span>

<span class="hljs-string">"abc"</span> == <span class="hljs-string">"a"</span>..<span class="hljs-string">"bc"</span>

<span class="hljs-comment">-- Output: True</span>
</code></pre>

<p>Objects will not be equal if the types are different or refer to different objects.</p>
<pre><code class="lua hljs">{} == <span class="hljs-string">"table"</span>

<span class="hljs-comment">-- Output: False</span>


<span class="hljs-comment">-- two different tables are created here</span>
{} == {}  

<span class="hljs-comment">-- Output: False</span>

t = {}
t2 = t

<span class="hljs-comment">-- we're referencing the same table here</span>
<span class="hljs-keyword">return</span> t == t2   

<span class="hljs-comment">-- Output: True</span>
</code></pre>

<p>Coercion does not work here, the types must be converted explicitly.</p>
<pre><code class="lua hljs"><span class="hljs-string">"10"</span> == <span class="hljs-number">10</span>

<span class="hljs-comment">-- Output: False</span>

<span class="hljs-built_in">tonumber</span>(<span class="hljs-string">"10"</span>) == <span class="hljs-number">10</span>

<span class="hljs-comment">-- Output: True</span>
</code></pre>

<p><strong>Logical operators</strong></p>
<p>Lua provides the logical operators and, or and not. In Lua both nil and the boolean value false represent false in a logical expression. 
Anything that is not false (either nil or false) is true. There are more notes on the implications of this at the end of this page. </p>
<pre><code class="lua hljs"><span class="hljs-keyword">false</span>==<span class="hljs-keyword">nil</span>   <span class="hljs-comment">-- although they represent the same thing they are not equivalent</span>

<span class="hljs-comment">-- Output: False</span>

<span class="hljs-keyword">true</span>==<span class="hljs-keyword">false</span>, <span class="hljs-keyword">true</span>~=<span class="hljs-keyword">false</span>

<span class="hljs-comment">-- Output: Collection(2) {False, True}</span>

does_this_exist  <span class="hljs-comment">-- test to see if variable "does_this_exist" exists. no, false.</span>

<span class="hljs-comment">-- Output: null</span>
</code></pre>

<p><em>not</em></p>
<p>The keyword not inverts a logical expression value: </p>
<pre><code class="lua hljs"><span class="hljs-keyword">true</span>, <span class="hljs-keyword">false</span>, <span class="hljs-keyword">not</span> <span class="hljs-keyword">true</span>, <span class="hljs-keyword">not</span> <span class="hljs-keyword">false</span>

<span class="hljs-comment">-- Output: Collection(4) {True, False, False, True}</span>

<span class="hljs-keyword">not</span> <span class="hljs-keyword">nil</span>       <span class="hljs-comment">-- nil represents false</span>

<span class="hljs-comment">-- Output: True</span>

<span class="hljs-keyword">not</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">true</span>  <span class="hljs-comment">-- true is not not true!</span>

<span class="hljs-comment">-- Output: True</span>

<span class="hljs-keyword">not</span> <span class="hljs-string">"foo"</span>     <span class="hljs-comment">-- anything not false or nil is true</span>

<span class="hljs-comment">-- Output: False</span>
</code></pre>

<p><em>and</em></p>
<p>The binary operator and does not necessarily return a boolean value true or false to the logical expression x and y. In some languages the and operator returns a boolean dependent on the two inputs. Rather in Lua, it returns the first argument if its value is false or nil, and the second argument if the first argument is not false or nil. So, a boolean is only returned if the first argument is false or the second argument is a boolean. </p>
<pre><code class="lua hljs"><span class="hljs-keyword">false</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">true</span>  <span class="hljs-comment">-- false is returned because it is the first argument</span>

<span class="hljs-comment">-- Output: False</span>

<span class="hljs-keyword">nil</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">true</span>    <span class="hljs-comment">-- as above</span>

<span class="hljs-comment">-- Output: null</span>

<span class="hljs-keyword">nil</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">false</span>

<span class="hljs-comment">-- Output: null</span>

<span class="hljs-keyword">nil</span> <span class="hljs-keyword">and</span> <span class="hljs-string">"hello"</span>, <span class="hljs-keyword">false</span> <span class="hljs-keyword">and</span> <span class="hljs-string">"hello"</span>
<span class="hljs-comment">-- null is removed from collection that is returned</span>

<span class="hljs-comment">-- Output: False</span>
</code></pre>

<p>All of the above expressions return the first argument. All of the following expressions return the second argument, as the first is true.</p>
<pre><code class="lua hljs"><span class="hljs-keyword">true</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">false</span>

<span class="hljs-comment">-- Output: False</span>

<span class="hljs-keyword">true</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">true</span>

<span class="hljs-comment">-- Output: True</span>

<span class="hljs-number">1</span> <span class="hljs-keyword">and</span> <span class="hljs-string">"hello"</span>, <span class="hljs-string">"hello"</span> <span class="hljs-keyword">and</span> <span class="hljs-string">"there"</span>

<span class="hljs-comment">-- Output: Collection(2) {hello, there}</span>

<span class="hljs-keyword">true</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">nil</span>

<span class="hljs-comment">-- Output: null</span>
</code></pre>

<p>As you can see the logical expressions are still evaluated correctly but we have some interesting behaviour because of the values returned. </p>
<p><em>or</em></p>
<p>The or binary operator also does not necessarily return a boolean value (see notes for and above). If the first argument is not false or nil it is returned, otherwise the second argument is returned. So, a boolean is only returned if the first argument is true or the second argument is a boolean. </p>
<pre><code class="lua hljs"><span class="hljs-keyword">true</span> <span class="hljs-keyword">or</span> <span class="hljs-keyword">false</span>

<span class="hljs-comment">-- Output: True</span>

<span class="hljs-keyword">true</span> <span class="hljs-keyword">or</span> <span class="hljs-keyword">nil</span>

<span class="hljs-comment">-- Output: True</span>

<span class="hljs-string">"hello"</span> <span class="hljs-keyword">or</span> <span class="hljs-string">"there"</span>, <span class="hljs-number">1</span> <span class="hljs-keyword">or</span> <span class="hljs-number">0</span>

<span class="hljs-comment">-- Output: Collection(2) {hello, 1}</span>
</code></pre>

<p>All of the above expressions return the first argument. All of the following expressions return the second argument, as the first is false or nil. </p>
<pre><code class="lua hljs"><span class="hljs-keyword">false</span> <span class="hljs-keyword">or</span> <span class="hljs-keyword">true</span>

<span class="hljs-comment">-- Output: True</span>

<span class="hljs-keyword">nil</span> <span class="hljs-keyword">or</span> <span class="hljs-keyword">true</span>

<span class="hljs-comment">-- Output: True</span>

<span class="hljs-keyword">nil</span> <span class="hljs-keyword">or</span> <span class="hljs-string">"hello"</span>

<span class="hljs-comment">-- Output: hello</span>
</code></pre>

<p>This can be a very useful property. For example, setting default values in a function: </p>
<pre><code class="lua hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">foo</span><span class="hljs-params">(x)</span></span>
  <span class="hljs-keyword">local</span> value = x <span class="hljs-keyword">or</span> <span class="hljs-string">"default"</span>  <span class="hljs-comment">-- if argument x is false or nil, value becomes "default"</span>
  <span class="hljs-keyword">return</span> value, x
<span class="hljs-keyword">end</span>

<span class="hljs-keyword">return</span> foo()
<span class="hljs-comment">-- Output: default</span>

<span class="hljs-keyword">return</span> foo(<span class="hljs-number">1</span>)
<span class="hljs-comment">-- Output: Collection(2) {1, 1}</span>

<span class="hljs-keyword">return</span> foo(<span class="hljs-keyword">true</span>)
<span class="hljs-comment">-- Output: Collection(2) {True, True}</span>

<span class="hljs-keyword">return</span> foo(<span class="hljs-string">"hello"</span>)
<span class="hljs-comment">-- Output: Collection(2) {hello, hello}</span>
</code></pre>

<p><strong>Ternary operators</strong></p>
<p>Ternary operators [2] are a useful feature in C. e.g. </p>
<pre><code class="c hljs cpp"><span class="hljs-keyword">int</span> value = x &gt; <span class="hljs-number">3</span> ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>;
</code></pre>

<p>This behaviour can be partially emulated in Lua using the logical operators and and or. The C form: 
value = test ? x : y;
roughly translates to the following Lua: value = test and x or y</p>
<p>E.g. </p>
<pre><code class="lua hljs"><span class="hljs-number">3</span>&gt;<span class="hljs-number">1</span> <span class="hljs-keyword">and</span> <span class="hljs-number">1</span> <span class="hljs-keyword">or</span> <span class="hljs-number">0</span>
<span class="hljs-comment">-- Output: 1</span>

<span class="hljs-number">3</span>&lt;<span class="hljs-number">1</span> <span class="hljs-keyword">and</span> <span class="hljs-number">1</span> <span class="hljs-keyword">or</span> <span class="hljs-number">0</span>
<span class="hljs-comment">-- Output: 0</span>

<span class="hljs-number">3</span>&lt;<span class="hljs-number">1</span> <span class="hljs-keyword">and</span> <span class="hljs-string">"True"</span> <span class="hljs-keyword">or</span> <span class="hljs-string">"False"</span> <span class="hljs-comment">-- In RailCOMPLETE "False" is returned as false.</span>
<span class="hljs-comment">-- Output: False</span>

<span class="hljs-number">3</span>&gt;<span class="hljs-number">1</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">true</span> <span class="hljs-keyword">or</span> <span class="hljs-string">"false"</span>
<span class="hljs-comment">-- Output: True</span>
</code></pre>

<p>This can be used for short hand to fill a hash: </p>
<pre><code class="lua hljs">t = {}
t[<span class="hljs-number">1</span>] = <span class="hljs-number">12</span>
t[<span class="hljs-number">2</span>] = <span class="hljs-number">13</span>
<span class="hljs-keyword">for</span> i=<span class="hljs-number">1</span>, <span class="hljs-number">3</span> <span class="hljs-keyword">do</span>
    t[i] = (t[i] <span class="hljs-keyword">or</span> <span class="hljs-number">0</span>) + <span class="hljs-number">1</span>
<span class="hljs-keyword">end</span>

text =<span class="hljs-string">""</span>
<span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> <span class="hljs-built_in">pairs</span>(t) <span class="hljs-keyword">do</span>
    text = text..k..<span class="hljs-string">"   "</span>..v..<span class="hljs-string">"\n"</span>
<span class="hljs-keyword">end</span>

<span class="hljs-keyword">return</span> text

<span class="hljs-comment">--[[ 
Output:  
1   13
2   14
3   1
--]]</span>

</code></pre>

<p>However, there is a caveat: This only works when the first return value is not nil or false. </p>
<pre><code class="lua hljs"><span class="hljs-number">3</span>&gt;<span class="hljs-number">1</span> <span class="hljs-keyword">and</span> <span class="hljs-number">1</span> <span class="hljs-keyword">or</span> <span class="hljs-string">"False"</span>         <span class="hljs-comment">-- works</span>

<span class="hljs-comment">-- Output: 1</span>

<span class="hljs-number">3</span>&gt;<span class="hljs-number">1</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">false</span> <span class="hljs-keyword">or</span> <span class="hljs-string">"oops"</span>      <span class="hljs-comment">-- failed, should return false</span>

<span class="hljs-comment">-- Output: oops</span>

<span class="hljs-number">3</span>&gt;<span class="hljs-number">1</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">nil</span> <span class="hljs-keyword">or</span> <span class="hljs-string">"oops"</span>        <span class="hljs-comment">-- failed, should return nil</span>

<span class="hljs-comment">-- Output: oops</span>
</code></pre>

<p>Note on test expressions and nil</p>
<p>An important point to note is that the value 0 is not a false test condition in Lua. In some languages, for example C, a test of: </p>
<pre><code class="c hljs cpp"><span class="hljs-keyword">if</span> (<span class="hljs-number">0</span>)
  <span class="hljs-built_in">printf</span>(<span class="hljs-string">"true"</span>);
<span class="hljs-keyword">else</span>
  <span class="hljs-built_in">printf</span>(<span class="hljs-string">"false"</span>);
</code></pre>

<p>would display "false". In Lua, </p>
<pre><code class="lua hljs"><span class="hljs-keyword">if</span> <span class="hljs-number">0</span> <span class="hljs-keyword">then</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">"true"</span>
<span class="hljs-keyword">else</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">"false"</span>
<span class="hljs-keyword">end</span>

<span class="hljs-comment">-- Output: true</span>
</code></pre>

<p>prints "true"! You should use false, or nil in place of 0: </p>
<pre><code class="lua hljs"><span class="hljs-keyword">if</span> <span class="hljs-keyword">false</span> <span class="hljs-keyword">then</span> <span class="hljs-keyword">return</span>(<span class="hljs-string">"true"</span>) <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span>(<span class="hljs-string">"false"</span>) <span class="hljs-keyword">end</span>

<span class="hljs-comment">-- Output: false</span>

<span class="hljs-keyword">if</span> <span class="hljs-keyword">nil</span> <span class="hljs-keyword">then</span> <span class="hljs-keyword">return</span>(<span class="hljs-string">"true"</span>) <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span>(<span class="hljs-string">"false"</span>) <span class="hljs-keyword">end</span>

<span class="hljs-comment">-- Output: false</span>
</code></pre>

<h2 id="control-structure-tutorial">Control Structure Tutorial</h2>
<p><strong><em>if</em> statement</strong></p>
<p>The if statement lets you run different code based on a condition:</p>
<pre><code class="lua hljs"><span class="hljs-keyword">if</span> condition <span class="hljs-keyword">then</span>
  block
<span class="hljs-keyword">elseif</span> condition2 <span class="hljs-keyword">then</span>
  block
<span class="hljs-keyword">elseif</span> condition3 <span class="hljs-keyword">then</span>
  block
<span class="hljs-keyword">else</span>
  block
<span class="hljs-keyword">end</span>
</code></pre>

<p>The <em>if</em> and <em>elseif</em> parts are checked in order, and once one of the conditions is true, it runs the block under it and skips to the end, ignoring any other <em>elseif</em> conditions after it. The <em>else</em> block is run if none of the conditions match. Finally, the elseif and <em>else</em> parts are optional.</p>
<pre><code class="lua hljs">n = <span class="hljs-number">5</span>
<span class="hljs-keyword">if</span> n &gt; <span class="hljs-number">5</span> <span class="hljs-keyword">then</span> <span class="hljs-keyword">return</span>(<span class="hljs-string">"greater than 5"</span>) <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span>(<span class="hljs-string">"less than 5"</span>) <span class="hljs-keyword">end</span>

<span class="hljs-comment">-- Output: less than 5</span>

n = <span class="hljs-number">7</span>
<span class="hljs-keyword">if</span> n &gt; <span class="hljs-number">5</span> <span class="hljs-keyword">then</span> <span class="hljs-keyword">return</span>(<span class="hljs-string">"greater than 5"</span>) <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span>(<span class="hljs-string">"less than 5"</span>) <span class="hljs-keyword">end</span>

<span class="hljs-comment">-- Output: greater than 5</span>
</code></pre>

<p>A more complex example:</p>
<pre><code class="lua hljs">n = <span class="hljs-number">12</span>
<span class="hljs-keyword">if</span> n &gt; <span class="hljs-number">15</span> <span class="hljs-keyword">then</span>
    <span class="hljs-keyword">return</span>(<span class="hljs-string">"the number is &gt; 15"</span>)
<span class="hljs-keyword">elseif</span> n &gt; <span class="hljs-number">10</span> <span class="hljs-keyword">then</span>
    <span class="hljs-keyword">return</span>(<span class="hljs-string">"the number is &gt; 10"</span>)
<span class="hljs-keyword">elseif</span> n &gt; <span class="hljs-number">5</span> <span class="hljs-keyword">then</span>
    <span class="hljs-keyword">return</span>(<span class="hljs-string">"the number is &gt; 5"</span>)
<span class="hljs-keyword">else</span>
    <span class="hljs-keyword">return</span>(<span class="hljs-string">"the number is &lt;= 5"</span>)
<span class="hljs-keyword">end</span>

<span class="hljs-comment">-- Output: the number is &gt; 10</span>

</code></pre>

<p>Notice how just one of the messages is returned, even though more than one of the conditions are true: This is because once one matches, the if statement skips checking the other conditions.</p>
<p><strong>Loops</strong></p>
<p><em>While loop</em></p>
<pre><code class="lua hljs"><span class="hljs-keyword">while</span> condition <span class="hljs-keyword">do</span>
  block
<span class="hljs-keyword">end</span>
</code></pre>

<p>This runs the block over and over in a loop, but on each iteration, it first checks the condition, and if it's false, skips to the end, breaking the loop. If the condition is always false, the block will never be run.</p>
<pre><code class="lua hljs">text = <span class="hljs-string">""</span>
i = <span class="hljs-number">1</span>
<span class="hljs-keyword">while</span> i &lt;= <span class="hljs-number">10</span> <span class="hljs-keyword">do</span>
    text = text..i..<span class="hljs-string">" "</span>
    i = i + <span class="hljs-number">1</span>
<span class="hljs-keyword">end</span>

<span class="hljs-keyword">return</span> text

<span class="hljs-comment">-- Output: 1 2 3 4 5 6 7 8 9 10 </span>
</code></pre>

<p><em>Repeat loop</em></p>
<pre><code class="lua hljs"><span class="hljs-keyword">repeat</span>
  block
<span class="hljs-keyword">until</span> condition
</code></pre>

<p>Same as the while loop, except the condition is inverted (breaks the loop when true), and it's checked after the first iteration, so the code is guaranteed to run at least once.</p>
<pre><code class="lua hljs">text = <span class="hljs-string">""</span>
i = <span class="hljs-number">5</span>
<span class="hljs-keyword">repeat</span>
    text = text..i..<span class="hljs-string">" "</span>
    i = i - <span class="hljs-number">1</span>
<span class="hljs-keyword">until</span> i == <span class="hljs-number">0</span>

<span class="hljs-keyword">return</span> text

<span class="hljs-comment">-- Output: 5 4 3 2 1 </span>
</code></pre>

<p><em>Numeric for loop</em></p>
<pre><code class="lua hljs"><span class="hljs-keyword">for</span> variable = start, stop, step <span class="hljs-keyword">do</span>
  block
<span class="hljs-keyword">end</span>
</code></pre>

<p>Runs the block with variable first being equal to start, then keeps incrementing it step amount and running the block again until it's greater than stop. step can be omitted and will default to 1. <br>
You can also make the step negative, and the loop will stop once the counter variable is less than the stop value.</p>
<pre><code class="lua hljs">text = <span class="hljs-string">""</span>
<span class="hljs-keyword">for</span> i = <span class="hljs-number">1</span>, <span class="hljs-number">5</span> <span class="hljs-keyword">do</span>
    text = text..i..<span class="hljs-string">" "</span>
<span class="hljs-keyword">end</span>

<span class="hljs-keyword">return</span> text

<span class="hljs-comment">-- Output: 1 2 3 4 5</span>

text = <span class="hljs-string">""</span>
<span class="hljs-keyword">for</span> i = <span class="hljs-number">1</span>, <span class="hljs-number">100</span>, <span class="hljs-number">8</span> <span class="hljs-keyword">do</span>
    text = text..i..<span class="hljs-string">" "</span>
<span class="hljs-keyword">end</span>

<span class="hljs-keyword">return</span> text

<span class="hljs-comment">-- Output: 1 9 17 25 33 41 49 57 65 73 81 89 97 </span>

text = <span class="hljs-string">""</span>
<span class="hljs-keyword">for</span> i = <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0.25</span> <span class="hljs-keyword">do</span>
    text = text..i..<span class="hljs-string">" "</span>
<span class="hljs-keyword">end</span>

<span class="hljs-keyword">return</span> text

<span class="hljs-comment">-- Output: 0 0.25 0.5 0.75 1</span>

text = <span class="hljs-string">""</span>
<span class="hljs-keyword">for</span> i = <span class="hljs-number">1</span>, <span class="hljs-number">3</span> <span class="hljs-keyword">do</span>
    <span class="hljs-keyword">for</span> j = <span class="hljs-number">1</span>, i <span class="hljs-keyword">do</span>
        text = text..j..<span class="hljs-string">" "</span>
    <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>

<span class="hljs-keyword">return</span> text

<span class="hljs-comment">-- Output: 1 1 2 1 2 3 </span>
</code></pre>

<h2 id="kinds-of-formulas">Kinds of formulas</h2>
<p>Short Lua programs called <strong>formulas</strong> are used throughout RailCOMPLETE in various contexts. This section describes the various context and what RailCOMPLETE assumes about the formulas.</p>
<h2 id="general">General</h2>
<p>Formulas are typically evaluated in the context of a specific object, which means that the object's properties are available though variable names in the script. For example, the following formula applied to a railway object would evaluate to the concatenation of the object's name and code:</p>
<pre><code class="lua hljs">name .. code
</code></pre>

<p>And the following formula would evaluate to true or false depending on the distance between the alignment and the object in question:</p>
<pre><code class="lua hljs"><span class="hljs-built_in">math</span>.abs(DistanceToAlignment) &gt; <span class="hljs-number">4.0</span>
</code></pre>

<h2 id="filter-formula">Filter formula</h2>
<p>Filters are formulas which are evaluated on each object in a a set of objects to filter the set.  For example, to select a set of objects to include in a table, a filter formula should return the <em>true</em> value when evaluated in the context of objects which are to be included in the set. </p>
<p>The following formula includes main signals with the <em>home</em> function in the set:</p>
<pre><code class="lua hljs">RCType == <span class="hljs-string">"Signal"</span> <span class="hljs-keyword">and</span> <span class="hljs-built_in">type</span> == <span class="hljs-string">"main"</span> <span class="hljs-keyword">and</span> <span class="hljs-function"><span class="hljs-keyword">function</span> == "<span class="hljs-title">home</span>"
</span></code></pre>

<h2 id="map-formula">Map formula</h2>
<p>Maps are formulas which are evaulated on an object to return a representative value for the object. For example, to present a column in a table, a map formula corresponding to the column is evaluated for each object in the table, and the value which the formula evaluated to is inserted in the table cell. Note that if the formula fails to produce a value, a default value is used instead. For tables, the default value is blank. For route export, the default value is a question mark.</p>
<p>The following formula presents the strings <em>near</em> or <em>far</em> depending on an objects distance from its alignment.</p>
<pre><code class="lua hljs"><span class="hljs-keyword">if</span> <span class="hljs-built_in">math</span>.abs(DistanceToAlignment) &gt; <span class="hljs-number">6.0</span> <span class="hljs-keyword">then</span>
  <span class="hljs-keyword">return</span> <span class="hljs-string">"far"</span>
<span class="hljs-keyword">else</span>
  <span class="hljs-keyword">return</span> <span class="hljs-string">"near"</span>
<span class="hljs-keyword">end</span>
</code></pre>

<h2 id="filter-map">Filter-map</h2>
<p>Filter-map formulas perform the function of the filter and the map at the same time. If the formula evaluates to a value, then the object is included in the set and the mapped value is used as representative value for the object. If the formula does not evaluate to a value, then the object is not included in the set. Formulas can produce no value by not executing a <em>return</em> statement, by executing a <em>return</em> statement with no argument, or by executing a return statement using the <code>nil</code> value argument.</p>
<p>The following formula presents all main signals by name:</p>
<pre><code class="lua hljs"><span class="hljs-keyword">if</span> RCType == <span class="hljs-string">"Signal"</span> <span class="hljs-keyword">and</span> <span class="hljs-built_in">type</span> == <span class="hljs-string">"main"</span> <span class="hljs-keyword">then</span>
  <span class="hljs-keyword">return</span> name
<span class="hljs-keyword">end</span>
</code></pre>

<p>The following formula is equivalent:</p>
<pre><code class="lua hljs"><span class="hljs-keyword">if</span> RCType == <span class="hljs-string">"Signal"</span> <span class="hljs-keyword">and</span> <span class="hljs-built_in">type</span> == <span class="hljs-string">"main"</span> <span class="hljs-keyword">then</span>
  <span class="hljs-keyword">return</span> name
<span class="hljs-keyword">else</span>
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">nil</span>
<span class="hljs-keyword">end</span>
</code></pre>

<h2 id="railcomplete-lua-functions">RailCOMPLETE Lua Functions</h2>
<p>In this section, all available RailCOMPLETE lua functions with description are listed.</p>
<div id="distance"></div>
<br><hr>
<h2>distance()</h2>
<p><strong>Calculates distance between two objects.</strong> <br>
Returns the distance if a train can navigate between the two objects object A and object B</p>
<h3 id="syntax">Syntax</h3>
<pre><code class="hljs stylus">Double <span class="hljs-function"><span class="hljs-title">distance</span><span class="hljs-params">(:RailwayObject objectA, RailwayObject objectB)</span></span>
</code></pre>

<h3 id="parameters">Parameters</h3>
<p>objectA <em>(optional)</em>  </p>
<blockquote>
<blockquote>
<p><em>Type:</em> <a href="https://www.railcomplete.com/docs/user-guide/lua/index.html#railwayobject"><strong>RailwayObject</strong></a><br>
<em>Default value:</em> source object</p>
<blockquote>
<p><em>The object to find the distance from</em></p>
</blockquote>
</blockquote>
</blockquote>
<hr>
<p>objectB</p>
<blockquote>
<blockquote>
<p><em>Type:</em> <a href="https://www.railcomplete.com/docs/user-guide/lua/index.html#railwayobject"><strong>RailwayObject</strong></a>  </p>
<blockquote>
<p><em>The object to find the distance to</em></p>
</blockquote>
</blockquote>
</blockquote>
<h3 id="return-value">Return value</h3>
<p><em>Type:</em> <strong>Double</strong>      </p>
<blockquote>
<p><em>The distance between the objects. If a train can't navigate between the two objects, the returned value is NaN</em>   </p>
</blockquote>
<h3 id="examples">Examples</h3>
<p>This code shows prints the distances to nearby placed railway objects. Source object is signal Ds.101.</p>
<p><img alt="isObjectReachableByPath() example" src="./images/isReachableByPath.png"></p>
<p>The following code returns a text containing name and distance to nearby objects.</p>
<pre><code class="lua hljs"><span class="hljs-comment">-- Simple function that formats a number to show given number of decimals</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">stringFormat</span><span class="hljs-params">(number, decimals)</span></span>
    <span class="hljs-keyword">return</span> isnan(number) <span class="hljs-keyword">and</span> <span class="hljs-string">"NaN"</span>
    <span class="hljs-keyword">or</span> <span class="hljs-built_in">string</span>.format(<span class="hljs-string">"%."</span>..decimals..<span class="hljs-string">"f"</span>, number)
<span class="hljs-keyword">end</span>

<span class="hljs-comment">-- Function that returns a text containing name</span>
<span class="hljs-comment">-- and distance to objects in collection "objects"</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">printDistances</span><span class="hljs-params">(objects)</span></span>
    <span class="hljs-keyword">local</span> text = <span class="hljs-string">""</span>
    <span class="hljs-keyword">for</span> i = <span class="hljs-number">0</span>, objects.Count - <span class="hljs-number">1</span> <span class="hljs-keyword">do</span>
        distanceToObject = stringFormat(objects[i]:distance(), <span class="hljs-number">2</span>)
        text = text..<span class="hljs-string">"Distance to "</span>..objects[i].name..<span class="hljs-string">":  "</span>
        ..distanceToObject..<span class="hljs-string">"\n"</span>
    <span class="hljs-keyword">end</span>
    <span class="hljs-keyword">return</span> text
<span class="hljs-keyword">end</span>

<span class="hljs-keyword">return</span> printDistances(getNearbyPointObjects2D(<span class="hljs-number">100</span>))

<span class="hljs-comment">--[[ Output:
Distance to Ds.102:  NaN
Distance to V.1:  68.59
Distance to Rep.Hs.1024:  93.62
--]]</span>


</code></pre>
<div id="getblockname"></div>
<br><hr>
<h2>getBlockName()</h2>
<p><strong>Returns the name of the symbol block representing the object.</strong></p>
<h3 id="syntax_1">Syntax</h3>
<pre><code class="hljs stylus">String <span class="hljs-function"><span class="hljs-title">getBlockName</span><span class="hljs-params">(:RailwayObject object)</span></span>
</code></pre>

<h4 id="parameters_1">Parameters</h4>
<p>object <em>(optional)</em>  </p>
<blockquote>
<blockquote>
<p><em>Type:</em> <a href="https://www.railcomplete.com/docs/user-guide/lua/index.html#railwayobject"><strong>RailwayObject</strong></a><br>
<em>Default value:</em> source object</p>
<blockquote>
<p><em>The object that will return its block name.</em></p>
</blockquote>
</blockquote>
</blockquote>
<h4 id="return-value_1">Return value</h4>
<p><em>Type:</em> String  </p>
<blockquote>
<p><em>The name of the symbol block.</em></p>
</blockquote>
<h3 id="examples_1">Examples</h3>
<p>The source object is signal Hs.1024</p>
<p><img alt="getBlockName() example" src="./images/getBlockName.png"></p>
<p>The following code returns the block name of the source object.</p>
<pre><code class="lua hljs"><span class="hljs-comment">-- Get block name from source object</span>
getBlockName()

<span class="hljs-comment">-- output: NO-BN-2D-JBTSI-SIGNAL-20-HS3-DS</span>
</code></pre>

<hr>
<p>To get the block name of another object</p>
<pre><code class="lua hljs"><span class="hljs-comment">-- Get block name of axle counter. </span>
<span class="hljs-comment">-- Use relations to get axle counter object</span>
getBlockName(Relations[<span class="hljs-string">"Er signal for tellepunkt"</span>][<span class="hljs-number">0</span>])


<span class="hljs-comment">-- Can also be written</span>
Relations[<span class="hljs-string">"Er signal for tellepunkt"</span>][<span class="hljs-number">0</span>]:getBlockName()

<span class="hljs-comment">-- Both will return the following output: </span>
<span class="hljs-comment">-- NO-BN-2D-JBTSI-TOGDETEKSJON-TELLEPUNKT-SENSOR</span>
</code></pre>
<div id="getblockimage"></div>
<br><hr>
<h2>getBlockImage()</h2>
<p><strong>Returns a thumbnail image of the symbol block representing the object.</strong><br>
Image is default 190x120 pixels. The image is suitable for dark backgrounds. Image background is transparent.   </p>
<h3 id="syntax_2">Syntax</h3>
<pre><code class="hljs kotlin">ImageSource getBlockImage(
            :RailwayObject <span class="hljs-keyword">object</span>, 
            <span class="hljs-typename">Int</span> width, 
            <span class="hljs-typename">Boolean</span> crop, 
            <span class="hljs-typename">Boolean</span> useActualSymbol)
</code></pre>

<h4 id="parameters_2">Parameters</h4>
<p>object <em>(optional)</em>  </p>
<blockquote>
<blockquote>
<p><em>Type:</em> <a href="https://www.railcomplete.com/docs/user-guide/lua/index.html#railwayobject"><strong>RailwayObject</strong></a><br>
<em>Default value:</em> source object</p>
<blockquote>
<p><em>The object that will return its block image.</em></p>
</blockquote>
</blockquote>
</blockquote>
<hr>
<p>width <em>(optional)</em>  </p>
<blockquote>
<blockquote>
<p><em>Type:</em> <strong>Int</strong><br>
<em>Default value:</em> 190</p>
<blockquote>
<p><em>The pixel width of the block image. Height will scale uniformly when width is changed.</em></p>
</blockquote>
</blockquote>
</blockquote>
<hr>
<p>crop <em>(optional)</em>  </p>
<blockquote>
<blockquote>
<p><em>Type:</em> <strong>Boolean</strong><br>
<em>Default value:</em> <strong>false</strong></p>
<blockquote>
<p><em><strong>true</strong> to crop image, default value is <strong>false</strong></em></p>
</blockquote>
</blockquote>
</blockquote>
<hr>
<p>useActualSymbol <em>(optional)</em>  </p>
<blockquote>
<blockquote>
<p><em>Type:</em> <strong>Boolean</strong><br>
<em>Default value:</em> source object  </p>
<blockquote>
<p><em><strong>true</strong> to get thumbnail of the actual block in drawing with orientation (ignoring alignment tangent). <strong>false</strong> to use symbol block from symbol library</em></p>
</blockquote>
</blockquote>
</blockquote>
<h4 id="return-value_2">Return value</h4>
<p><em>Type:</em> ImageSource  </p>
<blockquote>
<p><em>Thumbnail image of symbol block.</em></p>
</blockquote>
<h3 id="examples_2">Examples</h3>
<p>The source object is switch V.2</p>
<p><img alt="getBlockName() example" src="./images/getBlockImage.png"></p>
<p>The following code returns a thumbnail image of the source object.</p>
<pre><code class="lua hljs"><span class="hljs-comment">-- Get image of the symbol block of the source object. </span>
getBlockImage()

<span class="hljs-comment">-- Will return the following output: </span>
<span class="hljs-comment">-- First image below</span>

<span class="hljs-comment">-- Get a cropped image of the actual block of the source object. </span>
getBlockImage(<span class="hljs-keyword">true</span>, <span class="hljs-keyword">true</span>)

<span class="hljs-comment">-- Will return the following output: </span>
<span class="hljs-comment">-- Second image below</span>
</code></pre>

<p><img alt="getInvertedBlockImage() example" src="./images/getblockimageresult1.png">
<img alt="getInvertedBlockImage() example" src="./images/getblockimageresult2.png"></p>
<hr>
<p>To get the block image of another block using <a href="https://www.railcomplete.com/docs/user-guide/lua/index.html#relations">relations</a> .</p>
<pre><code class="lua hljs"><span class="hljs-comment">-- Get smaller cropped image of the symbol block of the point machine. </span>
Relations[<span class="hljs-string">"Har sporvekseldrivmaskin"</span>][<span class="hljs-number">0</span>]:getBlockImage(<span class="hljs-keyword">true</span>)

<span class="hljs-comment">-- Will return the following output: </span>
<span class="hljs-comment">-- Image below</span>
</code></pre>

<p><img alt="getInvertedBlockImage() example" src="./images/getblockimageresult3.png"></p>
<div id="getinvertedblockimage"></div>
<br><hr>
<h2>getInvertedBlockImage()</h2>
<p><strong>Returns a thumbnail image of the symbol block representing the object.</strong><br>
Image is default 190x120 pixels. The image is suitable for light backgrounds. Image background is transparent.
Returns an inverted version of <a href="https://www.railcomplete.com/docs/user-guide/lua/index.html#getblockimage">getBlockImage()</a>.</p>
<h3 id="syntax_3">Syntax</h3>
<pre><code class="hljs kotlin">ImageSource getInvertedBlockImage(
            :RailwayObject <span class="hljs-keyword">object</span>, 
            <span class="hljs-typename">Int</span> width, 
            <span class="hljs-typename">Boolean</span> crop, 
            <span class="hljs-typename">Boolean</span> useActualSymbol)
</code></pre>

<h4 id="parameters_3">Parameters</h4>
<p>object <em>(optional)</em>  </p>
<blockquote>
<blockquote>
<p><em>Type:</em> <a href="https://www.railcomplete.com/docs/user-guide/lua/index.html#railwayobject"><strong>RailwayObject</strong></a><br>
<em>Default value:</em> source object</p>
<blockquote>
<p><em>The object that will return its block image.</em></p>
</blockquote>
</blockquote>
</blockquote>
<hr>
<p>width <em>(optional)</em>  </p>
<blockquote>
<blockquote>
<p><em>Type:</em> <strong>Int</strong><br>
<em>Default value:</em> 190</p>
<blockquote>
<p><em>The pixel width of the block image. Height will scale uniformly when width is changed.</em></p>
</blockquote>
</blockquote>
</blockquote>
<hr>
<p>crop <em>(optional)</em>  </p>
<blockquote>
<blockquote>
<p><em>Type:</em> <strong>Boolean</strong><br>
<em>Default value:</em> <strong>false</strong></p>
<blockquote>
<p><em><strong>true</strong> to crop image, default value is <strong>false</strong></em></p>
</blockquote>
</blockquote>
</blockquote>
<hr>
<p>useActualSymbol <em>(optional)</em>  </p>
<blockquote>
<blockquote>
<p><em>Type:</em> <strong>Boolean</strong><br>
<em>Default value:</em> source object  </p>
<blockquote>
<p><em><strong>true</strong> to get thumbnail of the actual block in drawing with orientation (ignoring alignment tangent). <strong>false</strong> to use symbol block from symbol library</em></p>
</blockquote>
</blockquote>
</blockquote>
<h4 id="return-value_3">Return value</h4>
<p><em>Type:</em> ImageSource  </p>
<blockquote>
<p><em>Thumbnail image of symbol block.</em></p>
</blockquote>
<h3 id="examples_3">Examples</h3>
<p>The source object is signal Hs.1024</p>
<p><img alt="getBlockName() example" src="./images/getBlockName.png"></p>
<p>The following code returns a thumbnail image of the source object.</p>
<pre><code class="lua hljs"><span class="hljs-comment">-- Get image of the symbol block of the source object. </span>
getInvertedBlockImage()

<span class="hljs-comment">-- Will return the following output: </span>
<span class="hljs-comment">-- First image below</span>

<span class="hljs-comment">-- Get a cropped image of the actual block of the source object. </span>
getInvertedBlockImage(<span class="hljs-keyword">true</span>, <span class="hljs-keyword">true</span>)

<span class="hljs-comment">-- Will return the following output: </span>
<span class="hljs-comment">-- Second image below</span>
</code></pre>

<p><img alt="getInvertedBlockImage() example" src="./images/getinvertedblockimageresult1.png">
<img alt="getInvertedBlockImage() example" src="./images/getinvertedblockimageresult2.png"></p>
<hr>
<p>To get the block image of another block.</p>
<pre><code class="lua hljs"><span class="hljs-comment">-- Get smaller cropped image (50 pixels width) of the symbol block of the axle counter. </span>
Relations[<span class="hljs-string">"Er signal for tellepunkt"</span>][<span class="hljs-number">0</span>]:getInvertedBlockImage(<span class="hljs-number">50</span>, <span class="hljs-keyword">true</span>)

<span class="hljs-comment">-- Will return the following output: </span>
<span class="hljs-comment">-- Image below</span>
</code></pre>

<p><img alt="getInvertedBlockImage() example" src="./images/getinvertedblockimageresult3.png"></p>
<div id="get3dblockimage"></div><hr /><br />
<h2>get3DBlockImage()</h2>
<p><strong>Returns a screen shot of the object's 3D symbol block.</strong><br>
Image is default 500*200 pixels. Image background is transparent.</p>
<h3 id="syntax_4">Syntax</h3>
<pre><code class="hljs kotlin">ImageSource get3DBlockImage(
            :RailwayObject <span class="hljs-keyword">object</span>, 
            <span class="hljs-typename">Int</span> viewDirection, 
            <span class="hljs-typename">Int</span> width, 
            <span class="hljs-typename">Boolean</span> crop, 
            String style)
</code></pre>

<h4 id="parameters_4">Parameters</h4>
<p>object <em>(optional)</em>  </p>
<blockquote>
<blockquote>
<p><em>Type:</em> <a href="https://www.railcomplete.com/docs/user-guide/lua/index.html#railwayobject"><strong>RailwayObject</strong></a><br>
<em>Default value:</em> source object</p>
<blockquote>
<p><em>The object that will return its 3D block image.</em></p>
</blockquote>
</blockquote>
</blockquote>
<hr>
<p>viewDirection <em>(optional)</em>  </p>
<blockquote>
<blockquote>
<p><em>Type:</em> <strong>Int</strong><br>
<em>Default value:</em> 1</p>
<blockquote>
<p><em>The direction from which the 3D block is view from. Imagine walking around the numpad looking at the objekt which is placed at key 5.</em><br>
<img alt="numpad example" src="./images/3dnumpad.png"></p>
</blockquote>
</blockquote>
</blockquote>
<hr>
<p>width <em>(optional)</em>  </p>
<blockquote>
<blockquote>
<p><em>Type:</em> <strong>Int</strong><br>
<em>Default value:</em> 500</p>
<blockquote>
<p><em>The pixel width of the block image. Height will scale uniformly when width is changed.</em></p>
</blockquote>
</blockquote>
</blockquote>
<hr>
<p>crop <em>(optional)</em>  </p>
<blockquote>
<blockquote>
<p><em>Type:</em> <strong>Boolean</strong><br>
<em>Default value:</em> <strong>false</strong>  </p>
<blockquote>
<p><em><strong>true</strong> to crop image, default value is <strong>false</strong></em></p>
</blockquote>
</blockquote>
</blockquote>
<hr>
<p>style <em>(optional)</em>  </p>
<blockquote>
<blockquote>
<p><em>Type:</em> <strong>String</strong><br>
<em>Default value:</em> "Realistic"  </p>
<blockquote>
<p><em>Visual style of the 3D block, AutoCAD style types are:</em><br>
        Flat, 
        FlatWithEdges, 
        Gouraud, 
        GouraudWithEdges, 
        Wireframe2D, 
        Wireframe3D, 
        Hidden, 
        Basic, 
        Realistic, 
        Conceptual, 
        Custom, 
        Dim, 
        Brighten, 
        Thicken, 
        LinePattern, 
        FacePattern, 
        ColorChange,
        FaceOnly, 
        EdgeOnly, 
        DisplayOnly, 
        JitterOff, 
        OverhangOff, 
        EdgeColorOff, 
        ShadesOfGray, 
        Sketchy, 
        XRay, 
        ShadedWithEdges, 
        Shaded, 
        EmptyStyle.</p>
</blockquote>
</blockquote>
</blockquote>
<h4 id="return-value_4">Return value</h4>
<p><em>Type:</em> ImageSource  </p>
<blockquote>
<p><em>Screen shot of the object's 3D symbol block.</em></p>
</blockquote>
<h3 id="examples_4">Examples</h3>
<p>The source object is speed sign 68A</p>
<p><img alt="getBlockName() example" src="./images/get3dimageex.png"></p>
<p>The following code returns a screen shot of the 3D symbol of the source object.</p>
<pre><code class="lua hljs"><span class="hljs-comment">-- Get screen shot of the 3D symbol of the source object. </span>
get3DBlockImage()

<span class="hljs-comment">-- Will return the following output: </span>
<span class="hljs-comment">-- First image below</span>

<span class="hljs-comment">-- Get a cropped image of the 3D symbol of the source object viewed from the front. </span>
get3DBlockImage(<span class="hljs-number">2</span>, <span class="hljs-keyword">true</span>)

<span class="hljs-comment">-- Will return the following output: </span>
<span class="hljs-comment">-- Second image below</span>
</code></pre>

<p><img alt="get3DBlockImage() result1" src="./images/3dimageresult1.png">  </p>
<h2 id="_1"><img alt="get3DBlockImage() result2" src="./images/3dimageresult2.png"></h2>
<p>To get a screen shot of another block using attachment.</p>
<pre><code class="lua hljs"><span class="hljs-comment">-- Get a screen shot (300 pixels width) of the 3D symbol </span>
<span class="hljs-comment">-- of the wall bracket with Conceptual view style. </span>
attachment:get3DBlockImage(<span class="hljs-keyword">true</span>, <span class="hljs-number">1</span>, <span class="hljs-number">300</span>, <span class="hljs-string">"Conceptual"</span>)

<span class="hljs-comment">-- Will return the following output: </span>
<span class="hljs-comment">-- Image below</span>
</code></pre>

<p><img alt="getInvertedBlockImage() example" src="./images/3dimageresult3.png"></p>
<div id="getobjectdescription"></div>
<hr /><br/>
<h2>getObjectDescription()</h2>
<p><strong>Returns a short description of the current object.</strong><br>
The description is the variant name of the given block specified in the object type definitions.   </p>
<h3 id="syntax_5">Syntax</h3>
<pre><code class="hljs stylus">String <span class="hljs-function"><span class="hljs-title">getObjectDescription</span><span class="hljs-params">(:RailwayObject object)</span></span>
</code></pre>

<h4 id="parameters_5">Parameters</h4>
<p>object <em>(optional)</em>  </p>
<blockquote>
<blockquote>
<p><em>Type:</em> <a href="https://www.railcomplete.com/docs/user-guide/lua/index.html#railwayobject"><strong>RailwayObject</strong></a><br>
<em>Default value:</em> source object</p>
<blockquote>
<p><em>The object that will return its variant name.</em></p>
</blockquote>
</blockquote>
</blockquote>
<h4 id="return-value_5">Return value</h4>
<p><em>Type:</em> String  </p>
<blockquote>
<p><em>the variant name of the given block specified in the object type definitions.</em></p>
</blockquote>
<h3 id="examples_5">Examples</h3>
<p>The source object is signal Hs.1024</p>
<p><img alt="getBlockName() example" src="./images/getBlockName.png"></p>
<p>The following code returns the variant name of source object.</p>
<pre><code class="lua hljs"><span class="hljs-comment">-- Getvariant name of the source object. </span>
getObjectDescription()

<span class="hljs-comment">-- Will return the following output: </span>
<span class="hljs-comment">-- 3-lys hovedsignal med dverg</span>

</code></pre>
<div id="getalignmentinfo"></div>
<hr /><br/>
<h2>getAlignmentInfo()</h2>
<p><strong>Returns alignment information at the position of the object</strong> <br>
Retrieve information such as: </p>
<ul>
<li>Elevation</li>
<li>Gradient</li>
<li>Curve radius</li>
<li>Cant</li>
</ul>
<h3 id="syntax_6">Syntax</h3>
<pre><code class="hljs stylus">AlignmentInfoValues <span class="hljs-function"><span class="hljs-title">getAlignmentInfo</span><span class="hljs-params">(:RailwayObject object, String alignmentID)</span></span>
</code></pre>

<h4 id="parameters_6">Parameters</h4>
<p>object <em>(optional)</em>  </p>
<blockquote>
<blockquote>
<p><em>Type:</em> <a href="https://www.railcomplete.com/docs/user-guide/lua/index.html#railwayobject"><strong>RailwayObject</strong></a><br>
<em>Default value:</em> source object</p>
<blockquote>
<p><em>The object whose position will will be used</em></p>
</blockquote>
</blockquote>
</blockquote>
<hr>
<p>alignmentID <em>(optional)</em>  </p>
<blockquote>
<blockquote>
<p><em>Type:</em> <strong>String</strong><br>
<em>Default value:</em> Source objects alignment ID</p>
<blockquote>
<p><em>The ID of the alignment to get information from</em></p>
</blockquote>
</blockquote>
</blockquote>
<h4 id="return-value_6">Return value</h4>
<p><em>Type:</em> <a href="https://www.railcomplete.com/docs/user-guide/lua/index.html#alignmentinfovalues"><strong>AlignmentInfoValues</strong></a>.   </p>
<blockquote>
<p><em>AlignmentInfoValues contains alignment information at a point in the alignment. The following information can be found in AlignmentInfoValues:</em>   </p>
</blockquote>
<ul>
<li><strong>Double</strong> DistanceToAlignment</li>
<li><strong>String</strong> AlignmentName</li>
<li><strong>Double</strong> Mileage</li>
<li><strong>Double</strong> Elevation</li>
<li><strong>Double</strong> Gradient</li>
<li><strong>Double</strong> CantDeficiency</li>
<li><strong>LandXML.clockwise</strong> CantRotation</li>
<li><strong>Double</strong> CurveRadius</li>
<li><strong>String</strong> CurveType</li>
<li><strong>LandXML.clockwise</strong> CurveRotation</li>
<li><strong>Double</strong> Cant</li>
</ul>
<h3 id="examples_6">Examples</h3>
<p>The source object is signal Ds.104</p>
<p><img alt="getBlockName() example" src="./images/alignmentInfoEx.png"></p>
<p>The following code returns a text containing various information about the source objects track and reference track.</p>
<pre><code class="lua hljs"><span class="hljs-comment">-- Simple function that formats a number to show given number of decimals</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">stringFormat</span><span class="hljs-params">(number, decimals)</span></span>
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">string</span>.format(<span class="hljs-string">"%."</span>..decimals..<span class="hljs-string">"f"</span>, number)
<span class="hljs-keyword">end</span>

<span class="hljs-comment">-- Function that takes an AlignmentInfoValues object and returns some of its information</span>
<span class="hljs-comment">-- as a string.</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getAlignmentInfoString</span><span class="hljs-params">(alignmentInfo)</span></span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">"Name: "</span>..alignmentInfo.AlignmentName..<span class="hljs-string">"\n"</span>.. 
            <span class="hljs-string">"Distance from track: "</span>.. stringFormat(alignmentInfo.DistanceToAlignment, <span class="hljs-number">2</span>)..<span class="hljs-string">"\n"</span> 
            ..<span class="hljs-string">"Elevation: "</span>..stringFormat(alignmentInfo.Elevation, <span class="hljs-number">2</span>)..<span class="hljs-string">"\n"</span>
            ..<span class="hljs-string">"Curve type: "</span>..alignmentInfo.CurveType..

            <span class="hljs-comment">-- Check if curve radius is infinite. If it is, don't diplay it.</span>
            (alignmentInfo.CurveRadius ~= <span class="hljs-built_in">math</span>.huge <span class="hljs-keyword">and</span> 
            <span class="hljs-string">"\nCurve radius: "</span>..stringFormat(alignmentInfo.CurveRadius, <span class="hljs-number">2</span>) <span class="hljs-keyword">or</span> <span class="hljs-string">""</span>)..<span class="hljs-string">"\n"</span>
            ..<span class="hljs-string">"Cant: "</span>..alignmentInfo.Cant
<span class="hljs-keyword">end</span>

<span class="hljs-comment">-- Get the alignment information for source objects track</span>
trackInfo = getAlignmentInfo()
<span class="hljs-comment">-- Get the alignment information for source objects reference track</span>
refTrackInfo = getAlignmentInfo(ReferenceAlignment.id)  

<span class="hljs-keyword">return</span> getAlignmentInfoString(trackInfo)..<span class="hljs-string">"\n\n"</span>..getAlignmentInfoString(refTrackInfo)

<span class="hljs-comment">--[[ 
Will return the output:

Name: ARNA-HP_SPOR 20-0
Distance from track: -3.50
Elevation: 0.00
Curve type: Straight
Cant: 0

Name: SP1-ULRIKKEN-1
Distance from track: 19.98
Elevation: 0.00
Curve type: clothoid
Curve radius: 1220.82
Cant: 30
--]]</span>
</code></pre>
<div id="getclosestalignments"></div>
<hr /><br/>
<h2>getClosestAlignments()</h2>
<p><strong>Returns alignments sorted by proximity</strong> <br>
Retrieve a collection of all alignments in the drawing. The first alignment in the collection will be the one closest to the object.</p>
<h3 id="syntax_7">Syntax</h3>
<pre><code class="hljs stylus">ObservableCollection&lt;RailwayObject&gt; <span class="hljs-function"><span class="hljs-title">getClosestAlignments</span><span class="hljs-params">(:RailwayObject object)</span></span>
</code></pre>

<h4 id="parameters_7">Parameters</h4>
<p>object <em>(optional)</em>  </p>
<blockquote>
<blockquote>
<p><em>Type:</em> <a href="https://www.railcomplete.com/docs/user-guide/lua/index.html#railwayobject"><strong>RailwayObject</strong></a><br>
<em>Default value:</em> source object</p>
<blockquote>
<p><em>The object that will use its position to determine the closest alignments</em></p>
</blockquote>
</blockquote>
</blockquote>
<h4 id="return-value_7">Return value</h4>
<p><em>Type:</em> <strong>ObservableCollection&lt;<a href="https://www.railcomplete.com/docs/user-guide/lua/index.html#railwayobject"><strong>RailwayObject</strong></a>&gt;</strong>  </p>
<blockquote>
<p><em>A collection of alignments sorted on proximity</em></p>
</blockquote>
<h3 id="examples_7">Examples</h3>
<p>The source object is signal Ds.104</p>
<p><img alt="getBlockName() example" src="./images/closestAlignmentsEx.png"></p>
<p>The following code returns a text containing various information about the source objects track and reference track.</p>
<pre><code class="lua hljs"><span class="hljs-comment">-- Simple function that formats a number to show given number of decimals</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">stringFormat</span><span class="hljs-params">(number, decimals)</span></span>
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">string</span>.format(<span class="hljs-string">"%."</span>..decimals..<span class="hljs-string">"f"</span>, number)
<span class="hljs-keyword">end</span>

<span class="hljs-comment">-- Function that iterates the first given number of closest alignments</span>
<span class="hljs-comment">-- and returns a string containing distance and name of those alignments.</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">closestAlignmentsInfo</span><span class="hljs-params">(closest, number)</span></span>
    number = number &lt; closest.Count <span class="hljs-keyword">and</span> number <span class="hljs-keyword">or</span> closest.Count
    infoString = <span class="hljs-string">"The "</span>..number..<span class="hljs-string">" closest alignments of "</span>..name..<span class="hljs-string">"\n"</span>
    <span class="hljs-keyword">for</span> i = <span class="hljs-number">0</span>, number - <span class="hljs-number">1</span> <span class="hljs-keyword">do</span>
        infoString = infoString.. <span class="hljs-string">"\nDistance: "</span>
        ..stringFormat(<span class="hljs-built_in">math</span>.abs(getAlignmentInfo(closest[i].id).Distance), <span class="hljs-number">2</span>)
        ..<span class="hljs-string">" "</span>..closest[i].Name
    <span class="hljs-keyword">end</span> 
    <span class="hljs-keyword">return</span> infoString
<span class="hljs-keyword">end</span>

<span class="hljs-keyword">return</span> closestAlignmentsInfo(getClosestAlignments(), <span class="hljs-number">4</span>)

<span class="hljs-comment">--[[ 
Output will be: 

The 4 closest alignments of Ds.104

Distance: 3.50  ARNA-HP_SPOR 20-0
Distance: 19.98 SP1-ULRIKKEN-1
Distance: 20.13 ARNA-HP_SPOR 2-0
Distance: 24.83 SP3-ULRIKKEN
--]]</span>

</code></pre>
<div id="getnearbypointobjects2d"></div>
<hr /><br/>
<h2>getNearbyPointObjects2D()</h2>
<p><strong>Returns point objects closer than a given distance of the object.</strong> <br>
Objects are sorted by proximity and will not include the source object. Distance between objects are measured using all objects positions projected to the XY-Plane.</p>
<h3 id="syntax_8">Syntax</h3>
<pre><code class="hljs scala"><span class="hljs-type">ObservableCollection</span>&lt;<span class="hljs-type">RailwayObject</span>&gt; getNearbyPointObjects2D(
                                        :<span class="hljs-type">RailwayObject</span> <span class="hljs-class"><span class="hljs-keyword">object</span>, 
</span>                                        <span class="hljs-type">Double</span> distance, 
                                        <span class="hljs-type">String</span> <span class="hljs-class"><span class="hljs-keyword">type</span>)
</span></code></pre>

<h4 id="parameters_8">Parameters</h4>
<p>object <em>(optional)</em>  </p>
<blockquote>
<blockquote>
<p><em>Type:</em> <a href="https://www.railcomplete.com/docs/user-guide/lua/index.html#railwayobject"><strong>RailwayObject</strong></a><br>
<em>Default value:</em> source object</p>
<blockquote>
<p><em>The object whose nearby objects will be returned</em></p>
</blockquote>
</blockquote>
</blockquote>
<hr>
<p>distance</p>
<blockquote>
<blockquote>
<p><em>Type:</em> <strong>Double</strong>  </p>
<blockquote>
<p><em>The distance from the source object to return objects</em>
<img alt="getNearbyPointObjects2D() distance" src="./images/nearby2ddistance.png"></p>
</blockquote>
</blockquote>
</blockquote>
<hr>
<p>type <em>(optional)</em>  </p>
<blockquote>
<blockquote>
<p><em>Type:</em> <strong>String</strong><br>
<em>Default value:</em> ""</p>
<blockquote>
<p><em>If specified, only return objects of the given object type</em></p>
</blockquote>
</blockquote>
</blockquote>
<h4 id="return-value_8">Return value</h4>
<p><em>Type:</em> <strong>ObservableCollection&lt;<a href="https://www.railcomplete.com/docs/user-guide/lua/index.html#railwayobject"><strong>RailwayObject</strong></a>&gt;</strong>  </p>
<blockquote>
<p><em>A collection of nearby objects sorted by proximity</em></p>
</blockquote>
<h3 id="examples_8">Examples</h3>
<p>The source object is balise Balise 3</p>
<p><img alt="getNearbyPointObjects2D() example" src="./images/nearby2dex.png"></p>
<p>The following code returns the closest switchable balise inside a radius of 100 meters using <a href="https://www.railcomplete.com/docs/user-guide/lua/index.html#filter">filter()</a>.</p>
<pre><code class="lua hljs"><span class="hljs-comment">--Get balises inside a radius of 100</span>
nearby = getNearbyPointObjects2D(<span class="hljs-number">100</span>, <span class="hljs-string">"SA-ATB Balise"</span>)

<span class="hljs-keyword">return</span> nearby:filter(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(x)</span></span> <span class="hljs-keyword">return</span> x.Switchable <span class="hljs-keyword">end</span>)[<span class="hljs-number">0</span>].Name

<span class="hljs-comment">-- Output: Balise 3</span>

</code></pre>
<div id="getnearbypointobjects3d></div>
<hr /><br />
<h2">getNearbyPointObjects3D()</h2>
<p><strong>Returns point objects closer than a given distance of the object.</strong> <br>
Objects are sorted by proximity. This function includes difference in Z-values when locating nearby point objects</p>
<p>This function uses the same syntax as <a href="https://www.railcomplete.com/docs/user-guide/lua/index.html#getnearbypointobjects2d">getNearbyPointObjects2D()</a>.</p>
<div id="getfoulingpoints"></div>
<hr /><br/>
<h2>getFoulingPoints()</h2>
<p><strong>Calculates the fouling points for switch objects</strong></p>
<h3 id="syntax_9">Syntax</h3>
<pre><code class="hljs stylus">ObservableCollection&lt;FoulingPointResult&gt; <span class="hljs-function"><span class="hljs-title">getFoulingPoints</span><span class="hljs-params">(:RailwayObject switchObject)</span></span>
</code></pre>

<h4 id="parameters_9">Parameters</h4>
<p>switchObject <em>(optional)</em>  </p>
<blockquote>
<blockquote>
<p><em>Type:</em> <a href="https://www.railcomplete.com/docs/user-guide/lua/index.html#railwayobject"><strong>RailwayObject</strong></a><br>
<em>Default value:</em> source object</p>
<blockquote>
<p><em>The switch whose fouling points will be returned</em></p>
</blockquote>
</blockquote>
</blockquote>
<h4 id="return-value_9">Return value</h4>
<p><em>Type:</em> <strong>ObservableCollection&lt;<a href="https://www.railcomplete.com/docs/user-guide/lua/index.html#foulingpointresult"><strong>FoulingPointResult</strong></a>&gt;</strong>  </p>
<blockquote>
<p><em>A collection of fouling points.</em></p>
</blockquote>
<h3 id="examples_9">Examples</h3>
<p>The source object is switch V.1</p>
<p><img alt="getFoulingPoints() example" src="./images/getFoulingPoints.png"></p>
<p>The following code will return text with fouling point information.</p>
<pre><code class="lua hljs"><span class="hljs-comment">-- Simple function that formats a number to show given number of decimals</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">stringFormat</span><span class="hljs-params">(number, decimals)</span></span>
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">string</span>.format(<span class="hljs-string">"%."</span>..decimals..<span class="hljs-string">"f"</span>, number)
<span class="hljs-keyword">end</span>

<span class="hljs-comment">-- Function that return fouling point information from a list</span>
<span class="hljs-comment">-- of fouling points.</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fpInfo</span> <span class="hljs-params">(foulingPoints)</span></span>
    text = <span class="hljs-string">""</span>
    <span class="hljs-keyword">for</span> i = <span class="hljs-number">0</span>, foulingPoints.count - <span class="hljs-number">1</span> <span class="hljs-keyword">do</span>
        fp = foulingPoints[i]
        trunkTrack = fp.Trunk
        branchTrack = fp.Branch
        text = text..<span class="hljs-string">"\nFouling distance: "</span>..stringFormat(fp.FoulingDistance,<span class="hljs-number">2</span>)..<span class="hljs-string">"\n"</span>
        ..<span class="hljs-string">" Trunk track:    "</span>..trunkTrack.AlignmentRef.Name..<span class="hljs-string">"\n"</span>
        ..<span class="hljs-string">" Mileage:        "</span>..stringFormat(trunkTrack.Mileage,<span class="hljs-number">2</span>)..<span class="hljs-string">"\n"</span>
        ..<span class="hljs-string">" Branch track:   "</span>..branchTrack.AlignmentRef.Name..<span class="hljs-string">"\n"</span>
        ..<span class="hljs-string">" Mileage:        "</span>..stringFormat(branchTrack.Mileage,<span class="hljs-number">2</span>)..<span class="hljs-string">"\n"</span>
    <span class="hljs-keyword">end</span>
    <span class="hljs-keyword">return</span> text
<span class="hljs-keyword">end</span>

<span class="hljs-keyword">return</span> fpInfo(getFoulingPoints())

<span class="hljs-comment">--[[
Will produce the following output

Fouling distance: 4.00
    Trunk track:    ARNA-HP_SPOR 6-1
    Mileage:        462055.16
    Branch track:   ARNA-HP_SPOR 4
    Mileage:        462053.16

Fouling distance: 4.13
    Trunk track:    ARNA-HP_SPOR 5
    Mileage:        462051.52
    Branch track:   ARNA-HP_SPOR 4
    Mileage:        462051.08
--]]</span>

</code></pre>
<div id="getobjectfromid"></div>
<hr /><br/>
<h2>getObjectFromId()</h2>
<p><strong>Get railway object using id</strong></p>
<h3 id="syntax_10">Syntax</h3>
<pre><code class="hljs stylus">RailwayObject <span class="hljs-function"><span class="hljs-title">getObjectFromId</span><span class="hljs-params">(String id)</span></span>
</code></pre>

<h4 id="parameters_10">Parameters</h4>
<p>id </p>
<blockquote>
<blockquote>
<p><em>Type:</em> <strong>String</strong>  </p>
<blockquote>
<p><em>The id of the object that will be returned</em></p>
</blockquote>
</blockquote>
</blockquote>
<h4 id="return-value_10">Return value</h4>
<p><em>Type:</em> <a href="https://www.railcomplete.com/docs/user-guide/lua/index.html#railwayobject"><strong>RailwayObject</strong></a>  </p>
<blockquote>
<p><em>A railway object</em></p>
</blockquote>
<h3 id="examples_10">Examples</h3>
<p>This code demonstrates how to retrieve a railway object from an id</p>
<pre><code class="lua hljs">getObjectFromId(<span class="hljs-string">"86a09ad7-a949-4bcc-a951-ac52815f5c0d"</span>).id

<span class="hljs-comment">--Output will be: 86a09ad7-a949-4bcc-a951-ac52815f5c0d</span>

</code></pre>
<div id="getcollectionlength"></div><hr /><br />
<h2>getCollectionLength()</h2>
<p><strong>Returns the length of a collection</strong>
If the collection is null, 0 will be returned.</p>
<h3 id="syntax_11">Syntax</h3>
<pre><code class="hljs stylus">Int <span class="hljs-function"><span class="hljs-title">getCollectionLength</span><span class="hljs-params">(:Collection collection)</span></span>
</code></pre>

<h4 id="parameters_11">Parameters</h4>
<p>collection   </p>
<blockquote>
<blockquote>
<p><em>Type:</em> <strong>Collection</strong>  </p>
<blockquote>
<p><em>A collection of any object</em></p>
</blockquote>
</blockquote>
</blockquote>
<h4 id="return-value_11">Return value</h4>
<p><em>Type:</em> <strong>Int</strong>  </p>
<blockquote>
<p><em>The length of the collection</em></p>
</blockquote>
<h3 id="examples_11">Examples</h3>
<p>This code demonstrates how to get the length of a collection. Source object is balise Balise3</p>
<p><img alt="getCollectionLength() example" src="./images/getCollectionLength.png"></p>
<pre><code class="lua hljs"><span class="hljs-comment">-- Get the number of objects inside a 50 meter radius</span>
getNearbyPointObjects2D(<span class="hljs-number">50</span>):getCollectionLength()

<span class="hljs-comment">--Output will be: 4</span>

</code></pre>
<div id="filter"></div>
<hr /><br/>
<h2>filter()</h2>
<p><strong>Filters a collection with a given function.</strong> <br>
Returns a new collection of objects that all returned <strong>true</strong> in the given function.</p>
<h3 id="syntax_12">Syntax</h3>
<pre><code class="hljs elixir"><span class="hljs-constant">Collection&lt;Object&gt;</span> filter(
                    <span class="hljs-symbol">:Collection&lt;Object&gt;</span> collection, 
                    <span class="hljs-constant">LuaFunction </span>function, 
                    <span class="hljs-constant">Object </span>functionParameter ..)
</code></pre>

<h4 id="parameters_12">Parameters</h4>
<p>collection   </p>
<blockquote>
<blockquote>
<p><em>Type:</em> <strong>Collection&lt;Object&gt;</strong>       </p>
<blockquote>
<p><em>A collection of any object</em>   </p>
</blockquote>
</blockquote>
</blockquote>
<hr>
<p>function</p>
<blockquote>
<blockquote>
<p><em>Type:</em> <strong>LuaFunction</strong>  </p>
<blockquote>
<p><em>The function that filters the objects in the collection. the filter function must return true for an object to pass.</em></p>
</blockquote>
</blockquote>
</blockquote>
<hr>
<p>functionParameter  <em>(optional)</em>  </p>
<blockquote>
<blockquote>
<p><em>Type:</em> <strong>Object</strong>
<em>Default value:</em> nil</p>
<blockquote>
<p><em>Parameters for the filter function. 0 - infinite parameters can be included</em></p>
</blockquote>
</blockquote>
</blockquote>
<h4 id="return-value_12">Return value</h4>
<p><em>Type:</em> <strong>Collection&lt;Object&gt;</strong>      </p>
<blockquote>
<p><em>A new collection of objects that satisfy the conditions in the filter function</em>   </p>
</blockquote>
<h3 id="examples_12">Examples</h3>
<p>This code shows how filter can be used to find the intersection of two collections. Source object is balise Balise3</p>
<p><img alt="getCollectionLength() example" src="./images/getCollectionLength.png"></p>
<p>The following code returns a text containing various information about the source objects track and reference track.</p>
<pre><code class="lua hljs"><span class="hljs-comment">-- Function that returns text containing the names of</span>
<span class="hljs-comment">-- railway objects in a collection.</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">printItemsInList</span><span class="hljs-params">(list)</span></span>
    text = <span class="hljs-string">""</span>
    <span class="hljs-keyword">for</span> i = <span class="hljs-number">0</span>, list.Count - <span class="hljs-number">1</span> <span class="hljs-keyword">do</span>
        text = text..list[i].Name..<span class="hljs-string">"\n"</span>
    <span class="hljs-keyword">end</span> 
    <span class="hljs-keyword">return</span> text
<span class="hljs-keyword">end</span>

<span class="hljs-comment">-- Function that checks if railway object "x" is in collection "list"</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">contains</span><span class="hljs-params">(x, list)</span></span>
    <span class="hljs-keyword">for</span> i = <span class="hljs-number">0</span>, list.Count - <span class="hljs-number">1</span> <span class="hljs-keyword">do</span>
        <span class="hljs-keyword">if</span> x.id == list[i].id <span class="hljs-keyword">then</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>
        <span class="hljs-keyword">end</span>
    <span class="hljs-keyword">end</span> 
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>
<span class="hljs-keyword">end</span>

<span class="hljs-comment">-- Get objects inside a 50 meter radius</span>
nearby = getNearbyPointObjects2D(<span class="hljs-number">50</span>)

<span class="hljs-comment">-- Get balise objects inside a 50 meter radius</span>
nearbyBalises = getNearbyPointObjects2D(<span class="hljs-number">50</span>, <span class="hljs-string">"SA-ATB Balise"</span>)

<span class="hljs-comment">-- print the intersection of the two collections.</span>
<span class="hljs-keyword">return</span> printItemsInList(nearby:filter(contains, nearbyBalises))

<span class="hljs-comment">--[[
Will return output

Balise 2
Balise 1

--]]</span>

</code></pre>
<div id="isobjectreachablebypath"></div>
<hr /><br/>
<h2>isObjectReachableByPath()</h2>
<p><strong>Checks if a given object is reachable from the inspected object by a path.</strong> <br>
Returns <strong>true</strong> if a train can navigate between the two objects object A and object B.</p>
<h3 id="syntax_13">Syntax</h3>
<pre><code class="hljs stylus">Boolean <span class="hljs-function"><span class="hljs-title">isObjectReachableByPath</span><span class="hljs-params">(:RailwayObject objectA, RailwayObject objectB)</span></span>
</code></pre>

<h4 id="parameters_13">Parameters</h4>
<p>objectA <em>(optional)</em>  </p>
<blockquote>
<blockquote>
<p><em>Type:</em> <a href="https://www.railcomplete.com/docs/user-guide/lua/index.html#railwayobject"><strong>RailwayObject</strong></a><br>
<em>Default value:</em> source object</p>
<blockquote>
<p><em>The object that represent the start of the path</em></p>
</blockquote>
</blockquote>
</blockquote>
<hr>
<p>objectB</p>
<blockquote>
<blockquote>
<p><em>Type:</em> <a href="https://www.railcomplete.com/docs/user-guide/lua/index.html#railwayobject"><strong>RailwayObject</strong></a>  </p>
<blockquote>
<p><em>The object that represent the end of the path</em></p>
</blockquote>
</blockquote>
</blockquote>
<h4 id="return-value_13">Return value</h4>
<p><em>Type:</em> <strong>Boolean</strong>      </p>
<blockquote>
<p><em><strong>true</strong> if there exist a valid pathe between object A and object B. Otherwise <strong>false</strong></em>   </p>
</blockquote>
<h3 id="examples_13">Examples</h3>
<p>This code shows how to check if railway objects can be reached by a path. Source object is signal Ds.101.</p>
<p><img alt="isObjectReachableByPath() example" src="./images/isReachableByPath.png"></p>
<p>The following code returns a text containing various information about the source objects track and reference track.</p>
<pre><code class="lua hljs"><span class="hljs-comment">-- Function that returns text containing the names of</span>
<span class="hljs-comment">-- railway objects in a collection.</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">printItemsInList</span><span class="hljs-params">(list)</span></span>
    text = <span class="hljs-string">""</span>
    <span class="hljs-keyword">for</span> i = <span class="hljs-number">0</span>, list.Count - <span class="hljs-number">1</span> <span class="hljs-keyword">do</span>
        text = text..list[i].Name..<span class="hljs-string">"\n"</span>
    <span class="hljs-keyword">end</span> 
    <span class="hljs-keyword">return</span> text
<span class="hljs-keyword">end</span>

<span class="hljs-comment">-- Get nearby signals</span>
nearbySignals = getNearbyPointObjects2D(<span class="hljs-number">150</span>, <span class="hljs-string">"SA-SIG Signal"</span>)

<span class="hljs-comment">-- Get nearby signals reachable by path</span>
nearbyReachableSignals = 
nearbySignals:filter(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(x)</span></span> <span class="hljs-keyword">return</span> isObjectReachableByPath(x) <span class="hljs-keyword">end</span>)


<span class="hljs-keyword">return</span> <span class="hljs-string">"Nearby signals:\n"</span>..printItemsInList(nearbySignals)..
        <span class="hljs-string">"\nNearby signals reachable by path:\n"</span>..
        printItemsInList(nearbyReachableSignals)

<span class="hljs-comment">--[[
Output:

Nearby signals:
Ds.102
Rep.Hs.1024

Nearby signals reachable by path:
Rep.Hs.1024
--]]</span>

</code></pre>
<div id="getupobject"></div>
<hr /><br/>
<h2>getUpObject()</h2>
<p><strong>Gets the next object on the alignment in the up direction.</strong> <br>
If an object type is specified, returns the next object of that type.</p>
<h3 id="syntax_14">Syntax</h3>
<pre><code class="hljs delphi">RailwayObject getUpObject(:RailwayObject <span class="hljs-keyword">object</span>, <span class="hljs-keyword">String</span> <span class="hljs-keyword">type</span>)
</code></pre>

<h4 id="parameters_14">Parameters</h4>
<p>object <em>(optional)</em>  </p>
<blockquote>
<blockquote>
<p><em>Type:</em> <a href="https://www.railcomplete.com/docs/user-guide/lua/index.html#railwayobject"><strong>RailwayObject</strong></a><br>
<em>Default value:</em> source object</p>
<blockquote>
<p><em>The object to get up object from</em></p>
</blockquote>
</blockquote>
</blockquote>
<hr>
<p>type <em>(optional)</em>  </p>
<blockquote>
<blockquote>
<p><em>Type:</em> <strong>String</strong><br>
<em>Default value:</em> ""</p>
<blockquote>
<p><em>If type is specified the next object in up direction of that type is returned</em></p>
</blockquote>
</blockquote>
</blockquote>
<h4 id="return-value_14">Return value</h4>
<p><em>Type:</em> <a href="https://www.railcomplete.com/docs/user-guide/lua/index.html#railwayobject"><strong>RailwayObject</strong></a>      </p>
<blockquote>
<p><em>The next object on the alignment in the up direction</em>   </p>
</blockquote>
<h3 id="examples_14">Examples</h3>
<p>This code shows a balise model check formula. The code checks the distance to the next balise and returns a message along with a <a href="https://www.railcomplete.com/docs/user-guide/lua/index.html#symbol"><em>symbol</em></a>.</p>
<p><img alt="getUpObject() example" src="./images/getupobject.png"></p>
<p>The following code returns a text containing various information about the source objects track and reference track.</p>
<pre><code class="lua hljs"><span class="hljs-comment">-- Get next balise</span>
nextBalise = getUpObject(<span class="hljs-string">"SA-ATB Balise"</span>)
<span class="hljs-keyword">if</span> (nextBalise == <span class="hljs-keyword">nil</span>) <span class="hljs-keyword">then</span> 
    <span class="hljs-keyword">return</span> <span class="hljs-string">"Ingen baliser i kjørbar forbindelse i stigende km"</span>, _ok 
<span class="hljs-keyword">end</span>

<span class="hljs-comment">-- Get distance to next balise</span>
dist = distance(nextBalise)
distOut = <span class="hljs-built_in">string</span>.format(<span class="hljs-string">"%.3f"</span>, dist)

<span class="hljs-comment">-- Check distance up against rules to return correct message</span>
<span class="hljs-keyword">if</span> (dist &lt; <span class="hljs-number">2.35</span> ) <span class="hljs-keyword">then</span>
    <span class="hljs-keyword">return</span> distOut..
    <span class="hljs-string">": Ugyldig, balisenes magnetfelt kan flyte sammen – øk avstand"</span>, _error
<span class="hljs-keyword">elseif</span> (dist &gt;= <span class="hljs-number">2.35</span> <span class="hljs-keyword">and</span> dist &lt; <span class="hljs-number">2.8</span>) <span class="hljs-keyword">then</span>
    <span class="hljs-keyword">return</span> distOut..
    <span class="hljs-string">": Tillatt, men utenfor anbefalt byggetoleranse – øk avstand"</span>, _warning
<span class="hljs-keyword">elseif</span> (dist &gt;= <span class="hljs-number">2.8</span> <span class="hljs-keyword">and</span> dist &lt; <span class="hljs-number">3.2</span>) <span class="hljs-keyword">then</span>
    <span class="hljs-keyword">return</span> distOut..
    <span class="hljs-string">": OK – toget vil med god margin plassere balisene i samme gruppe"</span>, _ok
<span class="hljs-keyword">elseif</span> (dist &gt;= <span class="hljs-number">3.2</span> <span class="hljs-keyword">and</span> dist &lt; <span class="hljs-number">3.5</span>) <span class="hljs-keyword">then</span>
    <span class="hljs-keyword">return</span> distOut..
    <span class="hljs-string">": Tillatt, men utenfor anbefalt byggetoleranse – senk avstand"</span>, _warning
<span class="hljs-keyword">elseif</span> (dist &gt;= <span class="hljs-number">3.5</span> <span class="hljs-keyword">and</span> dist &lt; <span class="hljs-number">10.5</span>) <span class="hljs-keyword">then</span>
    <span class="hljs-keyword">return</span> distOut..
    <span class="hljs-string">": Ugyldig – toget kan ikke entydig avgjøre balisenes gruppetilhørighet"</span>, _error
<span class="hljs-keyword">elseif</span> (dist &gt;= <span class="hljs-number">10.5</span> <span class="hljs-keyword">and</span> dist &lt; <span class="hljs-number">11.8</span>) <span class="hljs-keyword">then</span>
    <span class="hljs-keyword">return</span> distOut..
    <span class="hljs-string">": Tillatt, men utenfor anbefalt byggetoleranse – øk avstand"</span>, _warning
<span class="hljs-keyword">elseif</span> (dist &gt; <span class="hljs-number">11.8</span>) <span class="hljs-keyword">then</span>
    <span class="hljs-keyword">return</span> distOut..
    <span class="hljs-string">": OK – toget vil med god margin plassere balisene i ulike grupper"</span>, _ok
<span class="hljs-keyword">else</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">"Feil i beregning av avstand"</span>, _warning
<span class="hljs-keyword">end</span>

<span class="hljs-comment">--[[ Output will be:
(Error) 5.679: Ugyldig – toget kan ikke entydig avgjøre balisenes gruppetilhørighet
--]]</span>

</code></pre>
<div id="getdownobject"></div><hr /><br />
<h2>getDownObject()</h2>
<p><strong>Gets the next object on the alignment in the down direction.</strong> <br>
    If an object type is specified, returns the next object of that type. <br>
    For more information see <a href="https://www.railcomplete.com/docs/user-guide/lua/index.html#getupobject"><em>getUpObject()</em></a>.</p>
<div id="getpropertyvalue"></div>
<hr /><br/>
<h2>getPropertyValue()</h2>
<p><strong>Gets the value of a property without evaluating formula in property</strong></p>
<h3 id="syntax_15">Syntax</h3>
<pre><code class="hljs delphi"><span class="hljs-keyword">Object</span> getPropertyValue(:RailwayObject <span class="hljs-keyword">object</span>, <span class="hljs-keyword">String</span> <span class="hljs-keyword">property</span>)
</code></pre>

<h4 id="parameters_15">Parameters</h4>
<p>object <em>(optional)</em>  </p>
<blockquote>
<blockquote>
<p><em>Type:</em> <a href="https://www.railcomplete.com/docs/user-guide/lua/index.html#railwayobject"><strong>RailwayObject</strong></a><br>
<em>Default value:</em> source object</p>
<blockquote>
<p><em>The object to get property value from</em></p>
</blockquote>
</blockquote>
</blockquote>
<hr>
<p>property</p>
<blockquote>
<blockquote>
<p><em>Type:</em> <strong>String</strong>   </p>
<blockquote>
<p><em>The name of the property to get value from</em></p>
</blockquote>
</blockquote>
</blockquote>
<h4 id="return-value_15">Return value</h4>
<p><em>Type:</em> <strong>Object</strong>      </p>
<blockquote>
<p><em>The value of the property</em>   </p>
</blockquote>
<h3 id="examples_15">Examples</h3>
<p>Normally when getting a property value, if the value is evaluated from a formula, this formula is evaluated to give the most up to date result.
This code shows how to get the value of a property without evaluating the formula the property value is evaluated from. </p>
<p><img alt="getPropertyValue() example" src="./images/getPropertyValue.png"></p>
<pre><code class="lua hljs"><span class="hljs-comment">-- Get the value of the attachments property "name"</span>
Attachment:getPropertyValue(<span class="hljs-string">"name"</span>)

<span class="hljs-comment">-- Output is: Ø60/vegg</span>

</code></pre>
<div id="getzeros"></div><hr /><br/>
<h2>getZeros()</h2>
<p><strong>Returns a list of zeros of a user specified function of one variable.</strong>  </p>
<h3 id="syntax_16">Syntax</h3>
<pre><code class="hljs scss">List&lt;<span class="hljs-value">double</span>&gt; <span class="hljs-function">getZeros</span>(
                LuaFunction formula, 
                {LuaTable interval, 
                <span class="hljs-value">Double</span> tolerance, 
                <span class="hljs-value">Double</span> decimals, 
                <span class="hljs-value">Double</span> timeLimit, 
                <span class="hljs-value">Double</span> rootDistance})
</code></pre>

<h4 id="parameters_16">Parameters</h4>
<p>formula</p>
<blockquote>
<blockquote>
<p><em>Type:</em> <a href="https://www.railcomplete.com/docs/user-guide/lua/index.html#luafunction"><strong>LuaFunction</strong></a>  </p>
<blockquote>
<p><em>The function to find zeros in</em></p>
</blockquote>
</blockquote>
</blockquote>
<hr>
<p>interval <em>(optional)</em>  </p>
<blockquote>
<blockquote>
<p><em>Type:</em> <strong><a href="https://www.railcomplete.com/docs/user-guide/lua/index.html#luatable"><strong>LuaTable</strong></a></strong><br>
<em>Default value:</em> {-10,10}</p>
<blockquote>
<p><em>The interval in which to search for zeros</em></p>
</blockquote>
</blockquote>
</blockquote>
<hr>
<p>tolerance <em>(optional)</em>  </p>
<blockquote>
<blockquote>
<p><em>Type:</em> <strong>Double</strong><br>
<em>Default value:</em> 0.0001</p>
<blockquote>
<p><em>Tolerance of zeros to be returned. <strong>F(x) &lt; tolerance</strong></em></p>
</blockquote>
</blockquote>
</blockquote>
<hr>
<p>decimals <em>(optional)</em>  </p>
<blockquote>
<blockquote>
<p><em>Type:</em> <strong>Double</strong><br>
<em>Default value:</em> Given by tolerance. The lower tolerance the more decimals. </p>
<blockquote>
<p><em>Specifies rounding of the answers</em></p>
</blockquote>
</blockquote>
</blockquote>
<hr>
<p>timeLimit <em>(optional)</em>  <em><strong>Obsolete</strong></em></p>
<blockquote>
<blockquote>
<p><em>Type:</em> <strong>Double</strong><br>
<em>Default value:</em> 10</p>
<blockquote>
<p><em>Time in seconds before the function times out.</em></p>
</blockquote>
</blockquote>
</blockquote>
<hr>
<p>rootDistance <em>(optional)</em>  </p>
<blockquote>
<blockquote>
<p><em>Type:</em> <strong>Double</strong><br>
<em>Default value:</em> interval length divided by 10</p>
<blockquote>
<p><em>Expected distance between zeros.</em></p>
</blockquote>
</blockquote>
</blockquote>
<h4 id="return-value_16">Return value</h4>
<p><em>Type:</em> List&lt;<strong>Double</strong>&gt;  </p>
<blockquote>
<p><em>List of identified zeros of the input function.</em></p>
</blockquote>
<h3 id="examples_16">Examples</h3>
<p>Find zeros of "a<em>x^2 + b</em>x + c", where a = 1, b = 0, c = -2. 
The following code returns a list of zeros of the above expression.</p>
<pre><code class="lua hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">myFunction</span><span class="hljs-params">(x)</span></span>
    <span class="hljs-keyword">local</span> a = <span class="hljs-number">1</span>
    <span class="hljs-keyword">local</span> b = <span class="hljs-number">0</span>
    <span class="hljs-keyword">local</span> c = -<span class="hljs-number">2</span>
    <span class="hljs-keyword">return</span> a*x^<span class="hljs-number">2</span> + b*x + c
<span class="hljs-keyword">end</span>

<span class="hljs-keyword">return</span> getZeros(myFunction, {tolerance = <span class="hljs-number">0.000001</span>, interval = {-<span class="hljs-number">5</span>,<span class="hljs-number">5</span>}})
<span class="hljs-comment">-- Will return the following output: </span>
<span class="hljs-comment">-- Collection(2){-1.414214, 1.414214}</span>

</code></pre>

<h2 id="railcomplete-classes">RailCOMPLETE classes</h2>
<h2 id="railwayobject">RailwayObject</h2>
<h2 id="relations">Relations</h2>
<h2 id="alignmentinfovalues">AlignmentInfoValues</h2>
<h2 id="foulingpointresult">FoulingPointResult</h2>
<h2 id="symbol">Symbol</h2>
<h2 id="luatable">LuaTable</h2>
<h2 id="luafunction">LuaFunction</h2>
<h2 id="lua-tips-and-tricks">Lua Tips and Tricks</h2>
<h2 id="display-name-vs-property">Display Name VS Property</h2>
<p>Some properties also have a display name. As shown below, the Model3DName property has a property display name 3D Model Name (in the properties window). </p>
<p><img alt="Lua DisplayName" src="./images/lua_displayname.png"></p>
<p>The value for Model3DName can also be found using the fromDisplayName function.</p>
<pre><code class="lua hljs"><span class="hljs-comment">-- Using fromDisplayName to get Model3DName.</span>
fromDisplayName(<span class="hljs-string">"3D Model Name"</span>)
</code></pre>

<p><img alt="Lua fromDisplayName" src="./images/fromDisplayName.png"></p>
              
            </div>

        <footer>
            <p>© 2018 - Railcomplete AS</p>
        </footer>
    </div>
</body></html>

